function getHighchartsTypes(){Highcharts.getOptions&&_.each(Highcharts.getOptions().plotOptions,function(t,e){IFB.Constants.Highcharts.ChartTypes[e]=e})}function HB_F(){IFB.Services.Streaming.CONNECTION.isAlive=!0}function ChangeGMT_F(){}function Connected_F(){IFB.Services.StreamingCallbacks.connected()}function END_F(){}function Notify_F(){}function Notificacion_F(){}function LOGOUT_F(){console.log("LOGOUT_F"),IFB.Services.StreamingCallbacks.logout(),this.isLogout=!0}function cargaInicial(t,e){IFB.Services.Streaming.CONNECTION.isAlive=!0,IFB.Services.StreamingCallbacks.realTime(t,e)}function callback(t,e){IFB.Services.Streaming.CONNECTION.isAlive=!0,IFB.Services.StreamingCallbacks.realTime(t,e)}function Alerta_F(t,e){IFB.Services.StreamingCallbacks.alert(t,e)}function activityCheckWT(t,e){IFB.Services.Streaming.CONNECTION.activityCheckWT(t,e)}function webTraderTiempoReal(t,e){IFB.Services.Trading.CONNECTION.updateData(t,e)}function activityCheckTrader(t,e){IFB.Services.Trading.CONNECTION.activityCheck(t,e)}function eventChart(t,e){IFB.Events.trigger(e)}function getGMToffset(){var t=new Date,e=-1*t.getTimezoneOffset()/60;return e}function initializeComplete(){IFB.Events.trigger("interactiveChart_initializeComplete")}var IFB=IFB||{};IFB.VERSION=IFB.VERSION||{},IFB.VERSION.CORE="0.0.0",IFB.Services=IFB.Services||{},IFB.Services.Streaming=IFB.Services.Streaming||{},IFB.Services.Streaming.CONNECTION=null,IFB.Services.Domain="infobolsa.es",IFB.Services.baseURL="http://wtst.infobolsa.es/WTRest",IFB.Services.ExternalUsersUrl="http://wtst.infobolsa.es/ExternalUsers",IFB.Services.StreamingBaseUrl="http://ifbwtsptest.infobolsa.es/WTServerRT",IFB.Services.PortfolioUrl="http://ifbwtsptest.infobolsa.es/WTPF/WTPF/Portfolio",IFB.Services.AUTH_TOKEN="TEMPORARYTOKEN",IFB.Services.Session="",IFB.Services.Profile="",IFB.Services.RetryLimit=1,IFB.Services.AnswerError='{"status": {"ok": false, "reason": "The maximum retry count has been exceeded with no response"}}',IFB.Router=IFB.Router||{},IFB.Models=IFB.Models||{},IFB.Collections=IFB.Collections||{},IFB.Views=IFB.Views||{},IFB.Views.HighStock=IFB.Views.HighStock||{},IFB.Renderers=IFB.Renderers||{},IFB.Utils=IFB.Utils||{},IFB.Pages=IFB.Pages||{},IFB.Components=IFB.Components||{},IFB.Templates=IFB.Templates||{},IFB.Templates.baseURL="../../templates",IFB.Templates.Versioned=!1,IFB.Product="",IFB.Language="",IFB.ClientConfiguration=null,IFB.Events={},_.extend(IFB.Events,Backbone.Events),IFB.Urls=IFB.Urls||{},IFB.Urls.CompanyLogos="http://www.infobolsa.es/img/logos/96/",IFB.Urls.InteractiveChartBaseUrl="http://ifbwtsptest.infobolsa.es",IFB.Settings=IFB.Settings||{},IFB.Settings.GmtOffset=0;var Highcharts=Highcharts||{};Highcharts.setOptions&&Highcharts.setOptions({lang:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],weekdays:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],shortMonths:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"]},credits:{enabled:!1}}),IFB.Utils=IFB.Utils||{},String.format=function(){var t=arguments[0],e=1;if(Array.isArray(arguments[1])){var i=arguments[1];for(e=0;e<i.length;e++){var r=new RegExp("\\{"+e+"\\}","gm");t=t.replace(r,i[e]||"")}}else for(e=1;e<arguments.length;e++){var r=new RegExp("\\{"+(e-1)+"\\}","gm");t=t.replace(r,arguments[e]||"")}return t},IFB.Class=function(t,e){t||(t=Object);var i=(Object.prototype.hasOwnProperty,function(){i.prototype.initialize.apply(this,arguments)}),r=function(){};r.prototype=t.prototype,i.prototype=new r,i.parent=t.prototype,i.prototype.constructor=i;var s;for(s in e)e.hasOwnProperty(s)&&(i.prototype[s]=e[s]);return i},IFB.ActivityManager={activityManagerInfobolsa:void 0,activityManagerProduct:void 0,activityManagerGoogleAnalytics:void 0,activitySourcePage:void 0,COMPONENT:{APPLICATION:"APLIC",INSTRUMENT_DETAIL:"VVALOR",BOLETA:"BOLETA",TRADING_ORDERS_BOOK:"LO",TRADING_POSITION:"PO"},ACTION:{LOGOUT:"LOGOUT",LOGIN:"LOGIN",BUY:"COMPRAR",SELL:"VENDER",MODIFY_BUY:"MODIFICARCOMPRA",MODIFY_SELL:"MODIFICARVENTA",PERQUOTE:"PERQUOTE",INSTRUMENT_DETAIL_OPEN_TAB:"VVALOR_SOLAPA",CANCEL_BUY:"CANCELAR_COMPRA",CANCEL_SELL:"CANCELAR_VENTA",CANCEL_ALL_BUY:"CANCELAR_TODAS_COMPRAS",CANCEL_ALL_SELL:"CANCELAR_TODAS_VENTAS",LOAD_ORDER_BOOK:"CONSULTA_LIBRO_ORDENES",LOAD_OPEN_POSITION:"CONSULTA_POSICION_ABIERTA",LOAD_ACCOUNTS:"CONSULTA_CUENTAS"},SOURCE:{BROWSER:"NAVEGADOR",APPLICATION:"APLIC",MENU:"MENU",VALUES_LIST:"LV",INSTRUMENT_DETAIL:"VVALOR",TRADING_ORDERS_BOOK:"LO",TRADING_POSITION:"POS",FILE:"FICH",GRAPHIC:"GRAF",SEARCH:"BUSCADOR",HOME:"HOME",BOLETA:"BOLETA",FAVORITES:"FAVORITOS",ERRORS:"ERRORES",NEWSDETAIL:"NOTICIA",NEWSRANGE:"NOTICIA",NEWSCRITERIA:"NOTICIA"},initialize:function(t){var e=IFB.Utils.ProductConfig.getEventos();if(e){var i=e.Infobolsa;if(i){var r=this.getConfigRequest(i,t.eventsTrace);r.Enabled}var s=e.Producto;if(s){var o=this.getConfigRequest(s,t.eventsTrace);o.Enabled&&(this.activityManagerProduct=new IFB.Services.Activity(o))}var n=e.GoogleAnalytics;n&&n.Enabled}},getConfigRequest:function(t,e){return{Url:t.Url,Params:t.Parametros,Enabled:"1"===t.Activar,responseFormatJson:!1,eventsTrace:e}},notify:function(t,e,i,r){r=r||this.activitySourcePage,this.activityManagerInfobolsa&&this.activityManagerInfobolsa.notify(t,e,i,r),this.activityManagerProduct&&this.activityManagerProduct.notify(t,e,i,r)}},IFB.TraderClass=IFB.Class(null,{defaults:{},enable:!1,sessionID:"",server:"",baseURL:"",streamingBaseURL:"",configTrader:{},accounts:[],ordersAlerted:[],ordersStatusNotifications:void 0,registeredOrders:!1,tradableMarkets:[],orderStatus:{ORDER_NEW:"0",ORDER_REJECTED:"8",ORDER_STOPPED_VT:"Z",ORDER_PARTIAL_FILL:"1",ORDER_FILLED:"2",ORDER_DONEFORDAY:"3",ORDER_CANCELED:"4",ORDER_PENDING_CANCEL:"6",ORDER_STOPPED:"7",ORDER_SUSPENDED:"9",ORDER_PENDING_NEW:"A",ORDER_CALCULATED:"B",ORDER_EXPIRED:"C",ORDER_ACCEPTED_FOR_BIDDING:"D",ORDER_PENDING_REPLACE:"E",ORDER_WAITING:"W"},statusNotifications:{NONE:"1",ALL:"2",INMARKET:"3"},orderTypeOptions:{LIMIT:{text:"Limitada",value:"2"},MARKET:{text:"Mercado",value:"1"},MARKET_TO_LIMIT:{text:"Por lo mejor",value:"K"},STOP:{text:"Stop mercado",value:"3"},STOP_LIMIT:{text:"Stop Limitada",value:"4"},STOP_MARKET:{text:"Stop por lo mejor",value:"5"},TODO_O_NADA:{text:"Todo o Nada",value:"6"},LIMIT_INMEDIATE:{text:"Limitada inmediata",value:"8"},ATAQUE:{text:"Ataque",value:"9"}},sideOptions:{BUY:{text:"Comprar",value:"1"},SELL:{text:"Vender",value:"2"}},webTraderConnected:function(t){var e=t;e.ordersStatusNotifications!==e.statusNotifications.NONE&&e.registerOrders()},orderTypeAvailable:function(t,e,i){var r=!1;if(!this.MAP_MARKET_ORDERTYPE)return!0;var s=t==this.sideOptions.BUY.value?this.MAP_MARKET_ORDERTYPE.BUY:this.MAP_MARKET_ORDERTYPE.SELL;if(s[i]){if("*"===s[i])return!0;r=-1!=s[i].search(e)}return r},getOrderTypes:function(t,e){elementsAvailable=[];var i=this.orderTypeOptions;return _.each(i,function(i){this.orderTypeAvailable(t.value,e.substring(0,2),i.value)&&elementsAvailable.push({text:i.text,value:i.value})},this),elementsAvailable},initialize:function(t){this.server=t.baseURL||"wtst.infobolsa.es",this.streamingServer=t.streamingBaseURL||"streamingst.infobolsa.es",this.baseURL="//"+this.server+"/WTServerTD/ServiceTrader.svc",this.streamingBaseURL="//"+this.streamingServer+"/WTServerTD/ServiceTrader.svc",this.setAccounts(t.accounts),this.sessionID=t.session,this.startTrading(t)},getFirstTradableAccount:function(){return _.find(this.accounts,function(t){return t.tradable===!0})},getFirstTradableAccountID:function(){var t=this.getFirstTradableAccount();return t?t.id:void 0},getFirstTradableAccountName:function(){var t=this.getFirstTradableAccount();return t?t.name:void 0},setAccounts:function(t){var e=this;if(t){var i=t.split(";");_.each(i,function(t){var i=t.split(":"),r={id:i[0],name:e.getNameFromParameters(i),tradable:1===i.length||i.length>1&&"1"===i[1]};e.accounts.push(r)})}},getNameFromParameters:function(t){var e=t.length>2?t[2]:t[0];return e=t.length>1&&"1"!==t[1]?e+" (no operable)":e},getAccountFromName:function(t){return _.find(this.accounts,function(e){return e.name===t})},getIdAccount:function(t){var e=this.getAccountFromName(t);return e?e.id:void 0},getAccountNameFromId:function(t){var e=_.find(this.accounts,function(e){return e.id===t});return e?e.name:void 0},getAccountsList:function(){return this.getAccountsArray().join(",")},getAccountsOrderBook:function(){return this.getAccountsList()},getAccountsArray:function(){var t=[];return _.each(this.accounts,function(e){t.push(e.id)}),t},startTrading:function(t){var e=new IFB.Services.Management;e.getProfile({session:this.sessionID,canalessubcanales:"2902"},{_function:this.callbackProfileTrading,params:t.callbackInitialize},this)},callbackProfileTrading:function(t,e,i){var r=e,s=JSON.parse(t);s.status.ok&&"0"!==s.answer&&void 0!==s.answer.PROFILE&&null!==s.answer.PROFILE.CS&&"1"===s.answer.PROFILE.CS.CS2902&&(r.enable=!0),r.getConfigTrader(i)},getNotifications:function(){var t=this.statusNotifications.INMARKET;return this.configTrader.Notificaciones&&this.configTrader.Notificaciones.EstadoOrden&&(t=this.configTrader.Notificaciones.EstadoOrden),t},getPath:function(){var t="/WTServerTD";return this.configTrader.Servidor&&this.configTrader.Servidor.Ruta&&(t=this.configTrader.Servidor.Ruta),t},getConfigTrader:function(t){this.configTrader=IFB.Utils.ProductConfig.getContratacion(),this.fillTradableMarket(IFB.Utils.ProductConfig.getAcciones()),this.ordersStatusNotifications=this.getNotifications();var e=this.getPath();this.baseURL="//"+this.server+e+"/ServiceTrader.svc",this.streamingBaseURL="//"+this.streamingServer+e+"/ServiceTrader.svc",this.startStreamingTrading(),t&&"function"==typeof callback&&t()},fillTradableMarket:function(t){var e=_.find(t.Accion,function(t){return t.Tipo="Comprar"});e&&(this.tradableMarkets=e.LM.split(","))},startStreamingTrading:function(){IFB.Services.Trading.CONNECTION=new IFB.Services.Trading({baseURL:this.baseURL||"",streamingBaseURL:this.streamingBaseURL||"",session:this.sessionID,serverLinkOrders:this.configTrader.Enlaces.Ordenes,serverLinkRisks:this.configTrader.Enlaces.Carteras}),IFB.Services.Trading.CONNECTION.initCall({callback:this.callbackInit},this)},callbackInit:function(t,e){var i=e;IFB.Services.Trading.CONNECTION.startStreaming(i.webTraderConnected,i)},getTraderEnabledCls:function(){return this.enable?"":"hide"},getAccounts:function(){return this.accounts.join(",")},getBaseURL:function(){return this.baseURL},getOrderTypeText:function(t){var e=this._findOrderType(t);return e.text},getOrderType:function(t){var e=this._findOrderType(t);return e.value},_findOrderType:function(t){var e=_.find(this.orderTypeOptions,function(e){return e.value===t},this);return e},getSideText:function(t){var e=_.find(this.sideOptions,function(e){return e.value===t},this);return e.text},registerOrders:function(){var t=this.getAccountsOrderBook();IFB.Services.Trading.CONNECTION&&(this.registeredOrders===!0&&IFB.Services.Trading.CONNECTION.unregisterEvents({accounts:t,informationType:IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_ORDERS,callback:this.onUpdateDataTrader,context:this}),IFB.Services.Trading.CONNECTION.registerRT({accounts:t,descriptors:this.getDescriptorsRegisterOrders(),informationType:IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_ORDERS,context:this,callback:this.onUpdateDataTrader}),this.registeredOrders=!0,IFB.Services.Trading.CONNECTION.getOrderBook({accounts:t,descriptors:this.getDescriptorsRegisterOrders(),informationType:IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_ORDERS,history:"N",context:this,callback:this.callbackGetOrders}))},getDescriptorsRegisterOrders:function(){return["6024","6204","6217","6035","6214","6205"]},callbackGetOrders:function(t,e){var i=e;if(void 0!==t&&t.status&&void 0!==t.answer){var r,s;_.each(t.answer,function(t){if(void 0!==t)switch(r=t[IFB.Descriptors.Trader.Key.descriptor],s=t[IFB.Descriptors.Trader.OrderStatusFIX.descriptor],this.ordersStatusNotifications){case this.statusNotifications.INMARKET:(s===i.orderStatus.ORDER_REJECTED||s===i.orderStatus.ORDER_NEW||s===i.orderStatus.ORDER_STOPPED_VT)&&i.ordersAlerted.push(r);break;case this.ordersStatusNotifications.ALL:}})}},unregisterOrders:function(){this.domElementsMap={},IFB.Services.Trading.CONNECTION&&IFB.Services.Trading.CONNECTION.unregisterRT({accounts:IFB.Trader.getAccountsList(),informationType:streamingType,callback:this.onUpdateDataTrader})},onUpdateDataTrader:function(t){this.notifyAvailable(t)&&this.showNotify(t)},notifyAvailable:function(t){switch(this.ordersStatusNotifications){case this.statusNotifications.INMARKET:var e=t[IFB.Descriptors.Trader.Key.descriptor],i=t[IFB.Descriptors.Trader.OrderStatusFIX.descriptor],r=t[IFB.Descriptors.Trader.OrderTypeFIX.descriptor];if(i===this.orderStatus.ORDER_REJECTED)return this.ordersAlerted.push(e),!0;if(i===this.orderStatus.ORDER_NEW&&r!==this.orderTypeOptions.STOP.value&&r!==this.orderTypeOptions.STOP_MARKET.value&&r!==this.orderTypeOptions.STOP_LIMIT.value||i===this.orderStatus.ORDER_STOPPED_VT&&(r===this.orderTypeOptions.STOP.value||r===this.orderTypeOptions.STOP_MARKET.value||r===this.orderTypeOptions.STOP_LIMIT.value)){var s=_.find(this.ordersAlerted,function(t){return e===t});if(!s)return this.ordersAlerted.push(e),!0}break;case this.statusNotifications.ALL:return!0}return!1},showNotify:function(t){var e=t[IFB.Descriptors.Trader.OrderStatusFIX.descriptor],i=t[IFB.Descriptors.Trader.RejectReason.descriptor],r=t[IFB.Descriptors.Trader.RejectCodeFIX.descriptor];switch(e){case this.orderStatus.ORDER_REJECTED:this.showOrderRejected(r,i);break;default:this.showOrderStatusNotifications(e)}},showOrderStatusNotifications:function(t){var e="";switch(t){case this.orderStatus.ORDER_NEW:e="Orden enviada al Mercado.";break;case this.orderStatus.ORDER_PARTIAL_FILL:e="Orden parcialmente ejecutada";break;case this.orderStatus.ORDER_FILLED:e="Orden ejecutada";break;case this.orderStatus.ORDER_DONEFORDAY:e="Orden validez de dia caducada";break;case this.orderStatus.ORDER_CANCELED:e="Orden cancelada";break;case this.orderStatus.ORDER_PENDING_CANCEL:e="Orden pendiente de cancelar";break;case this.orderStatus.ORDER_STOPPED:e="Orden parada";break;case this.orderStatus.ORDER_SUSPENDED:e="Orden suspendida";break;case this.orderStatus.ORDER_PENDING_NEW:e="Orden enviada";break;case this.orderStatus.ORDER_CALCULATED:e="Orden completada";break;case this.orderStatus.ORDER_EXPIRED:e="Orden expirada";break;case this.orderStatus.ORDER_ACCEPTED:e="Orden aceptada y evaluandose";break;case this.orderStatus.ORDER_PENDING_REPLACE:e="Orden pendiente de modificar";break;case this.orderStatus.ORDER_WAITING:e="Orden esperando confirmación";break;case this.orderStatus.ORDER_STOPPED_VT:e="Orden retenida";break;default:e="Estado de la orden a "+t}this.showNotification(e)},showOrderRejected:function(t,e){this.showNotification($.noty?'Su orden ha sido rechazada.<br/><b><a href="#!/errors/'+t+'" onclick="$.noty.closeAll();">'+e+"</a>":'Su orden ha sido rechazada.<br/><b><a href="#!/errors/'+t+'">'+e+"</a>")},showNotification:function(t){var e=[{text:"Aceptar"}];IFB.Utils.Helper.showNotification("information",t,!0,e)},isTradable:function(t){if(this.enable){var e=_.indexOf(this.tradableMarkets,t.substring(0,2));return e>=0}return!1},showWindowConfirmationOrderCV:function(){return"0"!==this.configTrader.BoletaConfirmarCV},showWindowConfirmationOrderModify:function(){return"0"!==this.configTrader.BoletaConfirmarModificar},showWindowConfirmationOrderBookCancel:function(){return"0"!==this.configTrader.LOConfirmarCancelar}}),IFB.Utils.Analytics=function(){function t(t,e,i,r,s,o){var n=IFB.Services.baseURL.replace("WTRest",""),a=n+"WTServerMG/Evento.srf?";return a+="sesion="+t,a+="&tipoUsuario="+e.substr(0,5),a+="&componente="+i.substr(0,5),a+="&accion="+r.substr(0,1),a+="&valor="+s.substr(0,15),a+="&param1="+o.substr(0,1),a+="&_dc="+(new Date).getTime()}function e(e,i,r,s,o){var n=t(IFB.Services.Session,e,i,r,s,o),a=document.createElement("img");a.setAttribute("src",n),a.setAttribute("height","0"),a.setAttribute("width","0"),a.setAttribute("style","position:absolute; visibility:hidden")}function i(t){_gaq.push(["_trackPageview",t])}function r(t,e,i,r,s){_gaq.push(["_trackEvent",t,e,i,r,s])}return{trackEvent:e,googleTrackPageview:i,googleTrackEvent:r}}(),IFB.Utils.Colors=function(){function t(t,e){if(!t)return"";for(var i=t.replace("#","").match(/(.{2})/g),r=3;r--;)i[r]=parseInt(i[r],16);return"undefined"==typeof e?"rgb("+i.join(", ")+")":"rgba("+i.join(", ")+", "+e+")"}return{hex2rgb:t}}();var IFB=IFB||{};IFB.Constants={Highcharts:{ChartTypes:{}}},getHighchartsTypes();var IFB=IFB||{};IFB.Defaults={Components:{InstrumentDetail:{serviceParams:{type:"GET",data:{type:"6",header:"80,240,420,250,60,70,390,410,1147,370,380,642,856,9565",rt:"1",sort:"-1"}}},TopFlopActive:{serviceParams:{type:"GET",data:{header:"10305,80,420,250,370,390,410,1147,10307",rt:"1",numVals:"3"}}},ChartDaily:{serviceParams:{type:"GET",data:{dateStart:moment().add("years",-1).format("YYYYMMDD"),dateEnd:moment().format("YYYYMMDD"),frequency:"d",type:"6"}}},ChartIntraday:{serviceParams:{type:"GET",data:{date:moment().format("YYYYMMDD"),compressionMult:"5",isSession:"1",type:"6"}}},Bubbles:{serviceParams:{type:"GET",data:{type:"1",header:"250",rt:"1",sort:"-1"}}},SignificantFactNearby:{serviceParams:{type:"GET",data:{type:"4"}}},Dividends:{serviceParams:{type:"GET",data:{dateStart:moment().add("years",-1).format("YYYYMMDD"),dateEnd:moment().add("years",1).format("YYYYMMDD"),type:"4"}}},InstrumentList:{serviceParams:{type:"GET",data:{type:"1",header:"420,250,3002,670,9469,9472,1838,10307,642,1147",rt:"1",sort:"10307"}}},InstrumentSearch:{serviceParams:{type:"POST",data:{}}},News:{serviceParams:{type:"GET",data:{numberOfItems:50}}},NewsCriteria:{serviceParams:{type:"GET",numberOfItems:50,data:{detailFormat:0}}},NewsRange:{serviceParams:{type:"GET",data:{fechaDesde:moment().format("YYYYMMDD"),fechaHasta:moment().format("YYYYMMDD")}}},OrdersBook:{serviceParams:{url:"//wtst.infobolsa.es",type:"POST",data:{descriptorsTrader:"6009,6017,6024,6027,6031,6033,6035,6043,6201,6202,6203,6204,6205,6206,6208,6209,6212,6211,6213,6214,6216,6217,6098,6084"}}},OpenPosition:{serviceParams:{url:"//wtst.infobolsa.es",type:"POST",data:{descriptorsTrader:"6052,6303,6301,6302,6305,6306,6307",type:"6",header:"420",rt:"1",sort:"-1"}}},Accounts:{serviceParams:{url:"//wtst.infobolsa.es",type:"POST",data:{descriptorsTrader:"Cuenta,EfectivoInicial,EfectivoCompra,EfectivoVenta,EfectivoDisponible"}}},Balances:{serviceParams:{url:"//wtst.infobolsa.es",type:"POST",data:{}}},ConsensusEvolution:{serviceParams:{type:"GET",data:{type:"2",param:"0;49;{MV},29(02)-29(04)-29(27)-29(28)-29(29)-29(30)-29(31)-29(32)-29(26),{DATE_INIT},{PERIOD}",tipoBusqueda:"F"},table:"T29"}},Positions:{serviceParams:{type:"GET",data:{type:"4",header:"735,350,740,330,340,750,360,642",numVals:"10"}}},AlertList:{serviceParams:{type:"POST",data:{}}},Transactions:{serviceParams:{type:"POST",data:{}}},Columnado:{serviceParams:{type:"POST",data:{tipo:"1",defecto:"0",agrupado:"1"}}}}};var IFB=IFB||{};IFB.Descriptors={_3MonthsHigh:{descriptor:"D9456"},_3MonthsLow:{descriptor:"D9463"},_3MonthsReturnClose:{descriptor:"D9470"},_12MonthsReturnClose:{descriptor:"D9472"},_2YearsHigh:{descriptor:"D572"},_2YearsLow:{descriptor:"D592"},_2YearsReturnClose:{descriptor:"D9473"},_3YearsReturn:{descriptor:"D1118"},_3YearsReturnClose:{descriptor:"D9474"},_3YearsHigh:{descriptor:"D574"},_3YearsLow:{descriptor:"D593"},_4YearsReturnClose:{descriptor:"D9499"},_5YearsReturnClose:{descriptor:"D2129"},_5YearsHigh:{descriptor:"D5901"},_5YearsLow:{descriptor:"D5902"},_52WeeksDateHigh:{descriptor:"D5101"},_52WeeksDateLow:{descriptor:"D5102"},_52WeeksHigh:{descriptor:"D568"},_52WeeksLow:{descriptor:"D591"},_6MonthsReturnClose:{descriptor:"D9471"},_AllTimeReturnClose:{descriptor:"D5903"},_AllTimeHigh:{descriptor:"D238"},_AllTimeLow:{descriptor:"D239"},_3T13:{descriptor:"D4223"},AskOrders:{descriptor:"D360"},AskPrice:{descriptor:"D340"},AskVolume:{descriptor:"D750"},AssetType:{descriptor:"D9558"},AverageDailyVolume_1Mouth:{descriptor:"D91"},Bancomer_Accion_CancelarOrden:{descriptor:"D1585"},Bancomer_Accion_DetalleOrden:{descriptor:"D1589"},Bancomer_Capitalization:{descriptor:"D936"},Bancomer_Estado:{descriptor:"D1572",sortType:"string"},Bancomer_Folio:{descriptor:"D1565"},Bancomer_Operacion:{descriptor:"D1567",sortType:"string"},Bancomer_PlusMinus:{descriptor:"D2614"},Bancomer_PlusMinusPerc:{descriptor:"D2615"},Bancomer_Titulos:{descriptor:"D1577"},Bancomer_Ultimo:{descriptor:"D1538"},Bancomer_ValorHoyEstimado:{descriptor:"D1571"},Bancomer_Valuacion:{descriptor:"D2613"},BidOrders:{descriptor:"D350"},BidPrice:{descriptor:"D330"},BidVolume:{descriptor:"D740"},BPA:{descriptor:"D1610"},Bursatility:{descriptor:"D9839"},Buy:{descriptor:"D1291"},CA_FundCalculationPeriod:{descriptor:"D4023"},CA_FundCalculationPeriod_Code:{descriptor:"D3303"},CA_FundCurrency:{descriptor:"D3304"},CA_FundLaunchDate:{descriptor:"D3301"},CA_FundKIID:{descriptor:"D3014"},CA_FundProspectus:{descriptor:"D3011"},CA_FundQuarterlyReport:{descriptor:"D3013"},CA_FundReporting:{descriptor:"D3012"},CA_FundRules:{descriptor:"D3009"},CA_FundRisk:{descriptor:"D3302"},CA_FundObjective_ES:{descriptor:"D3016",sortType:"string"},CA_FundObjective_CA:{descriptor:"D3017",sortType:"string"},CA_FundObjective_EN:{descriptor:"D3018",sortType:"string"},CA_FundObjective_FR:{descriptor:"D3019",sortType:"string"},CA_FundType:{descriptor:"D4021",sortType:"string"},CA_FundType_Long:{descriptor:"D4022",sortType:"string"},CA_FundType_Code:{descriptor:"D3005",sortType:"string"},Capitalization:{descriptor:"D935"},Cash:{descriptor:"D670"},Category:{descriptor:"D9875"},Center:{descriptor:"D27"},Change:{descriptor:"D240"},ChangePercent:{descriptor:"D250"},ChangePercentCurrentMonth:{descriptor:"D58"},ChangePercent_CurrentYear:{descriptor:"D64"},ChangePercent_CurrentYear_TR:{descriptor:"D1776"},ChangePercent_LastDay:{descriptor:"D270"},ChangePercent_LastYear:{descriptor:"D2271"},ChangePercent_2YearsAgo:{descriptor:"D2272"},ChangePercent_3YearsAgo:{descriptor:"D2273"},ChangePercent_4YearsAgo:{descriptor:"D2274"},ClientInstrumentTicker:{descriptor:"D10305",sortType:"string"},ClientInstrumentType:{descriptor:"D10311"},ClientIsin:{descriptor:"D10303"},Close:{descriptor:"D370"},CNMV_Inscription_Date:{descriptor:"D1040"},Code_MEFF:{descriptor:"D6183"},Settlement_Type:{descriptor:"D6182"},ConstituentsCode:{descriptor:"D856"},Country:{descriptor:"D9565"},CorporateName:{descriptor:"D9833"},Coupon:{descriptor:"D9830"},Currency:{descriptor:"D133"},CurrentYear_High:{descriptor:"D46"},CurrentYear_Low:{descriptor:"D56"},Date:{descriptor:"D60"},DateLastUpdate:{descriptor:"D1562"},DateOrTime:{descriptor:"D3002",sortType:"string"},DateOrTimeSituationMessage:{descriptor:"D3004",sortType:"string"},DayAvgVolume:{descriptor:"D1210"},Decimals:{descriptor:"D1147"},Derivatives_ExpirationDate:{descriptor:"D1795"},Derivatives_Open_Interest:{descriptor:"D11611"},Derivatives_Product_Type:{descriptor:"D5636"},Derivatives_Subyacente:{descriptor:"D9040"},Dividend_FiscalYear:{descriptor:"D1940"},Dividend_GrossValue:{descriptor:"D2120"},Dividend_PaymentDate:{descriptor:"D1990",sortType:"string"},Dividend_Type:{descriptor:"D1820",sortType:"string"},DividendYield:{descriptor:"D1420"},EBITDA_Previous:{descriptor:"D4241"},EBITDA_3T13:{descriptor:"D4240"},EBITDA_Percent:{descriptor:"D4225"},ExchangeShortName:{descriptor:"D95"},Emisora:{descriptor:"D9828",sortType:"string"},EqualCount:{descriptor:"D8780"},ETF_Benchmark:{descriptor:"D9770",sortType:"string"},ETF_Geographic_Area:{descriptor:"D9773"},ETF_Sector:{descriptor:"D9774"},ETF_Style:{descriptor:"D9772",sortType:"string"},ETF_Type:{descriptor:"D9771",sortType:"string"},ETF_Description:{descriptor:"D9523",sortType:"string"},ExpiryDate:{descriptor:"D9857"},FACTSET_Capitalization:{descriptor:"D9776"},FACTSET_DividendYield:{descriptor:"D1838"},FACTSET_DividendYield_NextYear:{descriptor:"D1839"},FACTSET_DividendYield_Next2Year:{descriptor:"D1841"},FACTSET_DividendYield_Next3Year:{descriptor:"D1842"},FACTSET_DividendYield_PreviousYear:{descriptor:"D1837"},FACTSET_EBITDA:{descriptor:"D1866"},FACTSET_EBITDA_NextYear:{descriptor:"D1867"},FACTSET_EBITDA_Next2Year:{descriptor:"D1868"},FACTSET_EBITDA_Next3Year:{descriptor:"D1869"},FACTSET_EBITDA_PreviousYear:{descriptor:"D1865"},FACTSET_EPS:{descriptor:"D1811"},FACTSET_EPS_NextYear:{descriptor:"D1812"},FACTSET_EPS_Next2Year:{descriptor:"D1823"},FACTSET_EPS_Next3Year:{descriptor:"D1824"},FACTSET_EPS_PreviousYear:{descriptor:"D1809"},FACTSET_EstimationPeriod:{descriptor:"D1796"},FACTSET_EstimationPeriod_NextYear:{descriptor:"D1797"},FACTSET_EstimationPeriod_Next1Year:{descriptor:"D1798"},FACTSET_EstimationPeriod_Next2Year:{descriptor:"D1799"},FACTSET_EstimationPeriod_PreviousYear:{descriptor:"D1794"},FACTSET_NetDividend:{descriptor:"D1833"},FACTSET_NetDividend_NextYear:{descriptor:"D1834"},FACTSET_NetDividend_Next2Year:{descriptor:"D1835"},FACTSET_NetDividend_Next3Year:{descriptor:"D1836"},FACTSET_NetDividend_PreviousYear:{descriptor:"D1832"},FACTSET_PER:{descriptor:"D1849"},FACTSET_PER_NextYear:{descriptor:"D1851"},FACTSET_PER_Next2Year:{descriptor:"D1852"},FACTSET_PER_Next3Year:{descriptor:"D1853"},FACTSET_PER_PreviousYear:{descriptor:"D1848"},FACTSET_PriceBook:{descriptor:"D1965"},FACTSET_PriceBook_NextYear:{descriptor:"D1966"},FACTSET_PriceBook_Nex2tYear:{descriptor:"D1967"},FACTSET_PriceBook_PreviousYear:{descriptor:"D1964"},FACTSET_PriceCashFlow:{descriptor:"D1877"},FACTSET_PriceCashFlow_NextYear:{descriptor:"D1878"},FACTSET_PriceCashFlow_Nex2tYear:{descriptor:"D1879"},FACTSET_PriceCashFlow_Nex3tYear:{descriptor:"D1881"},FACTSET_PriceCashFlow_PreviousYear:{descriptor:"D1876"},FACTSET_Period:{descriptor:"D5400"},FACTSET_Period_NextYear:{descriptor:"D5401"},FACTSET_Recommendation:{descriptor:"D5570"},FACTSET_RecommendationDate:{descriptor:"D5420"},FACTSET_Recommendation_1Month_Buy:{descriptor:"D1949"},FACTSET_Recommendation_1Month_Overweight:{descriptor:"D1951"},FACTSET_Recommendation_1Month_Hold:{descriptor:"D1952"},FACTSET_Recommendation_1Month_Underweight:{descriptor:"D1953"},FACTSET_Recommendation_1Month_Sell:{descriptor:"D1954"},FACTSET_Recommendation_1Month_Total:{descriptor:"D1955"},FACTSET_RecurrentEarnings:{descriptor:"D1912"},FACTSET_RecurrentEarnings_NextYear:{descriptor:"D1913"},FACTSET_RecurrentEarnings_Next2Year:{descriptor:"D1914"},FACTSET_RecurrentEarnings_Next3Year:{descriptor:"D1915"},FACTSET_RecurrentEarnings_PreviousYear:{descriptor:"D1911"},FACTSET_ROE:{descriptor:"D1872"},FACTSET_ROE_NextYear:{descriptor:"D1873"},FACTSET_ROE_Next2Year:{descriptor:"D1874"},FACTSET_ROE_Next3Year:{descriptor:"D1875"},FACTSET_ROE_PreviousYear:{descriptor:"D1871"},FACTSET_TargetPrice:{descriptor:"D5575"},FACTSET_TargetPriceChangePercent:{descriptor:"D5576"},FACTSET_TargetPriceGap:{descriptor:"D5577"},FlopCount:{descriptor:"D8770"},FONDSMD_ISIN:{descriptor:"D9504"},FriendlyName:{descriptor:"D9563",sortType:"string"},FundBetta_1Y:{descriptor:"D1325"},FundChangePercentCurrentYear:{descriptor:"D346"},FundComission:{descriptor:"D9515"},FundCalculationPeriod:{descriptor:"D6710"},FundCurreny:{descriptor:"D6700"},FundDividendDistribution:{descriptor:"D9708"},FundIssuer:{descriptor:"D9656"},FundLastDate:{descriptor:"D6400"},FundLaunchDate:{descriptor:"D6600"},FundLongName:{descriptor:"D6530",sortType:"string"},FundM2_1Y:{descriptor:"D1305"},FundManager:{descriptor:"D955"},FundManagerCode:{descriptor:"D950"},FundRisk:{descriptor:"D485"},FundType:{descriptor:"D2401"},FundValuationDate:{descriptor:"D281"},FundVocation:{descriptor:"D852"},FundVolatility_1Y:{descriptor:"D1575"},FundDepositCommission:{descriptor:"D995"},FundManagementCommission:{descriptor:"D985"},HistCash:{descriptor:"D10670"},HistChange:{descriptor:"D10240"},HistChangePercent:{descriptor:"D10250"},HistClose:{descriptor:"D10370"},HistDate:{descriptor:"D10060"},HistLast:{descriptor:"D10420"},HistOpen:{descriptor:"D10380"},HistSessionLow:{descriptor:"D10410"},HistSessionHigh:{descriptor:"D10390"},HistVolume:{descriptor:"D10710"},IFBLongName:{descriptor:"D10104",sortType:"string"},IFBMarketName:{descriptor:"D25"},IFBShortName:{descriptor:"D10103",sortType:"string"},Index_Consituents_Risers:{descriptor:"D8760"},Index_Consituents_Neutrals:{descriptor:"D8780"},Index_Consituents_Fallers:{descriptor:"D8770"},Industry:{descriptor:"D9758"},InstrumentTicker:{descriptor:"D30",sortType:"string"},InstrumentType:{descriptor:"D9558"},InstrumentSubtype:{descriptor:"D9559"},InstrumentYesterday:{descriptor:"D9837"},Isin:{descriptor:"D40",sortType:"string"},Issuance:{descriptor:"D9838"},IssuedCapital_I:{descriptor:"D9835"},IssuedCapital_II:{descriptor:"D9836"},Issuer:{descriptor:"D9828",sortType:"string"},Last:{descriptor:"D420"},MarketCapitalization:{descriptor:"D6430"},MarketCodeClient:{descriptor:"D10304"},MarketDepth:{descriptor:"D735"},MarketName:{descriptor:"D10314",sortType:"string"},MarketType:{descriptor:"D9846"},MIC:{descriptor:"D9557"},MonthReturn:{descriptor:"D1117"},MonthHigh:{descriptor:"D563"},MonthLow:{descriptor:"D582"},MonthReturnClose:{descriptor:"D9469"},NetAssetValue:{descriptor:"D6420"},NoesisFundamental_Capitalization:{descriptor:"D18412"},NoesisFundamental_Date:{descriptor:"D18405"},NoesisFundamental_ObjectivePrice:{descriptor:"D18410"},NoesisFundamental_Period:{descriptor:"D18404"},NoesisFundamental_PreviousPrice:{descriptor:"D18408"},NoesisFundamental_Recommendation:{descriptor:"D18414",sortType:"string"},NoesisFundamental_Shares:{descriptor:"D18413"},NoesisFundamental_Volatility:{descriptor:"D18411"},NoesisFundamental_Year:{descriptor:"D18403"},NoesisFundamental_BPA_Ac:{descriptor:"D18501"},NoesisFundamental_PER_T:{descriptor:"D18503"},NoesisFundamental_Ratio1:{descriptor:"D18505"},NoesisFundamental_Ratio2:{descriptor:"D18506"},NoesisFundamental_Ratio3:{descriptor:"D18507"},NoesisFundamental_Ratio4:{descriptor:"D18508"},NoesisFundamental_ResNet:{descriptor:"D18509"},NoesisFundamental_Serie1:{descriptor:"D18510"},NoesisFundamental_Serie2:{descriptor:"D18511"},NoesisFundamental_Serie3:{descriptor:"D18512"},NoesisFundamental_Serie4:{descriptor:"D18513"},Noesis_PivotPrice:{descriptor:"D2876"},Noesis_PivotPriceDate:{descriptor:"D2875"},Noesis_RecommendationLong:{descriptor:"D9783"},Noesis_RecommendationLongTerm:{descriptor:"D1071",sortType:"string"},Noesis_RecommendationMedium:{descriptor:"D9782"},Noesis_RecommendationMediumTerm:{descriptor:"D1072"},Noesis_RecommendationShort:{descriptor:"D9781"},Noesis_RecommendationShortTerm:{descriptor:"D1069"},Noesis_ResistancePrimary:{descriptor:"D1055"},Noesis_ResistanceSecondary:{descriptor:"D1056"},Noesis_SupportPrimary:{descriptor:"D1067"},Noesis_SupportSecondary:{descriptor:"D1068"},Noesis_TechnicalSituation:{descriptor:"D899"},Noesis_TechnicalSituationDate:{descriptor:"D926"},Noesis_GeneralAnalysis:{descriptor:"D954"},Noesis_GeneralAnalysisDate:{descriptor:"D956"},Noesis_Shares_Var30:{descriptor:"D2708"},Noesis_Shares_Var30Pct:{descriptor:"D2712"},Noesis_Shares_Var30Text:{descriptor:"D2710"},Noesis_Shares_Var30Class:{descriptor:"D2797"},Noesis_Shares_Beta30:{descriptor:"D2722"},Noesis_Shares_Beta30Text:{descriptor:"D2724"},Noesis_Shares_Beta30Class:{descriptor:"D2727"},Noesis_Shares_Volatility30:{descriptor:"D2750"},Noesis_Shares_Volatility30Text:{descriptor:"D2752"},Noesis_Shares_Volatility30Class:{descriptor:"D2755"},Nominal:{descriptor:"D706"},NominalValue:{descriptor:"D1120"},ON_Previous:{descriptor:"D4231"},ON_3T13:{descriptor:"D4230"},ON_Percent:{descriptor:"D4234"},Open:{descriptor:"D380"},OpeningTime:{descriptor:"D611"},Operations:{descriptor:"D9754"},Operativity:{descriptor:"D9841"},PER:{descriptor:"D1710"},Performance_CalculationDate:{descriptor:"D289"},Placement:{descriptor:"D9886"},PreviousYearClosingPrice:{descriptor:"D1230"},PriceBook:{descriptor:"D1720"},PriceCashFlow:{descriptor:"D1700"},ProfitPerShare:{descriptor:"D1811"},P_FLEPA_Main:{descriptor:"D716"},P_FLEPA_Factor1:{descriptor:"D676"},P_FLEPA_Factor2:{descriptor:"D677"},P_FEPA_Main:{descriptor:"D717"},P_FEPA_Factor1:{descriptor:"D678"},P_FEPA_Factor2:{descriptor:"D679"},P_U_Main:{descriptor:"D683"},P_U_Factor1:{descriptor:"D684"},P_U_Factor2:{descriptor:"D686"},P_VL_Main:{descriptor:"D687"},P_VL_Factor1:{descriptor:"D688"},P_VL_Factor2:{descriptor:"D689"},ReferenceIndex:{descriptor:"D638"},Research_Date:{descriptor:"D5001"},Research_Title:{descriptor:"D5004"},Research_Sector:{descriptor:"D5006"},Research_Subdirection:{descriptor:"D5008"},Rotation:{descriptor:"D1195"},Sales_Previous:{descriptor:"D4221"},Sales_3T13:{descriptor:"D4220"},Sales_Percentage:{descriptor:"D4224"},SampleIndicator:{descriptor:"D9845"},Sector:{descriptor:"D9757"},Sell:{descriptor:"D1292"},Serie:{descriptor:"D9829",sortType:"string"},SERIE_InstrumentType:{descriptor:"D9840"},SessionAverage:{descriptor:"D400"},SessionHigh:{descriptor:"D390"},SessionLow:{descriptor:"D410"},ShareType:{descriptor:"D9827"},SharesToday:{descriptor:"D9860"},ShortName:{descriptor:"D10307",sortType:"string"},Source:{descriptor:"D9834"},Stakeholders:{descriptor:"D6435"},Strike:{descriptor:"D9881"},SubIndustry:{descriptor:"D9759"},SubSector:{descriptor:"D9912"},Symbol:{descriptor:"D9825"},Time:{descriptor:"D70"},TirAverage:{descriptor:"D160"},TirHigh:{descriptor:"D150"},TimeLastUpdate:{descriptor:"D356"},TirLow:{descriptor:"D170"},TopCount:{descriptor:"D8760"},TradedCash:{descriptor:"D8730"},TradingState:{descriptor:"D147"},Trend:{descriptor:"D642"},Underlying:{descriptor:"D9872"},UN_Previous:{descriptor:"D4233"},UN_3T13:{descriptor:"D4232"},UN_Percent:{descriptor:"D4235"},VE_UAIIDA_Main:{descriptor:"D718"},VE_UAIIDA_Factor1:{descriptor:"D681"},VE_UAIIDA_Factor2:{descriptor:"D682"},Volume:{descriptor:"D710"},WeekHigh:{descriptor:"D561"},WeekLow:{descriptor:"D578"},WeekReturnClose:{descriptor:"D9468"},YearHigh:{descriptor:"D1245"},YearLow:{descriptor:"D1255"},YearReturn:{descriptor:"D1114"},YearReturnClose:{descriptor:"D9472"},YearVolume:{descriptor:"D1270"},ClientTradeable:{descriptor:"D10312"},ClientDecimals:{descriptor:"D10313"},OpenPercent:{descriptor:"D3765"},MaxPercent:{descriptor:"D3835"},MedPercent:{descriptor:"D3885"},MinPercent:{descriptor:"D3865"},LastExPercent:{descriptor:"D3785"},MaxAnnPercent:{descriptor:"D3800"},MinAnnPercent:{descriptor:"D3820"},CurrencyVolumes:{descriptor:"D136"},MarketCode:{descriptor:"D20"}},IFB.Descriptors.Trader={AccountFIX:{descriptor:"@D6205"},Assessment:{descriptor:"@D6047"},AssessmentClient:{descriptor:"@D6103"},AssessmentFIX:{descriptor:"@D6126"},AssetType:{descriptor:"@D6136"},AvgPrice:{descriptor:"@D6033"},BalanceAccount:{descriptor:"@D6069"},BalanceCurrency:{descriptor:"@D6068",sortType:"string"},BalanceDescription:{descriptor:"@D6066"},BalanceQuantity:{descriptor:"@D6067"},BORRADO:{descriptor:"@D6134"},CalculatedAssesment:{descriptor:"@D6148"},CancelOrder:{descriptor:"@D6017"},CancelOrderFIX:{descriptor:"@D6215"},CancelQuantity:{descriptor:"@D6045"},CompensationPrice:{descriptor:"@D6064"},CumQuantity:{descriptor:"@D6044"},ExecTypeFIX:{descriptor:"@D6209"},ExpireDateFIX:{descriptor:"@D6208"},Fixing:{descriptor:"@D6133"},FixingCost:{descriptor:"@D6147"},Multiplier:{descriptor:"@D6146"},IntradayFIX:{descriptor:"@D6084"},ISIN:{descriptor:"@D6046"},IsinFIX:{descriptor:"@D6201"},Key:{descriptor:"@D6024"},MaxFloorFIX:{descriptor:"@D6212"},MinQuantityFIX:{descriptor:"@D6211"},ModifyOrder:{descriptor:"@D6054"},MVFIX:{descriptor:"@D6203"},OrderAdmin:{descriptor:"@D6098"},OrderIntraday:{descriptor:"@D6084"},OrderStatus:{descriptor:"@D6029"},OrderStatusFIX:{descriptor:"@D6204",sortType:"string"},OrderTypeFIX:{descriptor:"@D6214"},OrderUserOrigin:{descriptor:"@D6221"},PendingVolume:{descriptor:"@D6032"},PendingVolumeFIX:{descriptor:"@D6216"},PortfolioAccount:{descriptor:"@D6302"},PortfolioBuyPriceFIX:{descriptor:"@D6048"},PortfolioBuyShares:{descriptor:"@D6304"},PortfolioBuyTrade:{descriptor:"@D6306"},PortfolioInitialTrade:{descriptor:"@D6305"},PortfolioKey:{descriptor:"@D6303"},PortfolioMV:{descriptor:"@D6301"},PortfolioSellPriceFIX:{descriptor:"@D6049"},PortfolioSellTrade:{descriptor:"@D6307"},PortfolioShortName:{descriptor:"@D6052",sortType:"string"},PortfolioTitlesFIX:{descriptor:"@D6063"},PortfolioLastPriceSFB:{descriptor:"@D6135"},Price:{descriptor:"@D6043"},PriceBuyClient:{descriptor:"@D6161"},PriceFIX:{descriptor:"@D6207"},ProfitLoss:{descriptor:"@D6065"},Quantity:{descriptor:"@D6031"},QuantityFIX:{descriptor:"@D6206"},Reason:{descriptor:"@D6014"},RejectCodeFIX:{descriptor:"@D6217"},RejectReason:{descriptor:"@D6035"},ShortName:{descriptor:"@D6027",sortType:"string"},Side:{descriptor:"@D6026"},SideFIX:{descriptor:"@D6202",sortType:"string"},State:{descriptor:"@D6009"},StopPriceFIX:{descriptor:"@D6213"},TransactionConcept:{descriptor:"@D6066"},TransactionDate:{descriptor:"@D6076"},TransactionQuantityH:{descriptor:"@D6124"},TransactionBalance:{descriptor:"@D6081"},TransactionQuantityD:{descriptor:"@D6123"},TransactionDH:{descriptor:"@D6083"}},IFB.Descriptors.Trader.Cuentas={Account:{descriptor:"Cuenta"},CashBuy:{descriptor:"EfectivoCompra"},CashAvailable:{descriptor:"EfectivoDisponible"},CashInitial:{descriptor:"EfectivoInicial"},CashSell:{descriptor:"EfectivoVenta"}},IFB.Utils.Favorites={DEFAULT_MV_LENGTH:7,favorites:[],defaults:{loadOnInitialize:!0,file:"_~FAVORITOS",type:"GRP",replace:"1",waitForSaveMillis:500,transform:"1"},initialize:function(t,e){_.defaults(this,t||{},this.defaults),_.extend(this,Backbone.Events),this.favorites=[],this.mgService=new IFB.Services.Management({}),this.save=this.waitForSaveMillis>0?_.debounce(this._save,this.waitForSaveMillis):this._save,this.loadOnInitialize?this.load(e):e(null,this)
},load:function(t){var e=this;this.mgService.loadFile({session:this.session||IFB.Services.Session,file:this.file,type:this.type,transform:this.transform},function(i){try{e.readFavoritesFromFile(i,e),_.isFunction(t)&&t(null,e,i)}catch(r){_.isFunction(t)&&t(r,e,i)}})},_save:function(t){var e=this;this.mgService.saveFile({session:this.session||IFB.Services.Session,file:this.file,type:this.type,replace:this.replace,content:this.formatContent(this.toString()),transform:this.transform},function(i){_.isFunction(t)&&t(null,e,i)})},formatContent:function(){throw new Error("This method must be overrided")},unformatContent:function(){throw new Error("This method must be overrided")},getAll:function(){return this.favorites||[]},has:function(t){return-1!==this.favorites.indexOf(this.normalize(t))},add:function(t,e){t=this.normalize(t),this.has(t)||(this.favorites.push(t),e||(this.save(this.onAddFavorite),this.trigger("add",t,this.getAll())))},remove:function(t,e){t=this.normalize(t),this.has(t)&&(this.favorites=_.without(this.favorites,t),e||(this.save(this.onRemoveFavorite),this.trigger("remove",t,this.getAll())))},toggle:function(t,e){t=this.normalize(t),this.has(t)?this.favorites=_.without(this.favorites,t):this.favorites.push(t),e||this.save()},reset:function(t,e){var i=this;this.favorites=[],t&&_.each(_.isArray(t)?t:[t],function(t){i.add(t,!0)}),e||this.save()},toString:function(t){return this.favorites.join(t||",")},splitLength:function(t,e){var i=this;if(e=e||this.DEFAULT_MV_LENGTH,-1!==t.indexOf(","))return _.map(t.split(","),function(t){return i.normalize(t)});if(t.length<=e)return[this.normalize(t)];var r=[],s=0;for(s=0;s+e<=t.length;s+=e)r.push(t.substring(s,s+e));return r},normalize:function(t,e,i){return e=e||this.DEFAULT_MV_LENGTH,t+new Array(e+1-t.length).join(i||" ")},readFavoritesFromFile:function(t,e){var i=JSON.parse(t);if(!IFB.Utils.Helper.getObjectValueIfExists(i,"status.ok"))throw new Error("Invalid response");e.favorites=e.unformatContent(i.answer)},onAddFavorite:function(){},onRemoveFavorite:function(){}},function(){var t={asNumber:function(t,e,i,r){var s=accounting.formatNumber(t,{precision:e,zero:i||""});return r&&t>0&&-1===s.indexOf(r)?r+s:s},stringFormat:function(t,e){var i=e;return t.replace(/{(\d+)}/g,function(t,e){return"undefined"!=typeof i[e]?i[e]:t})}};IFB.Utils.Format=t}(),function(){var t={userInfo:void 0,getQueryStringParam:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e,i="[\\?&]"+t+"=([^&#]*)",r=new RegExp(i),s=r.exec(window.location.search);return e=null===s?"":decodeURIComponent(s[1].replace(/\+/g," "))},initializeCulture:function(){moment&&moment.lang("es"),accounting&&(accounting.settings={currency:{symbol:"€",format:"%v %s",decimal:",",thousand:".",precision:2},number:{precision:0,thousand:".",decimal:","}})},clone:function(t){if(!t)return t;var e,i=[Number,String,Boolean];if(i.forEach(function(i){t instanceof i&&(e=i(t))}),"undefined"==typeof e)if("[object Array]"===Object.prototype.toString.call(t))e=[],t.forEach(function(t,i){e[i]=IFB.Utils.Helper.clone(t)});else if("object"==typeof t)if(t.nodeType&&"function"==typeof t.cloneNode)e=t.cloneNode(!0);else if(t.prototype)e=t;else if(t instanceof Date)e=new Date(t);else{e={};for(var r in t)e[r]=IFB.Utils.Helper.clone(t[r])}else e=t;return e},serializeObject:function(t){"use strict";var e={},i=function(t,i){var r=e[i.name];"undefined"!=typeof r&&null!==r?$.isArray(r)?r.push(i.value):e[i.name]=[r,i.value]:e[i.name]=i.value};return $.each(t.serializeArray(),i),e},chartIntradayTooltipFormatter:function(){return""},chartDailyTooltipFormatter:function(){return""},getConstituentsCode:function(t){return t},translateMarketCode:function(t){return t},getPreOpeningDiffMinutes:function(){return-30},getFACTSETDescriptorsManager:function(){return void 0},getHistoricDescriptorsConverter:function(){return void 0},showNotification:function(){},showNotificationTemplate:function(){},showNotificationConfirmOrder:function(){},showNotificationCancellationOrder:function(){},showNotificationReconnecting:function(){},getUserInfo:function(){},isIOS:function(){return-1!==["iPad","iPhone","iPod","iPad Simulator","iPhone Simulator","iPod Simulator"].indexOf(navigator.platform)},onBeforeUnload:function(){return IFB.Utils.Helper.callbackOnBeforeUnload()},callbackOnBeforeUnload:function(){},getAndroidVersion:function(t){var e=t||navigator.userAgent,i=e.match(/Android\s([0-9\.]*)/);return i?i[1]:!1},getObjectValueIfExists:function(t,e){if(t){var i=e.split(".");_.each(i,function(e){t=t&&t[e]?t[e]:void 0})}return t},isMobileWidth:function(){return $(window).width()<768},getClickOnDocumentsFixedParams:function(){},isTabletWidth:function(){return $(window).width()>=768&&$(window).width()<948},hash:function(t,e,i,r){function s(t,e){var i=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(i>>16);return r<<16|65535&i}function o(t,e){return t<<e|t>>>32-e}function n(t,e,i,r,n,a){return s(o(s(s(e,t),s(r,a)),n),i)}function a(t,e,i,r,s,o,a){return n(e&i|~e&r,t,e,s,o,a)}function c(t,e,i,r,s,o,a){return n(e&r|i&~r,t,e,s,o,a)}function u(t,e,i,r,s,o,a){return n(e^i^r,t,e,s,o,a)}function d(t,e,i,r,s,o,a){return n(i^(e|~r),t,e,s,o,a)}function l(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var i=1732584193,r=-271733879,o=-1732584194,n=271733878,l=0;l<t.length;l+=16){var h=i,p=r,f=o,m=n;i=a(i,r,o,n,t[l+0],7,-680876936),n=a(n,i,r,o,t[l+1],12,-389564586),o=a(o,n,i,r,t[l+2],17,606105819),r=a(r,o,n,i,t[l+3],22,-1044525330),i=a(i,r,o,n,t[l+4],7,-176418897),n=a(n,i,r,o,t[l+5],12,1200080426),o=a(o,n,i,r,t[l+6],17,-1473231341),r=a(r,o,n,i,t[l+7],22,-45705983),i=a(i,r,o,n,t[l+8],7,1770035416),n=a(n,i,r,o,t[l+9],12,-1958414417),o=a(o,n,i,r,t[l+10],17,-42063),r=a(r,o,n,i,t[l+11],22,-1990404162),i=a(i,r,o,n,t[l+12],7,1804603682),n=a(n,i,r,o,t[l+13],12,-40341101),o=a(o,n,i,r,t[l+14],17,-1502002290),r=a(r,o,n,i,t[l+15],22,1236535329),i=c(i,r,o,n,t[l+1],5,-165796510),n=c(n,i,r,o,t[l+6],9,-1069501632),o=c(o,n,i,r,t[l+11],14,643717713),r=c(r,o,n,i,t[l+0],20,-373897302),i=c(i,r,o,n,t[l+5],5,-701558691),n=c(n,i,r,o,t[l+10],9,38016083),o=c(o,n,i,r,t[l+15],14,-660478335),r=c(r,o,n,i,t[l+4],20,-405537848),i=c(i,r,o,n,t[l+9],5,568446438),n=c(n,i,r,o,t[l+14],9,-1019803690),o=c(o,n,i,r,t[l+3],14,-187363961),r=c(r,o,n,i,t[l+8],20,1163531501),i=c(i,r,o,n,t[l+13],5,-1444681467),n=c(n,i,r,o,t[l+2],9,-51403784),o=c(o,n,i,r,t[l+7],14,1735328473),r=c(r,o,n,i,t[l+12],20,-1926607734),i=u(i,r,o,n,t[l+5],4,-378558),n=u(n,i,r,o,t[l+8],11,-2022574463),o=u(o,n,i,r,t[l+11],16,1839030562),r=u(r,o,n,i,t[l+14],23,-35309556),i=u(i,r,o,n,t[l+1],4,-1530992060),n=u(n,i,r,o,t[l+4],11,1272893353),o=u(o,n,i,r,t[l+7],16,-155497632),r=u(r,o,n,i,t[l+10],23,-1094730640),i=u(i,r,o,n,t[l+13],4,681279174),n=u(n,i,r,o,t[l+0],11,-358537222),o=u(o,n,i,r,t[l+3],16,-722521979),r=u(r,o,n,i,t[l+6],23,76029189),i=u(i,r,o,n,t[l+9],4,-640364487),n=u(n,i,r,o,t[l+12],11,-421815835),o=u(o,n,i,r,t[l+15],16,530742520),r=u(r,o,n,i,t[l+2],23,-995338651),i=d(i,r,o,n,t[l+0],6,-198630844),n=d(n,i,r,o,t[l+7],10,1126891415),o=d(o,n,i,r,t[l+14],15,-1416354905),r=d(r,o,n,i,t[l+5],21,-57434055),i=d(i,r,o,n,t[l+12],6,1700485571),n=d(n,i,r,o,t[l+3],10,-1894986606),o=d(o,n,i,r,t[l+10],15,-1051523),r=d(r,o,n,i,t[l+1],21,-2054922799),i=d(i,r,o,n,t[l+8],6,1873313359),n=d(n,i,r,o,t[l+15],10,-30611744),o=d(o,n,i,r,t[l+6],15,-1560198380),r=d(r,o,n,i,t[l+13],21,1309151649),i=d(i,r,o,n,t[l+4],6,-145523070),n=d(n,i,r,o,t[l+11],10,-1120210379),o=d(o,n,i,r,t[l+2],15,718787259),r=d(r,o,n,i,t[l+9],21,-343485551),i=s(i,h),r=s(r,p),o=s(o,f),n=s(n,m)}return[i,r,o,n]}function h(t){for(var e=[],i=(1<<r)-1,s=0;s<t.length*r;s+=r)e[s>>5]|=(t.charCodeAt(s/r)&i)<<s%32;return e}function p(t){for(var e="",i=(1<<r)-1,s=0;s<32*t.length;s+=r)e+=String.fromCharCode(t[s>>5]>>>s%32&i);return e}function f(t){for(var e=i?"0123456789ABCDEF":"0123456789abcdef",r="",s=0;s<4*t.length;s++)r+=e.charAt(t[s>>2]>>s%4*8+4&15)+e.charAt(t[s>>2]>>s%4*8&15);return r}return e=e||!1,i=i||!1,r=r||8,e?p(l(h(t),t.length*r)):f(l(h(t),t.length*r))},UTF8_decode:function(t){for(var e="",i=c=c1=c2=0;i<t.length;)c=t.charCodeAt(i),c<128?(e+=String.fromCharCode(c),i++):c>191&&c<224?(c2=t.charCodeAt(i+1),e+=String.fromCharCode((31&c)<<6|63&c2),i+=2):(c2=t.charCodeAt(i+1),c3=t.charCodeAt(i+2),e+=String.fromCharCode((15&c)<<12|(63&c2)<<6|63&c3),i+=3);return e},UTF8_encode:function(t){var e="";t=t.replace(/\r\n/g,"\n");for(var i=0;i<t.length;i++){var r=t.charCodeAt(i);128>r?e+=String.fromCharCode(r):r>127&&2048>r?(e+=String.fromCharCode(r>>6|192),e+=String.fromCharCode(63&r|128)):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128),e+=String.fromCharCode(63&r|128))}return e},getInteractiveChartLanguage:function(t){switch(t){case"en":return"en_US";case"ca":return"ca_ES";case"es":return"es_ES";case"fr":return"fr_FR";default:return"es_ES"}},padRight:function(t,e,i){try{return t+Array(e-t.length+1).join(i||" ")}catch(r){return t}},chartDailyXAxisFormatter:function(t){return Highcharts.dateFormat("%b' %y",t,t)},xmlToJson:function(t){var e,i,r={};if("string"==typeof t?(e=new DOMParser,i=e.parseFromString(t,"text/xml")):"object"==typeof t&&(i=t),1==i.nodeType){if(i.attributes.length>0){r["@attributes"]={};for(var s=0;s<i.attributes.length;s++){var o=i.attributes.item(s);r["@attributes"][o.nodeName]=o.nodeValue}}}else 3==i.nodeType&&(r=i.nodeValue);if(i.hasChildNodes())for(var n=0;n<i.childNodes.length;n++){var a=i.childNodes.item(n),c=a.nodeName;if("undefined"==typeof r[c])r[c]=IFB.Utils.Helper.xmlToJson(a);else{if("undefined"==typeof r[c].push){var u=r[c];r[c]=[],r[c].push(u)}r[c].push(IFB.Utils.Helper.xmlToJson(a))}}return r}};IFB.Utils.Helper=t,window.onbeforeunload=IFB.Utils.Helper.onBeforeUnload}(),function(){defaults={pageSize:10,pageGroup:5,currentPage:void 0,totalPages:void 0,collection:[]},IFB.Utils.Pager=Pager=function(t){_.extend(this,this.config(t))},Pager.prototype={config:function(t){var e=_.extend(_.defaults({},defaults),t);return e.collection=_.isArray(e.collection)?e.collection:[],e.totalPages=Math.ceil(e.collection.length/e.pageSize),e.currentPage=e.totalPages>0?1:void 0,e},getCurrentPage:function(){return this.currentPage},isFirstPage:function(){return 1===this.currentPage},isLastPage:function(){return this.currentPage===this.totalPages},getPrevPage:function(){return this.currentPage-1},getNextPage:function(){return this.currentPage+1},getLastPage:function(){return this.totalPages},getCurrentPageGroup:function(t){t=t||this.currentPage,totalPages=this.totalPages;var e=Math.floor((t-1)/this.pageGroup)*this.pageGroup+1,i=Math.min(totalPages,e+this.pageGroup-1);return{from:e,to:i,isFirst:function(){return 1===this.from},isLast:function(){return this.to===totalPages}}},isFirstGroup:function(){return this.getCurrentPageGroup().isFirst()},isLastGroup:function(){return this.getCurrentPageGroup().isLast()},getPrevGroupPage:function(){return this.getCurrentPageGroup().from-1},getNextGroupPage:function(){return this.getCurrentPageGroup().to+1},getContent:function(t){t=t||this.currentPage;var e=this.pageSize*(this.currentPage-1),i=e+Math.min(this.collection.length-e,this.pageSize);return this.collection.slice(e,i)},goToPage:function(t){return 1>t||t>this.totalPages||t===this.currentPage?!1:(this.currentPage=t,!0)},enumAllPages:function(){for(var t=[],e=1;e<=this.totalPages;e+=1)t.push(e);return t},enumGroupPages:function(){for(var t=[],e=this.getCurrentPageGroup(),i=e.from;i<=e.to;i+=1)t.push(i);return t}}}(),IFB.Utils.ProductConfig={productConfiguration:void 0,initializeProductConfig:function(t,e){var i=this,r=new IFB.Services.Management;r.getProductConfig({session:t},function(t){i._readProductConfig(t,e)},this)},_readProductConfig:function(t,e){var i=JSON.parse(t);i.status.ok&&"0"!==i.answer&&void 0!==i.answer&&(this.productConfiguration=i.answer.Configuracion),_.isFunction(e)&&e()},getEventos:function(){return this.productConfiguration.Eventos||{}},getGeneral:function(){return this.productConfiguration.General||{}},getApariencia:function(){return this.productConfiguration.Apariencia||{}},getBuscador:function(){return this.productConfiguration.Buscador||{}},getBuscadorHT:function(){return this.productConfiguration.BuscadorHT||{}},getChart:function(){return this.productConfiguration.Chart||{}},getCE:function(){return this.productConfiguration.CE||{}},getAcciones:function(){return this.productConfiguration.Acciones||{}},getContratacion:function(){return this.productConfiguration.Contratacion||{}},getBuscadorHTPattern:function(){return this.productConfiguration&&this.productConfiguration.BuscadorHT?this.productConfiguration.BuscadorHT.Criterios:{}}},IFB.Utils.ReadStatusConfig={sources:"",sessionDate:void 0,groups:{},DATE_FORMAT:"YYYYMMDD",defaults:{loadOnInitialize:!0,file:"MensajesSesionLeidos",type:"NOTIF",replace:"1",waitForSaveMillis:500,transform:"1"},initialize:function(t,e){_.defaults(this,t||{},this.defaults),this.mgService=new IFB.Services.Management({}),this.save=this.waitForSaveMillis>0?_.debounce(this._save,this.waitForSaveMillis):this._save,this.sessionDate=this.getDate(),this.loadOnInitialize?this.load(e):e(null,this)},load:function(t){var e=this;this.mgService.loadFile({session:this.session||IFB.Services.Session,file:this.file,type:this.type,transform:this.transform},function(i){try{e.onLoadFile(i,e),_.isFunction(t)&&t(null,e,i)}catch(r){_.isFunction(t)&&t(r,e,i)}})},onLoadFile:function(t){var e=JSON.parse(t);e.status&&e.status.ok?this.setJsonState(e.answer):console.log("No se ha podido cargar estado: "+this.file)},markAsRead:function(t,e,i){this.checkSessionDate();var r=this.getGroup(t),s=this.findInGroup(r,e);-1===s&&(r.push(e),this.save(i),IFB.Events.trigger("newsMarkedAsRead",{source:t,key:e,date:i},this))},isRead:function(t,e){var i=this.getGroup(t),r=this.findInGroup(i,e);return r>-1},getReadItems:function(t){return this.getGroup(t)||[]},_save:function(t,e){var i=this;this.mgService.saveFile({session:this.session||IFB.Services.Session,file:this.file,type:this.type,replace:this.replace,content:JSON.stringify(this.getJsonState()),transform:this.transform},function(t){_.isFunction(e)&&e(null,i,t)})},getJsonState:function(){var t={NOT:{FECHA:this.sessionDate,FUENTES:[]}};return _.each(this.groups,function(e,i){t.NOT.FUENTES.push({TIPO:i,ITEMS:e})}),t},setJsonState:function(t){var e=[],i=[],r={};t.NOT&&(e=_.isArray(t.NOT.FUENTES)?t.NOT.FUENTES:[t.NOT.FUENTES],_.each(e,function(t){i=_.isArray(t.ITEMS)?t.ITEMS:[t.ITEMS],r[t.TIPO]=i||[]},this),this.groups=r,t.NOT.FECHA&&(this.sessionDate=t.NOT.FECHA))},checkSessionDate:function(){var t=this.getDate();Number(t)>Number(this.sessionDate)&&(this.sessionDate=t,this.groups={})},getGroup:function(t){return _.has(this.groups,t)||(this.groups[t]=[]),this.groups[t]},findInGroup:function(t,e){return _.indexOf(t,e)},getDate:function(){return moment().format(this.DATE_FORMAT)}},IFB.Utils.ReversePolishNotation={OPERATOR_ADD:"+",OPERATOR_SUBTRACT:"-",OPERATOR_MULTIPLY:"*",OPERATOR_DIVIDE:"/",OPERATOR_IF:"S",OPERATOR_EQUAL:"=",OPERATOR_MORETHAN:">",OPERATOR_LESSTHAN:"<",OPERATOR_MORETHANEQUAL:"M",OPERATOR_LESSTHANEQUAL:"m",TOKEN_DESCRIPTOR:"D",TOKEN_DESCRIPTOR_SUMATOTAL:"T",TOKEN_JSON:"J",TOKEN_NUMERO:"N",TOKEN_CADENA:"C",TOKEN_OPERATOR:"O",TIPO_DESCRIPTOR_NUMERO:"N",formula:void 0,data:{},header:void 0,stack:[],formulaStack:[],instrument:{},initConfig:function(t,e,i){this.instrument=e,this.formula=t,this.data=e.data,this.header=i,this.stack=[],this.formulaStack=[]},loadFormula:function(){var t=this,e=this.formula.split("|");_.each(e,function(e){t.readToken(e)})},getDescriptorType:function(t){var e=void 0;if(void 0!==this.header){var i=_.find(this.header.collection.models,function(e){return e.id===t},this);if(void 0!==i)return i.data.type}return e},getTotalDescriptorValue:function(t){var e=this.getTotalValue("DT"+t.substring(1));switch(this.getDescriptorType(t.substring(1))){case this.TIPO_DESCRIPTOR_NUMERO:return Number(e)}return e},getDescriptorValue:function(t){var e=_.find(this.header.collection.models,function(e){return e.id===t.substring(1)},this),i=this.instrument.getRawDataFromColumnadoConfig(e);return i},getValue:function(t){if(""!==t&&"undefined"!=typeof t){var e="";switch(t.type){case this.TOKEN_DESCRIPTOR_SUMATOTAL:e=this.getTotalDescriptorValue(t);break;case this.TOKEN_DESCRIPTOR:e=this.getDescriptorValue(t);break;case this.TOKEN_JSON:e=Number(this.getDataValue(t.substr(1)));break;case this.TOKEN_NUMERO:case this.TOKEN_CADENA:e=Number(t.substr(1));break;default:e=t}return e}},readToken:function(t){if(""!==t&&"undefined"!=typeof t){var e=t.substr(0,1);switch(e){case this.TOKEN_DESCRIPTOR_SUMATOTAL:this.stack.push({type:e,value:this.getTotalDescriptorValue(t)});break;case this.TOKEN_DESCRIPTOR:this.stack.push({type:e,value:this.getDescriptorValue(t)});break;case this.TOKEN_JSON:this.stack.push({type:e,value:Number(this.getDataValue(t.substr(1)))});break;case this.TOKEN_NUMERO:case this.TOKEN_CADENA:this.stack.push({type:e,value:Number(t.substr(1))});break;default:this.stack.push({type:this.TOKEN_OPERATOR,value:t})}}},getDataValue:function(t){var e=this.data[t];return void 0!==e?e:""},getTotalValue:function(t){var e=this.data[t];return void 0!==e?e:""},evaluateFormulaFrom:function(t){var e=this;return this.data=t,_.each(this.stack,function(i){i.type===e.TOKEN_OPERATOR?e.evaluateOperator(i.value):e.formulaStack.push(e.getValue(i,t))}),this.formulaStack.pop()},evaluateFormula:function(t,e,i){var r=this;this.initConfig(t,e,i),this.loadFormula(),_.each(this.stack,function(t){t.type===r.TOKEN_OPERATOR?r.evaluateOperator(t.value):r.formulaStack.push(t.value)});var s=this.formulaStack.pop();return _.isFinite(s)?s:Number.NaN},evaluateOperator:function(t){switch(t){case this.OPERATOR_IF:this.evaluateOperatorTrinary(t);break;default:this.evaluateOperatorBinary(t)}},evaluateOperatorBinary:function(t){var e=this.formulaStack.pop(),i=this.formulaStack.pop();switch(t){case this.OPERATOR_ADD:this.formulaStack.push(i+e);break;case this.OPERATOR_SUBTRACT:this.formulaStack.push(i-e);break;case this.OPERATOR_MULTIPLY:this.formulaStack.push(i*e);break;case this.OPERATOR_DIVIDE:this.formulaStack.push("0"!==e?i/e:"0");break;case this.OPERATOR_EQUAL:this.formulaStack.push(i===e?1:0);break;case this.OPERATOR_MORETHAN:this.formulaStack.push(i>e?1:0);break;case this.OPERATOR_LESSTHAN:this.formulaStack.push(e>i?1:0);break;case this.OPERATOR_MORETHANEQUAL:this.formulaStack.push(i>=e?1:0);break;case this.OPERATOR_LESSTHANEQUAL:this.formulaStack.push(e>=i?1:0)}},evaluateOperatorTrinary:function(t){var e=this.formulaStack.pop(),i=this.formulaStack.pop(),r=this.formulaStack.pop();switch(t){case this.OPERATOR_IF:this.formulaStack.push(r?i:e)}},getDescriptors:function(t){var e=this,i=[],r=t.split("|");return _.each(r,function(t){""!==t&&"undefined"!=typeof t&&t.substr(0,1)===e.TOKEN_DESCRIPTOR&&i.push(t)}),i}},function(){var t={templateVersion:"0.0.10",templates:{},loadRemoteTemplate:function(t,e,i){if(this.templates[t])i(this.templates[t]);else{$.get(this.getTemplateUrl(e),function(t){i(t)})}},addTemplate:function(t,e){this.templates[t]=e},localStorageAvailable:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},saveLocalTemplates:function(){this.localStorageAvailable&&(localStorage.setItem("templates",JSON.stringify(this.templates)),localStorage.setItem("templateVersion",this.templateVersion))},loadLocalTemplates:function(){if(this.localStorageAvailable){var t=localStorage.getItem("templateVersion");if(t&&t==this.templateVersion){var e=localStorage.getItem("templates");if(e){e=JSON.parse(e);for(var i in e)this.templates[i]||this.addTemplate(i,e[i])}}else localStorage.removeItem("templates"),localStorage.removeItem("templateVersion")}},getTemplateUrl:function(t){var e="1"===this.getURLParameter("debug");return e||!IFB.Templates.Versioned?IFB.Templates.baseURL+t+"?_dc="+(new Date).getTime():IFB.Templates.baseURL+"/"+IFB.VERSION.CLIENT+t},getURLParameter:function(t){return decodeURI((RegExp(t+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}};t.loadLocalTemplates(),IFB.Utils.TemplateLoader=t}(),function(){var t="00:00",e=function(e,i){var r=moment(),s=t;if(e=(e&&e.match(/[0-9]{8}/)?moment(e,"YYYYMMDD"):r).format("YYYY-MM-DD"),i){var o=i.match(/[0-9]{2}:[0-9]{2}/);_.isArray(o)&&o.length>0&&(s=o[0])}return moment(e+"T"+s)},i=function(t,e){var i=moment(t+e,"YYYYMMDDHHmmss");return i&&i.isValid()?i:moment()},r={getTradeTimeStatus:function(t,r,s){var o=e(t,s);return{preOpeningTime:o.clone().add("minutes",IFB.Utils.Helper.getPreOpeningDiffMinutes()),openingTime:o,lastUpdateTime:i(t,r),getStatus:function(){return this.lastUpdateTime<this.preOpeningTime?"preopening":this.lastUpdateTime<this.openingTime?"opening":""}}},getTradeTimeStatusFromList:function(t,e){var i=this,r=_.max(t,function(t){return t.D60}).D60,s=_.groupBy(t,function(t){return i.getTradeTimeStatus(t.D60,t.D70,e||t.D611).getStatus()||"DEFAULT"}),o=null;return!o&&s.DEFAULT&&(o=_.find(s.DEFAULT,function(t){return t.D60===r})),!o&&s.opening&&(o=_.find(s.opening,function(t){return t.D60===r})),!o&&s.preopening&&(o=_.find(s.preopening,function(t){return t.D60===r})),this.getTradeTimeStatus(o.D60,o.D70,e||o.D611)}};IFB.Utils.TradeTimeUtils=r}(),function(){var t={templateVersion:"0.0.1",templates:{},loadRemoteTemplate:function(t,e,i){if(this.templates[t])i(this.templates[t]);else{var r=this;$.get(e,function(e){r.addTemplate(t,e),i(e)})}},addTemplate:function(t,e){this.templates[t]=e},localStorageAvailable:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},saveLocalTemplates:function(){this.localStorageAvailable&&(localStorage.setItem("templates",JSON.stringify(this.templates)),localStorage.setItem("templateVersion",this.templateVersion))},loadLocalTemplates:function(){if(this.localStorageAvailable){var t=localStorage.getItem("templateVersion");if(t&&t===this.templateVersion){var e=localStorage.getItem("templates");if(e){e=JSON.parse(e);for(var i in e)this.templates[i]||this.addTemplate(i,e[i])}}else localStorage.removeItem("templates"),localStorage.removeItem("templateVersion")}}};t.loadLocalTemplates(),window.templateLoader=t}(),IFB.Models.Account=Backbone.Model.extend({id:void 0,data:void 0,initialize:function(){this.data=this.toJSON(),this.set({id:this.getDescriptorValue(IFB.Descriptors.Trader.Cuentas.Account.descriptor)})},getId:function(){return this.id},getAccount:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.Cuentas.Account.descriptor)},getCashBuy:function(){return this.formatAsNumber(IFB.Descriptors.Trader.Cuentas.CashBuy.descriptor,4)},getCashAvailable:function(t){return t=t||0===t?t:4,this.formatAsNumber(IFB.Descriptors.Trader.Cuentas.CashAvailable.descriptor,t)},getCashInitial:function(){return this.formatAsNumber(IFB.Descriptors.Trader.Cuentas.CashInitial.descriptor,4)},getCashSell:function(){return this.formatAsNumber(IFB.Descriptors.Trader.Cuentas.CashSell.descriptor,4)},getDescriptorValue:function(t){return this.data[t]||""},formatValueAsNumber:function(t,e,i,r,s){if(void 0!==i&&(!t||"0"===t||""===t))return i;var o=accounting.formatNumber(t,{precision:e,zero:i||""});return o+=s||"",r&&t>0&&-1===o.indexOf(r)?r+o:o},formatAsNumber:function(t,e,i,r,s){return this.formatValueAsNumber(this.getDescriptorValue(t),e,i,r,s)},setDescriptorValue:function(t,e){var i=this.data[t];return this.data[t]=e,i},createDescriptorsCalculated:function(){}}),IFB.Models.Alert=Backbone.Model.extend({id:void 0,data:void 0,initialize:function(){this.data=this.toJSON(),this.data.General&&this.set({id:this.data.General.ID})},formatValueAsDate:function(t,e){return e=e||"DD/MM/YYYY",t&&(t=moment(t,"YYYYMMDD").format(e)),t},formatValueAsTime:function(t,e){return e=e||"HH:mm",t&&(t=moment(t,"HHmmss").format(e)),t},getName:function(){return this.data.General?this.data.General.Nombre:""},getCreatioinDate:function(t){try{return this.formatValueAsDate(this.data.General.Fecha,t)}catch(e){return""}},getCreationTime:function(t){try{return this.formatValueAsTime(this.data.General.Hora,t)}catch(e){return""}},isEnabled:function(){return this.data.General?"1"===this.data.General.Activa:!1},getDescription:function(){return this.data.General?this.data.General.Observaciones:""},getGMT:function(){return this.data.General?this.data.General.GMT:""},getLanguage:function(){return this.data.General?this.data.General.Idioma:""},getUnderlyingMV:function(){return this.data.Tipo?this.data.Tipo.Subtipo.Param1:""}}),IFB.Models.BoletaOrder=Backbone.Model.extend({initialize:function(t){this.initializeModel(t),this.createDataValidators(),this.createValidators()},DEFAULTS_DECIMALS:3,DEFAULTS_DATE_FORMAT:"DD/MM/YYYY",DEFAULTS_DATE_FORMAT_RAW:"YYYYMMDD",DATE_INPUT_FORMAT_RAW:"YYYY-MM-DD",initializeModel:function(t){this.set("productType",t.dataInstrument[IFB.Descriptors.Derivatives_Product_Type.descriptor]),this.set("decimals",t.dataInstrument[IFB.Descriptors.Decimals.descriptor]||this.DEFAULTS_DECIMALS),this.set("instrumentType",t.dataInstrument[IFB.Descriptors.InstrumentType.descriptor]),this.set("MIC",t.dataInstrument[IFB.Descriptors.MIC.descriptor]),this.set("id",t.dataInstrument.MV),this.set("MV",t.dataInstrument.MV),this.set("idAccount",t.idAccount),this.set("volume",t.quantity),this.set("isin",t.dataInstrument[IFB.Descriptors.Isin.descriptor]),this.set("last",t.dataInstrument[IFB.Descriptors.Last.descriptor]),this.set("price",Number(IFB.Trader.sideOptions[t.side].value===IFB.Trader.sideOptions.BUY.value?t.dataInstrument[IFB.Descriptors.AskPrice.descriptor]:t.dataInstrument[IFB.Descriptors.BidPrice.descriptor])),this.set("side",IFB.Trader.sideOptions[t.side].value),this.set("name",t.dataInstrument[IFB.Descriptors.IFBShortName.descriptor]),this.set("orderType",IFB.Trader.orderTypeOptions.LIMIT.value),this.set("currency",t.dataInstrument[IFB.Descriptors.Currency.descriptor]),this.set("exectype",this.execTypeOptions.EXECTYPE_NONE),this.set("expireTime",this.expireTimeOptions.FIX_EXPIRETIME_SESSION),this.set("lastPrice",t.dataInstrument[IFB.Descriptors.Last.descriptor]),this.set("minQuantity",t.dataInstrument[IFB.Descriptors.Trader.MinQuantityFIX.descriptor]),this.set("stopPrice",t.dataInstrument[IFB.Descriptors.Trader.StopPriceFIX.descriptor]),this.set("maxFloor",t.dataInstrument[IFB.Descriptors.Trader.MaxFloorFIX.descriptor])},expireTimeOptions:{FIX_EXPIRETIME_SESSION:"0",FIX_EXPIRETIME_DATE:"6"},execTypeOptions:{EXECTYPE_NONE:"0",EXECTYPE_CONDICIONES_ADICIONALES_EJECUTAR_O_ANULAR:"3",EXECTYPE_CONDICIONES_ADICIONALES_TODO_NADA:"4",EXECTYPE_MINQTY:"M"},defaults:{instrumentType:void 0,exectype:"0",name:"",idAccount:"",MV:"",price:0,lastPrice:0,volume:0,amount:0,isin:"",currency:"EUR",expireDate:moment().format(this.DEFAULTS_DATE_FORMAT_RAW),expireTime:"0",last:0,minQuantity:0,stopPrice:0,maxFloor:0},getDescriptorValue:function(t){return this.getRawValue(t)},getRawValue:function(t){return this.get(t)||""},formatAsNumber:function(t,e,i,r,s){return this.formatValueAsNumber(this.getRawValue(t),e,i,r,s)},formatValueAsNumber:function(t,e,i,r,s){if(void 0!==i&&(!t||"0"===t||""===t))return i;var o=accounting.formatNumber(t,{precision:e,zero:i||""});return o+=s||"",r&&t>0&&-1===o.indexOf(r)?r+o:o},formatValueAsDate:function(t,e){return e=e||this.DEFAULTS_DATE_FORMAT,t&&(t=moment(t,this.DEFAULTS_DATE_FORMAT_RAW).format(e)),t},formatAsDate:function(t,e){return this.formatValueAsDate(this.getRawValue(t),e)},getDecimals:function(t){var e=this.getRawValue("decimals");return/^\s*\d+\s*$/.test(e)?parseInt(e,10):t||this.DEFAULTS_DECIMALS},getPrice:function(t){try{t=t||0===t?t:this.getDecimals();var e=this.formatAsNumber("price",t,"");return e=e.replace(accounting.settings.number.thousand,"")}catch(i){}},getStopPrice:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber("stopPrice",t,"")}catch(e){}},getVolume:function(){try{return this.formatAsNumber("volume",0,"")}catch(t){}},getRawVolume:function(){try{var t=this.getRawValue("volume");if(t&&t>0)return this.getRawValue("volume")}catch(e){}},getMinQuantity:function(){try{return this.formatAsNumber("minQuantity",0,"")}catch(t){}},getMaxFloor:function(){try{return this.formatAsNumber("maxFloor",0,"")}catch(t){}},getIntraday:function(){return"on"===this.getRawValue("intraday")},getAmount:function(t){try{var e=this.getRawValue("last")*this.getRawValue("volume");return t=t||0===t?t:this.getDecimals(),this.formatValueAsNumber(e,t)}catch(i){}},getAmountSend:function(){try{return this.getRawValue("last")*this.getRawValue("volume")}catch(t){}},getSide:function(){return this.getRawValue("side")},getSideCls:function(){return"1"===this.getRawValue("side")?"buy":"sell"},getAccount:function(){return this.getRawValue("idAccount")},getOrderTypeText:function(){var t=this.getRawValue("orderType");return IFB.Trader.getOrderTypeText(t)},getOrderType:function(){var t=this.getRawValue("orderType");return IFB.Trader.getOrderType(t)},getExecType:function(){return this.getRawValue("exectype")},getExpireTime:function(){var t=this.getExpireDate(this.DEFAULTS_DATE_FORMAT_RAW);return t&&t!==moment().format("YYYYMMDD")?"6":"0"},getIsin:function(){return this.getRawValue("isin")},getName:function(){return this.getRawValue("name")},getCurrency:function(){return this.getRawValue("currency")},getExpireDate:function(t){try{var e=this.getRawValue("expireDate");if(e&&-1===e.search("Invalid"))return this.formatValueAsDate(e,t)}catch(i){}},getMarket:function(){var t=this.getRawValue("MV");return t.substring(0,2)},getValue:function(){var t=this.getRawValue("MV");return t.substring(2)},getMIC:function(){return this.getRawValue("MIC")},getOrderToTrader:function(){var t={MIC:this.getMIC(),ExecType:this.getExecType(),Currency:this.getCurrency(),ISIN:this.getIsin(),Market:this.getMarket(),Value:this.getValue(),Side:this.getSide(),OrderType:this.getOrderType(),Quantity:this.getRawValue("volume"),ExpireDate:this.getExpireDate(this.DEFAULTS_DATE_FORMAT_RAW),ExpireTime:this.getExpireTime(),Account:this.getAccount(),Amount:this.getAmountSend(),Intradia:this.getIntraday()};if(this.isPriceToSend()&&(t.Price=this.getRawValue("price")),t.ExecType===this.execTypeOptions.EXECTYPE_MINQTY){t.ExecType=this.execTypeOptions.EXECTYPE_NONE;var e=this.getRawValue("minQuantity");void 0!==e&&""!==e&&"0"!==e&&(t.MinQty=this.getMinQuantity())}if(t.OrderType===IFB.Trader.orderTypeOptions.STOP.value||t.OrderType===IFB.Trader.orderTypeOptions.STOP_LIMIT.value){var i=this.getRawValue("stopPrice");""!==i&&"0"!==i&&(t.StopPrice=this.getStopPrice(3))}var r=this.getRawValue("maxFloor");return""!==r&&"0"!==r&&(t.MaxFloor=this.getMaxFloor()),t},getLast:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber("last",t)}catch(e){}},setDescriptorValue:function(t,e){var i=this.data[t];return this.data[t]=e,i},setModel:function(t){var e=this;try{_.each(t,function(t,i){e.isNumberField(i)?e.set(i,accounting.unformat(t,accounting.settings.number.decimal)):e.isDateField(i)?e.set(i,moment(t,e.DEFAULTS_DATE_FORMAT).format(e.DEFAULTS_DATE_FORMAT_RAW)):e.set(i,t)})}catch(i){}},isNumberField:function(t){var e=this.validation[t];return e?_.isArray(e)?_.some(e,function(t){return t.pattern&&("number"===t.pattern||"digits"===t.pattern)}):e.pattern&&("number"===e.pattern||"digits"===e.pattern):!1},isDateField:function(t){var e=this.validation[t];return e?_.isArray(e)?_.some(e,function(t){return t.date}):e.date:!1},createDataValidators:function(){this.validation={price:[{required:!0,pattern:"number",msg:"Indicar un precio válido. Máximo tres decimales separados por ','"},{decimals:this.getDecimals()},{pattern:"positive",msg:"Por favor, introduzca un precio mayor que cero"}],volume:{required:!0,min:1,msg:"Por favor, introduzca el número de títulos correcto",pattern:"integer"},minQuantity:{required:!0,min:1,msg:"Por favor, introduzca un volumen mínimo correcto",pattern:"digits"},expireDate:[{required:!0,msg:"Por favor, introduzca una fecha de expiración"},{date:{unavailableWeekend:!0,validRange:{initDate:moment(),endDate:moment().add("d",90)}}}],stopPrice:[{required:!0,pattern:"number",msg:"Indicar un precio de disparo válido. Máximo tres decimales separados por ','"},{decimals:this.getDecimals()},{pattern:"positive",msg:"Por favor, introduzca un precio de disparo mayor que cero"}],maxFloor:{required:!0,min:1,msg:"Por favor, introduzca el volumen oculto",pattern:"digits"}}
},createValidators:function(){_.extend(Backbone.Validation.validators,{decimals:function(t,e,i,r){var s=new RegExp("^[-]?\\d*(\\"+accounting.settings.number.decimal+"\\d{1,"+i+"})?$");return s.test(t)?void 0:"Sólo se admiten "+r.getDecimals()+" decimales como máximo"},date:function(t,e,i,r){var s=0,o=6;if(t){var n=moment(t,r.DEFAULTS_DATE_FORMAT);return n.isValid()?i.validRange&&(n.isBefore(i.validRange.initDate.startOf("day"))||n.isAfter(i.validRange.endDate))?"Fecha fuera del rango permitido":!i.unavailableWeekend||n.day()!==o&&n.day()!==s?void 0:"La fecha elegida coincide con el fin de semana. Por favor, seleccione otra fecha":"Formato de fecha no valido"}}}),_.extend(Backbone.Validation.patterns,{date:/^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/,positive:/^0*[1-9][0-9]*(\,[0-9]+)?|0+\,[0-9]*[1-9][0-9]*$/,integer:/^\d+$/}),_.extend(Backbone.Validation.messages,{date:"Por favor, seleccione una fecha correcta",positive:"Por favor, seleccione un número mayor que cero",integer:"Por favor, seleccione un entero"})},getExceTypeText:function(){var t={},e=this.getExecType();switch(e){case this.execTypeOptions.EXECTYPE_MINQTY:var i=this.getMinQuantity();void 0!==i&&0!==Number(i)&&(t.header="Volumen mínimo",t.text=i);break;case this.execTypeOptions.EXECTYPE_CONDICIONES_ADICIONALES_EJECUTAR_O_ANULAR:t.header="Ejecutar o anular",t.text="Sí";break;case this.execTypeOptions.EXECTYPE_CONDICIONES_ADICIONALES_TODO_NADA:t.header="Todo o nada",t.text="Sí";break;case this.execTypeOptions.EXECTYPE_NONE:}return t},isInputPrice:function(t){var t=t||this.getOrderType();return t===IFB.Trader.orderTypeOptions.LIMIT.value||t===IFB.Trader.orderTypeOptions.STOP_LIMIT.value||t===IFB.Trader.orderTypeOptions.LIMIT_INMEDIATE.value||t===IFB.Trader.orderTypeOptions.TODO_O_NADA.value?!0:!1},isPriceToSend:function(t){var t=t||this.getOrderType();return this.isInputPrice(t)||t==IFB.Trader.orderTypeOptions.ATAQUE.value},hasFieldOnstopPrice:function(t){var t=t||this.getOrderType();return t==IFB.Trader.orderTypeOptions.STOP.value||t==IFB.Trader.orderTypeOptions.STOP_MARKET.value||t==IFB.Trader.orderTypeOptions.STOP_LIMIT.value?!0:!1}}),IFB.Models.ChartDailyPoint=Backbone.Model.extend({id:void 0,data:void 0,initialize:function(){this.data=this.toJSON(),this.set({id:this.data.F13})},getHighChartPoint:function(){var t=[];return t.push(moment(this.data.F13,"YYYYMMDD").valueOf()),t.push(Number(this.data.F4)),t.push(Number(this.data.F7)),t.push(Number(this.data.F8)),t.push(Number(this.data.F6)),t},getDate:function(t){return moment(this.data.F13,"YYYYMMDD").format(t||"DD/MM/YYYY")},getOpening:function(t,e,i,r){return this.formatValueAsNumber(this.data.F4,t,e,i,r)},getHigh:function(t,e,i,r){return this.formatValueAsNumber(this.data.F7,t,e,i,r)},getLow:function(t,e,i,r){return this.formatValueAsNumber(this.data.F8,t,e,i,r)},getClose:function(t,e,i,r){return this.formatValueAsNumber(this.data.F6,t,e,i,r)},getVolume:function(t,e,i,r){return this.formatValueAsNumber(this.data.F5,t,e,i,r)},getChangePercent:function(){},formatValueAsNumber:function(t,e,i,r,s){if(i&&(!t||"0"===t))return i;var o=accounting.formatNumber(t,{precision:"number"==typeof e?e:this.getDecimals(),zero:i||""});return o+=s||"",r&&t>0&&-1===o.indexOf(r)?r+o:o}}),IFB.Models.ChartIntradayPoint=Backbone.Model.extend({id:void 0,data:void 0,initialize:function(){this.data=this.toJSON(),this.set({id:this.data.F4})}}),IFB.Models.Columnado=Backbone.Model.extend({idAttribute:"descriptor",data:void 0,id:void 0,columnTypes:{Time:"H",Date:"F",Number:"N",Caracter:"C"},columnOrigin:{DIRECTO:"0",FECHAHORA:"1",CALCULADO:"2",COMPARACION:"3",FORMULA_WT:"4",FORMULA:"5",NOTICIA:"N",FECHA:"F",EXTERNO:"E"},calculationTypeExternalSource:{BANCOMER_WT:"4"},defaultAlignmentCss:["ifb-alignLeft","ifb-alignCenter",""],initialize:function(){this.data=this.toJSON(),this.id=this.data.ID},getId:function(){return this.id},getDescriptorId:function(){return"D"+this.id},getAttribute:function(t){return this.data[t]},getAggregation:function(){return this.getAttribute("Aggregation")||""},getAlgor:function(){return this.getAttribute("Algor")||""},getAlignment:function(){return this.getAttribute("Alignment")||""},getDecimals:function(){return this.getAttribute("Decimals")||""},getFixed:function(){return this.getAttribute("Fixed")||""},getName:function(){return this.getAttribute("Name")||""},getNameL:function(){return this.getAttribute("NameL")||""},getOrigin:function(){return this.getAttribute("Origin")||""},getPrice:function(){return this.getAttribute("Price")||""},getRT:function(){return this.getAttribute("RT")||""},getTooltip:function(){return this.getAttribute("Tooltip")||""},getType:function(){return this.getAttribute("Type")||""},getTypeStreaming:function(){var t=this.getAttribute("Type")||"",e="";if(t)switch(t){case this.columnTypes.Time:e="time";break;case this.columnTypes.Date:e="date";break;case this.columnTypes.Number:e="number";break;case this.columnTypes.Caracter:e="string";break;default:e="string"}return e},getVisible:function(){return this.getAttribute("Visible")||""},getWidth:function(){return this.getAttribute("Width")||""},getZerosDraw:function(){return this.getAttribute("ZerosDraw")||""},isVisible:function(){return _.isUndefined(this.getAttribute("Visible"))?!0:this.getAttribute("Visible")},isFixed:function(){return _.isUndefined(this.getAttribute("Fixed"))?!1:"1"===this.getAttribute("Fixed")},getAction:function(){return this.getAttribute("Action")||""},isTopFlopColored:function(){var t=_.findWhere(IFB.Descriptors,{descriptor:"D"+this.getId()});return _.isUndefined(t)?!1:t.topFlopColored===!0},getCss:function(){var t=_.findWhere(IFB.Descriptors,{descriptor:"D"+this.getId()});return _.isUndefined(t)?"":t.css},getFormatFunction:function(){var t=this,e=this.getTypeStreaming(),i=_.find(_.pairs(IFB.Descriptors),function(e){return e[1].descriptor==="D"+t.getId()});return _.isUndefined(i)?{type:e}:i[1].formatFunction?i[1].formatFunction:{name:"get"+i[0],type:e}},getIcon:function(){return this.getAttribute("Icon")||""},getAlignmentCss:function(t){var e=this.getAlignment(),i=t||this.defaultAlignmentCss;return e=""!==e?Number(e):0,i[e]},isDateOrTimeTypeDescriptor:function(){var t="D"+this.id;return t===IFB.Descriptors.DateOrTimeSituationMessage.descriptor||t===IFB.Descriptors.DateOrTime.descriptor}}),IFB.Models.Error=Backbone.Model.extend({id:void 0,data:void 0,initialize:function(){this.data=this.toJSON()},getErrorCode:function(){return this.data.ErrorCode},getText:function(){return this.data.Text},getProvider:function(){return this.data.Provider}}),IFB.Models.Factset=Backbone.Model.extend({data:void 0,initialize:function(){this.data=this.toJSON()},getDescriptorValue:function(t){return this.data[t]||""},getDateOfInformation:function(){return this.getDescriptorValue("F04")},getBuyRecommendationsMonth:function(){try{return this.formatAsNumber("F27",0)}catch(t){}},getOverWeightRecommendationsMonth:function(){try{return this.formatAsNumber("F28",0)}catch(t){}},getHoldRecommendationsMonth:function(){try{return this.formatAsNumber("F29",0)}catch(t){}},getUnderWeightRecommendationsMonth:function(){try{return this.formatAsNumber("F30",0)}catch(t){}},getSellRecommendationsMonth:function(){try{return this.formatAsNumber("F31",0)}catch(t){}},getTotalRecommendationsMonth:function(){try{return Number(this.getDescriptorValue("F27"))+Number(this.getDescriptorValue("F28"))+Number(this.getDescriptorValue("F29"))+Number(this.getDescriptorValue("F30"))+Number(this.getDescriptorValue("F31"))}catch(t){}},getRecommendationAverage:function(){try{return this.getDescriptorValue("F26")}catch(t){}},formatAsNumber:function(t,e,i,r,s){return this.formatValueAsNumber(this.getDescriptorValue(t),e,i,r,s)},formatValueAsNumber:function(t,e,i,r,s){if(i&&(!t||"0"===t))return i;var o=accounting.formatNumber(t,{precision:e,zero:i||""});return o+=s||"",r&&t>0&&-1===o.indexOf(r)?r+o:o}}),IFB.Models.Header=Backbone.Model.extend({idAttribute:"descriptor",initialize:function(){var t=this.toJSON(),e=_.findWhere(IFB.Descriptors,{descriptor:t.descriptor});this.set(e?$.extend(!0,e,t):t)},getAttribute:function(t){return this.attributes[t]},getCss:function(){return this.getAttribute("css")||""},getText:function(){return this.getAttribute("text")||""},isVisible:function(){return _.isUndefined(this.getAttribute("visible"))?!0:this.getAttribute("visible")},isDynamic:function(){return _.isUndefined(this.getAttribute("dynamic"))?!1:this.getAttribute("dynamic")},isTopFlopColored:function(){return _.isUndefined(this.getAttribute("topFlopColored"))?!1:this.getAttribute("topFlopColored")},getFormatFunction:function(){return this.getAttribute("formatFunction")}}),IFB.Models.Instrument=Backbone.Model.extend({id:void 0,data:void 0,defaultDecimals:2,NATIONAL_MARKET:"M ",NATIONAL_MARKETS:["M ","SV","XX"],INSTRUMENTS_TYPES:{EQUITY:"V",INDEX:"I",FUTURE:"D1",WARRANTS:"W",FUND:"f",INTEREST_RATE:"T",CURRENCY:"d",COMMODITY:"M",DERIVATE:"D",RISK_PREMIUM:"i"},initialize:function(){this.data=this.toJSON(),this.set({id:this.data.MV})},getDecimals:function(t){var e=this.getDescriptorValue(IFB.Descriptors.Decimals.descriptor);return/^\s*\d+\s*$/.test(e)?parseInt(e,10):t||this.defaultDecimals},getDescriptorValue:function(t){return this.data[t]||""},getDescriptorValueOrNull:function(t,e,i){return e=e||"",i=i||"",this.data[t]?this.data[t]+i:e},setDescriptorValue:function(t,e){var i=this.data[t];return this.data[t]=e,i},getCustomDifference:function(t,e){var i=this.data[t],r=this.data[e];return i&&r?this.formatValueAsNumber(i-r,this.getDecimals()):""},getCustomPercentageDifference:function(t,e){var i,r=this.data[t],s=this.data[e];return r&&s?(0!==Number(r)&&(i=(r-s)/r*100),this.formatValueAsNumber(i,this.getDecimals())):""},formatValueAsNumber:function(t,e,i,r,s){if(i&&(!t||"0"===t))return i;var o=accounting.formatNumber(t,{precision:"number"==typeof e?e:this.getDecimals(),zero:i||""});return o+=s||"",r&&t>0&&-1===o.indexOf(r)?r+o:o},formatValueAsDate:function(t,e){return e=e||"DD/MM/YYYY",t&&(t=moment(t,"YYYYMMDD").isValid()?moment(t,"YYYYMMDD").format(e):""),t},formatValueAsTime:function(t,e){return e=e||"HH:mm",t&&(t=moment(t,"HHmmss").add("minutes",IFB.Settings.GmtOffset).format(e)),t},formatValueAsDateOrTime:function(t,e,i){if(e=e||"DD/MM",i=i||"HH:mm",_.isString(t)){if("H"===t.substring(0,1))return this.formatValueAsTime(t.substring(1),i);if("F"===t.substring(0,1))return this.formatValueAsDate(t.substring(1),e)}return""},formatAsNumber:function(t,e,i,r,s){return this.formatValueAsNumber(this.getDescriptorValue(t),e,i,r,s)},formatAsDate:function(t,e){return this.formatValueAsDate(this.getDescriptorValue(t),e)},formatAsTime:function(t,e){return this.formatValueAsTime(this.getDescriptorValue(t),e)},getDescriptorValueWithFormat:function(t,e){var i=_.isObject(e)?e:{decimals:e};try{return i.decimals=i.decimals||0===i.decimals?i.decimals:this.getDecimals(),this.formatAsNumber(t,i.decimals,i.zeroValue,i.positiveSign,i.suffix)}catch(r){}},getInstrumentDetailsUrl:function(){var t=this.getDescriptorValue("MV");return"stock/"+t},getTopFlopClsWithReferenceDescriptor:function(t,e,i){var r=Number(this.getDescriptorValue(t)||"0"),s=Number(this.getDescriptorValue(e)||"0");return i&&3===i.length||(i=["green","red",""]),r>s?i[0]:s>r?i[1]:i[2]},getTopFlopCls:function(t,e){var i=Number(this.getDescriptorValue(t)||"0");return e&&3===e.length||(e=["ifb-top","ifb-flop","ifb-equal"]),t===IFB.Descriptors.Trend.descriptor?1===i?e[0]:2===i?e[1]:e[2]:i>0?e[0]:0>i?e[1]:e[2]},getTopFlopClsInv:function(t){return this.getTopFlopCls(t,["ifb-flop","ifb-top","ifb-equal"])},getAlias:function(t){var e=this.getDescriptorValue(t);return $&&$.t?$.t("infobolsa.global:alias."+e):e},getIcon:function(t){var e=this.getDescriptorValue(t);return $&&$.t?$.t("infobolsa.global:icon."+e):e},getCommodityIcon:function(t){var e=this.getDescriptorValue(t);return $&&$.t?$.t("infobolsa.global:commodityIcon."+e):e},getCommodityUnit:function(t){var e=this.getDescriptorValue(t);return $&&$.t?$.t("infobolsa.global:commodityUnit."+e):e},getValueRangePercent:function(t,e,i){var r=i-e,s=0===r?50:Math.round(100*(t-e)/r);return 0>s?0:s>100?100:s},getNoLimitsValueRangePercent:function(t,e,i){var r=i-e,s=0===r?50:Math.round(100*(t-e)/r);return 0>s?0/0:s>100?0/0:s},isRising:function(){return this.getDescriptorValue(IFB.Descriptors.ChangePercent.descriptor)>0},isLosing:function(){return this.getDescriptorValue(IFB.Descriptors.ChangePercent.descriptor)<0},isEqual:function(){return 0===Number(this.getDescriptorValue(IFB.Descriptors.ChangePercent.descriptor))},getAgrup:function(){try{return this.getDescriptorValue(IFB.Descriptors.ConstituentsCode.descriptor).split("|")[0]}catch(t){}},getShortName:function(){return this.getDescriptorValue(IFB.Descriptors.ShortName.descriptor)},getFriendlyName:function(){return this.getDescriptorValue(IFB.Descriptors.FriendlyName.descriptor)},getIsin:function(){return this.getDescriptorValue(IFB.Descriptors.Isin.descriptor)},getSessionLow:function(t){var e=_.isObject(t)?t:{decimals:t};try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.SessionLow.descriptor,e.decimals,e.zeroValue,e.positiveSign,e.suffix)}catch(i){}},getSessionAverage:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.SessionAverage.descriptor,t)}catch(e){}},getSessionHigh:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.SessionHigh.descriptor,t)}catch(e){}},getLast:function(t){var e=_.isObject(t)?t:{decimals:t};try{return e.decimals=e.decimals||0===e.decimals?e.decimals:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.Last.descriptor,e.decimals,e.zeroValue,e.positiveSign,e.suffix)}catch(i){}},getChangePercent:function(t){t=_.defaults(t||{},{decimals:2});try{return this.formatAsNumber(IFB.Descriptors.ChangePercent.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getChange:function(t){t=t||{},decimals=t.decimals||0===t.decimals?t.decimals:this.getDecimals();try{return this.formatAsNumber(IFB.Descriptors.Change.descriptor,decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getYearReturn:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.YearReturn.descriptor,2,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getStakeholders:function(t){var e=_.isObject(t)?t:{decimals:t};try{return e.decimals=e.decimals||0===e.decimals?e.decimals:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.Stakeholders.descriptor,e.decimals,e.zeroValue,e.positiveSign,e.suffix)}catch(i){}},getNetAssetValue:function(t){var e=_.isObject(t)?t:{decimals:t};try{return e.decimals=e.decimals||0===e.decimals?e.decimals:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.NetAssetValue.descriptor,e.decimals,e.zeroValue,e.positiveSign,e.suffix)}catch(i){}},getTime:function(t){try{return this.formatAsTime(IFB.Descriptors.Time.descriptor,t)}catch(e){}},getOpeningTime:function(t){try{return this.formatAsTime(IFB.Descriptors.OpeningTime.descriptor,t)}catch(e){}},getDate:function(t){try{return this.formatAsDate(IFB.Descriptors.Date.descriptor,t)}catch(e){}},getDerivatives_ExpirationDate:function(){try{var t=this.getDescriptorValue(IFB.Descriptors.Derivatives_ExpirationDate.descriptor);return t&&8===t.length?t.substring(6,8)+"/"+t.substring(4,6)+"/"+t.substring(0,4):""}catch(e){}},getFundManager:function(){try{return this.getDescriptorValue(IFB.Descriptors.FundManager.descriptor)}catch(t){}},getFundManagerCode:function(){try{return this.getDescriptorValue(IFB.Descriptors.FundManagerCode.descriptor)}catch(t){}},getFundLastDate:function(){try{return this.formatAsDate(IFB.Descriptors.FundLastDate.descriptor)}catch(t){}},getFundVocation:function(){try{return this.getDescriptorValue(IFB.Descriptors.FundVocation.descriptor)}catch(t){}},getPreviousYearClose:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.PreviousYearClosingPrice.descriptor,t)}catch(e){}},getFundType:function(){try{return this.getDescriptorValue(IFB.Descriptors.FundType.descriptor)}catch(t){}},getYearHigh:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.YearHigh.descriptor,t)}catch(e){}},getYearLow:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.YearLow.descriptor,t)}catch(e){}},get2YearsHigh:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._2YearsHigh.descriptor,t)}catch(e){}},get2YearsLow:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._2YearsLow.descriptor,t)}catch(e){}},get52WeeksHigh:function(t){var e=_.isObject(t)?t:{decimals:t};try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._52WeeksHigh.descriptor,e.decimals,e.zeroValue,e.positiveSign,e.suffix)}catch(i){}},get52WeeksDateLow:function(t){try{return this.formatAsDate(IFB.Descriptors._52WeeksDateLow.descriptor,t)}catch(e){}},get52WeeksDateHigh:function(t){try{return this.formatAsDate(IFB.Descriptors._52WeeksDateHigh.descriptor,t)}catch(e){}},get52WeeksLow:function(t){var e=_.isObject(t)?t:{decimals:t};try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._52WeeksLow.descriptor,e.decimals,e.zeroValue,e.positiveSign,e.suffix)}catch(i){}},getAllTimeHigh:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._AllTimeHigh.descriptor,t)}catch(e){}},getAllTimeLow:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._AllTimeLow.descriptor,t)}catch(e){}},getOpen:function(t){var e=_.isObject(t)?t:{decimals:t};try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.Open.descriptor,e.decimals,e.zeroValue,e.positiveSign,e.suffix)}catch(i){}},getClose:function(t){var e=_.isObject(t)?t:{decimals:t};try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.Close.descriptor,e.decimals,e.zeroValue,e.positiveSign,e.suffix)}catch(i){}},getOperations:function(){try{return this.formatAsNumber(IFB.Descriptors.Operations.descriptor,0)}catch(t){}},getTopCount:function(){try{return this.formatAsNumber(IFB.Descriptors.TopCount.descriptor,0)}catch(t){}},getFlopCount:function(){try{return this.formatAsNumber(IFB.Descriptors.FlopCount.descriptor,0)}catch(t){}},getBidPrice:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.BidPrice.descriptor,t)}catch(e){}},getAskPrice:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.AskPrice.descriptor,t)}catch(e){}},getBidVolume:function(){try{return this.formatAsNumber(IFB.Descriptors.BidVolume.descriptor,0)}catch(t){}},getAskVolume:function(){try{return this.formatAsNumber(IFB.Descriptors.AskVolume.descriptor,0)}catch(t){}},isNationalInstrument:function(){try{var t=this.id.substring(0,2);return $.inArray(t,this.NATIONAL_MARKETS)>-1}catch(e){}},getInstrumentType:function(){try{return this.getDescriptorValue(IFB.Descriptors.InstrumentType.descriptor)}catch(t){}},getClientInstrumentType:function(){try{return this.getDescriptorValue(IFB.Descriptors.ClientInstrumentType.descriptor)}catch(t){}},getCountryCode:function(){try{return this.getDescriptorValue(IFB.Descriptors.Country.descriptor)}catch(t){}},getCurrency:function(){try{return this.getDescriptorValue(IFB.Descriptors.Currency.descriptor)}catch(t){}},getCurrencySymbol:function(t){switch(t=t||this.getCurrency()){case"USD":return"$";case"EUR":return"€";case"GBP":return"£";case"JPY":return"¥";case"pts":return"";default:return t}},getCurrencyName:function(t){switch(t=t||this.getCurrency()){case"USD":return"Dólar";case"EUR":return"Euro";case"GBP":return"Libra";case"JPY":return"Yen";case"pts":return"";default:return t}},getAssetType:function(){try{return this.getDescriptorValue(IFB.Descriptors.AssetType.descriptor)}catch(t){}},getTicker:function(){try{return this.getDescriptorValue(IFB.Descriptors.InstrumentTicker.descriptor)}catch(t){}},getClientTicker:function(){try{return this.getDescriptorValue(IFB.Descriptors.ClientInstrumentTicker.descriptor)}catch(t){}},isFalsyOrZero:function(t){return t=_.isArray(t)?t:[t],_.every(t,function(t){var e=this.getDescriptorValue(t);return!e||_.isNumber(e)&&0===Number(e)},this)},getDateOrTime:function(t,e,i){var r=IFB.Descriptors.DateOrTime.descriptor;t&&(r=IFB.Descriptors.DateOrTimeSituationMessage.descriptor);var s=this.getDescriptorValue(r);return this.formatValueAsDateOrTime(s,e,i)},isEtfInstrument:function(){var t=this.getDescriptorValue(IFB.Descriptors.InstrumentType.descriptor),e=this.getDescriptorValue(IFB.Descriptors.InstrumentSubtype.descriptor);return"V"===t&&"E"===e},isIndex:function(){var t=this.getDescriptorValue(IFB.Descriptors.InstrumentType.descriptor);return"I"===t},getMarketDescription:function(){try{return this.getDescriptorValue(IFB.Descriptors.MarketName.descriptor)}catch(t){}},getMarketCapitalization:function(t){var e=_.isObject(t)?t:{decimals:t};try{return e.decimals=e.decimals||0===e.decimals?e.decimals:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.MarketCapitalization.descriptor,e.decimals,e.zeroValue,e.positiveSign,e.suffix)}catch(i){}},getIFBMarketName:function(){try{return this.getDescriptorValue(IFB.Descriptors.IFBMarketName.descriptor)}catch(t){}},getVolume:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.Volume.descriptor,0,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getCash:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.Cash.descriptor,0,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getMonthReturn:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.MonthReturn.descriptor,2,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get3YearsReturn:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors._3YearsReturn.descriptor,2,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get3MonthsReturnClose:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors._3MonthsReturnClose.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get12MonthsReturnClose:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors._12MonthsReturnClose.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getCurrentYearChangePercent:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors.ChangePercent_CurrentYear.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getChangePercentCurrentMonth:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors.ChangePercentCurrentMonth.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getChangePercentLastDay:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors.ChangePercent_LastDay.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get2YearsReturnClose:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors._2YearsReturnClose.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getLastYearChangePercent:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors.ChangePercent_LastYear.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get3YearsReturnClose:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors._3YearsReturnClose.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get2YearsAgoChangePercent:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors.ChangePercent_2YearsAgo.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get4YearsReturnClose:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors._4YearsReturnClose.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get3YearsAgoChangePercent:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors.ChangePercent_3YearsAgo.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get5YearsReturnClose:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors._5YearsReturnClose.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getAllTimeReturnClose:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors._AllTimeReturnClose.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get4YearsAgoChangePercent:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors.ChangePercent_4YearsAgo.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getDividendYield:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.FACTSET_DividendYield.descriptor,2,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getPER:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.FACTSET_PER.descriptor,2,t.zeroValue,t.positiveSign)}catch(e){}},getProfitPerShare:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.ProfitPerShare.descriptor,2,t.zeroValue,t.positiveSign)}catch(e){}},isHistRising:function(){return this.getDescriptorValue(IFB.Descriptors.HistChangePercent.descriptor)>0},isHistLosing:function(){return this.getDescriptorValue(IFB.Descriptors.HistChangePercent.descriptor)<0},isHistEqual:function(){return 0===Number(this.getDescriptorValue(IFB.Descriptors.HistChangePercent.descriptor))},getMarketCodeClient:function(){return this.getDescriptorValue(IFB.Descriptors.MarketCodeClient.descriptor)},getIFBShortName:function(){return this.getDescriptorValue(IFB.Descriptors.IFBShortName.descriptor)},getIFBLongName:function(){return this.getDescriptorValue(IFB.Descriptors.IFBLongName.descriptor)},getClientIsin:function(){try{return this.getDescriptorValue(IFB.Descriptors.ClientIsin.descriptor)}catch(t){}},getYearVolume:function(){try{return this.formatAsNumber(IFB.Descriptors.YearVolume.descriptor,0)}catch(t){}},getDayAvgVolume:function(){try{return this.formatAsNumber(IFB.Descriptors.DayAvgVolume.descriptor,0)}catch(t){}},isTradable:function(){return IFB.Trader?IFB.Trader.isTradable(this.id):!1},getFundBetta_1Y:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.FundBetta_1Y.descriptor,t)}catch(e){}},getFundM2_1Y:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.FundM2_1Y.descriptor,t)}catch(e){}},getFundVolatility_1Y:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.FundVolatility_1Y.descriptor,t)}catch(e){}},getFundDepositCommission:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.FundDepositCommission.descriptor,t)}catch(e){}},getFundManagementCommission:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.FundManagementCommission.descriptor,t)}catch(e){}},getFundIssuer:function(){try{return this.getDescriptorValue(IFB.Descriptors.FundIssuer.descriptor)}catch(t){}},getFundDividendDistribution:function(){try{return this.getDescriptorValue(IFB.Descriptors.FundDividendDistribution.descriptor)}catch(t){}},getFundComission:function(){try{return this.formatAsNumber(IFB.Descriptors.FundComission.descriptor,4)}catch(t){}},getWeekReturnClose:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.WeekReturnClose.descriptor,2,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getMonthReturnClose:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.MonthReturnClose.descriptor,2,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},get6MonthsReturnClose:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors._6MonthsReturnClose.descriptor,2,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getYearReturnClose:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.YearReturnClose.descriptor,2,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getDataFromHeaderConfig:function(t){var e=this,i=t.getFormatFunction(),r="";return(i=i?_.isArray(i)?i:[i]:void 0)?(_.each(i,function(i){_.isFunction(e[i.name])&&(r+=e.getDataByFunctionName(i)),i.type&&(r+=e.getDataByType(i,t.id))}),r):e.getDescriptorValue(t.id)},getDataFromColumnadoConfig:function(t){var e=this,i=e.getRawDataFromColumnadoConfig(t),r=e.getFormatedDataFromColumnadoConfig(i,t);return r},getFormatedDataFromColumnadoConfig:function(t,e){{var i=this,r=e.getType(),s=t;"D"+e.id}switch(r){case e.columnTypes.Time:s=i.formatValueAsTime(t);break;case e.columnTypes.Date:s=i.formatValueAsDate(t);break;case e.columnTypes.Caracter:e.isDateOrTimeTypeDescriptor()&&(s=i.formatValueAsDateOrTime(t));break;case e.columnTypes.Number:var o,n,a="0"===e.getZerosDraw()?" ":"0";s=i.formatValueAsNumber(t,Number(e.getDecimals()),a,o,n)}return s},getRawDataFromColumnadoConfig:function(t){var e,i=this,r=t.getOrigin(),s="D"+t.id;switch(r){case t.columnOrigin.DIRECTO:e=i.getDescriptorValue(s);break;case t.columnOrigin.EXTERNO:e=i.getRawDataFromExternalOrigin(t);break;case t.columnOrigin.FORMULA_WT:e=i.getRawDataFromFormaulaWT(t);break;default:e=i.getDescriptorValue(s)}return e},getRawDataFromExternalOrigin:function(t){var e,i=this,r=t.getAlgor().split("-"),s=r[0];switch(s){case t.calculationTypeExternalSource.BANCOMER_WT:e=i.getRawDataFromBancomerWT(t)}return e},getRawDataFromFormaulaWT:function(t){var e;return e=IFB.Utils.ReversePolishNotation.evaluateFormula(t.getAlgor(),this,t)},getRawDataFromBancomerWT:function(t){try{return this.getDescriptorValue(this.getBCMDescriptor(t))}catch(e){}},getDataByFunctionName:function(t){try{return t.params?this[t.name](t.params):this[t.name]()}catch(e){}},getDataByType:function(t,e,i){var r=!t.params&&i?this.getFormatParamsFromHeader(i):{};switch(t.type){case"number":return this.formatAsNumber(e,r.decimals,r.zeroValue,r.positiveSign,r.suffix);case"date":return this.formatAsDate(e);case"time":return this.formatAsTime(e);case"string":return this.getDescriptorValue(e);default:return this.getDescriptorValue(e)}},getEtfBenchmark:function(){try{return this.getDescriptorValue(IFB.Descriptors.ETF_Benchmark.descriptor)}catch(t){}},getEtfGeographicArea:function(){try{return this.getDescriptorValue(IFB.Descriptors.ETF_Geographic_Area.descriptor)}catch(t){}},getEtfSector:function(){try{return this.getDescriptorValue(IFB.Descriptors.ETF_Sector.descriptor)}catch(t){}},getEtfStyle:function(){try{return this.getDescriptorValue(IFB.Descriptors.ETF_Style.descriptor)}catch(t){}},getEtfType:function(){try{return this.getDescriptorValue(IFB.Descriptors.ETF_Type.descriptor)}catch(t){}},getEtfDescription:function(){try{return this.getDescriptorValue(IFB.Descriptors.ETF_Description.descriptor)}catch(t){}},getCapitalization:function(){try{return this.formatAsNumber(IFB.Descriptors.FACTSET_Capitalization.descriptor,2," ")}catch(t){}},getBancomerCapitalization:function(){try{return this.formatAsNumber(IFB.Descriptors.Bancomer_Capitalization.descriptor,0," ")}catch(t){}},getCategory:function(){return this.getDescriptorValue(IFB.Descriptors.Category.descriptor)},getUnderlying:function(){return this.getDescriptorValue(IFB.Descriptors.Underlying.descriptor)},getSymbol:function(){return this.getDescriptorValue(IFB.Descriptors.Symbol.descriptor)},getPlacement:function(){return this.getDescriptorValue(IFB.Descriptors.Placement.descriptor)},getStrike:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.Strike.descriptor,0,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getExpiryDate:function(t){try{return this.formatAsDate(IFB.Descriptors.ExpiryDate.descriptor,t)}catch(e){}},getNoesisRecommendationCls:function(t,e){var i=Number(this.getDescriptorValue(t)||"0");switch(e&&5===e.length||(e=["ifb-top","ifb-top","ifb-equal","ifb-flop","ifb-flop"]),i){case 1:return e[0];case 2:return e[1];case 3:return e[2];case 4:return e[3];case 5:return e[4]}},getAverageDailyVolume_1Mouth:function(){try{return this.formatAsNumber(IFB.Descriptors.AverageDailyVolume_1Mouth.descriptor,0)
}catch(t){}},getEqualCount:function(){try{return this.getDescriptorValue(IFB.Descriptors.EqualCount.descriptor)}catch(t){}},getEmptyData:function(){return""},getEmptyDivData:function(){return"<div></div>"},getTimeLastUpdate:function(t){try{return this.formatAsTime(IFB.Descriptors.TimeLastUpdate.descriptor,t)}catch(e){}},getDateLastUpdate:function(t){try{return this.formatAsDate(IFB.Descriptors.DateLastUpdate.descriptor,t)}catch(e){}},getEmisora:function(){try{return this.getDescriptorValue(IFB.Descriptors.Emisora.descriptor)}catch(t){}},getSerie:function(){try{return this.getDescriptorValue(IFB.Descriptors.Serie.descriptor)}catch(t){}},getCorporateName:function(){try{return this.getDescriptorValue(IFB.Descriptors.CorporateName.descriptor)}catch(t){}},getMarketType:function(){try{return this.getDescriptorValue(IFB.Descriptors.MarketType.descriptor)}catch(t){}},getCenter:function(){try{return this.getDescriptorValue(IFB.Descriptors.Center.descriptor)}catch(t){}},getIndustry:function(){try{return this.getDescriptorValue(IFB.Descriptors.Industry.descriptor)}catch(t){}},getSubIndustry:function(){try{return this.getDescriptorValue(IFB.Descriptors.SubIndustry.descriptor)}catch(t){}},getShareType:function(){try{return this.getDescriptorValue(IFB.Descriptors.ShareType.descriptor)}catch(t){}},getCoupon:function(){try{return this.getDescriptorValue(IFB.Descriptors.Coupon.descriptor)}catch(t){}},getSector:function(){try{return this.getDescriptorValue(IFB.Descriptors.Sector.descriptor)}catch(t){}},getSubSector:function(){try{return this.getDescriptorValue(IFB.Descriptors.SubSector.descriptor)}catch(t){}},getSampleIndicator:function(){try{return this.getDescriptorValue(IFB.Descriptors.SampleIndicator.descriptor)}catch(t){}},getSERIE_InstrumentType:function(){try{return this.getDescriptorValue(IFB.Descriptors.SERIE_InstrumentType.descriptor)}catch(t){}},getOperativity:function(){try{return this.getDescriptorValue(IFB.Descriptors.Operativity.descriptor)}catch(t){}},getBursatility:function(){try{return this.getDescriptorValue(IFB.Descriptors.Bursatility.descriptor)}catch(t){}},getSource:function(){try{return this.getDescriptorValue(IFB.Descriptors.Source.descriptor)}catch(t){}},getIssuance:function(){try{return this.formatAsDate(IFB.Descriptors.Issuance.descriptor)}catch(t){}},getIssuedCapital_I:function(){try{return this.getDescriptorValue(IFB.Descriptors.IssuedCapital_I.descriptor)}catch(t){}},getIssuedCapital_II:function(){try{return this.getDescriptorValue(IFB.Descriptors.IssuedCapital_II.descriptor)}catch(t){}},getInstrumentYesterday:function(){try{return this.formatAsNumber(IFB.Descriptors.InstrumentYesterday.descriptor,0)}catch(t){}},getSharesToday:function(){try{return this.formatAsNumber(IFB.Descriptors.SharesToday.descriptor,0)}catch(t){}},getP_FLEPA_Main:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_FLEPA_Main.descriptor,t)}catch(e){}},getP_FLEPA_Factor1:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_FLEPA_Factor1.descriptor,t)}catch(e){}},getP_FLEPA_Factor2:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_FLEPA_Factor2.descriptor,t)}catch(e){}},getP_FEPA_Main:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_FEPA_Main.descriptor,t)}catch(e){}},getP_FEPA_Factor1:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_FEPA_Factor1.descriptor,t)}catch(e){}},getP_FEPA_Factor2:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_FEPA_Factor2.descriptor,t)}catch(e){}},getP_U_Main:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_U_Main.descriptor,t)}catch(e){}},getP_U_Factor1:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_U_Factor1.descriptor,t)}catch(e){}},getP_U_Factor2:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_U_Factor2.descriptor,t)}catch(e){}},getP_VL_Main:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_VL_Main.descriptor,t)}catch(e){}},getP_VL_Factor1:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_VL_Factor1.descriptor,t)}catch(e){}},getP_VL_Factor2:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.P_VL_Factor2.descriptor,t)}catch(e){}},getVE_UAIIDA_Main:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.VE_UAIIDA_Main.descriptor,t)}catch(e){}},getVE_UAIIDA_Factor1:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.VE_UAIIDA_Factor1.descriptor,t)}catch(e){}},getVE_UAIIDA_Factor2:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.VE_UAIIDA_Factor2.descriptor,t)}catch(e){}},getSales_Previous:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.Sales_Previous.descriptor,t)}catch(e){}},getSales_3T13:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.Sales_3T13.descriptor,t)}catch(e){}},getSales_Percentage:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.Sales_Percentage.descriptor,t)}catch(e){}},getON_Previous:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.ON_Previous.descriptor,t)}catch(e){}},getON_3T13:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.ON_3T13.descriptor,t)}catch(e){}},getON_Percent:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.ON_Percent.descriptor,t)}catch(e){}},getUN_Previous:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.UN_Previous.descriptor,t)}catch(e){}},getUN_3T13:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.UN_3T13.descriptor,t)}catch(e){}},get3T13:function(){try{return this.getDescriptorValue(IFB.Descriptors._3T13.descriptor)}catch(t){}},getUN_Percent:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.UN_Percent.descriptor,t)}catch(e){}},getEBITDA_Previous:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.EBITDA_Previous.descriptor,t)}catch(e){}},getEBITDA_3T13:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.EBITDA_3T13.descriptor,t)}catch(e){}},getEBITDA_Percent:function(t){try{return this.getDescriptorValueWithFormat(IFB.Descriptors.EBITDA_Percent.descriptor,t)}catch(e){}},getTradedCash:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.TradedCash.descriptor,0,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getOpenPercent:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.OpenPercent.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getMaxPercent:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.MaxPercent.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getMedPercent:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.MedPercent.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getMinPercent:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.MinPercent.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getLastExPercent:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.LastExPercent.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getMaxAnnPercent:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.MaxAnnPercent.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getMinAnnPercent:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.MinAnnPercent.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getRotation:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.Rotation.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getNominalValue:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.NominalValue.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getCurrencyVolumes:function(){try{return this.getDescriptorValue(IFB.Descriptors.CurrencyVolumes.descriptor)}catch(t){}},getMarketCode:function(){try{return this.getDescriptorValue(IFB.Descriptors.MarketCode.descriptor)}catch(t){}},getBCMDescriptor:function(t){try{var e=t.getAlgor().split("-");return e[1]}catch(i){}},getFormatParamsFromHeader:function(t){var e={};return t?(e.decimals=Number(t.getDecimals()),e):e},getRecommendationText:function(){return IFB.Utils.Helper.getRecommendationText(this.getDescriptorValue(IFB.Descriptors.FACTSET_Recommendation.descriptor))},getWeekHigh:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.WeekHigh.descriptor,t)}catch(e){}},getWeekLow:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.WeekLow.descriptor,t)}catch(e){}},getMonthHigh:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.MonthHigh.descriptor,t)}catch(e){}},getMonthLow:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.MonthLow.descriptor,t)}catch(e){}},get3MonthsHigh:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._3MonthsHigh.descriptor,t)}catch(e){}},get3MonthsLow:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._3MonthsLow.descriptor,t)}catch(e){}},getCurrentYearHigh:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.CurrentYear_High.descriptor,t)}catch(e){}},getCurrentYearLow:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors.CurrentYear_Low.descriptor,t)}catch(e){}},get3YearsHigh:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._3YearsHigh.descriptor,t)}catch(e){}},get3YearsLow:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._3YearsLow.descriptor,t)}catch(e){}},get5YearsHigh:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._5YearsHigh.descriptor,t)}catch(e){}},get5YearsLow:function(t){try{return t=t||0===t?t:this.getDecimals(),this.formatAsNumber(IFB.Descriptors._5YearsLow.descriptor,t)}catch(e){}},getIFB_PER:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.PER.descriptor,t.decimals||2,t.zeroValue,t.positiveSign)}catch(e){}},getBPA:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.BPA.descriptor,t.decimals||2,t.zeroValue,t.positiveSign)}catch(e){}},getPriceBook:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.PriceBook.descriptor,t.decimals||2,t.zeroValue,t.positiveSign)}catch(e){}},getIFB_DividendYield:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.DividendYield.descriptor,t.decimals||2,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getPriceCashFlow:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.PriceCashFlow.descriptor,t.decimals||2,t.zeroValue,t.positiveSign)}catch(e){}},getIFB_Capitalization:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.Capitalization.descriptor,t.decimals||2,t.zeroValue,t.positiveSign)}catch(e){}},getNumberOfConstituents:function(){var t=this.getConstituentsRisers()||0,e=this.getConstituentsFallers()||0,i=this.getConstituentsNeutrals()||0;return Number(t)+Number(e)+Number(i)},getConstituentsRisers:function(t){if(!t)return this.getDescriptorValue(IFB.Descriptors.Index_Consituents_Risers.descriptor);try{return this.formatAsNumber(IFB.Descriptors.Index_Consituents_Risers.descriptor,t.decimals||0,t.zeroValue,t.positiveSign)}catch(e){}},getConstituentsNeutrals:function(t){if(!t)return this.getDescriptorValue(IFB.Descriptors.Index_Consituents_Neutrals.descriptor);try{return this.formatAsNumber(IFB.Descriptors.Index_Consituents_Neutrals.descriptor,t.decimals||0,t.zeroValue,t.positiveSign)}catch(e){}},getConstituentsFallers:function(t){if(!t)return this.getDescriptorValue(IFB.Descriptors.Index_Consituents_Fallers.descriptor);try{return this.formatAsNumber(IFB.Descriptors.Index_Consituents_Fallers.descriptor,t.decimals||0,t.zeroValue,t.positiveSign)}catch(e){}},getCA_FundKIID:function(){try{return this.getDescriptorValue(IFB.Descriptors.CA_FundKIID.descriptor)}catch(t){}},getCA_FundProspectus:function(){try{return this.getDescriptorValue(IFB.Descriptors.CA_FundProspectus.descriptor)}catch(t){}},getCA_FundQuarterlyReport:function(){try{return this.getDescriptorValue(IFB.Descriptors.CA_FundQuarterlyReport.descriptor)}catch(t){}},getCA_FundReporting:function(){try{return this.getDescriptorValue(IFB.Descriptors.CA_FundReporting.descriptor)}catch(t){}},getCA_FundRules:function(){try{return this.getDescriptorValue(IFB.Descriptors.CA_FundRules.descriptor)}catch(t){}},getCA_FundType:function(){try{return this.getDescriptorValue(IFB.Descriptors.CA_FundType.descriptor)}catch(t){}},getFundLongName:function(){try{return this.getDescriptorValue(IFB.Descriptors.FundLongName.descriptor)}catch(t){}},getFundChangePercentCurrentYear:function(t){t=t||{},t.decimals=t.decimals||2;try{return this.formatAsNumber(IFB.Descriptors.FundChangePercentCurrentYear.descriptor,t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getFundCurrency:function(){try{return this.getDescriptorValue(IFB.Descriptors.FundCurreny.descriptor)}catch(t){}},getFundValuationDate:function(t){try{return this.formatAsDate(IFB.Descriptors.FundValuationDate.descriptor,t)}catch(e){}},getReferenceIndex:function(){try{return this.getDescriptorValue(IFB.Descriptors.ReferenceIndex.descriptor)}catch(t){}},getFundRisk:function(){try{return this.getDescriptorValue(IFB.Descriptors.FundRisk.descriptor)}catch(t){}},getFundLaunchDate:function(t){try{return this.formatAsDate(IFB.Descriptors.FundLaunchDate.descriptor,t)}catch(e){}},getFundCalculationPeriod:function(){try{return this.getDescriptorValue(IFB.Descriptors.FundCalculationPeriod.descriptor)}catch(t){}},getNoesisFundamental_Year:function(){return this.getDescriptorValue(IFB.Descriptors.NoesisFundamental_Year.descriptor)},getNoesisFundamental_Period:function(){return this.getDescriptorValue(IFB.Descriptors.NoesisFundamental_Period.descriptor)},getNoesisFundamental_Date:function(t){try{return this.formatAsDate(IFB.Descriptors.NoesisFundamental_Date.descriptor,t)}catch(e){}},getNoesisFundamental_PreviousPrice:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.NoesisFundamental_PreviousPrice.descriptor,t.decimals||2,t.zeroValue,t.positiveSign)}catch(e){}},getNoesisFundamental_ObjectivePrice:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.NoesisFundamental_ObjectivePrice.descriptor,t.decimals||2,t.zeroValue,t.positiveSign)}catch(e){}},getNoesisFundamental_Volatility:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.NoesisFundamental_Volatility.descriptor,t.decimals||2,t.zeroValue,t.positiveSign)}catch(e){}},getNoesisFundamental_Capitalization:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.NoesisFundamental_Capitalization.descriptor,t.decimals||2,t.zeroValue,t.positiveSign)}catch(e){}},getNoesisFundamental_CapitalizationM:function(t){t=t||{};try{return this.formatValueAsNumber(this.getDescriptorValue(IFB.Descriptors.NoesisFundamental_Capitalization.descriptor)/1e6,t.decimals||0,t.zeroValue,t.positiveSign)}catch(e){}},getNoesisFundamental_Shares:function(t){t=t||{};try{return this.formatAsNumber(IFB.Descriptors.NoesisFundamental_Shares.descriptor,0,t.zeroValue||"",t.positiveSign)}catch(e){}},getNoesisFundamental_Recommendation:function(){return this.getDescriptorValue(IFB.Descriptors.NoesisFundamental_Recommendation.descriptor)},getNoesisFundamental_BPA_Ac:function(t,e){return e=e||{},this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_BPA_Ac.descriptor,"ratio",t),e.decimals||2,e.zeroValue,e.positiveSign,e.suffix)},getNoesisFundamental_PER_T:function(t,e){return e=e||{},this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_PER_T.descriptor,"ratio",t),e.decimals||2,e.zeroValue,e.positiveSign,e.suffix)},getNoesisFundamental_Ratio1:function(t,e){return e=e||{},this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_Ratio1.descriptor,"ratio",t),e.decimals||2,e.zeroValue,e.positiveSign,e.suffix||"%")},getNoesisFundamental_Ratio2:function(t,e){return e=e||{},this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_Ratio2.descriptor,"ratio",t),e.decimals||2,e.zeroValue,e.positiveSign,e.suffix||"%")},getNoesisFundamental_Ratio3:function(t,e){return e=e||{},this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_Ratio3.descriptor,"ratio",t),e.decimals||2,e.zeroValue,e.positiveSign,e.suffix)},getNoesisFundamental_Ratio4:function(t,e){return e=e||{},this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_Ratio4.descriptor,"ratio",t),e.decimals||2,e.zeroValue,e.positiveSign,e.suffix)},getNoesisFundamental_ResNet:function(t){return this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_ResNet.descriptor,"serie",t),0)},getNoesisFundamental_Serie1:function(t){return this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_Serie1.descriptor,"serie",t),0)},getNoesisFundamental_Serie2:function(t){return this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_Serie2.descriptor,"serie",t),0)},getNoesisFundamental_Serie3:function(t){return this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_Serie3.descriptor,"serie",t),0)},getNoesisFundamental_Serie4:function(t){return this.formatValueAsNumber(this.getNoesisFundamental_DataYear(IFB.Descriptors.NoesisFundamental_Serie4.descriptor,"serie",t),0)},getNoesisFundamental_DataYear:function(t,e,i){var r;try{return r=IFB.Utils.Helper.xmlToJson(this.getDescriptorValue(t)),_.find(r[e].dato,function(t){return t["@attributes"].periodo===String(i)})["#text"]}catch(s){return""}}}),IFB.Models.News=Backbone.Model.extend({id:void 0,data:void 0,FORMAT_DETAIL_BOLSACAMINOS:"24",initialize:function(){this.data=this.toJSON(),this.set({id:this.data.Clave})},getTitle:function(){return this.data.Titular||this.data.F4},getDetails:function(){return this.data.Detalle||""},getKey:function(){return this.data.Clave||this.data.F3},getClassification:function(){return this.data.Clasificacion},getEvent:function(){return this.data.Clasificacion.evento},getRawDate:function(){return this.data.Fecha||this.data.F1},getDate:function(){var t=this.data.Fecha||this.data.F1;return t?this.formatValueAsDate(t):void 0},getSource:function(){return this.data.Fuente||this.data.F0},getFormatDetail:function(){return this.data.FD},getTime:function(){var t=this.data.Hora||this.data.F2;return t?this.formatValueAsTime(t):void 0},formatValueAsNumber:function(t,e,i){return accounting.formatNumber(t,{precision:e||6,zero:i||""})},formatValueAsDate:function(t){return t&&(t=moment(t,"YYYYMMDD").format("DD/MM/YYYY")),t},formatValueAsTime:function(t,e){return e=e||"HH:mm",t&&(t=moment(t,"HHmmss").add("minutes",IFB.Settings.GmtOffset).format(e)),t},newsDetailLink:function(){return"8"===this.data.FD?"href=/news/document?key="+this.data.Clave+"&source="+this.data.Fuente+"&date="+newsItem.Fecha+' target="_blank"':"20"===this.data.FD?"href=/news/video/detail?key="+this.data.Clave+"&source="+this.data.Fuente:"href=/news/detail?key="+this.data.Clave+"&source="+this.data.Fuente},getClaveSector:function(){return this.data.Clasificacion.ClaveSector},getSubDireccion:function(){return this.data.Clasificacion.SubDireccion},getCategory:function(){return this.data.Clasificacion.Categoria},isRead:function(){return IFB.Utils.ReadStatusConfig.isRead(this.getSource(),this.getKey())}}),IFB.Models.NewsDetail=Backbone.Model.extend({id:void 0,data:void 0,initialize:function(){this.data=this.toJSON(),this.set({id:this.data.Clave})},getTitle:function(){return this.data.Titular||this.data.F4},getDetails:function(){return this.data.url?'<iframe src="//'+this.data.url+'" width="100%" height="3100"/>':this.data.Detalle||""},getKey:function(){return this.data.Clave||this.data.F3},getEvent:function(){return this.data.Clasificacion.evento},getRawDate:function(){return this.data.Fecha||this.data.F1},getDate:function(){var t=this.data.Fecha||this.data.F1;return t?this.formatValueAsDate(t):void 0},getSource:function(){return this.data.Fuente||this.data.F0},getTime:function(){var t=this.data.Hora||this.data.F2;return t?this.formatValueAsTime(t):void 0},formatValueAsNumber:function(t,e,i){return accounting.formatNumber(t,{precision:e||6,zero:i||""})},formatValueAsDate:function(t){return t&&(t=moment(t,"YYYYMMDD").format("DD/MM/YYYY")),t},formatValueAsTime:function(t,e){return e=e||"HH:mm",t&&(t=moment(t,"HHmmss").add("minutes",IFB.Settings.GmtOffset).format(e)),t},newsDetailLink:function(){return"8"===this.data.FD?"href=/news/document?key="+this.data.Clave+"&source="+this.data.Fuente+"&date="+newsItem.Fecha+' target="_blank"':"20"===this.data.FD?"href=/news/video/detail?key="+this.data.Clave+"&source="+this.data.Fuente:"href=/news/detail?key="+this.data.Clave+"&source="+this.data.Fuente},getUrl:function(){return this.data.url}}),IFB.Models.OpenPosition=Backbone.Model.extend({id:void 0,data:void 0,defaultDecimals:2,initialize:function(){this.data=this.toJSON(),this.set({id:this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioKey.descriptor)+this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioShortName.descriptor)}),this.setDescriptorValue(IFB.Descriptors.Trader.PortfolioBuyShares.descriptor,0),this.setDescriptorValue(IFB.Descriptors.Trader.Assessment.descriptor,0),this.setDescriptorValue(IFB.Descriptors.Trader.AssessmentFIX.descriptor,0),this.setDescriptorValue(IFB.Descriptors.Last.descriptor,0),this.setDescriptorValue("MV",this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioMV.descriptor))},createDescriptorsCalculated:function(){this.setDescriptorValue(IFB.Descriptors.Trader.PortfolioBuyShares.descriptor,0),this.setDescriptorValue(IFB.Descriptors.Trader.Assessment.descriptor,0),this.setDescriptorValue(IFB.Descriptors.Trader.AssessmentFIX.descriptor,0),this.setDescriptorValue(IFB.Descriptors.Last.descriptor,0),this.setDescriptorValue("MV",this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioMV.descriptor)),this.calculatePortfolioBuyShares(),this.calculateAssessment(),this.calculateAssessmentFIX()},getId:function(){return this.id},getPortfolioLastPriceSFB:function(t){return t=t||0===t?t:this.defaultDecimals,this.formatAsNumber(IFB.Descriptors.Trader.PortfolioLastPriceSFB.descriptor,t)},getPortfolioAccount:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioAccount.descriptor)},getPortfolioMV:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioMV.descriptor)},getAssessment:function(t){return t=t||0===t?t:this.defaultDecimals,this.formatAsNumber(IFB.Descriptors.Trader.Assessment.descriptor,t)},getAssessmentFIX:function(t){return t=t||0===t?t:this.defaultDecimals,this.formatAsNumber(IFB.Descriptors.Trader.AssessmentFIX.descriptor,t)},getPortfolioShortName:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioShortName.descriptor)},getPortfolioInitialTrade:function(){return this.formatAsNumber(IFB.Descriptors.Trader.PortfolioInitialTrade.descriptor,0)},getPortfolioBuyShares:function(){return this.formatAsNumber(IFB.Descriptors.Trader.PortfolioBuyShares.descriptor,0)},getPortfolioBuyTrade:function(){return this.formatAsNumber(IFB.Descriptors.Trader.PortfolioBuyTrade.descriptor,0)},getPortfolioSellTrade:function(){return this.formatAsNumber(IFB.Descriptors.Trader.PortfolioSellTrade.descriptor,0)},getDescriptorValue:function(t){var e=this.data[t];return e},getPortfolioBuyPriceFIX:function(){return this.formatAsNumber(IFB.Descriptors.Trader.PortfolioBuyPriceFIX.descriptor,2)},getPortfolioSellPriceFIX:function(){return this.formatAsNumber(IFB.Descriptors.Trader.PortfolioSellPriceFIX.descriptor,2)},getProfitLoss:function(t){return t=t||0===t?t:this.defaultDecimals,this.formatAsNumber(IFB.Descriptors.Trader.ProfitLoss.descriptor,t)},setDescriptorValue:function(t,e){var i=this.data[t];return this.data[t]=e,this.applyAlgorithms(t),i},formatValueAsNumber:function(t,e,i,r,s){if(void 0!==i&&(!t||"0"===t||""===t))return i;var o=accounting.formatNumber(t,{precision:e,zero:i||""});return o+=s||"",r&&t>0&&-1===o.indexOf(r)?r+o:o},formatAsNumber:function(t,e,i,r,s){return this.formatValueAsNumber(this.getDescriptorValue(t),e,i,r,s)},applyAlgorithms:function(t){switch(t){case IFB.Descriptors.Trader.PortfolioInitialTrade.descriptor:case IFB.Descriptors.Trader.PortfolioBuyTrade.descriptor:case IFB.Descriptors.Trader.PortfolioSellTrade.descriptor:this.calculatePortfolioBuyShares(),this.calculateAssessment(),this.calculateAssessmentFIX();break;case IFB.Descriptors.Last.descriptor:this.calculateAssessment(),this.calculateAssessmentFIX()}},getRawPortfolioBuyShares:function(){var t=this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioInitialTrade.descriptor),e=this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioBuyTrade.descriptor),i=this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioSellTrade.descriptor),r=(void 0!==t?Number(t):0)+(void 0!==e?Number(e):0)-(void 0!==i?Number(i):0);return r},calculatePortfolioBuyShares:function(){var t=this.getRawPortfolioBuyShares();this.data[IFB.Descriptors.Trader.PortfolioBuyShares.descriptor]=t,this.set(IFB.Descriptors.Trader.PortfolioBuyShares.descriptor,t)},calculateAssessment:function(){var t=this.getRawPortfolioBuyShares()*this.getMultiplier()*Number(this.getDescriptorValue(IFB.Descriptors.Last.descriptor));this.data[IFB.Descriptors.Trader.Assessment.descriptor]=t,this.set(IFB.Descriptors.Trader.Assessment.descriptor,t)},calculateAssessmentFIX:function(){var t=this.getFixing(),e=(this.getTitles()*this.getMultiplier()*Number(this.getDescriptorValue(IFB.Descriptors.Last.descriptor))-parseFloat(this.getDescriptorValue(IFB.Descriptors.Trader.PortfolioSellPriceFIX.descriptor)))*t;this.data[IFB.Descriptors.Trader.AssessmentFIX.descriptor]=e,this.set(IFB.Descriptors.Trader.AssessmentFIX.descriptor,e)},setInstrumentData:function(t){this.instrument=t},getInstrumentData:function(){return this.instrument?this.instrument:new IFB.Models.Instrument},getMultiplier:function(t){var e=this.formatAsNumber(IFB.Descriptors.Trader.Multiplier.descriptor,t);return"10"==e&&console.log("multiplier",e),e?e:1},getCompensationPrice:function(t){return t=t||0===t?t:this.defaultDecimals,this.formatAsNumber(IFB.Descriptors.Trader.CompensationPrice.descriptor,t)},getFixing:function(){var t=this.formatAsNumber(IFB.Descriptors.Trader.Fixing.descriptor,2);return parseFloat(t.replace(/\./g,"").replace(",","."))},getTitles:function(){return this.formatAsNumber(IFB.Descriptors.Trader.PortfolioTitlesFIX.descriptor,0)},getBalanceCurrency:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.BalanceCurrency.descriptor)}}),IFB.Models.Order=Backbone.Model.extend({id:void 0,data:void 0,defaultDecimals:2,NATIONAL_MARKET:"M ",DEFAULTS_DATE_FORMAT:"DD/MM/YYYY",DEFAULTS_DATE_FORMAT_RAW:"YYYYMMDD",execTypeOptions:{EXECTYPE_NONE:"0",EXECTYPE_CONDICIONES_ADICIONALES_EJECUTAR_O_ANULAR:"3",EXECTYPE_CONDICIONES_ADICIONALES_TODO_NADA:"4"},state:{0:"E.Mer.",1:"P.Eje.",2:"Eje.",3:"D.f.D.",4:"Canc.",5:"Modif.",7:"Par.",8:"Rech.",9:"Susp.",A:"Env.",B:"Calc.",C:"Exp.",D:"A.f.B.",W:"E.Con.",Z:"Ret."},initialize:function(){this.data=this.toJSON(),this.set({id:this.getDescriptorValue(IFB.Descriptors.Trader.Key.descriptor)})},getCancelCls:function(){var t=this.getDescriptorValue(IFB.Descriptors.Trader.CancelOrder.descriptor)||"0";return"1"===t?"close":""},getSideCls:function(){var t=this.getDescriptorValue(IFB.Descriptors.Trader.SideFIX.descriptor||"0");return"1"===t?"buy":"sell"},getMVFIX:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.MVFIX.descriptor)},getMarketIB:function(){var t=this.getMVFIX();return t.length>2?t.substring(0,2):""},getSymbolIB:function(){var t=this.getMVFIX();return t.length>2?t.substring(2,7):""},getId:function(){return this.id},getShortName:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.ShortName.descriptor)},getSideFIX:function(){var t=this.getDescriptorValue(IFB.Descriptors.Trader.SideFIX.descriptor);return"1"===t?"C":"V"},getPrice:function(t){try{return t=t||0===t?t:3,this.formatAsNumber(IFB.Descriptors.Trader.Price.descriptor,t,"")}catch(e){}},getAvgPrice:function(t){try{return t=t||0===t?t:3,this.formatAsNumber(IFB.Descriptors.Trader.AvgPrice.descriptor,t,"")}catch(e){}},getQuantity:function(){return this.formatAsNumber(IFB.Descriptors.Trader.Quantity.descriptor,0)},getState:function(){try{var t=this.getDescriptorValue(IFB.Descriptors.Trader.OrderStatusFIX.descriptor);return this.state[t]}catch(e){}},getAccountFIX:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.AccountFIX.descriptor)},getAccountName:function(){var t=this.getDescriptorValue(IFB.Descriptors.Trader.AccountFIX.descriptor),e=IFB.Trader.getAccountNameFromId(t);return e},getIsinFIX:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.IsinFIX.descriptor)},getOrderTypeFIX:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.OrderTypeFIX.descriptor)},getOrderTypeLiteral:function(){var t=this.getOrderTypeFIX(),e=_.find(IFB.Trader.orderTypeOptions,function(e){return e.value===t});return void 0!==e?e.text:""},getPendingVolumeFIX:function(){return this.formatAsNumber(IFB.Descriptors.Trader.PendingVolumeFIX.descriptor,0)},getRejectCodeFIX:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.RejectCodeFIX.descriptor)},getExpireDateFIX:function(t){try{return this.formatAsDate(IFB.Descriptors.Trader.ExpireDateFIX.descriptor,t)}catch(e){}},getCurrency:function(){return"EUR"},getExecTypeFIX:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.ExecTypeFIX.descriptor)},getStopPriceFIX:function(t){try{return t=t||0===t?t:3,this.formatAsNumber(IFB.Descriptors.Trader.StopPriceFIX.descriptor,t,"")}catch(e){}},getMaxFloorFIX:function(){try{return this.formatAsNumber(IFB.Descriptors.Trader.MaxFloorFIX.descriptor,0)}catch(t){}},getMinQuantityFIX:function(){try{return this.formatAsNumber(IFB.Descriptors.Trader.MinQuantityFIX.descriptor,0)}catch(t){}},getDescriptorValue:function(t){return this.data[t]||""},formatValueAsNumber:function(t,e,i,r,s){if(void 0!==i&&(!t||"0"===t||""===t))return i;var o=accounting.formatNumber(t,{precision:e,zero:i||""});return o+=s||"",r&&t>0&&-1===o.indexOf(r)?r+o:o},formatAsNumber:function(t,e,i,r,s){return this.formatValueAsNumber(this.getDescriptorValue(t),e,i,r,s)},formatAsDate:function(t,e){return this.formatValueAsDate(this.getDescriptorValue(t),e)},formatValueAsDate:function(t,e){return e=e||this.DEFAULTS_DATE_FORMAT,t&&(t=moment(t,this.DEFAULTS_DATE_FORMAT_RAW).format(e)),t},setDescriptorValue:function(t,e){var i=this.data[t];return this.data[t]=e,i},getCalculatedValue:function(t){var e={};switch(t){case"StatusText":e.value=this.getState();break;case"CancelCls":var i=this.getDescriptorValue(IFB.Descriptors.Trader.CancelOrder.descriptor);"1"===i?e.addCls="close":e.removeCls="close";break;case"TypeLiteral":e.value=this.getOrderTypeLiteral()}return e},createDescriptorsCalculated:function(){},getExceTypeText:function(){var t={},e=this.getExecTypeFIX();switch(e){case this.execTypeOptions.EXECTYPE_NONE:var i=this.getMinQuantityFIX();void 0!==i&&(t.header="Volumen mínimo",t.text=i);break;case this.execTypeOptions.EXECTYPE_CONDICIONES_ADICIONALES_EJECUTAR_O_ANULAR:t.header="Ejecutar o anular",t.text="Sí";break;case this.execTypeOptions.EXECTYPE_CONDICIONES_ADICIONALES_TODO_NADA:t.header="Todo o nada",t.text="Sí"}return t},isIntraday:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.OrderIntraday.descriptor)
},isOrderAdmin:function(){return this.getDescriptorValue(IFB.Descriptors.Trader.OrderAdmin.descriptor)}}),IFB.Models.Positions=Backbone.Model.extend({id:void 0,data:void 0,defaultDecimals:3,defaultZeroValues:"",initialize:function(){this.data=this.toJSON(),this.set({id:this.getDescriptorValue(IFB.Descriptors.MarketDepth.descriptor),mv:this.data.MV})},getId:function(){return this.id},getDecimals:function(t){var e=this.getDescriptorValue(IFB.Descriptors.Decimals.descriptor);return/^\s*\d+\s*$/.test(e)?parseInt(e,10):t||this.defaultDecimals},getBidOrders:function(){try{return this.formatAsNumber(IFB.Descriptors.BidOrders.descriptor,0,this.defaultZeroValues)}catch(t){}},getAskOrders:function(){try{return this.formatAsNumber(IFB.Descriptors.AskOrders.descriptor,0,this.defaultZeroValues)}catch(t){}},getBidVolume:function(){try{return this.formatAsNumber(IFB.Descriptors.BidVolume.descriptor,0,this.defaultZeroValues)}catch(t){}},getAskVolume:function(){try{return this.formatAsNumber(IFB.Descriptors.AskVolume.descriptor,0,this.defaultZeroValues)}catch(t){}},getBidPrice:function(t){var e=_.isObject(t)?t:{decimals:t};try{return e.decimals=e.decimals||0===e.decimals?e.decimals:this.getDecimals(),e.zeroValue=e.zeroValue?e.zeroValue:this.defaultZeroValues,this.formatAsNumber(IFB.Descriptors.BidPrice.descriptor,e.decimals,e.zeroValue)}catch(i){}},getAskPrice:function(t){var e=_.isObject(t)?t:{decimals:t};try{return e.decimals=e.decimals||0===e.decimals?e.decimals:this.getDecimals(),e.zeroValue=e.zeroValue?e.zeroValue:this.defaultZeroValues,this.formatAsNumber(IFB.Descriptors.AskPrice.descriptor,e.decimals,e.zeroValue)}catch(i){}},getDescriptorValue:function(t){return this.data[t]||""},formatValueAsNumber:function(t,e,i,r,s){if(void 0!==i&&(!t||"0"===t||""===t))return i;var o=accounting.formatNumber(t,{precision:e,zero:i||""});return o+=s||"",r&&t>0&&-1===o.indexOf(r)?r+o:o},formatAsNumber:function(t,e,i,r,s){return this.formatValueAsNumber(this.getDescriptorValue(t),e,i,r,s)},setDescriptorValue:function(t,e){var i=this.data[t];return this.data[t]=e,i}}),IFB.Models.SignificantFact=IFB.Models.Instrument.extend({id:void 0,data:void 0,defaultDecimals:2,initialize:function(){this.data=this.toJSON(),this.set({id:this.data.MV})},getEventFamily:function(){try{return this.getDescriptorValue("HR")}catch(t){}},getEventType:function(){try{return this.getDescriptorValue("Tipo")}catch(t){}},getPaymentDate:function(t){try{return this.formatAsDate("FechaPago",t)}catch(e){}},getInitialDate:function(t){try{return this.formatAsDate("FechaIni",t)}catch(e){}},getFinalDate:function(t){try{return this.formatAsDate("FechaFin",t)}catch(e){}},getGrossAmount:function(t){t=t||{};try{return this.formatAsNumber("ImporteBruto",t.decimals||4,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getNetAmount:function(t){t=t||{};try{return this.formatAsNumber("ImporteNeto",t.decimals||4,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getOldShares:function(t){t=t||{};try{return this.formatAsNumber("AccionesAntiguas",t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getNewShares:function(t){t=t||{};try{return this.formatAsNumber("AccionesNuevas",t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getPricePerShare:function(t){t=t||{};try{return this.formatAsNumber("Precio",t.decimals||3,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getNominalAmount:function(t){t=t||{};try{return this.formatAsNumber("ImporteNominal",t.decimals||2,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getPayAmount:function(t){t=t||{};try{return this.formatAsNumber("ImporteDesembolso",t.decimals||3,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getIPODate:function(t){try{return this.formatAsDate("FechaOfertaPublica",t)}catch(e){}},getSequence:function(t){t=t||{};try{return this.formatAsNumber("Secuencia",t.decimals,t.zeroValue,t.positiveSign,t.suffix)}catch(e){}},getEffectDate:function(t){try{return this.formatAsDate("FechaEfectiva",t)}catch(e){}},getFirstCallDate:function(t){try{return this.formatAsDate("FechaConvocatoria1",t)}catch(e){}},getFirstCallTime:function(t){try{return this.formatAsTime("HoraConvocatoria1",t)}catch(e){}},getSecondCallDate:function(t){try{return this.formatAsDate("FechaConvocatoria2",t)}catch(e){}},getSecondCallTime:function(t){try{return this.formatAsTime("HoraConvocatoria2",t)}catch(e){}}}),IFB.Collections.Base=Backbone.Collection.extend({options:{},refreshIntervalId:void 0,ajaxTried:0,initialize:function(t){t&&(this.requests=[],this.options=t||{},this.url=(this.options.baseURL||"")+this.url,this.options.serviceParams.beforeSend=this.setAuthorizationHeader,this.options.serviceParams.reset=!0,this.bind("dataLoaded",this.dataLoaded,this))},setRefresh:function(){var t=this;this.options.refresh&&!t.refreshIntervalId&&(t.refreshIntervalId=setInterval(function(){t.refresh()},this.options.refresh))},dataLoaded:function(){this.setRefresh()},refresh:function(){this.load()},parse:function(){throw new Error("This method must be overrided")},getElementById:function(t){return this.get(t)},load:function(t){var e,i=_.clone(this.options.serviceParams);if(i.data=_.clone(this.options.serviceParams.data),_.extend(i.data,t||{}),IFB.ClientConfiguration&&IFB.ClientConfiguration.Services.CacheKey&&IFB.Services.Profile){var r=IFB.ClientConfiguration.Services.CacheKey;i.data.profile=r+"_"+IFB.Services.Profile}_.each(this.requests,function(t){t&&t.abort()}),this.requests=[],e=this.fetch(i),e&&this.requests.push(e)},sync:function(t,e,i){var r=this,s=arguments;Backbone.sync.apply(this,s).done(function(){r.ajaxTried=0}).fail(function(){r.ajaxTried<IFB.Services.RetryLimit?(r.ajaxTried++,r.sync.apply(r,s)):(r.ajaxTried=0,_.isFunction(i.success)&&i.success(JSON.parse(IFB.Services.AnswerError)))})},setAuthorizationHeader:function(t){$.support.cors=!0,IFB.Services.AUTH_TOKEN&&(t.setRequestHeader("Infobolsa-Auth-Token",IFB.Services.AUTH_TOKEN),t.setRequestHeader("Content-type","text/plain")),IFB.Services.Session&&t.setRequestHeader("Infobolsa-Session",IFB.Services.Session)},changeDataParam:function(){var t=this;return function(e){t.config.serviceParams.data.param=e,t.load()}}}),IFB.Services.Base=IFB.Class(null,{baseURL:void 0,session:void 0,servicename:void 0,initialize:function(t){this.baseURL=t.baseURL||IFB.Services.baseURL,this.session=t.session,this.servicename=t.servicename||""},request:function(t,e,i,r,s,o,n){({error:!0,code:"infobolsa.service."+this.servicename+"."+r+".error"});$.ajax({type:t,url:e,data:i,xhrFields:{withCredentials:!0},tryCount:0,success:function(t){_.isFunction(s)&&s(t,o,n)},beforeSend:function(t){IFB.Services.AUTH_TOKEN&&(t.setRequestHeader("Infobolsa-Auth-Token",IFB.Services.AUTH_TOKEN),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),IFB.Services.Session&&t.setRequestHeader("Infobolsa-Session",IFB.Services.Session)},error:function(){return this.tryCount<IFB.Services.RetryLimit?(this.tryCount++,void $.ajax(this)):void(_.isFunction(s)&&s(IFB.Services.AnswerError,o,n))}})},postRequest:function(t,e,i,r,s,o){this.request("POST",t,e,i,r,s,o)},cacheRequest:function(t,e,i,r,s,o){if(delete e.sesion,IFB.Services.Profile){var n="";IFB.ClientConfiguration&&IFB.ClientConfiguration.Services.CacheKey&&(n=IFB.ClientConfiguration.Services.CacheKey,e.profile=n+"_"+IFB.Services.Profile)}this.request("GET",t,e,i,r,s,o)},getRequest:function(t,e,i,r,s,o){this.request("GET",t,e,i,r,s,o)},postRequestNoAuth:function(t,e,i){({code:"infobolsa.service."+this.servicename+"."+i+".error"});$.ajax({cache:!1,type:"POST",url:t,xhrFields:{withCredentials:!0},data:e})},getRequestNoAuth:function(t,e,i,r,s,o){({error:!0,code:"infobolsa.service."+this.servicename+"."+i+".error"});$.ajax({type:"GET",url:t,data:e,tryCount:0,success:function(t){_.isFunction(r)&&r(t,s,o)},beforeSend:function(t){t.setRequestHeader("Content-Type","text/plain")},error:function(){return this.tryCount<IFB.Services.RetryLimit?(this.tryCount++,void $.ajax(this)):void(_.isFunction(r)&&r(IFB.Services.AnswerError,s,o))}})},jsonParamsPost:function(t,e,i,r,s,o){return e=JSON.stringify(e),this.postRequest(t,e,i,r,s,o)},getSession:function(){return this.session}}),IFB.Views.Base=Backbone.View.extend({initialize:function(){_.extend(this,Backbone.Events),this.model.bind("reset",this.reset,this),this.lastRegisterCall=void 0,this.initializeStreamingConfiguration()},reconnectingRealTime:!1,destroy:function(){this.options.streaming&&(this.lastRegisterCall&&this.unregister(),IFB.Services.Streaming.CONNECTION.unsubscribe("RealTime_Reconnected")),this.undelegateEvents()},reset:function(){var t=this.$el.attr("id");this.options.enableSort&&this.options.sortConfig&&this.options.sortConfig.descriptor?(this.options.sortConfig.changeSortDescriptor=!0,this.sortView(this.options.sortConfig,!0)):this.render(),this.options.streaming&&(this.lastRegisterCall&&this.unregister(),this.register()),this.publish("loaded",t)},render:function(){var t=this,e=t.$el.attr("id");return IFB.Utils.TemplateLoader.loadRemoteTemplate(this.options.templateId,this.options.templateFile,function(i){var r=_.template(i,{model:t.model,view:t});t.$el.html(r),t.publish("rendered",e)}),this.clearDomElementsMap(),t},onFetchError:function(){},changeDataParam:function(){var t=this;return function(e){t.model.options.serviceParams.data.param=e,t.model.load()}},reload:function(t){this.model.load(t)},publish:function(t,e){this.trigger(t,e)},subscribe:function(t,e,i){this.on(t,e,i)},register:function(){if(this.options.streaming){var t=this.model.models?_.map(this.model.models,function(t){return t.getDescriptorValue("MV")}):[this.model.getDescriptorValue("MV")];this.lastRegisterCall={descriptors:this.model.options.headerRT?this.model.options.headerRT.split(","):(this.model.options.serviceParams.data.header||"").split(","),instruments:t},IFB.Services.Streaming.CONNECTION&&IFB.Services.Streaming.CONNECTION.register({wnd:this.cid,instruments:this.lastRegisterCall.instruments,descriptors:this.lastRegisterCall.descriptors,context:this,callback:this.onUpdateData})}},unregister:function(){this.domElementsMap={},IFB.Services.Streaming.CONNECTION&&IFB.Services.Streaming.CONNECTION.unregister({wnd:this.cid,instruments:this.lastRegisterCall.instruments,descriptors:this.lastRegisterCall.descriptors,context:this,callback:this.onUpdateData})},onRender:function(){throw new Error("This method must be overrided")},initializeStreamingConfiguration:function(){this.options.streaming&&(this.options.topFlopCls&&3===this.options.topFlopCls.length||(this.options.topFlopCls={top:"ifb-top",flop:"ifb-flop",equal:"ifb-equal"}),this.options.hiEffectCls&&3===this.options.hiEffectCls.length||(this.options.hiEffectCls={top:"ifb-highlight-top",flop:"ifb-highlight-flop",equal:"ifb-highlight-equal"}),this.options.hiEffectMillis||(this.options.hiEffectMillis=3e3),this.clearDomElementsMap(),IFB.Services.Streaming.CONNECTION.subscribe("RealTime_Reconnected",this.realTimeReconnected,this))},realTimeReconnected:function(){this.reconnectingRealTime=!0,this.reset()},clearDomElementsMap:function(){this.domElementsMap={}},onUpdateData:function(t){var e=this.model.getElementById(t.MV);e&&this.updateInstrumentData(e,t)},updateInstrumentData:function(t,e){var i=this,r=e.MV;_.each(e.V,function(e){var s=[];key="[data-mv='"+r+"'][data-descriptor='"+e.D+"']",i.domElementsMap[key]||(i.domElementsMap[key]=$(key,i.$el)),elements=i.domElementsMap[key],i.options.highlightUsesPrevLastTrend&&e.D===IFB.Descriptors.Last.descriptor&&i.storePrevLastTrend(t,e.V),t.setDescriptorValue(e.D,e.V),elements.length>0&&i.updateDOM(t,elements,e.V,s),i.updateCalculatedFields(t,s)})},updateCalculatedFields:function(){},getPercent:function(t,e){var i=0;return t&&(i=Math.round(100*e/t*100)/100),i},updateDOM:function(t,e,i,r){var s=this;_.each(e,function(e){var o=$(e),n=$(o).parent(),a=o.attr("data-type"),c=o.attr("data-decimals")||2,u=o.attr("data-descriptor"),d=o.attr("data-suffix")||"",l=o.attr("data-zeroValue")||"",h=o.attr("data-positiveSign")||"",p=o.attr("data-inverseColors")||"",f=s.getDifValue(t,$(o).attr("data-dif-reference")||IFB.Descriptors.Trend.descriptor,i);if(s.isColorizedElement(o)?s.updateColor(o,f,p):s.isColorizedElement(n)&&s.updateColor(n,f,p),"silent"!==a){var m=s.formatValue(i,a,Number(c),l,h,d,t,o);if("topFlopBar"!==a)o.html(m);else{var g=Number(o.attr("data-total")),v=s.getPercent(g,Number(i));o.attr("data-value",i),v?(o.show(),o.css("width",v+"%")):o.hide()}}var D=u&&0===u.indexOf("D")?u.substring(1):u;if((!s.options.highlightDescriptors||-1!==s.options.highlightDescriptors.indexOf(D))&&D!==IFB.Descriptors.Trend.descriptor.replace("D",""))if(s.options.highlightUsesPrevLastTrend){var F=s.getDifValue(t,"PREV_LAST_TREND");s.highlight(o,F,p)}else s.highlight(o,f,p);if(r){var I=o.attr("data-calc-trigger");I&&_.each(I.split(","),function(t){var e=t.toLowerCase();-1===r.indexOf(e)&&r.push(e)})}})},formatValue:function(t,e,i,r,s,o,n,a){if("number"===e)return n.formatValueAsNumber(t,i,r,s,o);if("date"===e)return n.formatValueAsDate(t);if("time"===e)return n.formatValueAsTime(t);if("dateOrTime"===e){var c=a.attr("data-dateFormat"),u=a.attr("data-timeFormat");return n.formatValueAsDateOrTime(t,c,u)}return"topFlopBar"===e?"":t},isColorizedElement:function(t){return $(t).hasClass(this.options.topFlopCls.top)||$(t).hasClass(this.options.topFlopCls.flop)||$(t).hasClass(this.options.topFlopCls.equal)},highlight:function(t,e,i){var r,s="true"===i?this.options.hiEffectCls.flop:this.options.hiEffectCls.top,o="true"===i?this.options.hiEffectCls.top:this.options.hiEffectCls.flop,n=this.options.hiEffectCls.equal;r=e>0?s:0>e?o:n,t.addClass(r),_.delay(function(t){t.removeClass(r)},this.options.hiEffectMillis,t)},updateColor:function(t,e,i){var r="true"===i?this.options.topFlopCls.flop:this.options.topFlopCls.top,s="true"===i?this.options.topFlopCls.top:this.options.topFlopCls.flop,o=this.options.topFlopCls.equal;t.removeClass(r+" "+s+" "+o),t.addClass(e>0?r:0>e?s:o)},getDifValue:function(t,e,i){var r=e?t.getDescriptorValue(e)||i:i;return e===IFB.Descriptors.Trend.descriptor?"1"===r?1:"2"===r?-1:0:Number(r)},storePrevLastTrend:function(t,e){var i=t.getDescriptorValue(IFB.Descriptors.Decimals.descriptor)||4,r=t.getDescriptorValue(IFB.Descriptors.Last.descriptor)||0,s=(e-r).toFixed(i);t.setDescriptorValue("PREV_LAST_TREND",s)},initializeScroll:function(t){IFB.Utils.Helper.isMobileWidth()||(this.heightScroll=this.options.enableScroll?(this.options.heightScroll||this.heightScroll)+"px":"auto",this.options.enableScroll&&this.options.elScroll&&($(this.options.elScroll.selector).parent().css("max-height",this.heightScroll),this.$el.find(this.options.elScroll.selector).scrollLayout()),_.isFunction(t)&&t())},changeSortDescriptor:!1,sortConfig:{},addSortCss:function(){$("th[data-descriptor]",this.$el).append('<span class="'+this.sortConfig.css.arrow+'"></span>'),$('th[data-descriptor="'+this.sortConfig.descriptor+'"] span',this.$el).addClass(this.sortConfig.css[this.sortConfig.direction]),$('th[data-descriptor="'+this.sortConfig.descriptor+'"]',this.$el).toggleClass("arrange")},sortView:function(t){if(this.options.enableSort){var e=t.descriptor;e&&(this.changeSortDescriptor=t.changeSortDescriptor||this.sortConfig.descriptor!==e,this.sortConfig.descriptor=e,this.sortConfig.type=this.getSortType(),this.sortConfig.direction=t.direction||this.setSortDirection(),this.sortModel(),this.updateServiceParamSort(),this.render())}},getNumber:function(t){return void 0===t||""===t?0:Number(t)},sortModel:function(){var t,e,i=this,r=this.sortConfig.type,s=this.sortConfig.direction,o=this.sortConfig.descriptor;this.model.models.sort(function(n,a){var c=function(t,e,r){var s="function"==typeof t[e]?t[e]():i.model.userHeader?t.getRawDataFromColumnadoConfig(i.model.userHeader.get(e.replace("D",""))):t.data[e];return"number"===r?i.getNumber(s):s};return t=c(n,o,r),e=c(a,o,r),"number"===r?"asc"===s?t-e:e-t:"asc"===s?t>e?1:-1:t>e?-1:1})},setSortDirection:function(){var t="";return t=this.changeSortDescriptor?"number"===this.sortConfig.type?"desc":this.sortConfig.descriptor===IFB.Descriptors.Date.descriptor||this.sortConfig.descriptor===IFB.Descriptors.Time.descriptor?"desc":"asc":"asc"===this.sortConfig.direction?"desc":"asc"},updateServiceParamSort:function(){var t=this.sortConfig.descriptor.replace("D","");this.model.options.serviceParams.data.sort="desc"===this.sortConfig.direction?"-"+t:t},getSortType:function(){try{return _.findWhere(IFB.Descriptors,{descriptor:this.sortConfig.descriptor}).sortType||"number"}catch(t){return"number"}}}),IFB.Views.TraderBase=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments),this.lastRegisterCallTrader=void 0,this.initializeStreamingConfigurationTrader()},reconnectingTrader:!1,initializeStreamingConfigurationTrader:function(){this.options.streamingTrader&&(this.listenTo(this.model,"add",this.onViewCollectionAddElement),IFB.Services.Trading.CONNECTION.subscribe("WebTrader_Reconnected",this.webTraderReconnected,this),this.options.streamingType||(this.options.streamingType=IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_ORDERS),this.options.topFlopCls&&3===this.options.topFlopCls.length||(this.options.topFlopCls={top:"ifb-top",flop:"ifb-flop",equal:"ifb-equal"}),this.options.hiEffectCls&&3===this.options.hiEffectCls.length||(this.options.hiEffectCls={top:"ifb-highlight-top",flop:"ifb-highlight-flop",equal:"ifb-highlight-equal"}),this.options.hiEffectMillis||(this.options.hiEffectMillis=3e3),this.clearDomElementsMap())},webTraderReconnected:function(){this.reconnectingTrader=!0,this.reload()},destroy:function(){this.options.streamingTrader&&(this.lastRegisterCallTrader&&this.unregisterTrader(this.options.streamingType),IFB.Services.Trading.CONNECTION.unsubscribe("WebTrader_Reconnected")),IFB.Views.Base.prototype.destroy.apply(this,arguments)},reset:function(){this.options.enableSort&&this.sortModel(),this.options.streamingTrader&&(this.lastRegisterCallTrader&&this.unregisterTrader(this.options.streamingType),this.registerTrader(this.options.streamingType),this.reconnectingTrader=!1),IFB.Views.Base.prototype.reset.apply(this,arguments)},registerTrader:function(t){var e=this.model.models?_.map(this.model.models,function(t){return t.getId()}):[this.model.getElementById()];this.lastRegisterCallTrader={descriptors:(this.model.options.serviceParams.data.descriptorsTrader||"").split(","),instruments:e,accounts:this.model.options.serviceParams.data.Accounts||IFB.Trader.getAccountsList()},IFB.Services.Trading.CONNECTION&&IFB.Services.Trading.CONNECTION.registerRT({accounts:this.lastRegisterCallTrader.accounts,descriptors:this.lastRegisterCallTrader.descriptors,informationType:t,context:this,callback:this.onUpdateDataTrader})},unregisterTrader:function(t){this.domElementsMap={},IFB.Services.Trading.CONNECTION&&(this.reconnectingTrader||t===IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_ORDERS&&IFB.Trader.ordersStatusNotifications!==IFB.Trader.statusNotifications.NONE?IFB.Services.Trading.CONNECTION.unregisterEvents({accounts:this.lastRegisterCallTrader.accounts,informationType:t,callback:this.onUpdateDataTrader}):IFB.Services.Trading.CONNECTION.unregisterRT({accounts:this.lastRegisterCallTrader.accounts,informationType:t,callback:this.onUpdateDataTrader}))},onUpdateData:function(){IFB.Views.Base.prototype.onUpdateData.apply(this,arguments)},onUpdateDataTrader:function(t,e){if(this.model){var i=this;if("1"===t[IFB.Descriptors.Trader.BORRADO.descriptor]){this.model.reset();var r=t[IFB.Descriptors.Trader.PortfolioMV.descriptor];if(!r)return}var s,o,n=this.model?this.model.getElementById(e):void 0;n?_.each(t,function(t,r){var a=[];o='[data-key="'+e+'"][data-descriptor="'+r+'"]',i.domElementsMap[o]||(i.domElementsMap[o]=$(o,i.$el)),s=i.domElementsMap[o],s.length>0&&i.updateTraderDOM(n,s,t,a),n.setDescriptorValue(r,t),i.updateCalculatedFields(n,a)}):this.model.add(t)}},updateTraderDOM:function(t,e,i,r){var s=this;_.each(e,function(e){var o=$(e),n=($(o).parent(),o.attr("data-type")),a=o.attr("data-decimals")||2,c=o.attr("data-descriptor"),u=o.attr("data-suffix")||"",d=o.attr("data-zeroValue")||"",l=o.attr("data-positiveSign")||"",h=o.attr("data-calculated")||"",p="",f="";""!==h?(t.data[c]=i,f=t.getCalculatedValue(h),f.value&&(p=s.formatValue(f.value,n,a,u,t),o.html(p)),o.addClass(f.addCls),o.removeClass(f.removeCls)):(p=s.formatValue(i,n,a,d,l,u,t),o.html(p));var m=c&&0===c.indexOf("D")?c.substring(1):c;if(s.options.highlightDescriptors&&-1===s.options.highlightDescriptors.indexOf(m)||s.highlight(o,0),r){var g=o.attr("data-calc-trigger");g&&_.each(g.split(","),function(t){var e=t.toLowerCase();-1===r.indexOf(e)&&r.push(e)})}})},onViewCollectionAddElement:function(t){t&&(t.createDescriptorsCalculated(),this.sortModel(),this.render())},onOpenDetail:function(t,e){var i=$(e),r=i.parent();r.toggleClass("expand");var s=r.next("tr");s.slideToggle()}}),IFB.Components.Base=IFB.Class(null,{defaults:{show:!0},TYPE_PARAM_ISINMARKET:"6",_templates:IFB.Defaults.Templates||{},initialize:function(t){_.extend(this,Backbone.Events),this.options=_.clone(this.defaults),_.extend(this.options,t),this.views=[],this.dbService=new IFB.Services.Database({}),this.options.view&&this.options.view.el&&(this.$el=this.options.view.el),this.options.show&&this.show()},show:function(){this.create()},hide:function(){this.destroy()},create:function(){throw new Error("This method must be overriden")},update:function(){throw new Error("This method must be overriden")},destroy:function(){this.destroyRequested=!0,this.destroyAllViews()},configure:function(t,e,i){if(this.config={},this.config.serviceParams=this.options.serviceParams||{},this.config.serviceParams.data=this.options.service||{},this.config.viewOptions=this.options.view||this.options.viewOptions||{},this.options.config&&this._templates[this.options.config]&&(_.defaults(this.config,this._templates[this.options.config]),_.defaults(this.config.viewOptions,this._templates[this.options.config].viewOptions),_.defaults(this.config.serviceParams,this._templates[this.options.config].serviceParams),this._templates[this.options.config].serviceParams&&_.defaults(this.config.serviceParams.data,this._templates[this.options.config].serviceParams.data)),t&&(_.defaults(this.config,IFB.Defaults.Components[t]),_.defaults(this.config.viewOptions,IFB.Defaults.Components[t].viewOptions),_.defaults(this.config.serviceParams,IFB.Defaults.Components[t].serviceParams),_.defaults(this.config.serviceParams.data,IFB.Defaults.Components[t].serviceParams.data)),this.config.serviceParams.data.type===this.TYPE_PARAM_ISINMARKET&&this.config.serviceParams.data.param){var r=this.config.serviceParams.data.param;this.config.requestedParam=r,this.config.serviceParams.data.param=this.translateIsinMarketParam(r)}i&&(this.config.serviceParams.type=i),this.config.serviceParams.url=(this.config.serviceParams.url||IFB.Services.baseURL)+e},translateIsinMarketParam:function(t){var e="";return _.isArray(t)?(_.each(t,function(t){e+=this.translateMarket(t)+";"},this),e=e.substring(0,e.length-1)):e=this.translateMarket(t),e},translateMarket:function(t){var e="",i=12;if(t.length>i){var r=t.substring(0,i),s=IFB.Utils.Helper.translateMarketCode(t.substring(i));return _.isArray(s)?s.forEach(function(t){e+=r+t+";"}):e=r+s,e}return t},changeDataParam:function(t){var e=this;_.isArray(this.views)&&this.views.forEach(function(i){i.options.updatable&&i.view.changeDataParam()(e.translateMarket(t))})},reload:function(){_.isArray(this.views)&&this.views.forEach(function(t){t.options.updatable&&t.view.reload()})},registerView:function(t,e){var i=this;e=e||{updatable:!0};var r={view:t,options:e,events:{loaded:!1}};this.views.push(r),this.chainEvent("loaded",r),this.chainEvent("rendered",r),this.chainEvent("updating",r),this.chainEvent("perQuoteConsumed",r),this.chainEvent("clickArc",r),this.chainEvent("selectRow",r),t.on("rendered",function(){i.attachTemplateClickEvents(t.$el)})},chainEvent:function(t,e){var i=this;e.view.on(t,function(){var r=arguments;e.events[t]=!0,_.every(i.views,function(e){return e.events[t]})&&i.trigger(t,r[0],r[1],r[2])})},destroyAllViews:function(){var t=this;_.each(this.views,function(e){t.destroyView(e.view)}),this.views=[]},destroyView:function(t){t&&t.model&&(this.clearRefreshInterval(t.model),t.model.off(null,null,t),this.detachTemplateClickEvents(t.$el),t.destroy(),t.$el.empty())},clearRefreshInterval:function(t){t.refreshIntervalId&&clearInterval(t.refreshIntervalId)},attachTemplateClickEvents:function(t){var e=this;$(".ifbEventTrigger",t).each(function(t,i){var r=$(this).data("listen")?$(this).data("listen").split(","):["click tap"];$.each(r,function(t,r){if(!$(i).data("event"))throw new Error("Falta propiedad data-event sobre el objeto:",$(i).id);var s=$(i).data(),o=$(i).data("event").split(",");$(i).off(r).on(r,function(r){s.track&&s.category&&IFB.Utils.Analytics.googleTrackEvent(s.category,s.action||o[t],s.optlabel,s.optvalue,s.optnoninteraction),e.trigger(o[t],$(i).data(),$(i),r)})})})},detachTemplateClickEvents:function(t){$(".ifbEventTrigger",t).off()},removeTemplateElements:function(t){$(t,this.config.viewOptions.el).off(),$(t,this.config.viewOptions.el).remove()},isTemplateClickEvent:function(t){return t&&t.target?$(t.target).hasClass("ifbEventTrigger"):!1},_getInstrumentSituation:function(t,e,i){this.dbService.loadDataLV({sesion:IFB.Services.Session,param:t.param,type:t.type,header:t.header,rt:t.rt||"1",sort:t.sort||"-1"},function(t){var r=JSON.parse(t);if(r.answer&&r.answer.LV){var s=r.answer.LV;_.isArray(s)&&(s=s[0]),e(s,i)}})},showLoader:function(t,e){var i=$(this.config.viewOptions.el),r=i.find(".ifb-loader-container");0===r.length&&(i.prepend('<div class="ifb-loader-container">'),r=i.find(".ifb-loader-container")),this.loader=new t({config:e||"global_loading",view:{el:r}})},hideLoader:function(){this.loader&&(this.loader.destroy(),this.loader=void 0)},register:function(){_.isArray(this.views)&&this.views.forEach(function(t){t.view&&t.view.register()})}}),IFB.Components.ChartBase=IFB.Class(IFB.Components.Base,{INSTRUMENTSITUATION_DESCRIPTORS:"1147,642,250,420,611,60,70,10060,10240,370,10370,10307",create:function(){throw new Error(200,"create must be implemented")},_doCreate:function(){throw new Error(200,"_doCreate must be implemented")},_shouldBeSessionRequest:function(t,e,i,r,s){if(!t)return!0;var o=!0,n=t.substring(0,8),a=moment().format("YYYYMMDD"),c=(moment(r,"YYYYMMDD"),moment(a+" "+n,"YYYYMMDD hh:mm:ss")),u=moment(e+" "+i,"YYYYMMDD hhmmss"),d=u.diff(c,"minutes");if(0>d&&a===u.format("YYYYMMDD")){var l=moment().diff(c,"minutes");s>l&&(o=!1)}else a!==u.format("YYYYMMDD")&&(o=!1);return o},_getInstrumentSituation:function(t,e){var i=this;this.dbService.loadDataLV({sesion:IFB.Services.Session,param:t.param,type:t.type,header:this.INSTRUMENTSITUATION_DESCRIPTORS,rt:"1",sort:"-1"},function(t){var r=JSON.parse(t);if(r.answer&&r.answer.LV){var s=r.answer.LV;_.isArray(s.V)&&(s.V=s.V[0]),s.V&&s.V.MV&&s.V.MV.length>2&&(i.config.viewOptions.trend=Number(s.V[IFB.Descriptors.Trend.descriptor]||0),i.config.viewOptions.decimals=s.V[IFB.Descriptors.Decimals.descriptor]||2,e(s.V))}})},_getInstrumentsSituation:function(t,e){this.dbService.loadDataLV({sesion:IFB.Services.Session,param:t.param,type:t.type,header:"1147,642,250,420,611,60,70,10060,10240,370,10370,10307",rt:"1",sort:"-1"},function(t){var i=JSON.parse(t);i.answer&&i.answer.LV&&e(i.answer.LV.V)})},changeDataParam:function(t){var e=this;if(_.isArray(this.views)){var i=e.config.serviceParams.data;i.param=e.translateMarket(t),e._getInstrumentSituation(i,function(t){e.views.forEach(function(i){if(i.options.updatable){var r=IFB.Utils.Helper.getPreOpeningDiffMinutes(),s=e.config.viewOptions.openingTime||t.D611;e.config.viewOptions.close=t.D370,e._shouldBeSessionRequest(s,t.D60,t.D70,t.D10060,r)?e._restoreViewOptions():e._changeViewOptionsNotSessionRequest(t,e.config.serviceParams,e.config.viewOptions,2),i.view.changeDataMvParam()(t.MV,e.config.viewOptions);var o=new IFB.Models.Instrument(t);i.view.instrument=o}})})}},_changeViewOptionsNotSessionRequest:function(){},_restoreViewOptions:function(){},changeChartType:function(t,e){var i=e||!0,r=this.views&&this.views[0]?this.views[0].view:void 0;if(!Highcharts.getOptions().plotOptions[t])throw new Error("The chart type '"+t+"' does not exist");r&&r.chart&&r.chart.series&&r.chart.series[0]&&(r.typeChart=t,r.setExtremes(),r.chart.series[0].update({type:t,data:r.getHighchartPoints(),color:r.getColor()},i))},zoom:function(t,e){var i=this.views&&this.views[0]?this.views[0].view:void 0;i&&i.chart&&i.chart.series&&i.chart.series[0]&&i.chart.xAxis[0].setExtremes(t,e)}}),IFB.Components.News=IFB.Class(IFB.Components.Base,{model:void 0,view:void 0,callConfigure:function(){this.configure("News","/wtdb/NoticiasSesion")},create:function(){this.callConfigure(),this.model=new IFB.Collections.News(this.config);var t=_.extend({model:this.model,component:this},this.config.viewOptions);this.view=new IFB.Views.News(t),this.registerView(this.view),this.model.load()}}),IFB.Components.NewsRange=IFB.Class(IFB.Components.News,{callConfigure:function(){this.configure("NewsRange","/wtdb/NoticiasRangoFechas")}}),IFB.Collections.Accounts=IFB.Collections.Base.extend({model:IFB.Models.Account,url:"/GetAccountsJSON",accountSelected:void 0,initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){if(this.trigger("dataLoaded",this),!t.status.ok||!t.answer)return[];var e=t.answer;return e.length?e:[]},load:function(t){var e,i=_.clone(this.options.serviceParams);i.data=_.clone(this.options.serviceParams.data),_.extend(i.data,t||{}),i.url=IFB.Trader.getBaseURL()+"/GetAccountsJSON";var r=this.options.serviceParams.data.Accounts||IFB.Trader.getAccountsList();i.data=JSON.stringify({Accounts:r,TraderLink:IFB.Trader.configTrader.Enlaces.Carteras,SessionID:IFB.Trader.sessionID,Descriptors:i.data.descriptorsTrader}),_.each(this.requests,function(t){t.abort()}),this.requests=[],e=this.fetch(i),e&&this.requests.push(e)},setSelected:function(t){this.accountSelected=t},reset:function(){IFB.Collections.Base.prototype.reset.apply(this,arguments),this.selectFirstAccount()},selectFirstAccount:function(){this.accountSelected=this.getElementById(IFB.Trader.getFirstTradableAccountID())}}),IFB.Collections.AlertList=IFB.Collections.Base.extend({model:IFB.Models.Alert,url:"/wtmg/AlertaLista",initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){var e=[];return this.trigger("dataLoaded",this),t.status.ok&&t.answer.Alertas?($.isArray(t.answer.Alertas.Alerta)?e=t.answer.Alertas.Alerta:t.answer.Alertas.Alerta&&(e=[t.answer.Alertas.Alerta]),e.length?e:[]):[]}}),IFB.Collections.ChartDaily=IFB.Collections.Base.extend({model:IFB.Models.ChartDailyPoint,url:"/wtdb/ChartDaily",initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){return this.trigger("dataLoaded",this),t.answer&&!t.answer.error&&t.answer.LST&&t.answer.LST.TV&&t.answer.LST.TV.T15?$.isArray(t.answer.LST.TV.T15)?t.answer.LST.TV.T15:[t.answer.LST.TV.T15]:[]},getLastTime:function(){return this.models&&this.models.length>0?moment(this.models[this.models.length-1].id,"HHmmss").format("HHmmss"):""},getXFirstPoints:function(){var t=this.getPoints();return t&&t.length>0?t[0][0]:void 0},getPoint:function(t,e){var i=[];return i.push(moment(e.data.F13+"000000+0200","YYYYMMDDHHmmssZ").valueOf()),i.push(Number(e.data.F4)),i},getPoints:function(){var t=this,e=[];return _.each(this.models,function(i){e.push(t.getPoint(t.date,i))}),e},_getRawChangePercent:function(t){var e=this.models,i=e[t];if(e[t-1]){var r=e[t-1],s=this.calculateChangePercent(r.data.F6,i.data.F6);return s}return""},getPointTrend:function(t){var e=0,i=this._getRawChangePercent(t);return"number"==typeof i&&(0>i?e=2:i>0&&(e=1)),e},getPointChangePercent:function(t,e){var i=this._getRawChangePercent(t);return"number"==typeof i?this.formatValueAsNumber(i,e):""},calculateChangePercent:function(t,e){return t?(e-t)/t*100:0
},formatValueAsNumber:function(t,e,i,r,s){if(i&&(!t||"0"===t))return i;var o=accounting.formatNumber(t,{precision:e,zero:i||""});return o+=s||"",r&&t>0&&-1===o.indexOf(r)?r+o:o}}),IFB.Collections.ChartIntraday=IFB.Collections.Base.extend({model:IFB.Models.ChartIntradayPoint,url:"/wtdb/ChartIntraday",date:"",initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){return this.trigger("dataLoaded",this),t.answer&&!t.answer.error&&t.answer.LST&&t.answer.LST.TV&&t.answer.LST.TV.T09?(this.date=t.answer.LST.TV.FSD,$.isArray(t.answer.LST.TV.T09)?t.answer.LST.TV.T09:[t.answer.LST.TV.T09]):[]},getLastTime:function(){return this.models&&this.models.length>0?moment(this.models[this.models.length-1].id,"HHmmss").format("HHmmss"):""},getXFirstPoints:function(){var t=this.getPoints();return t&&t.length>0?t[0][0]:void 0},getPoint:function(t,e){var i=[];return i.push(moment(t+e.data.F4+"+0200","YYYYMMDDHHmmssZ").valueOf()),i.push(Number(e.data.F5)),i.push(Number(e.data.F7)),i.push(Number(e.data.F6)),i.push(Number(e.data.F8)),i},getPoints:function(){var t=this,e=[];return _.each(this.models,function(i){e.push(t.getPoint(t.date,i))}),e},getLastModel:function(){return this.models&&this.models.length>0?this.models[this.models.length-1]:void 0},getFrequency:function(){return this.options.serviceParams.data.compressionMult||""},updateLastModel:function(t){this.models[this.models.length-1]=new IFB.Models.ChartIntradayPoint(t.data)},addNewModel:function(t){var e=new IFB.Models.ChartIntradayPoint(t.data);this.add(e)}}),IFB.Collections.Columnado=IFB.Collections.Base.extend({model:IFB.Models.Columnado,url:"/wtdb/Columnado",initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){var e,i=[];return this.trigger("dataLoaded",this),t.status.ok&&t.answer.Header?(t.answer.Header.Group?_.each(t.answer.Header.Group,function(t){e=$.isArray(t.Col)?t.Col:[t.Col],_.each(e,function(e){e.groupName=t.Name,i.push(e)})}):i=$.isArray(t.answer.Header.Col)?t.answer.Header.Col:[t.answer.Header.Col],i.length?i:[]):[]}}),IFB.Collections.Dividends=IFB.Collections.Base.extend({model:IFB.Models.Instrument,url:"/wtdb/LoadDividends",initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){if(this.trigger("dataLoaded",this),!t.status.ok||!t.answer.LV)return[];var e=$.isArray(t.answer.LV.V)?t.answer.LV.V:[t.answer.LV.V];return e.length?e:[]}}),IFB.Collections.Header=Backbone.Collection.extend({model:IFB.Models.Header}),IFB.Collections.InstrumentList=IFB.Collections.Base.extend({model:IFB.Models.Instrument,url:"/wtdb/LoadDataLV",initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){var e=[];return this.trigger("dataLoaded",this),t.status.ok&&t.answer.LV?(this.infoTag=t.answer.LV.Info||{},e=$.isArray(t.answer.LV.V)?t.answer.LV.V:[t.answer.LV.V],e.length?e:[]):[]}}),IFB.Collections.News=IFB.Collections.Base.extend({model:IFB.Models.News,url:"/wtdb/NoticiasSesion",date:void 0,initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){return this.trigger("dataLoaded",this),t.status.ok&&t.answer.Noticias?(this.date=t.answer.Noticias.Date||moment().format("YYYYMMDD"),"0"!==t.answer.Noticias.TotalNum&&t.answer.Noticias.TN?$.isArray(t.answer.Noticias.TN)?t.answer.Noticias.TN:[t.answer.Noticias.TN]:[]):[]}}),IFB.Collections.NewsCriteria=IFB.Collections.News.extend({model:IFB.Models.News,url:"/wtdb/NoticiasCriterios",initialize:function(){IFB.Collections.News.prototype.initialize.apply(this,arguments)}}),IFB.Collections.NewsDetail=IFB.Collections.Base.extend({model:IFB.Models.NewsDetail,url:"/wtdb/News",date:void 0,initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){return this.trigger("dataLoaded",this),t.status.ok&&t.answer.Noticia?(this.date=t.answer.Noticia.Date||moment().format("YYYYMMDD"),t.answer.Noticia?[t.answer.Noticia]:[]):[]}}),IFB.Collections.NewsRange=IFB.Collections.News.extend({model:IFB.Models.News,url:"/wtdb/NoticiasRangoFechas",initialize:function(){IFB.Collections.News.prototype.initialize.apply(this,arguments)}}),IFB.Collections.OpenPositionList=IFB.Collections.Base.extend({model:IFB.Models.OpenPosition,url:"/GetOpenPositionJSON",selectedAccount:"",initialize:function(){this.selectFirstAccount(),IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){if(this.trigger("dataLoaded",this),!t.status.ok||!t.answer)return[];var e=t.answer;return e.length?e:[]},getInstrumentsArray:function(){var t=[];return _.each(this.models,function(e){var i=e.getPortfolioMV();-1===$.inArray(i,t)&&i&&7===i.length&&t.push(i)}),t},getInstrumentsList:function(){var t=this.getInstrumentsArray();return t.join(",")},setLastPrice:function(t,e){_.each(this.models,function(i){var r=i.getPortfolioMV();r===t&&i.setDescriptorValue(IFB.Descriptors.Last.descriptor,e)})},getModelByMV:function(t){return _.find(this.models,function(e){var i=e.getPortfolioMV();return i===t})},setSelectedAccount:function(t){this.selectedAccount=t},getSelectedAccount:function(){return this.selectedAccount},reset:function(){IFB.Collections.Base.prototype.reset.apply(this,arguments),this.selectFirstAccount()},selectFirstAccount:function(){this.selectedAccount=IFB.Trader.getFirstTradableAccountID()},load:function(t){var e,i=_.clone(this.options.serviceParams);i.data=_.clone(this.options.serviceParams.data),_.extend(i.data,t||{}),i.url=IFB.Trader.getBaseURL()+"/GetOpenPositionJSON";var r=this.options.serviceParams.data.Accounts||IFB.Trader.getAccountsList();i.data=JSON.stringify({Accounts:r,TraderLink:IFB.Trader.configTrader.Enlaces.Carteras,SessionID:IFB.Trader.sessionID,Descriptors:i.data.descriptorsTrader,Type:i.data.accountType,_dc:(new Date).getTime()}),_.each(this.requests,function(t){t.abort()}),this.requests=[],e=this.fetch(i),e&&this.requests.push(e)},createDescriptorsCalculated:function(){_.each(this.models,function(t){t.createDescriptorsCalculated()})},setInstrumentsData:function(t){var e=this;_(t).each(function(t){_(e.models).each(function(e){var i=e.getPortfolioMV();i===t.id&&e.setInstrumentData(t)})})}}),IFB.Collections.OrdersList=IFB.Collections.Base.extend({model:IFB.Models.Order,url:"/GetOrderBookJSON",initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){var e=[];return this.trigger("dataLoaded",this),t.status.ok&&t.answer?(e=t.answer,e.length?e:[]):[]},load:function(t){var e,i=_.clone(this.options.serviceParams);i.data=_.clone(this.options.serviceParams.data),_.extend(i.data,t||{}),i.url=IFB.Trader.getBaseURL()+"/GetOrderBookJSON",i.data=JSON.stringify({Accounts:IFB.Trader.getAccountsOrderBook(),TraderLink:IFB.Trader.configTrader.Enlaces.Ordenes,SessionID:IFB.Trader.sessionID,History:"N",Descriptors:i.data.descriptorsTrader,_dc:(new Date).getTime()}),_.each(this.requests,function(t){t.abort()}),this.requests=[],e=this.fetch(i),e&&this.requests.push(e)}}),IFB.Collections.Positions=IFB.Collections.Base.extend({model:IFB.Models.Positions,url:"/wtdb/LoadDataPosiciones",initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){var e=[];return this.trigger("dataLoaded",this),t.status.ok&&t.answer.LV?(this.infoTag=t.answer.LV.Info||{},t.answer.LV.V&&(e=$.isArray(t.answer.LV.V)?t.answer.LV.V:[t.answer.LV.V],e=_.sortBy(e,function(t){var e=t[IFB.Descriptors.MarketDepth.descriptor];return e?parseInt(e,10):0})),e.length?e:[]):[]}}),IFB.Collections.SignificantFacts=IFB.Collections.Base.extend({model:IFB.Models.SignificantFact,url:"/wtdb/HechoRelevanteCercano",initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments)},parse:function(t){if(this.trigger("dataLoaded",this),!t.status.ok||!t.answer.LV)return[];var e=$.isArray(t.answer.LV.V)?t.answer.LV.V:[t.answer.LV.V];return e.length?e:[]}}),IFB.Collections.TableField=IFB.Collections.Base.extend({model:{},url:"/wtdb/LoadDataLV",table:"",initialize:function(){IFB.Collections.Base.prototype.initialize.apply(this,arguments),this.table=this.options.serviceParams.table,this.model=this.getTypeModel()},parse:function(t){var e,i=[];return this.trigger("dataLoaded",this),t.status.ok&&t.answer.LST&&t.answer.LST[this.table]?(e=t.answer.LST[this.table],i=$.isArray(e)?e:[e],i.length?i:[]):[]},getTypeModel:function(){switch(this.table){case"T29":return IFB.Models.Factset}}}),IFB.Services.Activity=IFB.Class(IFB.Services.Base,{macroParameters:{EXTERNAL_USER:"[USUARIOEXTERNO]",EXTERNAL_SESSION:"[SESIONEXTERNA]",COMPONENT:"[COMPONENTE]",ACTION:"[ACCION]",SOURCE:"[ORIGEN]",DEVICE:"[DISPOSITIVO]",PARAMS:"[PARAMETROS]",DATE_DD_MM_AAAA:"[FECHA_DD-MM-AAAA]",HOUR:"[HORA]"},formats:{DATE:"DD/MM/YYYY",HOUR:"HH:mm:s",SECONDARY_PARAM:"{0}:{1}",SECONDARY_PARAMS_SEPARATOR:";",ARRAY_PARAMS_SEPARATOR:"|"},isActivityInfobolsa:!1,url:void 0,params:void 0,listParams:void 0,eventsTrace:void 0,initialize:function(t){this.isActivityInfobolsa=t.isActivityInfobolsa||!1,this.url=t.Url,this.params=t.Params,this.eventsTrace=t.eventsTrace,this.baseURL=window.location.protocol+"//"+this.url,this.servicename="activity",this.readParams()},readParams:function(){if(this.listParams=[],this.params&&this.params.length>0){var t=this.params.split(";");_.each(t,function(t){var e=t.split("=");this.listParams.push({name:e[0],value:e[1]})},this)}},notify:function(t,e,i,r){if(this.url){var s=this.parseParamsUrl(t,e,i,r);this.postRequest(this.baseURL,s,"notify",this.onCallbackNotify,this,[t,e])}},onCallbackNotify:function(t,e,i){if(e.isActivityInfobolsa&&e.eventsTrace){var r=t.indexOf("http://"),s=t.indexOf("\nPost"),o=t.substring(r,s);console.log("LOG ACTIVIDAD. Componente:",i[0],"- Accion:",i[1],"- URL Comprobacion:",o)}},parseParamsUrl:function(t,e,i,r){var s={};return _.each(this.listParams,function(o){var n;n=this.valueParamIsMacro(o.value)?this.parseParamMacro(o.value,t,e,i,r):o.value,s[o.name]=n},this),s},valueParamIsMacro:function(t){return-1!==t.indexOf("[")&&-1!==t.indexOf("]")},parseParamMacro:function(t,e,i,r,s){var o="";switch(t){case this.macroParameters.EXTERNAL_USER:var n=IFB.Utils.Helper.getUserInfo();n&&(o=n.externalUser);break;case this.macroParameters.EXTERNAL_SESSION:var n=IFB.Utils.Helper.getUserInfo();n&&(o=n.externalSession);break;case this.macroParameters.COMPONENT:o=e;break;case this.macroParameters.ACTION:o=i;break;case this.macroParameters.SOURCE:o=s;break;case this.macroParameters.DEVICE:o="PM";break;case this.macroParameters.PARAMS:o=_.isString(r)?r:this.jsonToParams(r);break;case this.macroParameters.DATE_DD_MM_AAAA:o=this.getDate();break;case this.macroParameters.HOUR:o=this.getHour()}return o},getDate:function(){return moment().format(this.formats.DATE)},getHour:function(){return moment().format(this.formats.HOUR)},jsonToParams:function(t){var e="";return"object"!=typeof t?e=t.toString().toUpperCase():_.isArray(t)?_.each(t,function(t){e+=e.length>0?this.formats.ARRAY_PARAMS_SEPARATOR:"",e+=this.jsonToParams(t)},this):_.each(t,function(t,i){e+=e.length>0?this.formats.SECONDARY_PARAMS_SEPARATOR:"",e+=IFB.Utils.Format.stringFormat(this.formats.SECONDARY_PARAM,[i.toUpperCase(),this.jsonToParams(t)])},this),e},request:function(t,e,i,r,s,o,n){$.ajax({type:t,url:e,data:i,success:function(t){s&&s(t,o,n)}})}}),IFB.Services.Database=IFB.Class(IFB.Services.Base,{options:{},initialize:function(t){this.options=t||{},IFB.Services.Database.parent.initialize.call(this,t),this.baseURL=t.baseURL||IFB.Services.baseURL+"/wtdb/",this.servicename="database"},serviceURLs:{loadDataLV:"LoadDataLV",chartDaily:"ChartDaily",chartIntraday:"ChartIntraday",relevantFactNearby:"HechoRelevanteCercano",criteriaNews:"NoticiasCriterios",dateRangeNews:"NoticiasRangeFechas",news:"News",recentNews:"NoticiasSesion",instrumentInGroup:"ValorEnAgrupacion",loadDataCombo:"LoadDataCombo",valuePerquote:"HayPerquote",columnado:"Columnado",loadDataMasSubenBajanContratan:"LoadDataMasSubenBajanContratan",chartIntradayRange:"ChartIntradayRange",loadDataPosiciones:"LoadDataPosiciones"},loadDataLV:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.loadDataLV;this.cacheRequest(r,t,this.serviceURLs.loadDataLV,e._function,i,e.params)},loadDataMasSubenBajanContratan:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.loadDataMasSubenBajanContratan;this.cacheRequest(r,t,this.serviceURLs.loadDataMasSubenBajanContratan,e._function,i,e.params)},chartDaily:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.chartDaily;this.cacheRequest(r,t,this.serviceURLs.chartDaily,e._function,i)},chartIntraday:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.chartIntraday;this.cacheRequest(r,t,this.serviceURLs.chartIntraday,e._function,i)},relevantFactNearby:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.relevantFactNearby;this.cacheRequest(r,t,this.serviceURLs.relevantFactNearby,e._function,i)},criteriaNews:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.criteriaNews;this.cacheRequest(r,t,this.serviceURLs.criteriaNews,e._function,i)},dateRangeNews:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.dateRangeNews;this.cacheRequest(r,t,this.serviceURLs.dateRangeNews,e._function,i)},news:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.news;this.cacheRequest(r,t,this.serviceURLs.news,e._function,i)},recentNews:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.recentNews;this.cacheRequest(r,t,this.serviceURLs.recentNews,e._function,i)},instrumentInGroup:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.instrumentInGroup;this.cacheRequest(r,t,this.serviceURLs.instrumentInGroup,e._function,i)},loadDataCombo:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.loadDataCombo;this.cacheRequest(r,t,this.serviceURLs.loadDataCombo,e._function,i)},valuePerquote:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.valuePerquote;this.postRequest(r,t,this.serviceURLs.valuePerquote,e._function,i)},columnado:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.columnado;this.cacheRequest(r,t,this.serviceURLs.columnado,e._function,i,e.params)},chartIntradayRange:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.chartIntradayRange;this.cacheRequest(r,t,this.serviceURLs.chartIntradayRange,e._function,i)},loadDataPosiciones:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.loadDataPosiciones;this.cacheRequest(r,t,this.serviceURLs.loadDataPosiciones,e._function,i)}}),IFB.Services.ExternalUsers=IFB.Class(IFB.Services.Base,{options:{},initialize:function(t){this.options=t||{},IFB.Services.ExternalUsers.parent.initialize.call(this,this.options),this.baseURL=this.options.baseURL||IFB.Services.ExternalUsersUrl,this.servicename="externalusers"},serviceURLs:{autoLogin:"AutoLogin.aspx",clickOnDocuments:"Si3/ClickOnDocuments.aspx"},autoLogin:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+"/"+this.serviceURLs.autoLogin;this.getRequestNoAuth(r,t,this.serviceURLs.autoLogin,e._function,i,e.params)},clickOnDocuments:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+"/"+this.serviceURLs.clickOnDocuments;this.getRequestNoAuth(r,t,this.serviceURLs.clickOnDocuments,e._function,i,e.params)}}),IFB.Services.Management=IFB.Class(IFB.Services.Base,{options:{},initialize:function(t){this.options=t||{},IFB.Services.Management.parent.initialize.call(this,this.options),this.baseURL=this.options.baseURL||IFB.Services.baseURL+"/wtmg/",this.servicename="management"},serviceURLs:{addAlert:"AlertaAlta",listAlert:"AlertaLista",removeAlert:"AlertaBaja",validateSID:"ValidateSID",getProfile:"Profile",getProductConfig:"ProdConfig",getEvents:"EventosConsulta",loadFile:"LoadFile",loadUserFiles:"LoadUserFiles",saveFile:"SaveFile",getOthersLikeYou:"EventosOtrosComoTu",login:"Login",loginSesion:"LoginSesion",infoLogin:"InfoLogin",addAlertING:"AlertaAltaING",deleteExternalUser:"UsuarioExternoBorrar",historicalAlerts:"AlertaHistorico"},addAlert:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.addAlert,s={alerta:t.alert};this.postRequest(r,s,this.serviceURLs.addAlert,e._function,i)},addAlertING:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.addAlertING,s={alerts:JSON.stringify(t.alerts)};this.postRequest(r,s,this.serviceURLs.addAlertING,e._function,i)},listAlert:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.listAlert,s={sesion:t.session,idAlertas:t.idAlert};this.postRequest(r,s,this.serviceURLs.listAlert,e._function,i,e.params)},removeAlert:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.removeAlert,s={sesion:t.session,alerta:t.alertId,formato:t.format};this.postRequest(r,s,this.serviceURLs.removeAlert,e._function,i)},validateSID:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.validateSID,s={sid:t.sid};this.postRequest(r,s,this.serviceURLs.validateSID,e._function,i,e.params)},getProfile:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.getProfile,s={sesion:t.session,canalessubcanales:t.canalessubcanales};this.postRequest(r,s,this.serviceURLs.getProfile,e._function,i,e.params)},getProductConfig:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.getProductConfig,s={sesion:t.session};this.postRequest(r,s,this.serviceURLs.getProductConfig,e._function,i,e.params)},getEvents:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.getEvents;this.postRequest(r,t,this.serviceURLs.getEvents,e._function,i,e.params)},getOthersLikeYou:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.getOthersLikeYou;this.postRequest(r,t,this.serviceURLs.getOthersLikeYou,e._function,i,e.params)},loadFile:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.loadFile,s={sesion:t.session,file:t.file,type:t.type,transform:t.transform};this.postRequest(r,s,this.serviceURLs.loadFile,e._function,i,e.params)},saveFile:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.saveFile,s={sesion:t.session,file:t.file,type:t.type,replace:t.replace,content:t.content,transform:t.transform};this.postRequest(r,s,this.serviceURLs.saveFile,e._function,i,e.params)},loadUserFiles:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.loadUserFiles,s={sesion:t.session,type:t.type,contentpreload:t.contentpreload};this.postRequest(r,s,this.serviceURLs.loadUserFiles,e._function,i,e.params)},login:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.login,s={usr:t.usr,pwd:t.pwd,lang:t.lang,product:t.product};this.postRequest(r,s,this.serviceURLs.login,e._function,i,e.params)},loginSesion:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.loginSesion,s={sesion:t.session,producto:t.product};this.postRequest(r,s,this.serviceURLs.loginSesion,e._function,i,e.params)},deleteExternalUser:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.deleteExternalUser,s={entidad:t.entidad,usuarioEntidad:t.usuarioEntidad,producto:t.producto};this.postRequest(r,s,this.serviceURLs.deleteExternalUser,e._function,i,e.params)},infoLogin:function(t,e,i,r,s){r=_.isFunction(r)?{_function:r}:r;var o=this.baseURL+this.serviceURLs.infoLogin,n={sesion:t,version:e,dispositivo:i};this.postRequest(o,n,this.serviceURLs.infoLogin,r._function,s)},historicalAlerts:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.historicalAlerts,s={sesion:t.session,idAlertas:t.idAlerts};this.postRequest(r,s,this.serviceURLs.historicalAlerts,e._function,i,e.params)}}),IFB.Services.Portfolio=IFB.Class(IFB.Services.Base,{options:{},initialize:function(t){this.options=t||{},IFB.Services.Portfolio.parent.initialize.call(this,this.options),this.baseURL=this.options.baseURL||IFB.ClientConfiguration&&IFB.ClientConfiguration.Services.PortfolioUrl?IFB.ClientConfiguration.Services.PortfolioUrl:IFB.Services.PortfolioUrl,this.servicename="portfolio"},serviceURLs:{addPortfolio:"AltaCartera",addOrder:"AltaMovimiento",getPortfolioList:"DameListaCarteras",getPortfolioOpenPosition:"PosicionAbierta",getPortfolioClosedPosition:"PosicionCerrada",removePortfolio:"BajaCartera",editPortfolio:"EditarCartera"},addPortfolio:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+"/"+this.serviceURLs.addPortfolio,s={sesionid:t.sesionid,nombrecartera:t.nombrecartera};this.postRequest(r,s,this.serviceURLs.addPortfolio,e._function,i)},addOrder:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+"/"+this.serviceURLs.addOrder,s={sesionid:t.sesionid,carteraid:t.carteraid,sentido:t.sentido,mv:t.mv,titulos:t.titulos,precio:t.precio,fecha:t.fecha,hora:t.hora,comision:t.comision,divisa:t.divisa};this.postRequest(r,s,this.serviceURLs.addOrder,e._function,i)},getPortfolioList:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+"/"+this.serviceURLs.getPortfolioList,s={sesionid:t.session,crea:t.crea};this.postRequest(r,s,this.serviceURLs.addPortfolio,e._function,i)},getPortfolioOpenPosition:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+"/"+this.serviceURLs.getPortfolioOpenPosition,s={sesionid:t.session,carteraid:t.portfolioId};this.postRequest(r,s,this.serviceURLs.getPortfolioOpenPosition,e._function,i)},getPortfolioClosedPosition:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+"/"+this.serviceURLs.getPortfolioClosedPosition,s={sesionid:t.session,carteraid:t.portfolioId};this.postRequest(r,s,this.serviceURLs.getPortfolioClosedPosition,e._function,i)},removePortfolio:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+"/"+this.serviceURLs.removePortfolio,s={sesionid:t.session,carteraid:t.portfolioId};this.postRequest(r,s,this.serviceURLs.removePortfolio,e._function,i)},editPortfolio:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+"/"+this.serviceURLs.editPortfolio,s={sesionid:t.session,carteraid:t.portfolioId,nombrecartera:t.portfolioName};this.postRequest(r,s,this.serviceURLs.editPortfolio,e._function,i)}}),IFB.Services.SI3=IFB.Class(IFB.Services.Base,{options:{},initialize:function(t){this.options=t||{},IFB.Services.SI3.parent.initialize.call(this,this.options),this.baseURL=this.options.baseURL||IFB.Services.baseURL+"/si3/",this.servicename="si3"},serviceURLs:{getClickOnDocuments:"GetClickOnDocuments",signDocument:"SignDocument",notifyDeleteUser:"NotificaBajaUsuario"},getClickOnDocuments:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.getClickOnDocuments,s={codCompany:t.codCompany,codUsr:t.codUsr,codProduct:t.codProduct,codSeller:t.codSeller};this.postRequest(r,s,this.serviceURLs.getClickOnDocuments,e._function,i)},signDocument:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.signDocument,s={codCompany:t.codCompany,codDoc:t.codDoc,codUser:t.codUser,codProduct:t.codProduct,codInstal:t.codInstal,signDate:t.signDate,clientid:t.clientid,product:t.product};this.postRequest(r,s,this.serviceURLs.signDocument,e._function,i)},notifyDeleteUser:function(t,e,i){e=_.isFunction(e)?{_function:e}:e;var r=this.baseURL+this.serviceURLs.notifyDeleteUser,s={codCompany:t.codCompany,codUser:t.codUser,emailsList:t.emailList,clientid:t.clientid,product:t.product};this.postRequest(r,s,this.serviceURLs.notifyDeleteUser,e._function,i)}}),IFB.Services.Streaming=IFB.Class(IFB.Services.Base,{isAlive:!1,isLogout:!1,TIMERHEARTBEAT:15e3,reconnecting:!1,options:{},firstConnection:!0,connected:!1,actualFrame:1,messages:0,mapValues:void 0,netting:0,maxMessages:void 0,formatTypeJson:void 0,ifbTables:{Positions:"47"},streamingEnabled:!0,initialize:function(t){_.extend(this,Backbone.Events),this.options=t||{},this.streamingEnabled=_.isUndefined(this.options.streamingEnabled)?!0:this.options.streamingEnabled,IFB.Services.Streaming.parent.initialize.call(this,t),this.servicename="streaming",_.once(this.setDomainName()),this.initConfig(),this.isEnabled()&&(this.createFrames(),this.addPostMessageListener())},subscribe:function(t,e,i){this.on(t,e,i)},unsubscribe:function(t){this.off(t)},isEnabled:function(){return!!this.session&&this.streamingEnabled},initConfig:function(){this.maxMessages=this.options.maxMessages||5e3,this.formatTypeJson=this.options.formatTypeJson||"3",this.netting=this.options.netting||0},setDomainName:function(){var t;IFB.ClientConfiguration&&IFB.ClientConfiguration.Services.Domain?t=IFB.ClientConfiguration.Services.Domain:IFB.Services.Domain&&(t=IFB.Services.Domain),t&&(document.domain=t)},getStreamingBaseUrl:function(){return IFB.ClientConfiguration&&IFB.ClientConfiguration.Services.StreamingBaseUrl?IFB.ClientConfiguration.Services.StreamingBaseUrl:IFB.Services.StreamingBaseUrl},serviceURLs:{setConnection:"SetConnection.srf",registerRT:"RegisterRT.srf",unregisterRT:"UnregisterRT.srf",unregisterAllRT:"unregisterAll.srf",registerPos:"RegisterPos.srf",unregisterPos:"UnregisterPos.srf",registerNot:"RegisterNot.srf",unregisterNot:"UnregisterNot.srf"},createFrames:function(){var t=this.getStreamingBaseUrl()+"/"+this.serviceURLs.setConnection+"?sesion="+escape(this.session)+"&amortiguacion="+this.netting;this.createFrame({name:"iframe_conexion1",id:"iframe_conexion1",src:t+"&idconnection=1&formatType="+this.formatTypeJson+"&timestamp="+(new Date).getTime(),width:0,height:0,frameborder:0}),this.createFrame({name:"iframe_conexion2",id:"iframe_conexion2",src:this.getStreamingBaseUrl()+"/blank.html",width:0,height:0,frameborder:0}),this.isAlive=!0,this.activityCheckWT()},createFrame:function(t){$('<iframe style="display:none" id="'+t.id+'" name="'+t.name+'" src="'+t.src+'" width="'+t.width+'" height="'+t.height+'" frameborder="'+t.frameborder+'" />').appendTo("body")},connect:function(t){this.connected=!0,this.messages=0,this.reconnecting?(this.reconnecting=!1,this.trigger("RealTime_Reconnected",this),console.log("Reconectado a Streaming ")):this.firstConnection&&(this.firstConnection=!1,console.log("Conectado a Streaming ")),t&&"function"==typeof t&&t()},reconnect:function(){var t=this.getStreamingBaseUrl()+"/"+this.serviceURLs.setConnection+"?sesion="+escape(this.session)+"&amortiguacion="+this.netting+"&idconnection=1&formatType="+this.formatTypeJson+"&timestamp="+(new Date).getTime();this.connected||$("#iframe_conexion"+this.actualFrame)&&$("#iframe_conexion"+this.actualFrame).attr("src",t)},disconnect:function(){$("#iframe_conexion"+this.actualFrame)&&(this.connected=!1,this.firstConnection=!0,$("#iframe_conexion"+this.actualFrame).attr("src",IFB.Services.baseURL+"/blank.html"))},register:function(t){if(this.isEnabled()){var e,i=this,r=this.baseURL+"/"+this.serviceURLs.registerRT,s={sesion:escape(this.session),wnd:t.wnd,lv:t.instruments.join(),header:t.descriptors.join(),initload:t.initload||0};this.postRequestNoAuth(r,s,this.serviceURLs.registerRt),_.each(t.instruments,function(r){e=i.getTopic("D",r),i.on(e,t.callback,t.context)})}},unregister:function(t){if(this.isEnabled()){var e,i=this,r=this.baseURL+"/"+this.serviceURLs.unregisterRT,s={sesion:escape(this.session),wnd:t.wnd,lv:t.instruments.join(),header:t.descriptors.join()};this.postRequestNoAuth(r,s,this.serviceURLs.unregisterRT),_.each(t.instruments,function(r){e=i.getTopic("D",r),i.off(e,t.callback,t.context)})}},registerPos:function(t){if(this.isEnabled()){var e,i=this,r=this.baseURL+"/"+this.serviceURLs.registerPos,s={sesion:escape(this.session),wnd:t.wnd,mv:t.mv,header:t.descriptors.join(),initload:t.initload||0};this.postRequestNoAuth(r,s,this.serviceURLs.registerPos),e=i.getTopic("P",t.mv),i.on(e,t.callback,t.context)}},unregisterPos:function(t){if(this.isEnabled()){var e,i=this,r=this.baseURL+"/"+this.serviceURLs.unregisterPos,s={sesion:escape(this.session),wnd:t.wnd,mv:t.mv,header:t.descriptors.join()};this.postRequestNoAuth(r,s,this.serviceURLs.unregisterPos),e=i.getTopic("P",t.mv),i.off(e,t.callback)}},registerNot:function(t){if(this.isEnabled()){var e,i=this,r=this.baseURL+"/"+this.serviceURLs.registerNot,s={sesion:escape(this.session),wnd:t.wnd,lf:t.sources};this.postRequestNoAuth(r,s,this.serviceURLs.registerNot),_.each(t.sources.split(","),function(r){e=i.getTopic("N",r),i.on(e,t.callback,t.context)})}},unregisterNot:function(t){if(this.isEnabled()){var e,i=this,r=this.baseURL+"/"+this.serviceURLs.unregisterNot,s={sesion:escape(this.session),wnd:t.wnd,lf:t.sources};this.postRequestNoAuth(r,s,this.serviceURLs.unregisterNot),_.each(t.sources.split(","),function(r){e=i.getTopic("N",r),i.off(e,t.callback,t.context)})}},unregisterAll:function(){if(this.isEnabled()){var t=this.baseURL+"/"+this.serviceURLs.unregisterAllRT,e={sesion:escape(this.session)};this.postRequestNoAuth(t,e,this.serviceURLs.unregisterAllRT)}},getTopic:function(t,e){if(e){var i=e.replace(/^\s+|\s+$/g,"");return t+":"+i.replace(" ","_")}return""},updateData:function(t){this.messages++,this.messages>=this.maxMessages&&(this.changeFrame(),this.messages=0),this.dataTrigger(t)},dataTrigger:function(t){if("NT"===t.type)this.trigger(this.getTopic("N",t.Fuente),t.Noticia);else switch(t.T){case this.ifbTables.Positions:this.trigger(this.getTopic("P",t.MV),t),"1"===t.C&&this.trigger(this.getTopic("D",t.MV),t);break;default:this.trigger(this.getTopic("D",t.MV),t)}},changeFrame:function(){this.actualFrame=1===this.actualFrame?2:1;var t=this.getStreamingBaseUrl()+"/"+this.serviceURLs.setConnection+"?sesion="+escape(this.session)+"&amortiguacion="+this.netting+"&formatType="+this.formatTypeJson+"&idconnection="+this.actualFrame+"&timestamp="+(new Date).getTime();$("#iframe_conexion"+this.actualFrame).attr("src",t)},alertComplete:function(t,e){IFB.Utils.Helper.onAlertComplete(t,e)},addPostMessageListener:function(){window.addEventListener?addEventListener("message",this.onPostMessage,!1):attachEvent("onmessage",this.onPostMessage)},activityCheckWT:function(){this.streamingEnabled&&(this.isAlive?this.isAlive=!1:this.isLogout||(console.log("Streaming desconectado "),this.reconnecting=!0,this.changeFrame()),setTimeout(activityCheckWT,2.3*this.TIMERHEARTBEAT))},onPostMessage:function(t){var e=IFB.Services.Streaming.CONNECTION;if(-1!==t.data.indexOf("type")){var i=JSON.parse(t.data);switch(this.isAlive=!0,i.type){case"ChangeGMT":ChangeGMT_F();break;case"Connected":Connected_F();break;case"HB":HB_F();break;case"NT":callback(i,e.actualFrame);break;case"LOGOUT":LOGOUT_F();break;case"RT":callback(i,e.actualFrame);break;case"IL":callback(i,e.actualFrame);break;case"Notification":Notificacion_F();break;case"END":END_F();break;case"Alerta":Alerta_F(i.id,i)}}}}),function(){var t={alert:function(t,e){IFB.Services.Streaming.CONNECTION.alertComplete(t,e)},connected:function(){IFB.Services.Streaming.CONNECTION.connect()},logout:function(){},realTime:function(t,e){IFB.Services.Streaming.CONNECTION.updateData(t,e)}};IFB.Services.StreamingCallbacks=t}(),IFB.Services.Trading=IFB.Class(IFB.Services.Base,{streamingBaseURL:void 0,options:{},callbackConnected:void 0,firstConnection:!0,connected:!1,actualFrame:1,messages:0,mapValues:void 0,maxMessages:void 0,serverLinkOrders:"ORDENES",serverLinkRisks:"CARTERAS",isAlive:!1,isLogout:!1,TIMERHEARTBEAT:15e3,reconnecting:!1,notificationReconnectingExists:!1,INFORMATION_TYPE_ORDERS:"ORDENES",INFORMATION_TYPE_PORTFOLIO:"CARTERAS",INFORMATION_TYPE_PORTFOLIO_CASH:"CARTERASCONTADO",INFORMATION_TYPE_PORTFOLIO_INTRADAY:"CARTERASINTRADIA",INFORMATION_TYPE_ACCOUNTS:"CUENTAS",INFORMATION_TYPE_BALANCE:"SALDOS",INFORMATION_TYPE_TRANSACTIONS:"MOVIMIENTOS",serviceURLs:{openConection:"OpenConnection",modifyOrder:"ModifyOrderJSON",newOrder:"NewOrderJSON",cancelOrders:"CancelOrderJSON",getOrderBook:"GetOrderBookJSON",getEvents:"GetEventsJSON",getOpenPosition:"GetOpenPositionJSON",getAccounts:"GetAccountsJSON",registerRT:"RegisterRT",unregisterRT:"UnregisterRT",unregisterUser:"UnregisterUserJSON",initCall:"Init",getErrors:"GetErrors",getCommission:"GetCommissionJSON",getBalance:"DameSaldos"},initialize:function(t){_.extend(this,Backbone.Events),this.options=t||{},this.serverLinkOrders=this.options.serverLinkOrders,this.serverLinkRisks=this.options.serverLinkRisks,IFB.Services.Trading.parent.initialize.call(this,t),this.streamingBaseURL=t.streamingBaseURL,this.servicename="trader",_.once(this.setDomainName()),this.initConfig()
},startStreaming:function(t,e){this.callbackConnected=t,this.contextCallback=e,this.isEnabled()&&this.createFrames()},activityCheck:function(){this.isAlive?this.isAlive=!1:this.isLogout||(this.reconnecting=!0,console.log("Web Trader desconectado "),this.showNotificationReconnecting(),this.changeFrame()),setTimeout(activityCheckTrader,2.3*this.TIMERHEARTBEAT)},isEnabled:function(){return!0},initConfig:function(){this.maxMessages=this.options.maxMessages||5e3},setDomainName:function(){IFB.Services.Domain&&(document.domain=IFB.Services.Domain)},closeNotificationReconnecting:function(){this.notificationReconnectingExists&&(IFB.Utils.Helper.closeNotification(),this.notificationReconnectingExists=!1)},showNotificationReconnecting:function(){this.reconnecting&&!this.notificationReconnectingExists&&(IFB.Utils.Helper.showNotificationReconnecting(),this.notificationReconnectingExists=!0)},createFrames:function(){var t=this.streamingBaseURL+"/"+this.serviceURLs.openConection+"?sesion="+escape(this.session);this.createFrame({name:"iframe_trader_conexion1",id:"iframe_trader_conexion1",src:t+"&idconnection=1&timestamp="+(new Date).getTime()+"&timehb="+this.TIMERHEARTBEAT,width:0,height:0,frameborder:0}),this.createFrame({name:"iframe_trader_conexion2",id:"iframe_trader_conexion2",src:this.streamingBaseURL+"/Init",width:0,height:0,frameborder:0}),this.actualFrame=1,this.isAlive=!0,this.activityCheck()},createFrame:function(t){$('<iframe style="display:none" id="'+t.id+'" name="'+t.name+'" src="'+t.src+'" width="'+t.width+'" height="'+t.height+'" frameborder="'+t.frameborder+'" />').appendTo("body")},connect:function(){this.connected=!0,this.firstConnection&&(this.firstConnection=!1),this.closeNotificationReconnecting(),this.callbackConnected&&"function"==typeof this.callbackConnected&&this.callbackConnected(this.contextCallback)},getServerLink:function(t){return t===this.INFORMATION_TYPE_ORDERS?this.serverLinkOrders:this.serverLinkRisks},registerRT:function(t){if(this.isEnabled()){var e=this.baseURL+"/"+this.serviceURLs.registerRT,i={SessionID:escape(this.session),TraderLink:this.getServerLink(t.informationType),Accounts:t.accounts,Type:t.informationType,Descriptors:t.descriptors.join(","),timestamp:(new Date).getTime()};this.jsonParamsPost(e,i,this.serviceURLs.registerRT),this.registerEvents(t)}},registerEvents:function(t){var e=this,i=t.accounts.split(",");_.each(i,function(i){topic=e.getTopic(t.informationType,i),e.on(topic,t.callback,t.context)})},unregisterEvents:function(t){var e=this,i=t.accounts.split(",");_.each(i,function(i){topic=e.getTopic(t.informationType,i),e.off(topic,t.callback,t.context)})},unregisterRT:function(t){if(this.isEnabled()){var e=this.baseURL+"/"+this.serviceURLs.unregisterRT,i={SessionID:escape(this.session),TraderLink:this.getServerLink(t.informationType),Accounts:t.accounts,Type:t.informationType,timestamp:(new Date).getTime()};this.jsonParamsPost(e,i,this.serviceURLs.unregisterRT),this.unregisterEvents(t)}},unregisterUser:function(){if(this.isEnabled()){var t=this.baseURL+"/"+this.serviceURLs.unregisterUser,e={SessionID:escape(this.session),TraderLink:this.serverLinkOrders};this.jsonParamsPost(t,e,this.serviceURLs.unregisterUser)}},getErrors:function(t){if(this.isEnabled()){var e=this.baseURL+"/"+this.serviceURLs.getErrors,i={SessionID:escape(this.session)};t.language&&(i.Language=t.language),t.provider&&(i.Provider=t.provider),t.traderlink&&(i.TraderLink=t.traderlink),t.fields&&(i.Fields=t.fields),this.jsonParamsPost(e,i,this.serviceURLs.getErrors,t.callback,t.context,t.callbackParams)}},getOrderBook:function(t){if(this.isEnabled()){var e=this.baseURL+"/"+this.serviceURLs.getOrderBook,i={SessionID:escape(this.session),TraderLink:this.serverLinkOrders,Accounts:t.accounts,History:t.history,Descriptors:t.descriptors.join()};this.jsonParamsPost(e,i,this.serviceURLs.getOrderBook,t.callback,t.context,t.callbackParams)}},getEvents:function(t){if(this.isEnabled()){var e=this.baseURL+"/"+this.serviceURLs.getEvents,i={SessionID:escape(this.session),TraderLink:this.serverLinkOrders,OrderID:t.orderID,History:t.history,Descriptors:t.descriptors.join(),Account:t.account};this.jsonParamsPost(e,i,this.serviceURLs.getEvents)}},initCall:function(t,e){if(this.isEnabled()){var i=this.baseURL+"/"+this.serviceURLs.initCall;this.getRequest(i,{},this.serviceURLs.initCall,t.callback,e,t.callbackParams)}},getAccounts:function(t){if(this.isEnabled()){var e=this.baseURL+"/"+this.serviceURLs.getAccount,i={SessionID:escape(this.session),TraderLink:this.serverLinkRisks,Accounts:t.accounts,Descriptors:t.descriptors.join()};this.jsonParamsPost(e,i,this.serviceURLs.getAccount)}},getOpenPosition:function(t){if(this.isEnabled()){var e=this.baseURL+"/"+this.serviceURLs.getOpenPosition,i={SessionID:escape(this.session),TraderLink:this.serverLinkRisks,Accounts:t.accounts,Descriptors:t.descriptors.join(),_dc:(new Date).getTime()};this.jsonParamsPost(e,i,this.serviceURLs.getOpenPosition)}},newOrder:function(t,e){if(this.isEnabled()){var i=this.baseURL+"/"+this.serviceURLs.newOrder,r={SessionID:escape(this.session),TraderLink:this.serverLinkOrders,Order:t.Order};this.jsonParamsPost(i,r,this.serviceURLs.newOrder,t.callback,e,t.callbackParams)}},getCommission:function(t,e){if(this.isEnabled()){var i=this.baseURL+"/"+this.serviceURLs.getCommission,r={SessionID:escape(this.session),TraderLink:this.serverLinkOrders,Order:t.Order};this.jsonParamsPost(i,r,this.serviceURLs.getCommission,t.callback,e,t.callbackParams)}},getBalance:function(){if(this.isEnabled()){var t=this.baseURL+"/"+this.serviceURLs.getBalance,e={SessionID:escape(this.session),TraderLink:this.serverLinkOrders,Accounts:openPositionInfo.accounts,Descriptors:openPositionInfo.descriptors.join()};this.jsonParamsPost(t,e,this.serviceURLs.getCommission,params.callback,context,params.callbackParams)}},modifyOrder:function(t){if(this.isEnabled()){var e=this.baseURL+"/"+this.serviceURLs.modifyOrder,i={SessionID:escape(this.session),TraderLink:this.serverLinkOrders,Order:t.order};this.jsonParamsPost(e,i,this.serviceURLs.modifyOrder)}},cancelOrders:function(t,e){if(this.isEnabled()){var i=this.baseURL+"/"+this.serviceURLs.cancelOrders,r={SessionID:escape(this.session),TraderLink:this.serverLinkOrders,Orders:t.orders};this.jsonParamsPost(i,r,this.serviceURLs.cancelOrders,t.callback,e,t.callbackParams)}},getTopic:function(t,e){var i=e.replace(/^\s+|\s+$/g,"");return t+":"+i.replace(" ","_")},updateData:function(t){switch(this.messages++,this.isAlive=!0,this.messages>=this.maxMessages&&(this.changeFrame(),this.messages=0),t.type){case"HB":this.webTraderHB();break;case"ORDEN":this.notificacionOrdenTR(t.data);break;case"ORDENRECHAZADA":this.notificationOrderReject(t.data);break;case"CUENTA":this.notificacionCuentaTR(t.data);break;case"CARTERA":this.notificacionCarteraTR(t.data,IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_PORTFOLIO);break;case"CARTERA_CONTADO":this.notificacionCarteraTR(t.data,IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_PORTFOLIO_CASH);break;case"CARTERA_INTRADIA":this.notificacionCarteraTR(t.data,IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_PORTFOLIO_INTRADAY);break;case"LOGOUT":this.webTraderLogout();break;case"CONNECTED":this.webTraderConnected();break;case"DISCONNECTED":this.webTraderDesconnected()}},changeFrame:function(){if(!IFB.Services.Streaming.CONNECTION.isLogout){this.actualFrame=1===this.actualFrame?2:1;var t=this.streamingBaseURL+"/"+this.serviceURLs.openConection+"?sesion="+escape(this.session)+"&idconnection="+this.actualFrame+"&timestamp="+(new Date).getTime()+"&timehb="+this.TIMERHEARTBEAT;$("#iframe_trader_conexion"+this.actualFrame).attr("src",t)}},subscribe:function(t,e,i){this.on(t,e,i)},unsubscribe:function(t){this.off(t)},webTraderLogout:function(){console.log("LogOut de Web Trader"),this.isLogout=!0},webTraderDesconnected:function(){console.log("Desconectado de Web Trader")},webTraderConnected:function(){this.reconnecting?(this.reconnecting=!1,this.trigger("WebTrader_Reconnected",this),this.connect()):this.firstConnection&&(this.firstConnection=!1,this.connect()),console.log("Conectado a WebTrader"),this.messages=0},webTraderHB:function(){},getOrderAccount:function(t){return t[IFB.Descriptors.Trader.AccountFIX.descriptor]},getAccountAccount:function(t){return t[IFB.Descriptors.Trader.Cuentas.Account.descriptor]},getPortfolioAccount:function(t){return t[IFB.Descriptors.Trader.PortfolioAccount.descriptor]},getKeyFromResponse:function(t,e){var i="";switch(t){case IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_ORDERS:i=e[IFB.Descriptors.Trader.Key.descriptor];break;case IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_ACCOUNTS:i=e[IFB.Descriptors.Trader.Cuentas.Account.descriptor];break;case IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_PORTFOLIO:case IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_PORTFOLIO_INTRADAY:case IFB.Services.Trading.CONNECTION.INFORMATION_TYPE_PORTFOLIO_CASH:i=e[IFB.Descriptors.Trader.PortfolioKey.descriptor]+e[IFB.Descriptors.Trader.PortfolioShortName.descriptor]}return i},notificacionOrdenTR:function(t){var e=this;t.status.ok&&_.each(t.answer,function(t){var i=e.getOrderAccount(t),r=e.getKeyFromResponse(e.INFORMATION_TYPE_ORDERS,t),s=e.getTopic(e.INFORMATION_TYPE_ORDERS,i);e.trigger(s,t,r)})},notificacionCarteraTR:function(t,e){var i=this;t.status.ok&&_.each(t.answer,function(t){var r=i.getPortfolioAccount(t),s=i.getKeyFromResponse(e,t),o=i.getTopic(e,r);i.trigger(o,t,s)})},notificacionCuentaTR:function(t){var e=this;t.status.ok&&_.each(t.answer,function(t){var i=e.getAccountAccount(t),r=e.getKeyFromResponse(e.INFORMATION_TYPE_ACCOUNTS,t),s=e.getTopic(e.INFORMATION_TYPE_ACCOUNTS,i);e.trigger(s,t,r)})},notificationOrderReject:function(t){var e=t.answer[0][IFB.Descriptors.Trader.RejectReason.descriptor],i=[{text:"Aceptar"}];IFB.Utils.Helper.showNotification("information","orden rechazada.<br/><b><a>"+e+"</a>",!0,i)}}),IFB.Services.WebSocket=IFB.Class(IFB.Services.Base,{options:{},initialize:function(t){this.options=t||{},IFB.Services.WebSocket.parent.initialize.call(this,t),this.servicename="websocket",this.initConfig()},initConfig:function(){this.enabled="undefined"!=typeof io},connect:function(t){if(!this.enabled)return void this.done(t);var e=this;this.socket=io.connect(),this.socket.on("connect",function(){e.socket.emit("adduser",SOCKET_IO_ADDUSER||{anonymous:!0}),e.connected=!0,e.done(t)}),this.socket.on("data",function(t){IFB.Services.Streaming.CONNECTION.updateData(t)})},done:function(t){t&&"function"==typeof t&&t(this)},register:function(t){if(this.enabled){var e=this;this.socket.emit("register",{instruments:t.instruments.join(","),descriptors:t.descriptors.join(",")}),_.each(t.instruments,function(i){var r=e.getTopic("D",i);amplify.subscribe(r,t.context,t.callback)})}},registerPos:function(t){if(this.enabled){var e=this;this.socket.emit("registerPos",{instruments:t.instruments.join(","),descriptors:t.descriptors.join(",")}),_.each(t.instruments,function(i){var r=e.getTopic("D",i);amplify.subscribe(r,t.context,t.callback)})}},unregister:function(t){if(this.enabled){var e=this;this.socket.emit("unregister",{instruments:t.instruments.join(","),descriptors:t.descriptors.join(",")}),_.each(t.instruments,function(i){var r=e.getTopic("D",i);amplify.unsubscribe(r,t.callback)})}},unregisterPos:function(t){if(this.enabled){var e=this;this.socket.emit("unregisterPos",{instruments:t.instruments.join(","),descriptors:t.descriptors.join(",")}),_.each(t.instruments,function(i){var r=e.getTopic("D",i);amplify.unsubscribe(r,t.callback)})}},getTopic:function(t,e){var i=e.replace(/^\s+|\s+$/g,"");return t+":"+i.replace(" ","_")},updateData:function(t){amplify.publish(this.getTopic("D",t.MV),t)}}),IFB.Views.Accounts=IFB.Views.TraderBase.extend({initialize:function(){IFB.Views.TraderBase.prototype.initialize.apply(this,arguments)},onAccountChange:function(t,e){var i=this,r=e.val(),s=i.model.getElementById(r),o="-";i.model.setSelected(s),s&&(o=s.getCashAvailable(2)),$("#cash").text(o)},onUpdateDataTrader:function(t,e){if(this.model){var i,r,s=this,o=this.model?this.model.getElementById(e):void 0;o?_.each(t,function(t,e){o===s.model.accountSelected&&(i='[data-descriptor="'+e+'"]',s.domElementsMap[i]||(s.domElementsMap[i]=$(i,s.$el)),r=s.domElementsMap[i],r.length>0&&s.updateTraderDOM(o,r,t,[])),o.setDescriptorValue(e,t)}):this.model.add(t)}}}),IFB.Views.AlertList=IFB.Views.Base.extend({selectedRowId:void 0,initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments),this.on("rendered",this.initializeScroll),this.options.enableSort&&(this.sortConfig=this.options.sortConfig?_.defaults({},this.options.sortConfig,this.defaultSortConfig):_.defaults({},this.defaultSortConfig),this.subscribe("rendered",this.addSortCss,this))},heightScroll:200,defaultSortConfig:{type:"string",direction:"asc",descriptor:IFB.Descriptors.ShortName.descriptor,css:{arrow:"sortArrow",asc:"activeDown",desc:"activeUp"}},events:function(){return _.extend({},IFB.Views.Base.prototype.events,{"click .x-radiobutton":"onRadioButtonCheck","click tbody>tr":"onClickTr"})},reload:function(){this.sortConfig=_.defaults({},this.defaultSortConfig),IFB.Views.Base.prototype.reload.apply(this,arguments)}}),IFB.Views.ChartBase=IFB.Views.Base.extend({initialize:function(t){IFB.Views.Base.prototype.initialize.apply(this,arguments),this.updateDefaults(t)},updateDefaults:function(t){this.title=t.title||"",this.name=t.name||this._getMV(),this.width=t.width,this.height=t.height,this.decimals=t.decimals||2,this.decimalsYAxis=t.decimalsYAxis||this.decimals,this.colors=t.colors||["#666666","#93C371","#cc3333"],this.trendClassnames=t.trendClassnames||["ifb-equal","ifb-top","ifb-flop"],this.trend=t.trend||0,this.closeLineHeight=t.closeLineHeight||3,this.lineWidth=t.lineWidth||3,this.tooltipCrosshairsColor=t.tooltipCrosshairsColor||"",this.closeLineColor=t.closeLineColor||"#999999",this.titleYAxis=t.titleYAxis||Highcharts.getOptions().yAxis.title,this.colorLabelXAxis=t.colorLabelXAxis||Highcharts.getOptions().xAxis.labels.style.color,this.colorLineXAxis=t.colorLineXAxis||Highcharts.getOptions().xAxis.lineColor,this.colorTickXAxis=t.colorTickXAxis||Highcharts.getOptions().xAxis.tickColor,this.colorLabelYAxis=t.colorLabelYAxis||Highcharts.getOptions().yAxis.labels.style.color,this.colorLineYAxis=t.colorLineYAxis||Highcharts.getOptions().yAxis.lineColor,this.colorTickYAxis=t.colorTickYAxis||Highcharts.getOptions().yAxis.tickColor,this.colorGridLineYAxis=t.colorGridLineYAxis||Highcharts.getOptions().yAxis.gridLineColor,this.tooltipEnabled=_.isUndefined(t.tooltipEnabled)?!0:t.tooltipEnabled,this.pinchType=t.pinchType||null,this.followTouchMove=t.followTouchMove||!1,this.typeChart=t.typeChart||"line"},setModel:function(t){return new IFB.Collections.ChartIntraday(t||"")},register:function(){this.lastRegisterCall={descriptors:(this.model.options.serviceParams.data.descriptors||"").split(","),instruments:[this.model.options.serviceParams.data.mv]},IFB.Services.Streaming.CONNECTION&&IFB.Services.Streaming.CONNECTION.register({wnd:this.cid,instruments:this.lastRegisterCall.instruments,descriptors:this.lastRegisterCall.descriptors,context:this,initload:1,callback:this.onUpdateData})},onUpdateData:function(){throw new Error("This method must be overrided")},getDecimals:function(){return this.decimals},getColor:function(){var t;return this.isOHLCStyleType()||(t=_.isArray(this.colors)&&1===this.colors.length?this.colors[0]:this.colors[this.trend]),t},getTrendClassname:function(){return this.trendClassnames[this.trend]},changeDataMvParam:function(){var t=this;return function(e,i){t.updateDefaults(i),t.model.options.serviceParams.data.mv=e,t.model.load()}},getYAxisTitle:function(){return{text:this.titleYAxis||""}},getXAxisLabelsStyle:function(){return{fontFamily:"Verdana",fontSize:"12px",color:this.colorLabelXAxis}},getYAxisLabelsStyle:function(){return{fontFamily:"Verdana",fontSize:"12px",color:this.colorLabelYAxis}},_getMV:function(){try{return this.model.options.serviceParams.data.mv}catch(t){return""}return""},redraw:function(){this.chart.yAxis[0].setExtremes(this.chart.series[0].dataMin,this.chart.series[0].dataMax),this.chart.redraw()},getHighchartPoints:function(){var t=this,e=[];_.each(this.model.models,function(i){e.push(t.getHighchartPoint(t.model.date,i))});var i=this.getLastPricePoint(e);return i&&e.push(i),e},getLastPricePoint:function(t){var e=this;if(this.options.showLastPrice){var i=t[t.length-1],r={data:{F13:this.instrument.data.D60,F6:this.instrument.data.D420,F7:this.instrument.data.D420,F8:this.instrument.data.D420,F4:this.instrument.data.D420}},s=e.getHighchartPoint(this.instrument.data.D60,r);if(s[0]>i[0])return s}},getHighchartPoint:function(){throw new Error("This method must be overrided")},setExtremes:function(){try{(this.typeChart===IFB.Constants.Highcharts.ChartTypes.area||this.typeChart===IFB.Constants.Highcharts.ChartTypes.column)&&this.chart.yAxis[0].setExtremes(this.chart.series[0].dataMin,this.chart.series[0].dataMax)}catch(t){}},isOHLCStyleType:function(){return this.typeChart===IFB.Constants.Highcharts.ChartTypes.candlestick||this.typeChart===IFB.Constants.Highcharts.ChartTypes.ohlc},getObjectSerie:function(t,e,i){var r=this;return{name:t,data:e,marker:{enabled:!1,states:{hover:{enabled:!0,radius:5}}},color:r.getColor(),lineWidth:i}},getNavigatorOptions:function(){return this.options.navigator||{enabled:!1}},changeSerieColor:function(t){this.chart.series[0].update({color:t||this.getColor()})},getPointValue:function(t){var e,i=this.chart.series[0].points;return e=_.find(i,function(e){return e.x>=t}),e?e.y:void 0},getMaxAndMin:function(t,e){var i=this.chart.series[0].points,r={};_.each(i,function(i){i.x>=t&&i.x<=e&&(!r.max||r.max<i.y?r.max=i.y:(!r.min||r.min>i.y)&&(r.min=i.y))});var s={start:this.getPointValue(t),end:this.getPointValue(e),min:r.min,max:r.max};return s},updateRangeTrend:function(t,e){this.trend=e>t?1:t===e?0:2},onSetExtremes:function(t){var e=this.chart.series[1]?this.chart.series[1].data:this.chart.series[0].data,i={first:{x:e.length?e[0].x:0,y:e.length?e[0].y:0},last:{x:e.length?e[e.length-1].x:0,y:e.length?e[e.length-1].y:0}},r=t?this.getPointValue(t.min)||i.first.y:i.first.y,s=t?this.getPointValue(t.max)||i.last.y:i.last.y;this.updateRangeTrend(r,s),this.isOHLCStyleType()||this.changeSerieColor();var o=this.getMaxAndMin(t?t.min:i.first.x,t?t.max:i.last.x);o.min&&o.max&&this.publish("setExtremes",o)},getXAxisEvents:function(){var t=this,e=_.throttle(function(e){t.onSetExtremes(e)},1e3);return this.options.lineColorByPeriod?{setExtremes:e}:{}}}),IFB.Views.ChartColumnInstrumentList=IFB.Views.Base.extend({chart:void 0,mvs:void 0,categories:void 0,pointCoordYZero:1e-4,coordYZeroPoint:.005,zero:0,dateFormat:"",timeFormat:"",topColor:"",flopColor:"",equalColor:"",chartDescriptor:"",chartDescriptorSuffix:"",initialize:function(t){this.categories=[],this.mvs=[],IFB.Views.Base.prototype.initialize.apply(this,arguments),this.updateDefaults(t)},updateDefaults:function(t){t&&(this.dateFormat=t.dateFormat||"HH:mm",this.timeFormat=t.timeFormat||"DD/MM",this.topColor=t.topColor||"",this.flopColor=t.flopColor||"",this.equalColor=t.equalColor||"",this.chartDescriptor=t.chartDescriptor||"",this.chartDescriptorSuffix=t.chartDescriptorSuffix||"")},getInitialOptionsChart:function(t){var e=this;return{chart:{type:"columnrange",renderTo:e.el},title:{text:""},xAxis:{categories:t,labels:{enabled:!0,useHTML:!0,formatter:function(){return"<span>"+this.value+"</span>"}}},yAxis:{title:{text:""},labels:{enabled:!1}},tooltip:{enabled:!1},plotOptions:{columnrange:{dataLabels:{enabled:!0,useHTML:!0,formatter:function(){return e.getDataLabel(this)}}}},legend:{enabled:!1},series:[]}},getDataLabel:function(t){var e=this.model.get(t.point.mv),i="";return e&&(i=t.y===-this.coordYZeroPoint?this.getDateOrTimeLabel(e):t.y===this.coordYZeroPoint?this.getChartDescriptorLabel(e):t.y===this.pointCoordYZero?this.getDateOrTimeLabel(e):t.y===-this.pointCoordYZero?this.getDateOrTimeLabel(e):this.getChartDescriptorLabel(e)),"<span>"+i+"</span>"},getDateOrTimeLabel:function(t){var e=t.getDescriptorValue(IFB.Descriptors.DateOrTimeSituationMessage.descriptor);return e?t.formatValueAsDateOrTime(e,this.dateFormat,this.timeFormat):""},getChartDescriptorLabel:function(t){var e=_.defaults(t.options||{},{decimals:2});try{return t.formatValueAsNumber(t.getDescriptorValue(this.chartDescriptor),e.decimals,e.zeroValue,e.positiveSign,this.chartDescriptorSuffix)}catch(i){}},getHighchartPoints:function(){var t=this,e=this.model.models,i=[],r="",s="";return _.each(e,function(e,o){e&&(r=e.getDescriptorValue(t.chartDescriptor),s=e.getDescriptorValue(IFB.Descriptors.Trend.descriptor),""!==r&&(t.mvs.push(e.id),t.categories.push(e.getIFBShortName()),i.push(t.getHighchartPoint(e.id,o,Number(r),s))))}),i},getHighchartPoint:function(t,e,i,r){var s={x:e,mv:t};return"1"===r?(s.low=this.pointCoordYZero,s.high=i,s.color=this.topColor):"2"===r?(s.low=i,s.high=-this.pointCoordYZero,s.color=this.flopColor):(s.low=-this.coordYZeroPoint,s.high=this.coordYZeroPoint,s.color=this.equalColor),s},getObjectSerie:function(t){return{colorByPoint:!0,data:t}},render:function(){var t=this,e=this.getHighchartPoints();return void 0!==this.chart&&this.chart.destroy(),this.chart=new Highcharts.Chart(this.getInitialOptionsChart(this.categories)),this.chart.addSeries(this.getObjectSerie(e)),t.publish("rendered",t.id),t},onUpdateData:function(t){var e,i,r,s=this.chart.series&&this.chart.series.length>0?this.chart.series[0]:void 0;t&&t.MV&&(e=_.indexOf(this.mvs,t.MV),-1!==e&&s&&(i=s.data[e],r=this.model.get(t.MV),i&&r&&(this.updateModel(r,t,e),pointUpdated=this.getHighchartPoint(t.MV,e,Number(r.getDescriptorValue(this.chartDescriptor)),r.getDescriptorValue(IFB.Descriptors.Trend.descriptor)),this.updateSerie(s,e,pointUpdated))))},updateModel:function(t,e,i){e.V&&(_.each(e.V,function(e){t.setDescriptorValue(e.D,e.V)}),this.model.models[i]=t)},updateSerie:function(t,e,i){t&&i&&e&&t.data[e].update({low:i.low,high:i.high,color:i.color},!0)}}),IFB.Views.ChartDaily=IFB.Views.ChartBase.extend({getHighchartPoint:function(t,e){var i={},r=moment(e.data.F13+"000000+0000","YYYYMMDDHHmmssZ").valueOf();return i.x=r.valueOf(),i.y=Number(e.data.F4),i.open=Number(e.data.F6),i.high=Number(e.data.F7),i.low=Number(e.data.F8),i.close=Number(e.data.F4),i},formatYLabel:function(t){return accounting.formatNumber(t,this.decimalsYAxis)},tooltipFormatter:function(){return IFB.Utils.Helper.chartDailyTooltipFormatter(this)},getXAxisConfiguration:function(){var t=this.getXAxisLabelsStyle();return{type:"datetime",tickPixelInterval:150,lineColor:self.colorLineXAxis,tickColor:self.colorTickXAxis,labels:{style:t,y:20}}},getInitialOptionsChart:function(){var t=this,e=this.getHighchartPoints(),i=[];if(!e.length){var r=this.$el.width();i.push({html:"No hay información en las fechas seleccionadas",style:{top:(t.height-25)/2,left:(r-250)/2}})}return{chart:{renderTo:t.el,type:t.typeChart,height:t.height,width:t.width,backgroundColor:"rgba(255, 255, 255, 0.1)",pinchType:t.pinchType},title:{text:this.title,floating:!0},xAxis:{type:"datetime",lineColor:t.colorLineXAxis,tickColor:t.colorTickXAxis,labels:{style:this.getXAxisLabelsStyle(),y:20,formatter:function(){return IFB.Utils.Helper.chartDailyXAxisFormatter(this.value)}},events:t.getXAxisEvents()},yAxis:{opposite:!1,title:this.getYAxisTitle(),gridLineWidth:.2,gridLineDashStyle:"Dot",gridLineColor:t.colorGridLineYAxis,lineColor:t.colorLineYAxis,tickColor:t.colorTickYAxis,lineWidth:1,labels:{formatter:function(){return t.formatYLabel(this.value)},style:this.getYAxisLabelsStyle()}},rangeSelector:{enabled:!1},navigator:t.getNavigatorOptions(),scrollbar:{enabled:!1},tooltip:{enabled:t.tooltipEnabled,useHTML:!0,followPointer:!1,borderColor:"auto",borderWidth:0,crosshairs:{color:t.tooltipCrosshairsColor,dashStyle:"solid"},shared:!0,borderRadius:0,shadow:!1,backgroundColor:"rgba(255, 255, 255, 0.1)",formatter:this.tooltipFormatter(),style:{padding:"0px"},followTouchMove:t.followTouchMove},legend:{enabled:!1},labels:{items:i},plotOptions:{series:{turboThreshold:2e3}},series:[t.getObjectSerie(t.name,e,t.lineWidth)]}},render:function(){var t=this.getInitialOptionsChart();return void 0!==this.chart&&this.chart.destroy(),this.chart=Highcharts&&Highcharts.StockChart?new Highcharts.StockChart(t):new Highcharts.Chart(t),this.setExtremes(),this.publish("rendered",this.id),this.options.lineColorByPeriod&&this.onSetExtremes(),this},onUpdateData:function(){}}),IFB.Views.ChartIntraday=IFB.Views.ChartBase.extend({getHighchartPoint:function(t,e){var i={},r=moment(t+e.data.F4+"+0000","YYYYMMDDHHmmssZ").add("minutes",IFB.Settings.GmtOffset);return i.x=r.valueOf(),i.y=Number(e.data.F8),i.open=Number(e.data.F5),i.high=Number(e.data.F7),i.low=Number(e.data.F6),i.close=Number(e.data.F8),i},destroyAndRenderChart:function(){this.render()},render:function(){var t,e=this,i=this.getHighchartPoints(),r=[];if(!i.length){var s=this.$el.width();r.push({html:this.options.noDataText||"No hay información de sesión",style:{top:(e.height-25)/2,left:(s-250)/2}})}return void 0!==this.chart&&this.chart.destroy(),t=this.getInitialOptionsChart(r),this.chart=Highcharts&&Highcharts.StockChart?new Highcharts.StockChart(t):new Highcharts.Chart(t),this.setExtremes(),this.addCloseLine(),this.chart.addSeries(this.getObjectSerie(this.name,i,this.lineWidth)),e.publish("rendered",e.id),this.options.lineColorByPeriod&&this.onSetExtremes(),e},getInitialOptionsChart:function(t){var e=this;return{chart:{renderTo:e.el,type:e.typeChart,height:e.height,width:e.width,backgroundColor:"rgba(255, 255, 255, 0.1)",pinchType:e.pinchType},title:{text:e.title,floating:!0},xAxis:{type:"datetime",lineColor:e.colorLineXAxis,tickColor:e.colorTickXAxis,labels:{style:this.getXAxisLabelsStyle(),y:20},events:e.getXAxisEvents()},yAxis:{opposite:!1,title:this.getYAxisTitle(),gridLineWidth:.2,gridLineDashStyle:"Dot",lineWidth:1,gridLineColor:e.colorGridLineYAxis,lineColor:e.colorLineYAxis,tickColor:e.colorTickYAxis,labels:{formatter:function(){return accounting.formatNumber(this.value,e.decimalsYAxis)},style:this.getYAxisLabelsStyle()}},rangeSelector:{enabled:!1},navigator:e.getNavigatorOptions(),scrollbar:{enabled:!1},tooltip:{enabled:e.tooltipEnabled,borderColor:"auto",useHTML:!0,borderWidth:0,crosshairs:{color:e.tooltipCrosshairsColor,dashStyle:"solid"},shared:!0,borderRadius:0,shadow:!1,backgroundColor:"rgba(255, 255, 255, 0.1)",formatter:IFB.Utils.Helper.chartIntradayTooltipFormatter(e),style:{padding:"0px"},followTouchMove:e.followTouchMove},legend:{enabled:!1},labels:{items:t},series:[]}},_getStreamingPoint:function(t){var e={};e.data={};var i=this.model.date,r=this.trend,s=this;return _.each(t.V,function(t){switch(t.D){case IFB.Descriptors.Date.descriptor:i=t.V;break;case IFB.Descriptors.Time.descriptor:e.data.F4=s._getRoundTime(t.V);break;case IFB.Descriptors.Last.descriptor:e.data.F8=t.V;break;case IFB.Descriptors.Volume.descriptor:e.data.F9=t.V;break;case IFB.Descriptors.Trend.descriptor:r=t.V}}),e.data.date=i,e.data.trend=r,e},_getRoundTime:function(t){var e=moment(t,"HHmmss"),i=e.format("HHmm");return e&&e.second()>0&&(i=e.add("minutes",1).format("HHmm")),i},_getStreamingModel:function(t,e){var i=this._getStreamingPoint(t);return i.data.F4=i.data.F4||e.data.F4,i.data.F8=i.data.F8||e.data.F8,i},isModFrequency:function(t){if(t){var e=this.model.getFrequency();return t.data.F4%e===0?!0:!1}},onUpdateData:function(t){var e,i,r=this.chart.series&&this.chart.series.length>0?this.chart.series[0]:void 0;r&&this._getMV()===t.MV&&(e=this.model.getLastModel(),i=this._getStreamingModel(t,e),i.data.F4&&(this.trend=i.data.trend,this.model.date===i.data.date?this.isModFrequency(e)?i.data.F4===e.data.F4?this._refreshLastModelAndPoint(r,e,i):Number(i.data.F4)>Number(e.data.F4)&&this._insertNewModelAndPoint(r,i):(i.data.F4===e.data.F4||Number(i.data.F4)>Number(e.data.F4))&&this._refreshLastModelAndPoint(r,e,i):this._resetModelAndSerie(r,i),this.changeSerieColor()))},_resetModelAndSerie:function(t,e){t&&e&&(this.model.remove(this.model.models),this.model.addNewModel(e),this.model.date=e.data.date,this._resetSerie(t))},_resetSerie:function(t){var e=this.getObjectSerie(this.name,this.getHighchartPoints(),this.lineWidth);t&&e&&(t.remove(),this.chart.addSeries(e),this.redraw())},_insertNewModelAndPoint:function(t,e){t&&e&&(e=this._initializeNewModel(e),this.model.addNewModel(e),this._insertNewPoint(t,e))},_initializeNewModel:function(t){return t.data.F5=t.data.F8,t.data.F6=t.data.F8,t.data.F7=t.data.F8,t.data.F9=0,t},_insertNewPoint:function(t,e){var i;t&&e&&(i=this.getHighchartPoint(e.data.date,e),t.addPoint(i),this.redraw())},_refreshLastModelAndPoint:function(t,e,i){t&&e&&i&&(i=this._refreshLastModel(e,i),this.model.updateLastModel(i),this._refreshLastPoint(t,e,i))},_refreshLastModel:function(t,e){return t&&e&&(e.data.F5=t.data.F5,e.data.F6=Number(e.data.F8)<Number(t.data.F6)?e.data.F8:t.data.F6,e.data.F7=Number(e.data.F8)>Number(t.data.F7)?e.data.F8:t.data.F7,e.data.F9=e.data.F9||t.data.F9),e},_refreshLastPoint:function(t,e,i){var r;t&&e&&i&&(r=this.getHighchartPoint(i.data.date,i,!0),t.data.length>0&&(t.data[t.data.length-1].update({x:r.x,y:r.y,open:r.open,high:r.high,low:r.low,close:r.close}),this.redraw()))},addCloseLine:function(){this.options.closeLine&&this.chart.yAxis[0].addPlotLine({color:this.closeLineColor,width:this.closeLineHeight,value:this.options.close})}}),IFB.Views.DonutChart=IFB.Views.Base.extend({chart:null,render:function(){var t=this;return this.chart=new Highcharts.Chart({chart:t.getChartConfig(),title:t.getTitleConfig(),tooltip:t.getTooltipConfig(),plotOptions:t.getPlotOptionsConfig(),series:t.getSeriesConfig(),colors:t.getColors()}),t},getColors:function(){throw new Error("getColors: This method must be overrided")},getChartConfig:function(){throw new Error("getChartConfig: This method must be overrided")},getTitleConfig:function(){throw new Error("getTitleConfig: This method must be overrided")},getTooltipConfig:function(){throw new Error("getTooltipConfig: This method must be overrided")},getPlotOptionsConfig:function(){throw new Error("getPlotOptionsConfig: This method must be overrided")},getSeriesConfig:function(){throw new Error("getSeriesConfig: This method must be overrided")}}),IFB.Views.HeaderSelector=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments)}}),IFB.Views.HistoricalPrices=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments)}}),IFB.Views.InstrumentDetail=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments),this.on("rendered",this.initializeScroll),this.countClick=0,this.options.updateButton&&(this.options.updateButton.updatingText=this.options.updateButton.updatingText||"Actualizando",this.options.updateButton.updateText=this.options.updateButton.updateText||"Actualizar",this.options.updateButton.disabledClass=this.options.updateButton.disabledClass||"disabled",this.options.updateButton.updatingClass=this.options.updateButton.updatingClass||"updating",this.buttonUpdateClass="",this.buttonUpdateText=this.options.updateButton.updateText)},events:{"click .updateButton":"onUpdateButton","click .addFav":"toggleFavorites"},onUpdateButton:function(){var t=this,e=this.$el.find(".updateButton"),i=this.options.updateButton.maxClick||Number.MAX_VALUE;if(!(!this.options.updateButton||this.countClick>=i||e.hasClass(this.options.updateButton.disabledClass))){this.moveButtonToState(e,"updating"),this.countClick+=1,this.trigger("updating"),this.on("loaded",function(){"updating"===this.state&&setTimeout(function(){t.moveButtonToState(t.$el.find(".updateButton"),"disabled")},r>1e3?1e3:0),this.options.updateButton.perQuote&&this.trigger("perQuoteConsumed")}),this.reload({perquote:this.options.updateButton.perQuote?1:0});var r=this.options.updateButton.delay||0;setTimeout(function(){t.countClick<i&&t.moveButtonToState(t.$el.find(".updateButton"),"ready")
},r)}},moveButtonToState:function(t,e){switch(e){case"updating":this.setState(t,{add:[this.options.updateButton.updatingClass]},this.options.updateButton.updatingText);break;case"disabled":this.setState(t,{remove:[this.options.updateButton.updatingClass],add:[this.options.updateButton.disabledClass]},this.options.updateButton.updateText);break;default:this.setState(t,{remove:[this.options.updateButton.updatingClass,this.options.updateButton.disabledClass]},this.options.updateButton.updateText)}this.state=e},setState:function(t,e,i){var r=this;this.buttonUpdateClass="",this.buttonUpdateText=i,_.isArray(e.add)&&e.add.forEach(function(e){t.hasClass(e)||t.addClass(e),r.buttonUpdateClass+=r.buttonUpdateClass?" "+e:e}),_.isArray(e.remove)&&e.remove.forEach(function(e){t.removeClass(e)}),t.text(this.buttonUpdateText)},changeDataMvParam:function(){var t=this;return function(e){t.model.options.serviceParams.data.mv=e,t.model.load()}},toggleFavorites:function(t){var e=$(t.target),i=$(e).data("mv"),r="selected";i&&($(e).hasClass(r)?($(e).removeClass(r),INFOBOLSA.Utils.Favorites.remove(i)):($(e).addClass(r),INFOBOLSA.Utils.Favorites.add(i)))}}),IFB.Views.InstrumentList=IFB.Views.Base.extend({selectedRowMv:void 0,initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments),this.on("rendered",this.initializeScroll),this.options.enableSort&&(this.sortConfig=this.options.sortConfig?_.defaults({},this.options.sortConfig,this.defaultSortConfig):_.defaults({},this.defaultSortConfig),this.subscribe("rendered",this.addSortCss,this))},heightScroll:200,defaultSortConfig:{type:"string",direction:"asc",descriptor:IFB.Descriptors.ShortName.descriptor,css:{arrow:"sortArrow",asc:"activeUp",desc:"activeDown"}},events:function(){return _.extend({},IFB.Views.Base.prototype.events,{"click .x-expandable":"clickOnDetails","click .addFav":"toggleFavorites","click .x-radiobutton":"onRadioButtonCheck","click tbody>tr":"onClickTr"})},clickOnDetails:function(t){var e=this,i=$(t.target),r=$(i).closest("tr");r&&($(r).hasClass("normal")?(this.collapseAllInstrumentDetails($(i).closest("table")),e.expandInstrumentDetails(r,"fast")):this.collapseInstrumentDetails(r,"fast"))},toggleClass:function(t,e){$.isArray(e)&&$.each(e,function(e,i){$(t).toggleClass(i)})},expandInstrumentDetails:function(t,e){var i=this,r=t.find(".x-expandable"),s=r.attr("data-expand-ref"),o=r.attr("data-marketcod"),n=r.attr("data-isin"),a=t.find("a.buy");this.toggleClass(t,["normal","expand"]),this.toggleClass(r,["expand","close"]),r.addClass("active"),a.hide(),t.find("td").attr("style","border-bottom-width:0px");var c=this.model.getElementById(s);IFB.Utils.TemplateLoader.loadRemoteTemplate("miniInstrumentDetailsTable","/instrumentDetails/miniInstrumentDetailsTable.htm",function(r){var a=_.template(r,{model:c,view:i});t.after(a),i.clearDomElementsMap();var u=t.next();if(u){if(u.css("style","background-color:"+t.css("background-color")),i.options.component&&"function"==typeof i.options.component.showChartIntraday){var d=u.find(".ifb-FvChart");i.options.component.showChartIntraday(d,s),i.options.component.attachTemplateClickEvents(u)}i.options.component.isInstrumentInPortfolio(o,n)||($(u).find("a.sell").remove(),$(u).find("a.buy").addClass("only")),$("div:first-child",u).slideDown(e,function(){i.options.enableScroll&&i.options.elScroll&&i.moveScrollToRow(t,u)})}})},collapseInstrumentDetails:function(t,e){function i(){r.options.component&&"function"==typeof r.options.component.showChartIntraday&&r.options.component.detachTemplateClickEvents(n),a.forEach(function(t){t.remove()}),r.clearDomElementsMap(),r.options.enableScroll&&r.options.elScroll&&r.moveScrollToRow(t)}var r=this,s=t.find(".x-expandable"),o=(s.attr("data-expand-ref"),t.find("a.buy")),n=t.next(),a=[n,n.next()];n&&(e?$("div:first-child",n).slideUp(e,i):i()),this.toggleClass(t,["normal","expand"]),this.toggleClass(s,["expand","close"]),s.removeClass("active"),o.show(),t.find("td").removeAttr("style")},collapseAllInstrumentDetails:function(t){var e=this,i=t.find("tr.expand");$.each(i,function(t,i){var r=$(i);e.collapseInstrumentDetails(r)})},moveScrollToRow:function(t,e){var i=t.closest(".scrollview"),r=t.closest(".scrollport"),s=Math.abs(i.css("margin-top").replace("px","")),o=t.position().top-i.position().top+s,n=t.height()+(e?e.height():0),a=i.height()-r.height(),c=Math.min(o+n-r.height(),a);c>0?$(this.options.elScroll.selector).scrollLayout({animateToPosition:-c}):s>a&&$(this.options.elScroll.selector).scrollLayout({animateToPosition:-a})},toggleFavorites:function(t){var e=$(t.target),i=$(e).data("mv"),r="selected";i&&($(e).hasClass(r)?($(e).removeClass(r),INFOBOLSA.Utils.Favorites.remove(i)):($(e).addClass(r),INFOBOLSA.Utils.Favorites.add(i)))},onClickTr:function(t){if(this.options.enableSelectedRow){var e=$(t.target).closest("tr");this.selectRow(e)}},selectRow:function(t){if(this.options.enableSelectedRow&&0!==$(t).lenght){var e=$(t);e.siblings().removeClass("selected"),e.addClass("selected"),this.trigger("selectRow",$(e).data(),$(e)),this.selectedRowMv=$(e).data("mv")}},selectFirstRow:function(){this.options.enableSelectedRow&&this.selectRow(this.$el.find("table tbody tr").first())},recoverSelectedRow:function(){if(this.options.enableSelectedRow)if(this.selectedRowMv){var t=this.$el.find("tr[data-mv='"+this.selectedRowMv+"']");t.length>0?this.selectRow(t):this.selectFirstRow()}else this.selectFirstRow()}}),IFB.Views.InstrumentListDynamicHeader=IFB.Views.InstrumentList.extend({}),IFB.Views.InteractiveChart=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments),this.on("rendered",this.initializeChart)},SERIE_TYPE:{INTRADAY:2,HISTORIC:3},lightBoxOpened:!1,serieType:null,baseUrl:IFB.Urls.InteractiveChartBaseUrl,contextMenuActions:{addIndicator:{functionName:"AnadirIndicadores",title:"Añadir Indicador"},addInstrument:{functionName:"AnadirValor",title:"Añadir Valor"},changeChartType:{functionName:"CambiarTipoGrafico",title:"Cambiar tipo de gráfico"}},initializeChart:function(){this.baseURL=this.options.flashConfig.baseURL||IFB.ClientConfiguration&&IFB.ClientConfiguration.Urls.InteractiveChartBaseUrl?IFB.ClientConfiguration.Urls.InteractiveChartBaseUrl:IFB.Urls.InteractiveChartBaseUrl,this.flashId=this.options.flashConfig.flashvars.componentID,this.mv=this.options.mv,this.serieType=this.options.flashConfig.flashvars.tipoSerie,this.createInteractiveChartFlashObject()},createInteractiveChartFlashObject:function(){var t=this.options.flashConfig;t.swf=this.options.flashConfig.swf||this.baseURL+"/InteractiveChart/WTGraficoInteractivoLogin.swf",t.flashvars.rootURL=this.options.flashConfig.flashvars.rootURL||this.baseURL+"/WTServerMG",t.flashvars.swfRootURL=this.options.flashConfig.flashvars.swfRootURL||this.baseURL+"/InteractiveChart",window.swfobject?($("#"+this.flashId).append($('<div id="'+this.flashId+'_replace"></div>')),t.params={allowScriptAccess:"always",backgroundColor:"#869ca7",movie:t.swf},t.attributes={quality:"high",name:"WTServer",align:"middle"},swfobject.switchOffAutoHideShow(),swfobject.embedSWF(t.swf,this.flashId+"_replace",t.width||"100%",t.height||"100%","15.0.0","expressInstall.swf",t.flashvars,t.params,t.attributes,function(){})):$("#"+this.flashId).flash(t)},getFlashId:function(){try{return $("#"+this.el.id).flash().attr("id")}catch(t){}},getChartXml:function(){return document.getElementById(this.getFlashId()).getXMLgraf()},openChartWithXML:function(t){document.getElementById(this.getFlashId()).openChartWithXML(t)},changeDataParam:function(t,e){this.unregisterMV(this.mv),this.registerMV(t),e||document.getElementById(this.getFlashId()).sustituirGrafico(t),this.mv=t},addIndicator:function(){this.lightBoxOpened||document.getElementById(this.getFlashId()).menuAction(this.contextMenuActions.addIndicator.functionName,this.contextMenuActions.addIndicator.title)},addInstrument:function(){this.lightBoxOpened||document.getElementById(this.getFlashId()).menuAction(this.contextMenuActions.addInstrument.functionName,this.contextMenuActions.addInstrument.title)},changeChartType:function(){this.lightBoxOpened||document.getElementById(this.getFlashId()).menuAction(this.contextMenuActions.changeChartType.functionName,this.contextMenuActions.changeChartType.title)},addDrawTool:function(t){document.getElementById(this.getFlashId()).anadirFigura(t.tool)},changeSerieChart:function(t){document.getElementById(this.getFlashId()).cambiarSerie(t.serie),this.serieType=t.serie},onOpenLightBox:function(){this.lightBoxOpened=!0},onCloseLightBox:function(){this.lightBoxOpened=!1},onUpdateData:function(t){var e=this,i=document.getElementById(e.getFlashId());i&&_.isFunction(i.datos)&&_.each(t.V,function(e){i.datos(t.T,0,t.MV,t.C,e.D,e.V)})},registerMV:function(t){this.options.streaming&&IFB.Services.Streaming.CONNECTION&&IFB.Services.Streaming.CONNECTION.register({wnd:this.cid,instruments:[t],descriptors:[this.options.model.options.serviceParams.data.header],context:this,callback:this.onUpdateData,initload:1})},unregisterMV:function(t){this.options.streaming&&IFB.Services.Streaming.CONNECTION&&IFB.Services.Streaming.CONNECTION.unregister({wnd:this.cid,instruments:[t],descriptors:[this.options.model.options.serviceParams.data.header],context:this,callback:this.onUpdateData})}}),IFB.Views.Boleta=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments)},notificationOnShow:!1,validationErrors:[],sendLoginRequestClick:function(){},onSendOrderClick:function(){if(!IFB.Trader.accounts.length){var t=[{text:"Aceptar"}];return void IFB.Utils.Helper.showNotification("warning","No dispone de cuentas asociadas",!0,t)}if(!this.notificationOnShow)if(this.validateOrder())this.showConfirmOrder();else{var t=[{text:"Aceptar"}];IFB.Utils.Helper.showNotification("warning",this.validationErrors[0].error,!0,t)}},validateOrder:function(){var t=this,e=IFB.Utils.Helper.serializeObject(this.$el);e.expireDate&&this.testDateInputFormatRaw(e.expireDate)&&(e.expireDate=moment(e.expireDate,this.model.DATE_INPUT_FORMAT_RAW).format(this.model.DEFAULTS_DATE_FORMAT));var i=this.model.preValidate(e);return i?(t.validationErrors=[],_.each(i,function(e,i){t.validationErrors.push({field:i,error:e})}),!1):(this.model.setModel(e),!0)},showConfirmOrder:function(){var t=this,e=[{text:"Aceptar",cls:"btnOkConfirmationOrder "+this.model.getSideCls(),callback:function(){t.sendOrder()}},{text:"Cancelar"}],i={title:this.model.getSide()===IFB.Trader.sideOptions.BUY.value?"ORDEN DE COMPRA":"ORDEN DE VENTA",account:this.model.getAccount(),name:this.model.getName(),isin:this.model.getIsin(),sideOrder:this.model.getSide()===IFB.Trader.sideOptions.BUY.value?"COMPRA":"VENTA",qty:this.model.getVolume(),orderType:this.model.getOrderTypeText(),date:this.model.getExpireDate(),amount:this.model.getAmount(2),sideCls:this.model.getSideCls(),currency:this.model.getCurrency()},r=this.model.getOrderType();(r===IFB.Trader.orderTypeOptions.LIMIT.value||r===IFB.Trader.orderTypeOptions.STOP_LIMIT.value)&&(i.price=this.model.getPrice(3));var s=this.model.getExceTypeText();s&&(i.execTypeText=s),(r===IFB.Trader.orderTypeOptions.STOP.value||r===IFB.Trader.orderTypeOptions.STOP_MARKET.value||r===IFB.Trader.orderTypeOptions.STOP_LIMIT.value)&&(i.stopPrice=this.model.getStopPrice(3));var o=this.model.getMaxFloor();"0"!==o&&(i.maxFloor=o),IFB.Utils.Helper.showNotificationConfirmOrder(i,e)},onVolumeChange:function(){this.validateField("volume")?this.changeAmount():this.setFieldValue("amount",accounting.formatNumber(0,3))},validateField:function(t){var e=this.getFieldValue(t),i=this.model.preValidate(t,e),r=this;if(i){var s=[{text:"Aceptar",callback:function(){r.notificationOnShow=!1}}];return r.notificationOnShow=!0,IFB.Utils.Helper.showNotification("warning",i,!0,s),!1}return!0},onOrderTypeChange:function(t,e){var i=e.val();this._setPriceProperties(i),this._setStopPriceProperties(i)},_setPriceProperties:function(t){var e=$("#price",this.$el);t===IFB.Trader.orderTypeOptions.LIMIT.value||t===IFB.Trader.orderTypeOptions.STOP_LIMIT.value?(e.prop("disabled",!1),this.setFieldValue("price",this.model.getPrice(3))):(e.prop("disabled",!0),this.setFieldValue("price",""))},_setStopPriceProperties:function(t){var e=$("#stopPriceLabel",this.$el),i=$("#stopPrice",this.$el);t===IFB.Trader.orderTypeOptions.STOP.value||t===IFB.Trader.orderTypeOptions.STOP_MARKET.value||t===IFB.Trader.orderTypeOptions.STOP_LIMIT.value?(e.removeClass("disable"),i.prop("disabled",!1),i.removeClass("disable")):(e.addClass("disable"),i.prop("disabled",!0),i.addClass("disable"))},changeAmount:function(){var t=this.model.getRawValue("last"),e=this.getUnformatFieldValue("volume"),i=t*e;_.isNumber(i)&&!_.isNaN(i)&&(this.model.set("volume",e),$("#amount",this.$el).text(this.model.getAmount(2)))},getUnformatFieldValue:function(t){var e=this.getFieldValue(t);return accounting.unformat(e,accounting.settings.number.decimal)},getFieldValue:function(t){return $("#"+t,this.$el).val()||""},setFieldValue:function(t,e){$("#"+t,this.$el).val(e)},sendOrder:function(){var t=this.model.getOrderToTrader(),e={Order:t,callback:this.callbackNewOrder};IFB.Services.Trading.CONNECTION.newOrder(e,this)},callbackNewOrder:function(t){t.status&&t.status.ok?(console.log("Orden añadida correctamente"),window.history.back()):IFB.Utils.Helper.showNotification("error","Se produjo un error al añadir la orden. Mensaje:<br/><b>'"+t.status.reason+"'</b>")},onUpdateData:function(t){var e=this;_.each(t.V,function(t){t.D===IFB.Descriptors.Last.descriptor&&(e.model.set("last",t.V),$("#last",e.$el).html(t.V))})},onCancelOrderClick:function(){window.history.back()},onRadioButtonConditionsClick:function(){var t=$("#minQuantity",this.$el);t.prop("disabled",!0),t.addClass("disable")},onRadioButtonMinQuantityCondition:function(){var t=$("#minQuantity",this.$el);t.prop("disabled",!1),t.removeClass("disable")},onCheckMaxFloorClick:function(t,e){var i=$("#maxFloor",this.$el);i.prop("disabled",!e.context.checked),i.toggleClass("disable")},testDateInputFormatRaw:function(t){return/^\d{4}-\d{1,2}-\d{1,2}$/.test(t)}}),IFB.Views.News=IFB.Views.Base.extend({heightScroll:200,initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments),this.options.initializeScrollOnInit!==!1&&this.on("rendered",this.initializeScroll)},register:function(){this.options.streaming&&(this.model.options.serviceParams.data.sources?sources=this.model.options.serviceParams.data.sources.replace(/;/g,","):this.model.options.serviceParams.data.source?sources=this.model.options.serviceParams.data.source.replace(/;/g,","):this.model.options.serviceParams.data.fuente?sources=this.model.options.serviceParams.data.fuente.replace(/;/g,","):this.model.options.serviceParams.data.fuentes&&(sources=this.model.options.serviceParams.data.fuentes.replace(/;/g,",")),this.lastRegisterCall?this.lastRegisterCall.sources=sources:this.lastRegisterCall={sources:sources},IFB.Services.Streaming.CONNECTION&&IFB.Services.Streaming.CONNECTION.registerNot({wnd:this.cid,sources:this.lastRegisterCall.sources,context:this.options.component,callback:this.options.component.onUpdateNews}))},unregister:function(){this.domElementsMap={},IFB.Services.Streaming.CONNECTION&&IFB.Services.Streaming.CONNECTION.unregisterNot({wnd:this.cid,sources:this.lastRegisterCall.sources,context:this.options.component,callback:this.options.component.onUpdateNews})},onUpdateNews:function(){throw new Error("onUpdateNews: This method must be overrided")}}),IFB.Views.OpenPositionList=IFB.Views.TraderBase.extend({initialize:function(){this.veces=3,IFB.Views.TraderBase.prototype.initialize.apply(this,arguments),this.on("rendered",this.initializeScroll),this.options.enableSort&&(this.sortConfig=this.options.sortConfig?_.defaults({},this.options.sortConfig,this.defaultSortConfig):_.defaults({},this.defaultSortConfig),this.subscribe("rendered",this.addSortCss,this)),this.options.streamingTrader&&(this.listenTo(this.model,"change:"+IFB.Descriptors.Trader.PortfolioBuyShares.descriptor,this.onChangePortfolioBuyShares),this.listenTo(this.model,"change:"+IFB.Descriptors.Trader.Assessment.descriptor,this.onChangeAssesment))},createDescriptorsCalculated:function(){this.model.createDescriptorsCalculated()},onChangeAssesment:function(t){this.updateElementDOM(t,IFB.Descriptors.Trader.Assessment.descriptor)},onChangePortfolioBuyShares:function(t){this.updateElementDOM(t,IFB.Descriptors.Trader.PortfolioBuyShares.descriptor)},reset:function(){var t=this,e=arguments;this.createDescriptorsCalculated(),this._getInstrumentsPrice(function(i){_.each(i,function(e){e&&t.model.setLastPrice(e.MV,e[IFB.Descriptors.Last.descriptor])}),IFB.Views.TraderBase.prototype.reset.apply(t,e)})},defaultSortConfig:{type:"string",direction:"asc",descriptor:IFB.Descriptors.Trader.PortfolioShortName.descriptor,css:{arrow:"sortArrow",asc:"activeUp",desc:"activeDown"}},getSortType:function(){try{return _.findWhere(IFB.Descriptors.Trader,{descriptor:this.sortConfig.descriptor}).sortType||"number"}catch(t){return"number"}},_getInstrumentsPrice:function(t){var e=this;e.options.component.dbService.loadDataLV({sesion:IFB.Services.Session,param:this.model.getInstrumentsList(),type:"4",header:"420",rt:"1"},function(e){var i=JSON.parse(e);if(i.answer&&i.answer.LV){var r=i.answer.LV.V;_.isArray(r)||(r=[r]),t(r)}})},_registerInstrumentPrice:function(t){var e=this;t&&IFB.Services.Streaming.CONNECTION&&(this.lastRegisterCall.instruments=this.model.getInstrumentsArray(),IFB.Services.Streaming.CONNECTION.register({wnd:e.cid,instruments:[t],descriptors:[420],context:e,callback:e.onUpdateData,initload:1}))},onUpdateData:function(t){var e=this;if(t&&t.MV&&t.V){_.each(t.V,function(i){i.D===IFB.Descriptors.Last.descriptor&&e.model.setLastPrice(t.MV,i.V)});var i=e.model.getModelByMV(t.MV);i&&this.updateInstrumentData(i.getInstrumentData(),t)}IFB.Views.TraderBase.prototype.onUpdateData.apply(this,arguments)},changeAccount:function(t){this.model.setSelectedAccount(IFB.Trader.getIdAccount(t)),this.render()},updateElementDOM:function(t,e){if(e&&t){var i=this,r=t.getId(),s='[data-key="'+r+'"][data-descriptor="'+e+'"]';i.domElementsMap[s]||(i.domElementsMap[s]=$(s,i.$el)),elements=i.domElementsMap[s],elements.length>0&&i.updateTraderDOM(t,elements,t.getDescriptorValue(e),[])}},onViewCollectionAddElement:function(t){if(t){t.createDescriptorsCalculated();var e=t.getPortfolioMV(),i=_.find(this.lastRegisterCall.instruments,function(t){return t===e});i||this._registerInstrumentPrice(e)}IFB.Views.TraderBase.prototype.onViewCollectionAddElement.apply(this,arguments)}}),IFB.Views.OrdersList=IFB.Views.TraderBase.extend({initialize:function(){IFB.Views.TraderBase.prototype.initialize.apply(this,arguments),this.on("rendered",this.initializeScroll),this.options.enableSort&&(this.sortConfig=this.options.sortConfig?_.defaults({},this.options.sortConfig,this.defaultSortConfig):_.defaults({},this.defaultSortConfig),this.subscribe("rendered",this.addSortCss,this))},keyOrderToCancel:void 0,defaultSortConfig:{type:"string",direction:"asc",descriptor:IFB.Descriptors.Trader.ShortName.descriptor,css:{arrow:"sortArrow",asc:"activeUp",desc:"activeDown"}},getSortType:function(){try{return _.findWhere(IFB.Descriptors.Trader,{descriptor:this.sortConfig.descriptor}).sortType||"number"}catch(t){return"number"}},onCancellationOrderClick:function(t){this.keyOrderToCancel=t.key,IFB.Trader.showWindowConfirmationOrderBookCancel()?this.showCancelConfirmationDialog():this.cancelOrder(this.keyOrderToCancel)},showCancelConfirmationDialog:function(t){var e=this,i=this.model.getElementById(this.keyOrderToCancel),r=i.getSideCls(),s=[{text:"Aceptar",cls:"btnOkConfirmationOrder "+r,callback:function(){e.cancelOrder(e.keyOrderToCancel)}},{text:"Cancelar"}],o=i.getOrderTypeFIX(),n=i.getSideFIX(),a={title:"C"===n?"CANCELAR COMPRA":"CANCELAR VENTA",account:i.getAccountFIX(),name:i.getShortName(),isin:i.getIsinFIX(),sideOrder:"C"===n?"COMPRA":"VENTA",qty:i.getQuantity(),orderType:IFB.Trader.getOrderTypeText(o),date:i.getExpireDateFIX(),sideCls:r,currency:i.getCurrency()};(o===IFB.Trader.orderTypeOptions.LIMIT.value||o===IFB.Trader.orderTypeOptions.STOP_LIMIT.value)&&(a.price=i.getPrice(3));var c=i.getExceTypeText();c&&(a.execTypeText=c),(o===IFB.Trader.orderTypeOptions.STOP.value||o===IFB.Trader.orderTypeOptions.STOP_MARKET.value||o===IFB.Trader.orderTypeOptions.STOP_LIMIT.value)&&(a.stopPrice=i.getStopPriceFIX(3)),"0"!==u&&(a.maxFloor=u);var u=i.getMaxFloorFIX();"0"!==u&&(a.maxFloor=u),t&&t.commission&&(a.commission=t.commission);var d=i.isIntraday();"undefined"!=typeof d&&""!==d.toLowerCase()&&"no"!==d.toLowerCase()&&(a.intraday=!0),IFB.Utils.Helper.showNotificationCancellationOrder(a,s)},cancelOrder:function(t){var e=this._getOrderToTrader(t),i={orders:[e],callback:this.onOrderCancelled};IFB.Services.Trading.CONNECTION.cancelOrders(i,this),IFB.ActivityManager.notify(IFB.ActivityManager.COMPONENT.TRADING_ORDERS_BOOK,e.Side==IFB.Trader.sideOptions.BUY.value?IFB.ActivityManager.ACTION.CANCEL_BUY:Modulos.Comun.Actividad.GestorActividad.ACCION.CANCEL_SELL,e)},onOrderCancelled:function(t){if(responseJson=JSON.parse(t),responseJson.status&&responseJson.status.ok){var e=[{text:"Aceptar"}];IFB.Utils.Helper.showNotification("information","La cancelación de la orden ha sido enviada al mercado",!0,e)}else IFB.Utils.Helper.showNotification("error","Se produjo un error en la cancelación de la orden. Mensaje:<br/><b>'"+responseJson.status.reason+"'</b>")},_getOrderToTrader:function(t){var e=this.model.getElementById(t),i={OrderID:t,Side:"C"===e.getSideFIX()?IFB.Trader.sideOptions.BUY.value:IFB.Trader.sideOptions.SELL.value,ISIN:e.getIsinFIX(),Account:e.getAccountFIX(),Market:e.getMarketIB(),Value:e.getSymbolIB()},r=IFB.Utils.Helper.getUserInfo();r&&r.externalUser&&(i.SenderLocationID=r.externalUser);var s=e.isIntraday();return"undefined"!=typeof s&&""!==s.toLowerCase()&&"no"!==s.toLowerCase()&&(i.intradia=!0),i}}),IFB.Views.Positions=Backbone.View.extend({initialize:function(){_.extend(this,Backbone.Events),this.model.bind("reset",this.reset,this),this.lastRegisterCall=void 0,this.initializeStreamingConfiguration()},reconnectingRealTime:!1,destroy:function(){this.options.streaming&&(this.lastRegisterCall&&this.unregister(),IFB.Services.Streaming.CONNECTION.unsubscribe("RealTime_Reconnected")),this.undelegateEvents()},registerUnregister:function(){this.model.models.length>0&&this.options.streaming&&(this.lastRegisterCall&&this.unregister(),this.register())},reset:function(){var t=this.$el.attr("id");this.render(),this.registerUnregister(),this.publish("loaded",t)},render:function(){var t=this,e=t.$el.attr("id");return IFB.Utils.TemplateLoader.loadRemoteTemplate(this.options.templateId,this.options.templateFile,function(i){var r=_.template(i,{model:t.model,view:t});t.$el.html(r),t.publish("rendered",e)}),this.clearDomElementsMap(),t},onFetchError:function(){},changeDataParam:function(){var t=this;return function(e){t.model.options.serviceParams.data.param=e,t.model.load()}},reload:function(t){this.model.load(t)},publish:function(t,e){this.trigger(t,e)},subscribe:function(t,e,i){this.on(t,e,i)},register:function(){if(this.options.streaming){var t=this.model.models?_.uniq(_.map(this.model.models,function(t){return t.getDescriptorValue("MV")})):[this.model.getDescriptorValue("MV")];this.lastRegisterCall={descriptors:(this.model.options.serviceParams.data.header||"").split(","),mv:t.join(",")},IFB.Services.Streaming.CONNECTION&&IFB.Services.Streaming.CONNECTION.registerPos({wnd:this.cid,mv:t.join(","),descriptors:this.lastRegisterCall.descriptors,context:this,callback:this.onUpdateData})}},unregister:function(){this.domElementsMap={},IFB.Services.Streaming.CONNECTION&&IFB.Services.Streaming.CONNECTION.unregisterPos({wnd:this.cid,mv:this.lastRegisterCall.mv,descriptors:this.lastRegisterCall.descriptors,callback:this.onUpdateData})},onRender:function(){throw new Error("This method must be overrided")},initializeStreamingConfiguration:function(){this.options.streaming&&(this.options.topFlopCls&&3===this.options.topFlopCls.length||(this.options.topFlopCls={top:"ifb-top",flop:"ifb-flop",equal:"ifb-equal"}),this.options.hiEffectCls&&3===this.options.hiEffectCls.length||(this.options.hiEffectCls={top:"ifb-highlight-top",flop:"ifb-highlight-flop",equal:"ifb-highlight-equal"}),this.options.hiEffectMillis||(this.options.hiEffectMillis=3e3),this.clearDomElementsMap(),IFB.Services.Streaming.CONNECTION.subscribe("RealTime_Reconnected",this.realTimeReconnected,this))},realTimeReconnected:function(){this.reconnectingRealTime=!0,this.reset()},clearDomElementsMap:function(){this.domElementsMap={}},onUpdateData:function(t){var e,i,r=this,s=t.C,o=this.model.getElementById(s);o&&_.each(t.V,function(t){var n=[];e="[data-key='"+s+"'][data-descriptor='"+t.D+"']",r.domElementsMap[e]||(r.domElementsMap[e]=$(e,r.$el)),i=r.domElementsMap[e],r.options.highlightUsesPrevLastTrend&&t.D===IFB.Descriptors.Last.descriptor&&r.storePrevLastTrend(o,t.V),i.length>0&&r.updateDOM(o,i,t.V,n),o.setDescriptorValue(t.D,t.V),r.updateCalculatedFields(o,n)})},updateCalculatedFields:function(){},updateDOM:function(t,e,i,r){var s=this;_.each(e,function(e){var o=$(e),n=$(o).parent(),a=o.attr("data-type"),c=o.attr("data-decimals")||2,u=o.attr("data-descriptor"),d=o.attr("data-suffix")||"",l=o.attr("data-zeroValue")||"",h=o.attr("data-positiveSign")||"",p=s.getDifValue(t,$(o).attr("data-dif-reference")||IFB.Descriptors.Trend.descriptor,i);if(s.isColorizedElement(o)?s.updateColor(o,p):s.isColorizedElement(n)&&s.updateColor(n,p),"silent"!==a){var f=s.formatValue(i,a,Number(c),l,h,d,t);o.html(f)}var m=u&&0===u.indexOf("D")?u.substring(1):u;if(!s.options.highlightDescriptors||-1!==s.options.highlightDescriptors.indexOf(m))if(s.options.highlightUsesPrevLastTrend){var g=s.getDifValue(t,"PREV_LAST_TREND");s.highlight(o,g)}else s.highlight(o,p);if(r){var v=o.attr("data-calc-trigger");v&&_.each(v.split(","),function(t){var e=t.toLowerCase();-1===r.indexOf(e)&&r.push(e)})}})},formatValue:function(t,e,i,r,s,o,n){return"number"===e?n.formatValueAsNumber(t,i,r,s,o):"date"===e?n.formatValueAsDate(t):"time"===e?n.formatValueAsTime(t):"dateOrTime"===e?n.formatValueAsDateOrTime(t):t},isColorizedElement:function(t){return $(t).hasClass(this.options.topFlopCls.top)||$(t).hasClass(this.options.topFlopCls.flop)||$(t).hasClass(this.options.topFlopCls.equal)},highlight:function(t,e){var i;i=e>0?this.options.hiEffectCls.top:0>e?this.options.hiEffectCls.flop:this.options.hiEffectCls.equal,t.addClass(i),_.delay(function(t){t.removeClass(i)},this.options.hiEffectMillis,t)},updateColor:function(t,e){t.removeClass(this.options.topFlopCls.top+" "+this.options.topFlopCls.flop+" "+this.options.topFlopCls.equal),t.addClass(e>0?this.options.topFlopCls.top:0>e?this.options.topFlopCls.flop:this.options.topFlopCls.equal)},getDifValue:function(t,e,i){var r=e?t.getDescriptorValue(e)||i:i;return e===IFB.Descriptors.Trend.descriptor?"1"===r?1:"2"===r?-1:0:Number(r)},storePrevLastTrend:function(t,e){var i=t.getDescriptorValue(IFB.Descriptors.Decimals.descriptor)||4,r=t.getDescriptorValue(IFB.Descriptors.Last.descriptor)||0,s=(e-r).toFixed(i);t.setDescriptorValue("PREV_LAST_TREND",s)},initializeScroll:function(){IFB.Utils.Helper.isMobileWidth()||(this.heightScroll=this.options.enableScroll?(this.options.heightScroll||this.heightScroll)+"px":"auto",this.options.enableScroll&&this.options.elScroll&&($(this.options.elScroll.selector).parent().css("max-height",this.heightScroll),this.$el.find(this.options.elScroll.selector).scrollLayout()))},getNumber:function(t){return void 0===t||""===t?0:Number(t)}}),IFB.Views.SignificantFactNearby=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments)}}),IFB.Views.Static=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments)}}),IFB.Views.TopFlopActive=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments)}}),IFB.Components.Accounts=IFB.Class(IFB.Components.Base,{create:function(){this.configure("Accounts","/WTServerTD/ServiceTrader.svc/GetAccountsJSON"),this.setServiceParams();var t=new IFB.Collections.Accounts(this.config),e=_.extend({model:t,component:this},this.config.viewOptions),i=new IFB.Views.Accounts(e);this.registerView(i),this._addEvents(i),t.load(),IFB.ActivityManager.notify(IFB.ActivityManager.COMPONENT.TRADING_POSITION,IFB.ActivityManager.ACTION.LOAD_ACCOUNTS,IFB.Trader.getAccountsArray())},setServiceParams:function(){},_addEvents:function(t){this.on("changeAccount",t.onAccountChange,t)},_changeAccountsParamValue:function(t){this.config.serviceParams.data.Accounts=t,this.destroyAllViews(),this.create()}}),IFB.Components.AlertList=IFB.Class(IFB.Components.Base,{LOADDATALV_HEADER:"40,10303,10305,10307",instrumentList:[],create:function(){var t=this;this.configure("AlertList","/wtmg/AlertaLista"),t._doCreate()},_doCreate:function(){if(this.destroyRequested)return void(this.destroyRequested=!1);this.model=new IFB.Collections.AlertList(this.config);var t=_.extend({model:this.model,component:this},this.config.viewOptions);this.view=new IFB.Views.AlertList(t),this.registerView(this.view),this.model.load(),this._addEvents()},_addEvents:function(){var t=this;this.on("loaded",function(){var e=[];_.each(t.model.models,function(t){e.push(t.getUnderlyingMV())}),e=_.uniq(e),t._loadInstrumentList(e)}).on("clickRemoveAlert",function(e){t._removeAlert(e)}).on("sortView",this.view.sortView,this.view)},_loadInstrumentList:function(t){var e=this,i=t.join(""),r={serviceParams:{data:{header:this.LOADDATALV_HEADER,param:i,rt:0,type:4,sort:"10307"},reset:!0,type:"GET",url:IFB.Services.baseURL+"/wtdb/LoadDataLV"}};this.instrumentList=new IFB.Collections.InstrumentList(r),this.instrumentList.load(),this.instrumentList.on("reset",function(){e._mergeModels()})},_mergeModels:function(){var t=this;_.each(this.instrumentList.models,function(e){e.alerts=[];var i=(e.getShortName(),e.id);_.each(t.model.models,function(t){t.getUnderlyingMV()===i&&(e.alerts.push(t.id),t.instrument=e)})}),this.view.instruments=this.instrumentList.models,this.view.render()},_removeAlert:function(){},getAlert:function(t){return this.model.get(t)},removeAlert:function(t,e){this.model.remove(t);var i=this.instrumentList.get(e);i&&(i.alerts=_(i.alerts).without(t)),this.view.render()}}),IFB.Components.ChartColumnInstrumentList=IFB.Class(IFB.Components.Base,{initialize:function(t){this._templates=IFB.Defaults.Templates,IFB.Components.ChartColumnInstrumentList.parent.initialize.call(this,t)},create:function(){this.configure("InstrumentList","/wtdb/LoadDataLV");var t=new IFB.Collections.InstrumentList(this.config);this.config.viewOptions.model=t;var e=new IFB.Views.ChartColumnInstrumentList(this.config.viewOptions);this.registerView(e),t.load()},refreshView:function(){this.views&&this.views[0]&&this.views[0].view.refreshView()}}),IFB.Components.ChartDaily=IFB.Class(IFB.Components.ChartBase,{create:function(){var t=this;this.configure("ChartDaily","/wtdb/ChartDaily"),t._getInstrumentSituation(this.config.serviceParams.data,function(e){t.config.serviceParams.data.mv=e.MV,t._doCreate(e)})},_doCreate:function(t){var e=this;this.config=this.modifyDateStartIfWeekend(this.config);var i=new IFB.Collections.ChartDaily(this.config);this.config.viewOptions.model=i;var r=this._getView(),s=new IFB.Models.Instrument(t);r.instrument=s,this.registerView(r),r.on("setExtremes",function(){e.trigger("setExtremes",arguments[0],arguments[1],arguments[2])}),i.load()},_getView:function(){return new IFB.Views.ChartDaily(this.config.viewOptions)},changeFrequencyChart:function(t,e){var i=e||!0;try{this.config.serviceParams.data.frequency=t,i&&this.reload()}catch(r){}},changePeriodChart:function(t,e){var i=_.isUndefined(e)?!0:e,r="C"===t.substring(0,1),s=Number(t.substr(r?1:0,1)),o=t.substring(r?2:1);i?(this.config.serviceParams.data.dateStart=r?moment().add(o,-(s-1)).startOf(o).format("YYYYMMDD"):moment().add(o,-s).format("YYYYMMDD"),this.config.serviceParams.data.dateEnd=moment().format("YYYYMMDD"),this.config=this.modifyDateStartIfWeekend(this.config),this.reload()):this.zoom(moment().subtract(s,o).utc(),moment().utc())
},modifyDateStartIfWeekend:function(t){var e=moment(t.serviceParams.data.dateStart,"YYYYMMDD");return e.isoWeekday()>5&&t.viewOptions.disableWeekends&&(e=e.isoWeekday(-2),t.serviceParams.data.dateStart=e.format("YYYYMMDD")),t}}),IFB.Components.ChartIntraday=IFB.Class(IFB.Components.ChartBase,{create:function(){var t=this;this.configure("ChartIntraday","/wtdb/ChartIntraday"),this.originalConfig=IFB.Utils.Helper.clone(this.config),t._getInstrumentSituation(this.config.serviceParams.data,function(e){t.config.serviceParams.data.mv=e.MV;var i=IFB.Utils.Helper.getPreOpeningDiffMinutes(),r=t.config.viewOptions.openingTime||e.D611;t.config.viewOptions.close=e.D370,t._shouldBeSessionRequest(r,e.D60,e.D70,e.D10060,i)?t._restoreViewOptions():t._changeViewOptionsNotSessionRequest(e,t.config.serviceParams,t.config.viewOptions,2),t._doCreate()})},_changeViewOptionsNotSessionRequest:function(t,e,i,r){e.data.isSession=r;var s=t.D60;s===moment().format("YYYYMMDD")&&(i.close=t.D10370,s=t.D10060,t.D10240>0?i.trend=1:t.D10240<0&&(i.trend=2)),e.data.date=s},_restoreViewOptions:function(){this.config.serviceParams.data.date=this.originalConfig.serviceParams.data.date,this.config.serviceParams.data.isSession=this.originalConfig.serviceParams.data.isSession},_doCreate:function(){var t=this,e=new IFB.Collections.ChartIntraday(this.config);this.config.viewOptions.model=e;var i=new IFB.Views.ChartIntraday(this.config.viewOptions);this.registerView(i),i.on("setExtremes",function(){t.trigger("setExtremes",arguments[0],arguments[1],arguments[2])}),e.load()},update:function(){var t=this;this.dbService.chartIntraday({sesion:IFB.Services.Session,mv:this.config.serviceParams.data.mv,compressionMult:this.config.serviceParams.data.compressionMult,isSession:this.config.serviceParams.data.isSession,date:this.config.serviceParams.data.date,time:this.config.viewOptions.model.getLastTime()},function(e){var i=JSON.parse(e);if(i.status.ok&&i.answer.LST&&i.answer.LST.TV){var r=$.isArray(i.answer.LST.TV.T09)?i.answer.LST.TV.T09:[i.answer.LST.TV.T09],s=t.views[0].view;r.length&&!s.chart.series[0].data.length&&console.log("destruimos el gráfico");var o=s.chart.series[0].data.length;_(r).each(function(e){var i=new IFB.Models.ChartIntradayPoint(e);if(t.config.viewOptions.model.add(i),o){var r=s.getHighchartPoint(t.config.serviceParams.data.date,i);s.chart.series[0].addPoint(r)}}),o||s.destroyAndRenderChart()}})},changeFrequencyChart:function(t,e){var i=e||!0;this.config.serviceParams.data.compressionMult=t,i&&this.reload()}}),IFB.Components.ClickOn=IFB.Class(IFB.Components.Base,{codInstall:"",codCompany:"",codProduct:"",codSeller:"",company:"",product:"",codDoc:"",refuseEmailList:"",create:function(){var t=this;this.getFixedParams(),this.getClickOnDocuments(),this.on("rendered",function(){$("#clickOnDocument").html(t.htmlContent)}),this.on("acceptClickOn",this.onAcceptClickOn,this),this.on("refuseClickOn",this.onRefuseClickOn,this),this.on("checkConditions",this.onCheckConditions,this)},getFixedParams:function(){var t=IFB.Utils.Helper.getClickOnDocumentsFixedParams();t&&(this.codCompany=t.CLICKON_CODCOMPANY,this.codProduct=t.CLICKON_CODPRODUCT,this.codSeller=t.CLICKON_CODSELLER,this.refuseEmailList=t.CLICKON_EMAILLIST)},getClickOnDocuments:function(){var t=new IFB.Services.SI3({}),e={codUsr:this.options.params.Usr,codCompany:this.codCompany,codProduct:this.codProduct,codSeller:this.codSeller};t.getClickOnDocuments(e,this.onClickOnDocuments,this)},onClickOnDocuments:function(t,e){var i;t=JSON.parse(t),t.status.ok&&t.answer.DOCUMENTOS&&t.answer.DOCUMENTOS.DOCUMENTO?(i=_.isArray(t.answer.DOCUMENTOS.DOCUMENTO)?t.answer.DOCUMENTOS.DOCUMENTO[0]:t.answer.DOCUMENTOS.DOCUMENTO,e.codDoc=i.CODDOC,e.htmlContent=i.CONTENT,e.createComponent()):e.trigger("clikcOnNoDocuments")},createComponent:function(){this.configure();var t=new Backbone.Model(this.config);this.config.viewOptions.model=t;var e=new IFB.Views.Static(this.config.viewOptions);this.registerView(e),e.reset()},onAcceptClickOn:function(){var t=this,e=new IFB.Services.SI3({}),i={codCompany:t.codCompany,codDoc:t.codDoc,codUser:t.options.params.Usr,codProduct:t.codProduct,codInstal:t.options.params.CodInstalacion,signDate:"",clientid:t.options.params.clientid,product:t.options.params.profileid};e.signDocument(i,function(){t.trigger("clikcOnAccepted"),t.destroy()})},onRefuseClickOn:function(){var t=this,e=new IFB.Services.SI3({}),i=new IFB.Services.Management({}),r={codCompany:t.codCompany,codUser:t.options.params.Usr,emailList:t.refuseEmailList,clientid:t.options.params.clientid,product:t.options.params.profileid};e.notifyDeleteUser(r,function(){i.deleteExternalUser({entidad:t.options.params.appname,usuarioEntidad:t.options.params.clientid,producto:t.options.params.profileid},function(){t.destroy()})}),this.trigger("clikcOnRefused")},onCheckConditions:function(t,e){$("#btnRefuse").toggleClass("disable"),$("#btnAccept").toggleClass("disable"),e.is(":checked")?($("#btnAccept").prop("disabled",!1),$("#btnRefuse").prop("disabled",!0)):($("#btnAccept").prop("disabled",!0),$("#btnRefuse").prop("disabled",!1))}}),IFB.Components.Dividends=IFB.Class(IFB.Components.Base,{create:function(){var t=this;this.configure("Dividends","/wtdb/LoadDividends"),this.setServiceParams(),t.addFilterEvents(),this._doCreate()},_doCreate:function(){if(this.destroyRequested)return void(this.destroyRequested=!1);this.model=new IFB.Collections.InstrumentList(this.config);var t=_.extend({model:this.model,component:this},this.config.viewOptions);this.view=new IFB.Views.InstrumentList(t),this.registerView(this.view),this.model.load()},setServiceParams:function(){this.setServiceParamSort(),this.config.serviceParams.data.param&&-1===this.config.serviceParams.data.param.indexOf(";")&&(this.config.serviceParams.data.param=IFB.Utils.Helper.getConstituentsCode(this.config.serviceParams.data.param))},setServiceParamSort:function(){var t=this.config.viewOptions,e=t.sortConfig;if(t.enableSort&&e&&e.descriptor){var i=e.descriptor.replace("D","");this.config.serviceParams.data.sort=e.direction&&"desc"===e.direction?"-"+i:i}},resetFilter:function(){try{this.config.viewOptions.filterTable.enabled&&(this.textFilter="")}catch(t){}},addFilterEvents:function(){this.on("keyUpFilter",this.onKeyUpFilter,this),this.on("rendered",this.onRendered,this)},onKeyUpFilter:function(t,e){this.textFilter=e.context.value.toUpperCase(),this.view.filterText=e.context.value,this.filterTable(this.textFilter)},onRendered:function(){this.textFilter&&""!==this.textFilter&&this.filterTable(this.textFilter)},filterTable:function(t){var e=$(this.config.viewOptions.el),i=e.find('tbody [data-descriptor="'+this.config.viewOptions.filterTable.descriptor+'"]'),r=0;i.closest("tr").show(),_.each(i,function(e){-1===$(e).html().toUpperCase().indexOf(t)?$(e).closest("tr").hide():r++}),e.find("#filterNoResults").toggle(0===r)}}),IFB.Components.Events=IFB.Class(IFB.Components.InstrumentList,{defaultEventsQueryType:"1",create:function(){var t=this;this.configure("InstrumentList","/wtdb/LoadDataLV"),this.setServiceParams(),t._getEvents(function(){t._doCreate()})},_getEvents:function(t){var e=this,i=new IFB.Services.Management({}),r=_.extend({sesion:IFB.Services.Session,consulta:this.eventsQueryType||this.defaultEventsQueryType},this.config.events),s={_function:e._parseEvents,params:function(){return t()}};i.getEvents(r,s,e)},_parseEvents:function(){throw new Error(200,"_parseEvents: This method must be overrided")}}),IFB.Components.Form=IFB.Class(IFB.Components.Base,{create:function(){var t=this;this.configure();var e=new Backbone.Model(this.config);this.config.viewOptions.model=e;var i=new IFB.Views.Static(this.config.viewOptions);this.registerView(i),i.reset(),this.on("onSubmit",function(e,i){t._onSubmit(e,i)})},_onSubmit:function(){var t=this._readFormParameters();this.trigger("sendForm",t)},_deletePrefix:function(t){var e="";return t&&(e=t.replace(/field-/g,"")),e},_readFormParameters:function(){var t,e=this,i=$("[class*='field-']"),r={},s="";return _.each(i,function(i){t=$(i).attr("class").match(/field-\w+/),s=e._deletePrefix(t[0]);var o=$(i).val();s&&(r[s]=o)}),r}}),IFB.Components.HeaderSelector=IFB.Class(IFB.Components.Base,{fileType:"HDU",fileTransform:"0",create:function(){this.configure("Columnado","/wtdb/Columnado"),this.mgService=new IFB.Services.Management({}),this.dbService=new IFB.Services.Database({}),this.model=new IFB.Collections.Columnado(this.config),this.model.title=this.options.title,this.model.bind("reset",this.onColumnadoLoaded,this),this.model.load(),this.addEvents()},addEvents:function(){this.on("saveUserHeader",this.saveUserHeader,this)},onColumnadoLoaded:function(){var t=this;this.model.groupedHeader=_.groupBy(this.model.models,function(t){return t.attributes.groupName}),this.model.userHeader=this.options.userHeader||void 0,_.isUndefined(this.model.userHeader)?t.loadUserHeader(function(e){var i=JSON.parse(e);i.status&&i.status.ok&&i.answer[t.fileType]?(t.model.userHeader=t.createUserHeader(i.answer[t.fileType].Data.Header),t.createView()):t.loadColumnadoDefault(function(e){i=JSON.parse(e),t.model.userHeader=t.createUserHeader(i.answer.Header),t.createView()})}):t.createView()},getNumLeftFixedColumns:function(){var t=0,e=!0;return _.each(this.model.userHeader.models,function(i){e&&i.isFixed()?t++:e=!1}),t},createUserHeader:function(t){var e=[];_.each(t.Col,function(t){e.push(new IFB.Models.Columnado(t))});var i=new IFB.Collections.Header(e);return i.numLeftFixedColumns=t.numLeftFixedColumns,new IFB.Collections.Header(e)},loadUserHeader:function(t){this.mgService.loadFile({session:this.session||IFB.Services.Session,file:this.options.file,type:this.fileType,transform:this.fileTransform},function(e){t(IFB.Utils.Helper.UTF8_decode(e))})},loadColumnadoDefault:function(t){this.dbService.columnado({session:this.session||IFB.Services.Session,columnado:this.options.service.columnado,tipo:"1",defecto:"1",agrupado:"0"},function(e){t(e)})},saveUserHeader:function(){var t=this.serializeHeader(),e=this;this.mgService.saveFile({session:this.session||IFB.Services.Session,file:this.options.file,type:this.fileType,transform:"0",content:t,replace:"1"},function(){e.trigger("userHeaderSaved",{file:e.options.file},e)})},serializeHeader:function(){throw new Error("This method must be overrided")},createView:function(){var t=this,e=_.extend({model:t.model},t.config.viewOptions);this.model.userHeader.numLeftFixedColumns=this.model.userHeader.numLeftFixedColumns||this.getNumLeftFixedColumns(),view=new IFB.Views.HeaderSelector(e),t.registerView(view),view.reset()}}),IFB.Components.HistoricalPrices=IFB.Class(IFB.Components.ChartDaily,{initialize:function(t){IFB.Components.HistoricalPrices.parent.initialize.call(this,t)},_doCreate:function(t){var e=new IFB.Collections.ChartDaily(this.config);this.config.viewOptions.model=e;var i=this._getView(),r=new IFB.Models.Instrument(t);i.instrument=r,this.registerView(i),e.load()},_getView:function(){return new IFB.Views.HistoricalPrices(this.config.viewOptions)}}),IFB.Components.InstrumentBase=IFB.Class(IFB.Components.Base,{create:function(){throw new Error(200,"create must be implemented")},_doCreate:function(){throw new Error(200,"_doCreate must be implemented")},changeDataParam:function(t){var e=this;if(_.isArray(this.views)){var i=e.config.serviceParams.data;i.param=e.translateMarket(t),e._getInstrumentSituation(i,function(t){e.views.forEach(function(i){i.options.updatable&&i.view.changeDataMvParam()(t,e.config.viewOptions)})})}},_preloadTimeStatus:function(t,e){var i=this,r=_.defaults(t,{type:"1",header:"611,60,70"});this._getInstrumentSituation(r,function(t){var r=t&&t.V?_.isArray(t.V)?t.V:[t.V]:void 0;r&&r.length>0&&i.historicDescriptorsConverter&&(i.tradeTimeStatus=IFB.Utils.TradeTimeUtils.getTradeTimeStatusFromList(r,i.config.viewOptions.openingTime),i.config.serviceParams.data.header="preopening"===i.tradeTimeStatus.getStatus()?i.historicDescriptorsConverter.convertDescriptors(i.config.serviceParams.data.header,"current_to_historic"):i.historicDescriptorsConverter.convertDescriptors(i.config.serviceParams.data.header,"historic_to_current")),e(t)})},_parseDataPreopeningState:function(t){var e=this;if(this.historicDescriptorsConverter&&this.tradeTimeStatus&&"preopening"===this.tradeTimeStatus.getStatus()){var i=[];return _.each(_.isArray(t)?t:[t],function(t){var r=e.historicDescriptorsConverter.convertData(t,"historic_to_current");if(r.PREOPENING_STATUS=e.tradeTimeStatus.getStatus(),r[IFB.Descriptors.Date.descriptor]){var s="F"+r[IFB.Descriptors.Date.descriptor];r[IFB.Descriptors.DateOrTime.descriptor]=s,r[IFB.Descriptors.DateOrTimeSituationMessage.descriptor]=s}if(!r[IFB.Descriptors.Trend.descriptor]){var o=Number(r[IFB.Descriptors.Change.descriptor]||r[IFB.Descriptors.ChangePercent.descriptor]);r[IFB.Descriptors.Trend.descriptor]=o>0?"1":0>o?"2":"0"}i.push(r)}),i}return t}}),IFB.Components.InstrumentDetail=IFB.Class(IFB.Components.InstrumentBase,{model:void 0,view:void 0,create:function(){var t=this;this.configure("InstrumentDetail","/wtdb/LoadDataLV"),this._configureComponent(void 0,function(){t._doCreate()})},changeDataParam:function(t){this.config.serviceParams.data.param=t,this.destroyAllViews(),this.create()},reload:function(){var t=this;this._configureComponent(void 0,function(){IFB.Components.InstrumentBase.prototype.reload.apply(t,arguments)})},_doCreate:function(){var t=this;this.model=new(IFB.Collections.InstrumentList.extend({parse:function(){return t._parseDataPreopeningState(IFB.Collections.InstrumentList.prototype.parse.apply(this,arguments))}}))(this.config),this.config.viewOptions.model=this.model,this.view=new IFB.Views.InstrumentDetail(this.config.viewOptions),this.registerView(this.view),this.model.load()},_getCurrentModel:function(){return this.model&&_.isArray(this.model.models)&&this.model.models.length>0?this.model.models[0]:void 0},get:function(t){var e=this._getCurrentModel();return e&&"function"==typeof e.getDescriptorValue?e.getDescriptorValue(t):void 0},_checkInstrumentInGroup:function(t,e,i){this.dbService.instrumentInGroup({sesion:IFB.Services.Session,mv:t,agrupaciones:e},function(t){var e=JSON.parse(t);e.answer&&e.answer.Respuesta&&e.answer.Respuesta.Datos&&i("1"===e.answer.Respuesta.Datos.Existe)})},_configureComponent:function(t,e){var i=this;if(this.historicDescriptorsConverter=IFB.Utils.Helper.getHistoricDescriptorsConverter(),this.FACTSETDescriptorsManager=IFB.Utils.Helper.getFACTSETDescriptorsManager(),this.historicDescriptorsConverter||this.FACTSETDescriptorsManager){var r={type:this.config.serviceParams.data.type||"6",param:t||this.config.serviceParams.data.param};this._preloadTimeStatus(r,function(t){i._checkFACSETDescriptors(t,e)})}else e()},_checkFACSETDescriptors:function(t,e){var i=this,r=t&&t.V?_.isArray(t.V)?t.V[0]:t.V:void 0;if(r)if(this.FACTSETDescriptorsManager){var s=this.FACTSETDescriptorsManager.getValidGroups(i.config.serviceParams.data.header);s?i._checkInstrumentInGroup(r.MV,s,function(r){r||(i.config.serviceParams.data.header=i.FACTSETDescriptorsManager.removeDescriptors(i.config.serviceParams.data.header)),e(t)}):e(t)}else e(t);else e(t)}}),IFB.Components.InstrumentList=IFB.Class(IFB.Components.InstrumentBase,{textFilter:"",create:function(){var t=this;this.configure("InstrumentList","/wtdb/LoadDataLV"),this.setServiceParams(),this._configureComponent(void 0,function(){t.addFilterEvents(),t._doCreate()})},changeDataParam:function(t){this.config.serviceParams.data.param=t,this.destroyAllViews(),this.create(),this.resetFilter()},reload:function(){var t=this;this._configureComponent(void 0,function(){IFB.Components.InstrumentBase.prototype.reload.apply(t,arguments)})},_doCreate:function(){if(this.destroyRequested)return void(this.destroyRequested=!1);var t=this;this.model=new(IFB.Collections.InstrumentList.extend({parse:function(){return t._parseDataPreopeningState(IFB.Collections.InstrumentList.prototype.parse.apply(this,arguments))}}))(this.config);var e=_.extend({model:this.model,component:this},this.config.viewOptions);this.view=new IFB.Views.InstrumentList(e),this.registerView(this.view),this.on("sortView",this.view.sortView,this.view),this.model.load()},setServiceParams:function(){this.setServiceParamSort(),this.config.serviceParams.data.param&&-1===this.config.serviceParams.data.param.indexOf(";")&&(this.config.serviceParams.data.param=IFB.Utils.Helper.getConstituentsCode(this.config.serviceParams.data.param))},setServiceParamSort:function(){var t=this.config.viewOptions,e=t.sortConfig;if(t.enableSort&&e&&e.descriptor){var i=e.descriptor.replace("D","");this.config.serviceParams.data.sort=e.direction&&"desc"===e.direction?"-"+i:i}},showChartIntraday:function(t,e){new IFB.Components.ChartIntraday({config:"portfolioOverview_Detail_chartIntraday",view:{el:t,closeLine:!0},service:{param:e,type:4}})},isInstrumentInPortfolio:function(t,e){var i=this.options.portfolioData;if(i){var r=_.isArray(i)?i:[i];return _.any(r,function(i){return _.isArray(i)?_.any(i,function(i){return i.marketCod===t&&i.isin===e}):i.marketCod===t&&i.isin===e})}return!1},_configureComponent:function(t,e){if(this.historicDescriptorsConverter=IFB.Utils.Helper.getHistoricDescriptorsConverter(),this.FACTSETDescriptorsManager=IFB.Utils.Helper.getFACTSETDescriptorsManager(),this.historicDescriptorsConverter||this.FACTSETDescriptorsManager){var i={type:this.config.serviceParams.data.type,param:t||this.config.serviceParams.data.param};this._preloadTimeStatus(i,function(){e()})}else e()},resetFilter:function(){try{this.config.viewOptions.filterTable.enabled&&(this.textFilter="")}catch(t){}},addFilterEvents:function(){this.on("keyUpFilter",this.onKeyUpFilter,this),this.on("rendered",this.onRendered,this)},onKeyUpFilter:function(t,e){this.textFilter=e.context.value.toUpperCase(),this.view.filterText=e.context.value,this.filterTable(this.textFilter)},onRendered:function(){this.textFilter&&""!==this.textFilter&&this.filterTable(this.textFilter)},filterTable:function(t){var e=$(this.config.viewOptions.el),i=e.find('tbody [data-descriptor="'+this.config.viewOptions.filterTable.descriptor+'"]'),r=0;i.closest("tr").show(),_.each(i,function(e){-1===$(e).html().toUpperCase().indexOf(t)?$(e).closest("tr").hide():r++}),e.find("#filterNoResults").toggle(0===r)}}),IFB.Components.InstrumentListDynamicHeader=IFB.Class(IFB.Components.InstrumentList,{_doCreate:function(){var t,e=this;this.model=new(IFB.Collections.InstrumentList.extend({parse:function(){return e._parseDataPreopeningState(IFB.Collections.InstrumentList.prototype.parse.apply(this,arguments))}}))(this.config),t=_.extend({model:this.model,component:this},this.config.viewOptions),this.view=new IFB.Views.InstrumentListDynamicHeader(t),this.registerView(this.view),this.on("sortView",this.view.sortView,this.view),this.on("showDynamicHeaderToolTip",this.showDynamicHeaderToolTip),this.model.load(),this.model.headerList=this.createHeaderCollection(this.options.header),this.model.headerToolTipList=this.createHeaderCollection(this.options.headerToolTip)},setServiceParams:function(){this.setServiceParamSort(),this.setHeaderParam(),this.config.serviceParams.data.param=IFB.Utils.Helper.getConstituentsCode(this.config.serviceParams.data.param)},setHeaderParam:function(){this.config.serviceParams.data.header=_.map(this.options.header,function(t){return t.descriptor.replace("D","")}).join()},createHeaderCollection:function(t){var e=[];return _.each(t,function(t){e.push(new IFB.Models.Header(t))}),new IFB.Collections.Header(e)},showDynamicHeaderToolTip:function(){throw new Error(200,"showDynamicHeaderToolTip: This method must be overrided")},changeColumns:function(t,e){var i=this.options.header,r=this.arrayObjectIndexOf(this.options.header,"descriptor",t);i[r]={descriptor:e,dynamic:!0},this.changeHeader(),this.reload()},changeHeader:function(){var t=this.options.header;this.setHeaderParam(),this.model.headerList=this.createHeaderCollection(t)},changeHeaderToolTip:function(){var t=this.options.headerToolTip;this.model.headerToolTipList=this.createHeaderCollection(t)},arrayObjectIndexOf:function(t,e,i){var r;for(r=0,len=t.length;r<len;r++)if(t[r][e]===i)return r;return-1}}),IFB.Components.InstrumentListHeader=IFB.Class(IFB.Components.InstrumentList,{userHeader:void 0,create:function(){var t=this;this.configure("InstrumentList","/wtdb/LoadDataLV"),this.setServiceParams(),this._configureComponent(void 0,function(){t.loadDataFromHeader(function(){t._doCreate()})})},_doCreate:function(){if(this.destroyRequested)return void(this.destroyRequested=!1);var t=this;this.model=new(IFB.Collections.InstrumentList.extend({parse:function(){return t._parseDataPreopeningState(IFB.Collections.InstrumentList.prototype.parse.apply(this,arguments))}}))(this.config),this.model.userHeader=this.userHeader;var e=_.extend({model:this.model,component:this},this.config.viewOptions);this.view=new IFB.Views.InstrumentList(e),this.registerView(this.view),this.on("sortView",this.view.sortView,this.view),this.model.load()},loadDataFromHeader:function(t){var e,i=this;i.loadUserHeader(function(r){e=JSON.parse(r),e.status&&e.status.ok&&e.answer.HDU?(i.createUserColumnado(e.answer.HDU.Data.Header),i.config.serviceParams.data.header=_.pluck(e.answer.HDU.Data.Header.Col,"ID").join(","),i.config.headerRT=_.pluck(_.where(e.answer.HDU.Data.Header.Col,{RT:"1"}),"ID").join(","),t()):i.loadDefaultHeader(function(r){e=JSON.parse(r),e.status&&e.status.ok&&e.answer.Header&&(i.createUserColumnado(e.answer.Header),i.config.serviceParams.data.header=_.pluck(e.answer.Header.Col,"ID").join(","),i.config.headerRT=_.pluck(_.where(e.answer.Header.Col,{RT:"1"}),"ID").join(",")),t()})})},createUserColumnado:function(t){var e=[];_.each(t.Col,function(t){e.push(new IFB.Models.Columnado(t))}),this.userHeader=new IFB.Collections.Header(e),this.userHeader.numLeftFixedColumns=t.numLeftFixedColumns},loadDefaultHeader:function(t){var e=new IFB.Services.Database({});e.columnado({session:this.session||IFB.Services.Session,columnado:this.config.serviceParams.header.columnado,tipo:"1",defecto:"1",agrupado:"0",descriptoresAdicionales:this.config.serviceParams.header.descriptoresAdicionales||""},function(e){t(e)})},loadUserHeader:function(t){var e=new IFB.Services.Management({}),i=this.config.configHeaderSelector&&this.config.configHeaderSelector.file?this.config.configHeaderSelector.file:this.options.configHeaderSelector&&this.options.configHeaderSelector.file?this.options.configHeaderSelector.file:this.options.config;e.loadFile({session:this.session||IFB.Services.Session,file:escape(i),type:"HDU",transform:"0"},function(e){t(IFB.Utils.Helper.UTF8_decode(e))})},openSelectorHeader:function(){var t=this,e=this.getComponentHeaderSelector();e.on("closeClick",function(){t.trigger("componentSelectorHeaderClose")}),e.on("userHeaderSaved",function(){t.trigger("componentSelectorHeaderSave"),t.onSaveUserHeader()}),e.on("rendered",function(){t.trigger("componentSelectorHeaderRendered")}),this.componentSelectorHeader=e},getComponentHeaderSelector:function(){throw new Error("This method must be overriden")},reload:function(){var t=this;this._configureComponent(void 0,function(){t.loadDataFromHeader(function(){t.model.userHeader=t.userHeader,IFB.Components.InstrumentBase.prototype.reload.apply(t,arguments)})})},onSaveUserHeader:function(){this.reload()}}),IFB.Components.InstrumentSearch=IFB.Class(IFB.Components.InstrumentList,{create:function(){var t=this;this.configure("InstrumentSearch","/wtdb/LoadDataLV"),this.setServiceParams(),this._configureComponent(void 0,function(){t.addFilterEvents(),t._doCreate()})},_doCreate:function(){var t=this;if(this.destroyRequested)return void(this.destroyRequested=!1);var e=String.format(this.config.serviceParams.data.pattern,this.options.replacements);this._doSearch(this.config.serviceParams.data,e,function(e){t.config.serviceParams.data.param=e,t.model=new(IFB.Collections.InstrumentList.extend({parse:function(){return t._parseDataPreopeningState(IFB.Collections.InstrumentList.prototype.parse.apply(this,arguments))}}))(t.config);var i=_.extend({model:t.model,component:t},t.config.viewOptions);t.view=new IFB.Views.InstrumentList(i),t.registerView(t.view),t.on("sortView",t.view.sortView,t.view),t.model.load()})},_doSearch:function(t,e,i){this.dbService.loadDataLV({sesion:IFB.Services.Session,param:e,type:"2",header:"80",rt:"1",sort:"-1"},function(t){var e=JSON.parse(t);if(e.answer&&e.answer.LV){var r=e.answer.LV,s=[];$.each(_.isArray(r.V)?r.V:r,function(t,e){s.push(e.MV)}),i(s.join(","))}})},reload:function(){var t=this,e=String.format(this.config.serviceParams.data.pattern,this.options.replacements);this._doSearch(this.config.serviceParams.data,e,function(e){t.config.serviceParams.data.param=e,t._configureComponent(void 0,function(){IFB.Components.InstrumentList.prototype.reload.apply(t,arguments)})})}}),IFB.Components.InstrumentVsIndex=IFB.Class(IFB.Components.Base,{create:function(){var t=this;this.configure("InstrumentDetail","/wtdb/LoadDataLV");var e=new IFB.Collections.InstrumentList(this.config);e.bind("reset",function(e){t.loadReferenceIndex(e)}),e.load()},loadReferenceIndex:function(t){var e=this,i=t.models[0],r=i?i.get(IFB.Descriptors.ReferenceIndex.descriptor):void 0;if(r){var s=new IFB.Collections.InstrumentList(this.config);s.bind("reset",function(i){e.createViewFromModels(t,i)}),s.load({param:r,type:4})}else e.createViewFromModels(t)},createViewFromModels:function(t,e){e&&e.models&&e.models.length>0&&t.models.push(e.models[0]),this.config.viewOptions.model=t;var i=new IFB.Views.InstrumentList(this.config.viewOptions);this.registerView(i),i.reset()}}),IFB.Components.InteractiveChart=IFB.Class(IFB.Components.Base,{create:function(){_.extend(IFB.Events,Backbone.Events),this.configure(),this.config.MV=this.config.viewOptions.mv;var t=new IFB.Models.Instrument(this.config);t.options={serviceParams:{data:{header:this.config.serviceParams.data.header}}},this.config.viewOptions.model=t;var e=new IFB.Views.InteractiveChart(this.config.viewOptions);this.registerView(e),this.view=e,e.reset(),this.addEvents()},initialize:function(t){IFB.Components.InteractiveChart.parent.initialize.call(this,t)},changeDataParam:function(t){this.view.changeDataParam(t)},addEvents:function(){this.on("iconCloseClick",this.onIconCloseClick,this),this.on("iconResizeClick",this.onIconResizeClick,this),this.on("addIndicator",this.view.addIndicator,this.view),this.on("addInstrument",this.view.addInstrument,this.view),this.on("changeChartType",this.view.changeChartType,this.view),this.on("addDrawTool",this.view.addDrawTool,this.view),this.on("changeSerieChart",this.view.changeSerieChart,this.view),IFB.Events.on("OPEN_LIGHTBOX",this.view.onOpenLightBox,this.view),IFB.Events.on("CLOSE_LIGHTBOX",this.view.onCloseLightBox,this.view),IFB.Events.on("interactiveChart_initializeComplete",this.onInteractiveChartInitializeComplete,this)},onIconResizeClick:function(){},onIconCloseClick:function(){}}),IFB.Components.NewsCriteria=IFB.Class(IFB.Components.News,{callConfigure:function(){this.configure("NewsCriteria","/wtdb/NoticiasCriterios"),this.config.serviceParams.data.param=this._configureParam(this.config)},_configureParam:function(t){var e=t.serviceParams;return"0;"+e.searchFunc+";"+e.data.sources+","+e.data.fromDate+",,"+(e.data.toDate||e.data.fromDate)+",,,"+(e.data.isin||"")+","+(e.numberOfItems||"")+",,,"+(e.data.detailFormat||"")}}),IFB.Components.NewsDetail=IFB.Class(IFB.Components.Base,{callConfigure:function(){this.configure("News","/wtdb/News")},create:function(){this.callConfigure();var t=new IFB.Collections.NewsDetail(this.config),e=_.extend({model:t,component:this},this.config.viewOptions),i=new IFB.Views.News(e);this.registerView(i),t.load()}}),IFB.Components.OpenPosition=IFB.Class(IFB.Components.Base,{create:function(){this.configure("OpenPosition","GetOpenPositionJSON"),this.setServiceParams(),this.model=new IFB.Collections.OpenPositionList(this.config);var t=_.extend({model:this.model,component:this},this.config.viewOptions),e=new IFB.Views.OpenPositionList(t);this.registerView(e),this._addEvents(e),this.model.load(),IFB.ActivityManager.notify(IFB.ActivityManager.COMPONENT.TRADING_POSITION,IFB.ActivityManager.ACTION.LOAD_OPEN_POSITION,IFB.Trader.getAccountsArray())},setServiceParams:function(){this.setServiceParamSort()},setServiceParamSort:function(){var t=this.config.viewOptions,e=t.sortConfig;if(t.enableSort&&e&&e.descriptor){var i=e.descriptor.replace("D","");this.config.serviceParams.data.sort=e.direction&&"desc"===e.direction?"-"+i:i}},_addEvents:function(t){this.on("sortView",t.sortView,t),this.on("openDetailClick",t.onOpenDetail,t)}}),IFB.Components.OrdersBook=IFB.Class(IFB.Components.Base,{create:function(){this.configure("OrdersBook","/WTServerTD/ServiceTrader.svc/GetOrderBookJSON"),this.setServiceParams();var t=new IFB.Collections.OrdersList(this.config),e=_.extend({model:t,component:this},this.config.viewOptions);this.view=new IFB.Views.OrdersList(e),this.registerView(this.view),this._addEvents(this.view),t.load(),IFB.ActivityManager.notify(IFB.ActivityManager.COMPONENT.TRADING_ORDERS_BOOK,IFB.ActivityManager.ACTION.LOAD_ORDER_BOOK,IFB.Trader.getAccountsArray())},setServiceParams:function(){this.setServiceParamSort()},setServiceParamSort:function(){var t=this.config.viewOptions,e=t.sortConfig;if(t.enableSort&&e&&e.descriptor){var i=e.descriptor.replace("D","");this.config.serviceParams.data.sort=e.direction&&"desc"===e.direction?"-"+i:i}},_addEvents:function(t){this.on("sortView",t.sortView,t),this.on("cancellationOrderClick",t.onCancellationOrderClick,t),this.on("openDetailClick",t.onOpenDetail,t)}}),IFB.Components.Positions=IFB.Class(IFB.Components.Base,{create:function(){var t=this;this.configure("Positions","/wtdb/LoadDataPosiciones"),this.setServiceParams(),t._doCreate()},changeDataParam:function(t){this.config.serviceParams.data.param=t,this.destroyAllViews(),this.create()},reload:function(){var t=this;IFB.Components.Base.prototype.reload.apply(t,arguments)},_doCreate:function(){if(this.destroyRequested)return void(this.destroyRequested=!1);this.model=new IFB.Collections.Positions(this.config);var t=_.extend({model:this.model,component:this},this.config.viewOptions);this.view=new IFB.Views.Positions(t),this.registerView(this.view),this.model.load()},setServiceParams:function(){this.config.serviceParams.data.param=IFB.Utils.Helper.getConstituentsCode(this.config.serviceParams.data.param)}}),IFB.Components.Search=IFB.Class(IFB.Components.Base,{model:void 0,view:void 0,searchPattern:void 0,create:function(){this.configure("InstrumentList","/wtdb/LoadDataLV"),this.model=new IFB.Collections.InstrumentList(this.config),this.model.bind("reset",this._onSearchReady,this),this.searchPattern=IFB.Utils.ProductConfig.getBuscadorHTPattern(),IFB.Components.Search.lastCall&&this.search(IFB.Components.Search.lastCall)},search:function(t){IFB.Components.Search.lastCall=t,this.view&&this.destroy();var e=this.searchPattern.replace("{0}",t.trim());e=e.replace("{1}",""),this.model.load({param:e,type:"2"})},_onSearchReady:function(){if(this.view)this.view.$el.scrollTop(0);else{var t=_.extend({model:this.model,component:this},this.config.viewOptions);this.view=new IFB.Views.InstrumentList(t),this.registerView(this.view)}this.view.reset()}}),IFB.Components.Search.lastCall=void 0,IFB.Components.SignificantFactNearby=IFB.Class(IFB.Components.InstrumentBase,{create:function(){var t=this;this.configure("SignificantFactNearby","/wtdb/HechoRelevanteCercano"),_.extend(this.config.viewOptions,this.getMarketCodIsinFromParam(this.config.requestedParam));var e={type:this.config.serviceParams.data.type,header:"611",param:this.config.serviceParams.data.param};this._getInstrumentSituation(e,function(e){e&&e.V&&e.V.MV?(t.config.serviceParams.data.type="4",t.config.serviceParams.data.param=e.V.MV,t._doCreate()):t._doCreate()})},_doCreate:function(){var t=new IFB.Collections.SignificantFacts(this.config);this.config.viewOptions.model=t;var e=new IFB.Views.SignificantFactNearby(this.config.viewOptions);
this.registerView(e),t.load()},getMarketCodIsinFromParam:function(t){return t&&t.length>12?{marketCod:t.substring(12),isin:t.substring(0,12)}:void 0},showNoData:function(){$(this.config.viewOptions.el).append("<p>No hay información</p>")}}),IFB.Components.Static=IFB.Class(IFB.Components.Base,{create:function(){this.configure();var t=new Backbone.Model(this.config);this.config.viewOptions.model=t;var e=new IFB.Views.Static(this.config.viewOptions);this.registerView(e),e.reset()}}),IFB.Components.TopFlopActive=IFB.Class(IFB.Components.Base,{view:void 0,create:function(){this.configure("TopFlopActive","/wtdb/LoadDataMasSubenBajanContratan"),this.config.serviceParams.data.param=IFB.Utils.Helper.getConstituentsCode(this.config.serviceParams.data.param);var t=new IFB.Collections.InstrumentList(this.config);this.config.viewOptions.model=t,this.view=new IFB.Views.TopFlopActive(this.config.viewOptions),this.registerView(this.view),t.load()}});