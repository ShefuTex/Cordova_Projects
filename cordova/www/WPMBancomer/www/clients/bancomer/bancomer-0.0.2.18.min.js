var BANCOMER=BANCOMER||{};BANCOMER.VERSION="1.0.0";BANCOMER.CULTURETEXT=BANCOMER.CULTURETEXT||{};BANCOMER.Launcher=BANCOMER.Launcher||{};BANCOMER.Router=BANCOMER.Router||{};BANCOMER.Models=BANCOMER.Models||{};BANCOMER.Collections=BANCOMER.Collections||{};BANCOMER.Views=BANCOMER.Views||{};BANCOMER.Views.HighStock=BANCOMER.Views.HighStock||{};BANCOMER.Renderers=BANCOMER.Renderers||{};BANCOMER.Utils=BANCOMER.Utils||{};BANCOMER.Pages=BANCOMER.Pages||{};BANCOMER.Lightboxes=BANCOMER.Lightboxes||{};BANCOMER.Components=BANCOMER.Components||{};BANCOMER.Services=BANCOMER.Services||{};BANCOMER.Services.Streaming=BANCOMER.Services.Streaming||{};BANCOMER.HOMEURL="";IFB.Product="HTBANCOMER";IFB.Services.RetryLimit=3;moment.lang("es");accounting.settings={currency:{symbol:"$",format:"%v %s",decimal:".",thousand:",",precision:2},number:{precision:0,decimal:".",thousand:","}};Highcharts.setOptions({xAxis:{lineColor:"#F7F7F7",tickColor:"#F7F7F7",labels:{style:{color:"#8C949C"}}},yAxis:{gridLineColor:"#F7F7F7",lineColor:"#F7F7F7",tickColor:"#000000",labels:{style:{color:"#8C949C"}}},plotOptions:{series:{dataGrouping:{enabled:false},turboThreshold:0,tooltip:{followTouchMove:true}},candlestick:{color:"#cc0a5a",upColor:"#5cc800"},area:{fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,Highcharts.getOptions().colors[0]],[1,Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get("rgba")]]}}}});IFB.Utils.ProductConfig.getBuscadorHTPattern=function(){return"0;29;20(07)|20(25),{0},,,1,XI;27;M8;RA;4F,3,0,1"};$.extend($.fn.dataTable.defaults,{searching:false,ordering:false});BANCOMER.Launcher.Main=IFB.Class(null,{defaults:{},os:"",accounts:"",server:"",streaming:"",session:"",sid:"",protocol:"",clientSettings:{},activationDelay:2e3,activationTextLenght:2,realTimeNetting:250,PREFERENCES_FILENAME:"_~PREFERENCES",PREFERENCES_TYPE:"PRF",STATUSCONFIG_FILENAME:"MensajesSesionLeidos",STATUSCONFIG_TYPE:"NOTIF",headerComponents:[],footerComponents:[],searchComponent:undefined,messageComponent:undefined,noticeComponent:undefined,settingComponent:undefined,searching:false,footerMenu:undefined,footerMenuVisible:false,initialize:function(options){_.extend(this,Backbone.Events);this.os=options.os||"";this.server=options.server||"";this.streaming=options.streaming||"";this.sid=options.sid||"";this.protocol=options.protocol||"";this.accounts=options.accounts||"";this.clientSettings=options.settings||{};IFB.Services.Domain=this.os==="android"||this.os==="ios"?"bbvanet.com.mx":"";IFB.Templates.baseURL="../templates";this._setClientConfig();this._setServers();this._initializeHeader();IFB.Utils.Helper.callbackOnBeforeUnload=this.callbackOnBeforeUnload},callbackOnBeforeUnload:function(){if(IFB.Services.Streaming.CONNECTION){IFB.Services.Streaming.CONNECTION.unregisterAll();IFB.Services.Streaming.CONNECTION.disconnect()}IFB.ActivityManager.notify(IFB.ActivityManager.COMPONENT.APPLICATION,IFB.ActivityManager.ACTION.LOGOUT,IFB.ActivityManager.ACTION.LOGOUT,IFB.ActivityManager.SOURCE.BROWSER)},_initializeHeader:function(){this._setHeaderTexts();this._setHeaderHandlers();this._setAccountsButton();this._setSearcher();this._setClickableLevel()},_setClickableLevel:function(){var self=this;$("#clickableLevel").on("click",function(){$(".speechBubble").hide();self.hideClickable()});$(".ifb-contHelp").on("click",function(){BANCOMER.Router.navigate("",{trigger:false,replace:true});$(".ifb-contHelp").hide()})},_setClientConfig:function(){if(this.clientSettings){moment.lang(this.clientSettings.language||moment.lang());accounting.settings.currency.decimal=this.clientSettings.decimal||accounting.settings.currency.decimal;accounting.settings.currency.thousand=this.clientSettings.thousand||accounting.settings.currency.thousand;accounting.settings.number.decimal=this.clientSettings.decimal||accounting.settings.number.decimal;accounting.settings.number.thousand=this.clientSettings.thousand||accounting.settings.number.thousand;$.datepicker.setDefaults($.datepicker.regional[this.clientSettings.language])}},_setHeaderTexts:function(){$("#menuBtnExit a").text(BANCOMER.CULTURETEXT.t("pageExitBtn"));$("#txtSearch").attr("placeholder",BANCOMER.CULTURETEXT.t("pageSearcherPlaceholder"))},_setHeaderHandlers:function(){var self=this;$("#menuBtnExit").on("click",function(){self._onClickBtnExit()});$("#homeBtn").on("click",function(){self._onClickBtnHome()});$("#menuBtnAccounts").on("click",function(){self._onClickBtnAccounts()});$("#menuBtnNotice").on("click",function(){self._onClickBtnNotice()});$("#menuBtnMessage").on("click",function(){self._onClickBtnMessage()});$("#menuBtnHelp").on("click",function(){self._showHelp()});$("#menuBtnTransference").on("click",function(){self._onClickBtnTransference()});$("#mnuFooterIcon").on("click",function(){if(!self.footerMenuVisible){self.openFooterMenu()}})},_showHelp:function(el){this.showClickable();$("#settingsBubble").show()},showClickable:function(){$("#clickableLevel").show()},hideClickable:function(){$("#clickableLevel").hide()},_setAccountsButton:function(){var self=this;var accountsButton=$("#menuBtnAccounts");if(this.accounts==="1"){accountsButton.removeClass("hidden")}else{accountsButton.addClass("hidden")}},_setSearcher:function(){var self=this;var message;$("#txtSearch").on("click",function(){$("#search_instrumentList").hide();self.hideClickable()});$("#txtSearch").on("keyup",_.debounce(function(){if(self.searchComponent){message=escape(document.querySelector("#txtSearch").value);if(message.length>self.activationTextLenght&&!self.searching){shown=true;self.showSearchResults(message)}self.searching=false}},self.activationDelay));$("#txtSearch").on("keydown",function(event){if(self.searchComponent){message=escape(document.querySelector("#txtSearch").value);if(message.length>self.activationTextLenght){if(self.isEnterKeyCode(event)){self.searching=true;self.showSearchResults(message)}}}})},showSearchResults:function(message){this._launchSearch(message);this.showClickable();$("#search_instrumentList").empty();$("#search_instrumentList").show()},isEnterKeyCode:function(event){return event.keyCode===13},_onClickBtnAccounts:function(){var params={};var self=this;BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.SolicitaCambioContrato,params,function(response){if(response.answer!==undefined&&response.status!==undefined&&response.status.ok&&params.id_testigo===response.answer.id_testigo){if(response.answer.cuentaNueva==="1"){self.trigger("changeAccount")}}})},_onClickBtnTransference:function(){var params={};BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.TransferenciaEfectivo,params)},_onClickBtnExit:function(){var self=this;var buttons=[{text:BANCOMER.CULTURETEXT.t("noty_Btn_Exit_Cancel")},{text:BANCOMER.CULTURETEXT.t("noty_Btn_Exit_Close"),callback:function(){var params={};IFB.Services.Streaming.CONNECTION.unregisterAll();IFB.Services.Streaming.CONNECTION.disconnect();self._destroyHeader();self._destroyFooter();document.location.href="#!/logout";BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.SolicitaCierreApp,params)}}];IFB.Utils.Helper.showNotificationWarning("warning",BANCOMER.CULTURETEXT.t("noty_Exit_Title"),true,buttons)},_onClickBtnNotice:function(){document.location.href="#!/lightbox/newsList/pageTitle_NoticePage/BWTAVISOS"},_onClickBtnMessage:function(){document.location.href="#!/lightbox/newsList/pageTitle_MessagePage/BWTMENSAJES"},_onClickBtnHome:function(){document.location.href="#!/home"},_launchSearch:function(message){this.searchComponent.search(message)},_loadSearchComponent:function(){var component=new BANCOMER.Components.Search({config:"header_search_instrumentList",view:{el:"#search_instrumentList"}});component.on("openInstrumentDetail",this._openInstrumentDetail,this);return component},_loadHeaderSettingsComponent:function(){var component=new BANCOMER.Components.MenuSettings({config:"menuHeader_settings",view:{el:"#settingsBubble",streamingStatus:BANCOMER.Defaults.Application.streaming||"1"}});component.on("sendChangeStreaming",this.onSendChangeStreaming,this);return component},_loadMessageComponent:function(){var component=new BANCOMER.Components.NewsButton({config:"header_message",view:{el:"#menuBtnMessage"}});return component},_loadNoticeComponent:function(){var component=new BANCOMER.Components.NewsButton({config:"header_notice",view:{el:"#menuBtnNotice"}});return component},_openInstrumentDetail:function(eventData){this.hideClickable();$("#txtSearch").val("");document.location.href="#!/lightbox/instrumentDetail/"+eventData.mv},enter:function(){var self=this;if(this.sid!==""){var mgService=new IFB.Services.Management;var params={sid:this.sid};var callback=function(response){var responseJson=JSON.parse(response);var serverGMT=0;if(responseJson.status!==undefined&&responseJson.status.ok){self.server=responseJson.answer.server||self.server;self.streaming=responseJson.answer.streaming||self.streaming;self.session=responseJson.answer.sesion||"";IFB.Services.Session=self.session;serverGMT=responseJson.answer.gmt||"0";self._setGmtOffset(self.clientSettings.gmt,serverGMT);self._setServers();self.createClickOnComponent(responseJson.answer)}else{IFB.Utils.Helper.showNotificationWarning("warning",BANCOMER.CULTURETEXT.t("noty_Error_SID"),true)}};mgService.validateSID(params,callback)}else{IFB.Utils.Helper.showNotificationWarning("warning",BANCOMER.CULTURETEXT.t("noty_Error_SID"),true)}},_setGmtOffset:function(clientGMT,serverGMT){IFB.Settings.GmtOffset=(Number(clientGMT)-Number(serverGMT))*60},_initializeProductConfig:function(){var self=this;IFB.Utils.ProductConfig.initializeProductConfig(IFB.Services.Session,function(){self._loadUserPreferences(self)})},_setServers:function(){if(this.server){IFB.Services.baseURL=this.protocol+this.server+"/WTRest"}IFB.Services.ExternalUsersUrl=this.protocol+this.server+"/ExternalUsers";IFB.Services.StreamingBaseUrl=this.protocol+this.streaming+"/WTServerRT"},_startStreamingRealTime:function(callback,context){var self=context;var streamingEnabled;IFB.Services.Streaming.CONNECTION=new IFB.Services.Streaming({baseURL:self.protocol+self.server+"/WTServerRT"||"",streamingBaseURL:IFB.Services.StreamingBaseUrl||"",session:IFB.Services.Session,formatTypeJson:"4",netting:self.realTimeNetting});streamingEnabled=BANCOMER.Utils.Helper.hasStreamingEnabled();if(streamingEnabled){IFB.Services.Streaming.CONNECTION.connect(function(){if(_.isFunction(callback)){callback(context)}})}else{IFB.Services.Streaming.CONNECTION.streamingEnabled=false;if(_.isFunction(callback)){callback(context)}}},_loadUserPreferences:function(context){var self=context;BANCOMER.Utils.Helper.getUserFiles(IFB.Services.Session,self.PREFERENCES_TYPE,function(files){self._initializeUserPreferences(_.first(files),self)})},_initializeUserPreferences:function(file,context){var self=context;BANCOMER.Utils.Preferences.initialize({file:self.PREFERENCES_FILENAME,type:self.PREFERENCES_TYPE,loadOnInitialize:true},function(){self._initializeStatusConfig(context)})},_initializeStatusConfig:function(context){var self=context;IFB.Utils.ReadStatusConfig.initialize({file:self.STATUSCONFIG_FILENAME,type:self.STATUSCONFIG_TYPE,loadOnInitialize:true},function(){BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules);BANCOMER.Defaults.application=$.extend(true,BANCOMER.Defaults.Application,BANCOMER.Utils.Preferences.preferences.application);self._startStreamingRealTime(self._startBackbone,self)})},_startBackbone:function(context){var self=context;BANCOMER.Router=new BANCOMER.Router.Main;Backbone.history.start();self._createHeaderComponents();self._createFooterComponents()},_destroyHeader:function(){while(this.headerComponents.length){this.headerComponents.shift().destroy()}},_destroyFooter:function(){while(this.footerComponents.length){this.footerComponents.shift().destroy()}},_createHeaderComponents:function(context){this.searchComponent=this._loadSearchComponent();this.messageComponent=this._loadMessageComponent();this.noticeComponent=this._loadNoticeComponent();this.settingComponent=this._loadHeaderSettingsComponent();this.headerComponents.push(this.searchComponent);this.headerComponents.push(this.messageComponent);this.headerComponents.push(this.noticeComponent)},onClikcOnAccepted:function(){this.clickOnComponent.destroy();$("div.ifb-cont").show();this._initializeProductConfig()},onClikcOnRefused:function(){var params={};this.clickOnComponent.destroy();BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.IrAPosicionGlobal,params)},createClickOnComponent:function(validateSidJson){var self=this;this.clickOnComponent=new BANCOMER.Components.ClickOn({config:"clickOn",params:validateSidJson});this.clickOnComponent.on("clikcOnNoDocuments",self.onClikcOnAccepted,self);this.clickOnComponent.on("clikcOnAccepted",self.onClikcOnAccepted,self);this.clickOnComponent.on("clikcOnRefused",self.onClikcOnRefused,self)},getOS:function(){var os=this.os;if(os===""){os=IFB.Utils.Helper.isIOS()?"ios":"android"}return os},onSendChangeStreaming:function(){if($("#myonoffswitch").is(":checked")){this.connectStreaming()}else{this.disconnectStreaming()}BANCOMER.Utils.Helper.setRefreshIcon()},disconnectStreaming:function(){this.updateStreamingPreference("0");if(IFB.Services.Streaming.CONNECTION){IFB.Services.Streaming.CONNECTION.unregisterAll();IFB.Services.Streaming.CONNECTION.disconnect();IFB.Services.Streaming.CONNECTION.streamingEnabled=false}},connectStreaming:function(){this.updateStreamingPreference("1");IFB.Services.Streaming.CONNECTION.streamingEnabled=true;this._startStreamingRealTime(function(){BANCOMER.Router.currentPage.registerComponents();_.each(BANCOMER.Router.lightboxes,function(lightbox){lightbox.registerComponents()})},this)},updateStreamingPreference:function(newValue){BANCOMER.Defaults.Application.streaming=newValue;BANCOMER.Utils.Preferences.addPreferenceApplication("streaming",newValue);BANCOMER.Utils.Preferences.save()},_createFooterComponents:function(context){this.footerMenu=this._loadMenuComponent();this.footerComponents.push(this.footerMenu);this.addEventsFooterMenu()},addEventsFooterMenu:function(){var self=this;this.footerMenu.on("clickItemMenu",function(data){$("#footerContainer").addClass("ifHidden");self.footerMenuVisible=false;BANCOMER.Utils.Helper.closeFooterMenu();document.location.href="#!/workspace/"+data.workspace});this.footerMenu.on("closeMenu",function(){if(self.footerMenuVisible){self.closeFooterMenu()}})},openFooterMenu:function(){if(this.footerMenu&&!this.footerMenuVisible){$("#footerContainer").removeClass("ifHidden");this.footerMenuVisible=true;this.footerMenu.config.viewOptions.items=BANCOMER.Utils.Preferences.preferences.workspaces||[];this.footerMenu.reload();BANCOMER.Utils.Helper.openFooterMenu()}},closeFooterMenu:function(){if(this.footerMenuVisible){$("#footerContainer").addClass("ifHidden");BANCOMER.Utils.Helper.closeFooterMenu();this.footerMenuVisible=false}},_loadMenuComponent:function(){var config={config:"footerMenu",view:{items:BANCOMER.Utils.Preferences.preferences.workspaces||[]}};return new BANCOMER.Components.MenuFooter(config)}});(function(){BANCOMER=BANCOMER||{};BANCOMER.Defaults=IFB.Defaults||{};BANCOMER.Defaults.Application=BANCOMER.Defaults.Application||{};_.extend(BANCOMER.Defaults,{Templates:{home_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"home_markUp",templateFile:"/home/markUp.htm"}},home_IndexesChart:{serviceParams:{data:{param:"BPG001",type:"1",header:"10103,250,3002,642",sort:"-1"}},viewOptions:{el:$("#homeIndexesChart"),templateId:"home_IndexesChart",templateFile:"/base/indexChart.htm",streaming:true,numberOfItems:5,percentageEqual:4}},home_marketGrid:{serviceParams:{data:{param:"BPG002",type:"1",rt:"1",sort:"-1"},header:{columnado:"TAURO_INDICES_INDICES2",tipo:"1",defecto:"0"}},viewOptions:{el:$("#homeIndexesMarketGrid"),templateId:"home_marketGrid",templateFile:"/instrumentList/table.htm",streaming:true,dataTable:{id:"marketGridTable"}},configHeaderSelector:{config:"header_selector",title:"componentTitle_UserHeader_Index"}},home_multipleTopFlopHorizontalList:{viewOptions:{el:$("#homeMultiTopFlopList")},serviceParams:{data:{param:"mx0001"}},components:[{config:"home_topHorizontal"},{config:"home_flopHorizontal"}]},home_topHorizontal:{serviceParams:{data:{type:"1",header:"10103,250,642,9828,9829,40",numVals:"4"}},viewOptions:{el:"#ifb-topHorizontal",templateId:"home_topHorizontal",templateFile:"/home/topFlopHorizontal.htm",streaming:true,topFlopArrowCls:{top:"arrowBigVTop",flop:"arrowBigVFlop",equal:"arrowBigVEqual"}},refresh:15e3},home_flopHorizontal:{serviceParams:{data:{type:"2",header:"10103,250,642,9828,9829,40",numVals:"4"}},viewOptions:{el:"#ifb-flopHorizontal",templateId:"home_flopHorizontal",templateFile:"/home/topFlopHorizontal.htm",streaming:true,topFlopArrowCls:{top:"arrowBigVTop",flop:"arrowBigVFlop",equal:"arrowBigVEqual"}},refresh:15e3},logout_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"logout_markUp",templateFile:"/logout/markUp.htm"}},home_ResearchNews:{viewOptions:{},news:{markUp:"home_ResearchNews_markUpNews",components:[{config:"home_ResearchNews_News"}]},research:{markUp:"home_ResearchNews_markUpResearch",components:[{config:"home_ResearchNews_Research"}]},researchNews:{markUp:"home_ResearchNews_markUpResearchNews",components:[{config:"home_ResearchNews_ResearchNews_Research"},{config:"home_ResearchNews_ResearchNews_News"}]},urlFileNode:"FicheroIB"},home_ResearchNews_markUpResearchNews:{serviceParams:{},viewOptions:{el:"#homeResearchNews",templateId:"home_ResearchNews_markUpResearchNews",templateFile:"/home/researchNews_markUpResearchNews.htm"}},home_ResearchNews_markUpNews:{serviceParams:{},viewOptions:{el:"#homeResearchNews",templateId:"home_ResearchNews_markUpNews",templateFile:"/home/researchNews_markUpNews.htm"}},home_ResearchNews_markUpResearch:{serviceParams:{},viewOptions:{el:"#homeResearchNews",templateId:"home_ResearchNews_markUpResearch",templateFile:"/home/researchNews_markUpResearch.htm"}},home_ResearchNews_News:{serviceParams:{searchFunc:"41",numberOfItems:14,data:{sources:"INFOSEL_BOLSA;INFOSEL_EMPRESAS;EMISNET"}},viewOptions:{el:"#homeNews",templateId:"home_ResearchNews_News",templateFile:"/home/news.htm",itemIdPrefix:"homeNews",streaming:true}},home_ResearchNews_Research:{serviceParams:{searchFunc:"41",numberOfItems:14,data:{sources:"BCMRANALISIS"}},viewOptions:{el:"#homeResearch",templateId:"home_ResearchNews_Research",templateFile:"/home/research.htm",itemIdPrefix:"homeResearch",streaming:true}},home_ResearchNews_ResearchNews_News:{serviceParams:{searchFunc:"41",numberOfItems:7,data:{sources:"INFOSEL_BOLSA;INFOSEL_EMPRESAS;EMISNET"}},viewOptions:{el:"#homeNews",templateId:"home_ResearchNews_ResearchNews_News",templateFile:"/home/researchNews_news.htm",itemIdPrefix:"homeNews",streaming:true}},home_ResearchNews_ResearchNews_Research:{serviceParams:{searchFunc:"41",numberOfItems:7,data:{sources:"BCMRANALISIS"}},viewOptions:{el:"#homeResearch",templateId:"home_ResearchNews_ResearchNews_Research",templateFile:"/home/researchNews_research.htm",itemIdPrefix:"homeResearch",streaming:true}},home_TopFlopPieChart:{viewOptions:{el:$("#homeTopFlopPieChart"),templateId:"home_TopFlopPieChart",templateFile:"/home/topFlopPieChart.htm",streaming:true,height:142},serviceParams:{data:{param:"RAMXC  ",header:"8760,8770,8780",type:"4"}}},home_multipleTopFlopActive:{viewOptions:{el:$("#multipleTopFlopActive")},serviceParams:{data:{param:"mx0001"}},components:[{config:"home_top"},{config:"home_flop"},{config:"home_active"}]},home_top:{serviceParams:{data:{type:"1",header:"10305,80,420,250,370,390,410,1147,10307,133,642,10103"}},viewOptions:{el:"#ifb-top",templateId:"home_top",templateFile:"/home/top.htm",streaming:true},refresh:15e3},home_flop:{serviceParams:{data:{type:"2",header:"10305,80,420,250,370,390,410,1147,10307,133,642,10103"}},viewOptions:{el:"#ifb-flop",templateId:"home_flop",templateFile:"/home/flop.htm",streaming:true},refresh:15e3},home_active:{serviceParams:{data:{type:"3",header:"10305,10103,133,670,10307,642,9828,9829"}},viewOptions:{el:"#ifb-active",templateId:"home_active",templateFile:"/home/active.htm",streaming:true},refresh:15e3},home_investmentDetailChart:{serviceBCOMParams:{operationCode:"7",params:{data1:"D"}},serviceParams:{header:{columnado:"TAURO_RESUMENEJECUTIVOPOSICION",tipo:"1",defecto:"0",descriptoresAdicionales:"40,9558,642,250,1538"}},viewOptions:{el:"#homeInvestmentDetailChart",templateId:"home_investmentDetailChart",templateFile:"/home/investmentDetailChart.htm",niceScroll:{id:"niceScrollGraph"}}},home_investmentDetailTable:{serviceBCOMParams:{operationCode:"7",params:{data1:"D"}},serviceParams:{header:{columnado:"TAURO_RESUMENEJECUTIVOPOSICION",tipo:"1",defecto:"0",descriptoresAdicionales:"40,9558,642,250,1538"},data:{header:"1538,642,250"}},viewOptions:{el:"#homeInvestmentDetailTable",templateId:"home_investmentDetailTable",templateFile:"/home/investmentDetailTable.htm",streaming:true,highlightDescriptors:["1538","250"],enableSort:true,sortConfig:{css:{arrow:"sortArrow2",asc:"activeUp",desc:"activeDown"}},dataTable:{id:"investmentDetailGridTable"}}},boleta_markUp:{serviceParams:{},viewOptions:{el:"#lightboxBoleta",templateId:"boleta_markUp",templateFile:"/boleta/markUp.htm"}},boleta_menu:{serviceParams:{},viewOptions:{el:"#boletaMenu",templateId:"boleta_menu",templateFile:"/boleta/boletaMenu.htm"}},boleta_instrumentDetail:{serviceParams:{data:{header:"420,370,240,250,340,330,670,642",rt:"1",sort:"-1",type:"4"}},viewOptions:{el:$("#boletaInstrumentDetail"),templateId:"boleta_instrumentDetail",templateFile:"/boleta/boletaInstrumentDetail.htm",streaming:true,highlightDescriptors:["340","330","642"]}},boleta_positions:{serviceParams:{data:{type:"4",header:"735,350,740,330,340,750,360"}},viewOptions:{el:$("#boletaPositions"),templateId:"boleta_positions",templateFile:"/boleta/boletaPositions.htm",highlightDescriptors:[],streaming:true}},boleta_form:{serviceParams:{data:{header:"9828,9829,330,340,1147,420",type:"4",rt:"1"}},viewOptions:{el:$("#boletaForm"),templateId:"boleta_boleta",templateFile:"/boleta/boletaForm.htm",streaming:true}},boleta_confirmation:{serviceParams:{},viewOptions:{el:$("#boletaConfirmation"),templateId:"boleta_confirmation",templateFile:"/boleta/confirmation.htm"}},boleta_receipt:{serviceParams:{},viewOptions:{el:$("#boletaReceipt"),templateId:"boleta_receipt",templateFile:"/boleta/receipt.htm"}},investmentDetail_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"investmentDetail_markUp",templateFile:"/investmentDetail/markUp.htm"}},investmentDetail_positionTable:{serviceBCOMParams:{operationCode:"7",params:{data1:"D"}},serviceParams:{header:{columnado:"TAURO_DETALLEINVERSIONPOSICION",tipo:"1",defecto:"0"},data:{header:"1538,642,356,1562,250,410,390,9754"}},viewOptions:{el:"#investmentDetail_positionTable",templateId:"investmentDetail_positionTable",templateFile:"/investmentDetail/positionTable.htm",streaming:true,highlightDescriptors:["1538","356","1562","250","390","410","9754"],dataTable:{id:"positionTable"},enableSort:true,sortConfig:{descriptor:IFB.Descriptors.Emisora.descriptor}},configHeaderSelector:{config:"header_selector",title:"componentTitle_UserHeader_PositionTable"}},investmentDetail_orderBookTable:{serviceBCOMParams:{operationCode:"4",params:{data1:"4"}},serviceParams:{header:{columnado:"TAURO_DETALLEINVERSIONORDENES",tipo:"1",defecto:"0"},data:{header:"1538,642,356,1562,250,410,390,9754"}},viewOptions:{el:"#investmentDetail_orderBookTable",templateId:"investmentDetail_orderBookTable",templateFile:"/investmentDetail/orderBookTable.htm",dataTable:{id:"orderBookTable"},enableSort:true,sortConfig:{descriptor:IFB.Descriptors.Bancomer_Estado.descriptor,direction:"desc"}},configHeaderSelector:{config:"header_selector",title:"componentTitle_UserHeader_OrderBookTable"}},investmentDetail_orderDetail:{serviceBCOMParams:{operationCode:"5"},viewOptions:{el:"#investmentDetail_orderDetail",templateId:"investmentDetail_orderDetail",templateFile:"/investmentDetail/orderDetail_table.htm",dataTable:{id:"orderDetailTable"}}},orderDetail_markUp:{serviceParams:{},viewOptions:{el:"#lightboxOrderDetail",templateId:"orderDetail_markUp",templateFile:"/investmentDetail/orderDetail_markUp.htm"}},orderCancel_markUp:{serviceParams:{},viewOptions:{el:"#lightboxOrderCancel",templateId:"orderCancel_markUp",templateFile:"/orderCancel/markUp.htm"}},orderCancel_confirmation:{serviceParams:{},serviceBCOMParams:{operationCode:"4",params:{data1:"1"}},viewOptions:{templateId:"orderCancel_confirmation",templateFile:"/orderCancel/orderConfirmation.htm"}},home_moduleFilter_marketSummary:{serviceParams:{},viewOptions:{el:"#moduleFilterMarketSummary",templateId:"home_moduleFilter_marketSummary",templateFile:"/home/moduleFilter_marketSummary.htm"}},home_moduleFilter_topFlop:{serviceParams:{},viewOptions:{el:"#moduleFilterTopFlop",templateId:"home_moduleFilter_topFlop",templateFile:"/home/moduleFilter_topFlop.htm"}},home_moduleFilter_investmentDetail:{serviceParams:{},viewOptions:{el:"#moduleFilterInvestmentDetail",templateId:"home_moduleFilter_investmentDetail",templateFile:"/home/moduleFilter_investmentDetail.htm"}},home_moduleFilter_researchNews:{serviceParams:{},viewOptions:{el:"#moduleFilterResearchNews",templateId:"home_moduleFilter_researchNews",templateFile:"/home/moduleFilter_researchNews.htm"}},researchNews_moduleFilter_researchNews:{serviceParams:{},viewOptions:{el:"#moduleFilterResearchNewsMaximized",templateId:"researchNews_moduleFilter_researchNews",templateFile:"/researchNews/moduleFilter_researchNews.htm"}},header_search_instrumentList:{serviceParams:{data:{header:"10103,40,25",sort:"10103"}},viewOptions:{el:$("#search_instrumentList"),templateId:"header_search_instrumentList",templateFile:"/header/searchInstrumentList.htm",sortConfig:{descriptor:IFB.Descriptors.IFBShortName.descriptor},niceScroll:{id:"niceScrollSearch"}}},menuHeader_settings:{serviceParams:{},viewOptions:{el:$("#settingsBubble"),templateId:"menuHeader_settings",templateFile:"/header/settings.htm"}},instrumentDetail_markUp:{serviceParams:{},viewOptions:{el:"#lightboxInstrumentDetail",templateId:"instrumentDetail_markUp",templateFile:"/instrumentDetail/base/markUp.htm"}},instrumentDetail_issuer_resume:{serviceParams:{data:{header:"642,10103,420,240,250,60,70,370,380,390,410,8730,710,8760,8770,568,5101,9754,670,936,5102",rt:"1",sort:"-1",type:"4"}},viewOptions:{el:"#instrumentDetail_resume",templateId:"instrumentDetail_issuer_resume",templateFile:"/instrumentDetail/issuer/resume.htm",streaming:true,highlightDescriptors:[],topFlopBackgroundCls:{top:"ifb-bgTop",flop:"ifb-bgFlop",equal:"ifb-bgEqual"},topFlopArrowCls:{top:"ifb-topArrowWhite",flop:"ifb-flopArrowWhite",equal:"ifb-equalArrowWhite"}}},instrumentDetail_warrant_resume:{serviceParams:{data:{header:"642,10103,420,240,250,60,70,9875,9881,9857,9872,10104,9825,25,9886,568,5101,568,5102",rt:"1",sort:"-1",type:"4"}},viewOptions:{el:"#instrumentDetail_resume",templateId:"instrumentDetail_warrant_resume",templateFile:"/instrumentDetail/warrant/resume.htm",streaming:true,topFlopBackgroundCls:{top:"ifb-bgTop",flop:"ifb-bgFlop",equal:"ifb-bgEqual"},topFlopArrowCls:{top:"ifb-topArrowWhite",flop:"ifb-flopArrowWhite",equal:"ifb-equalArrowWhite"}}},instrumentDetail_etf_resume:{serviceParams:{data:{header:"642,10103,420,240,250,60,70,370,380,390,410,8730,710,8760,8770,568,5101,568,5102",rt:"1",sort:"-1",type:"4"}},viewOptions:{el:"#instrumentDetail_resume",templateId:"instrumentDetail_etf_resume",templateFile:"/instrumentDetail/etf/resume.htm",streaming:true,topFlopBackgroundCls:{top:"ifb-bgTop",flop:"ifb-bgFlop",equal:"ifb-bgEqual"},topFlopArrowCls:{top:"ifb-topArrowWhite",flop:"ifb-flopArrowWhite",equal:"ifb-equalArrowWhite"}}},instrumentDetail_etf_serie:{serviceParams:{data:{header:"9833,27,25,9846,9758,9759,9827,9828,9829,9830,40,9757,9912,9845,9840,9841,9839,9834,9835,9838,9836,9837,9860",rt:"1",sort:"-1",type:"4"}},viewOptions:{el:"#instrumentDetail_resume",templateId:"instrumentDetail_etf_serie",templateFile:"/instrumentDetail/etf/serie.htm",streaming:true}},instrumentDetail_etf_positions:{serviceParams:{data:{type:"4",header:"735,350,740,330,340,750,360"}},viewOptions:{el:"#instrumentDetail_positions",templateId:"instrumentDetail_etf_positions",templateFile:"/instrumentDetail/etf/positions.htm",highlightDescriptors:[],streaming:true}},instrumentDetail_index_resume:{serviceParams:{data:{header:"642,10103,420,240,250,60,70,370,380,390,410,8730,710,8760,8770,568,5101,568,5102",rt:"1",sort:"-1",type:"4"}},viewOptions:{el:"#instrumentDetail_resume",templateId:"instrumentDetail_index_resume",templateFile:"/instrumentDetail/index/resume.htm",streaming:true,highlightDescriptors:[],topFlopBackgroundCls:{top:"ifb-bgTop",flop:"ifb-bgFlop",equal:"ifb-bgEqual"},topFlopArrowCls:{top:"ifb-topArrowWhite",flop:"ifb-flopArrowWhite",equal:"ifb-equalArrowWhite"}}},instrumentDetail_issuer_serie:{serviceParams:{data:{header:"9833,27,25,9846,9758,9759,9827,9828,9829,9830,40,9757,9912,9845,9840,9841,9839,9834,9835,9838,9836,9837,9860",rt:"1",sort:"-1",type:"4"}},viewOptions:{el:"#instrumentDetail_resume",templateId:"instrumentDetail_issuer_serie",templateFile:"/instrumentDetail/issuer/serie.htm",streaming:true}},instrumentList_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"instrumentList_markUp",templateFile:"/instrumentList/markUp.htm"}},instrumentList_table:{serviceParams:{data:{type:"3",header:"70,642,9558,9828,9829,330,340,740,750,356,1562,250,420,10103,670,40",sort:"10103",numVals:"50"},header:{columnado:"TAURO_ACCIONES2_PANORAMA2",tipo:"1",defecto:"0"}},viewOptions:{el:"#instrumentList_table",templateId:"instrumentList_table",templateFile:"/instrumentList/table.htm",streaming:true,enableSort:true,sortConfig:{direction:"asc",descriptor:"D9828"},dataTable:{id:"instrumentListTable"}},configHeaderSelector:{config:"header_selector",title:"componentTitle_UserHeader_InstrumentList"}},instrument_listTopFlop:{serviceParams:{data:{type:"3",header:"70,642,9558,9828,9829,330,340,740,750,356,1562,250,420,10103,670,40",sort:"10103",numVals:"50"},header:{columnado:"TAURO_ACCIONES2_PANORAMA2",tipo:"1",defecto:"0"}},viewOptions:{el:"#instrumentList_table",templateId:"instrumentList_table",templateFile:"/instrumentList/table.htm",streaming:true,enableSort:true,sortConfig:{direction:"asc",descriptor:"D642"},dataTable:{id:"instrumentListTable"},highlightDescriptors:["420","250","330","340","740","750","670"]},configHeaderSelector:{config:"header_selector",title:"componentTitle_UserHeader_InstrumentList"}},newsDetail_markUp:{serviceParams:{},viewOptions:{el:"#lightboxNewsDetail",templateId:"newsDetail_markUp",templateFile:"/newsDetail/markUp.htm"}},newsDetail_newsDetail:{serviceParams:{},viewOptions:{el:"#newsDetail_newsDetail",templateId:"newsDetail_newsDetail",templateFile:"/newsDetail/newsDetail.htm",niceScroll:{id:"niceScrollNewsDetail"},titleTextKey:"componentLabel_NewsDetail_Title_Research&News"}},researchNews_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"researchNews_markUp",templateFile:"/researchNews/markUp.htm"}},researchNews_ResearchNews:{viewOptions:{},news:{markUp:"researchNews_ResearchNews_markUpNews",components:[{config:"researchNews_ResearchNews_News"}]},research:{markUp:"researchNews_ResearchNews_markUpResearch",components:[{config:"researchNews_ResearchNews_Research"}]},researchNews:{markUp:"researchNews_ResearchNews_markUpResearchNews",components:[{config:"researchNews_ResearchNews_ResearchNews_Research"},{config:"researchNews_ResearchNews_ResearchNews_News"}]},urlFileNode:"FicheroIB"},researchNews_ResearchNews_markUpResearchNews:{serviceParams:{},viewOptions:{el:"#researchNews",templateId:"researchNews_ResearchNews_markUpResearchNews",templateFile:"/researchNews/researchNews_markUpResearchNews.htm"}},researchNews_ResearchNews_markUpNews:{serviceParams:{},viewOptions:{el:"#researchNews",templateId:"researchNews_ResearchNews_markUpNews",templateFile:"/researchNews/researchNews_markUpNews.htm"}},researchNews_ResearchNews_markUpResearch:{serviceParams:{},viewOptions:{el:"#researchNews",templateId:"researchNews_ResearchNews_markUpResearch",templateFile:"/researchNews/researchNews_markUpResearch.htm"}},researchNews_ResearchNews_News:{serviceParams:{searchFunc:"41",numberOfItems:22,data:{sources:"INFOSEL_BOLSA;INFOSEL_EMPRESAS;EMISNET"}},viewOptions:{el:"#researchNewsNews",templateId:"researchNews_ResearchNews_News",templateFile:"/researchNews/news.htm",itemIdPrefix:"researchNewsNews",streaming:true}},researchNews_ResearchNews_Research:{serviceParams:{searchFunc:"41",numberOfItems:22,data:{sources:"BCMRANALISIS"}},viewOptions:{el:"#researchNewsResearch",templateId:"researchNews_ResearchNews_Research",templateFile:"/researchNews/research.htm",itemIdPrefix:"researchNewsResearch",streaming:true}},researchNews_ResearchNews_ResearchNews_News:{serviceParams:{searchFunc:"41",numberOfItems:11,data:{sources:"INFOSEL_BOLSA;INFOSEL_EMPRESAS;EMISNET"}},viewOptions:{el:"#researchNewsNews",templateId:"researchNews_ResearchNews_ResearchNews_News",templateFile:"/researchNews/researchNews_news.htm",itemIdPrefix:"researchNewsNews",streaming:true}},researchNews_ResearchNews_ResearchNews_Research:{serviceParams:{searchFunc:"41",numberOfItems:11,data:{sources:"BCMRANALISIS"}},viewOptions:{el:"#researchNewsResearch",templateId:"researchNews_ResearchNews_ResearchNews_Research",templateFile:"/researchNews/researchNews_research.htm",itemIdPrefix:"researchNewsResearch",streaming:true}},indexDetailPage_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"indexDetailPage_markUp",templateFile:"/indexDetailPage/markUp.htm"}},indexDetailPage_indexChart:{serviceParams:{data:{param:"BPG003",type:"1",header:"10103,250,3002,642",sort:"-1"}},viewOptions:{el:$("#indexDetailPageChart"),templateId:"indexDetailPage_indexChart",templateFile:"/base/indexChart.htm",streaming:true,numberOfItems:8,percentageEqual:2}},indexDetailPage_indexTable:{serviceParams:{data:{param:"BPG002",type:"1",rt:"1",sort:"-1"},header:{columnado:"TAURO_INDICES_INDICES2",tipo:"1",defecto:"0"}},viewOptions:{el:$("#indexDetailPageTable"),templateId:"indexDetailPage_indexTable",templateFile:"/instrumentList/table.htm",streaming:true,dataTable:{id:"marketGridTable"}},configHeaderSelector:{config:"header_selector",title:"componentTitle_UserHeader_Index"}},instrumentDetail_resumeCharts:{serviceParams:{data:{header:"420,60,70,5101,5102,568,591",rt:"1",sort:"-1",type:"4"}},viewOptions:{el:"#instrumentDetailResumeCharts",templateId:"instrumentDetail_resumeCharts",templateFile:"/instrumentDetail/base/resumeCharts.htm",streaming:true,highlightDescriptors:[]},charts:{intraday:{type:"line",frequency:"1"},daily:{type:"line",frequency:"d",period:"1y"}},saveOnServer:"0"},chartIntraday:{serviceParams:{data:{type:"4",descriptors:"60,70,420,642,790",compressionMult:"1"}},viewOptions:{streaming:true,colors:["#009EE5"],trendClassnames:["ifb-equal","ifb-top","ifb-flop"],lineWidth:2,tooltipCrosshairsColor:"#FBBBBC",colorLabelXAxis:"#8C949C",colorLineXAxis:"#D4E1EC",colorTickXAxis:"#D4E1EC",colorLabelYAxis:"#8C949C",colorLineYAxis:"#D4E1EC",colorTickYAxis:"#D4E1EC",colorGridLineYAxis:"#D4E1EC",tooltipEnabled:true,decimalsYAxis:3,pinchType:null,followTouchMove:true}},chartDaily:{serviceParams:{data:{type:"4",descriptors:"60,70,420,642,790"}},viewOptions:{streaming:false,colors:["#009EE5"],trendClassnames:["ifb-equal","ifb-top","ifb-flop"],lineWidth:2,tooltipCrosshairsColor:"#FBBBBC",colorLabelXAxis:"#8C949C",colorLineXAxis:"#D4E1EC",colorTickXAxis:"#D4E1EC",colorLabelYAxis:"#8C949C",colorLineYAxis:"#D4E1EC",colorTickYAxis:"#D4E1EC",colorGridLineYAxis:"#D4E1EC",tooltipEnabled:true,decimalsYAxis:3,pinchType:null,followTouchMove:true}},instrumentDetail_research:{serviceParams:{searchFunc:"41",data:{fromDate:moment().subtract("d",70).format("YYYYMMDD"),sources:"BCMRANALISIS"}},viewOptions:{el:"#instrumentDetail_resume",templateId:"instrumentDetail_research",templateFile:"/instrumentDetail/base/research.htm",dataTable:{id:"researchTable"}},urlFileNode:"FicheroIB"},instrumentDetail_header:{serviceParams:{data:{header:"10103,40,9828,9829,420,370,240,250,60,70",rt:"1",sort:"-1",type:"4"}},viewOptions:{el:"#instrumentDetail_header",templateId:"instrumentDetail_header",templateFile:"/instrumentDetail/base/header.htm"}},header_message:{serviceParams:{data:{fuentes:"BWTMENSAJES",fecha:moment().format("YYYYMMDD")}},viewOptions:{el:$("#menuBtnMessage"),templateId:"header_Message",templateFile:"/header/message.htm",streaming:true,format:"1"}},header_notice:{serviceParams:{data:{fuentes:"BWTAVISOS",fecha:moment().format("YYYYMMDD")}},viewOptions:{el:$("#menuBtnNotice"),templateId:"header_notice",templateFile:"/header/notice.htm",streaming:true,format:"2"}},clickOn:{serviceParams:{},viewOptions:{el:$("#clickOn"),templateId:"clikcOn",templateFile:"/clickOn/clickOn.htm"}},newsList_markUp:{serviceParams:{},viewOptions:{el:"#lightboxMessageNotice",templateId:"newsList_markUp",templateFile:"/newsList/markUp.htm"}},newsList_newsList:{serviceParams:{},viewOptions:{el:"#newsList_table",templateId:"newsList_newsList",templateFile:"/newsList/table.htm",niceScroll:{id:"newsListTable"},streaming:true,clsItemNoRead:"noRead",clsItemEven:"par",counterId:"newsListCounter"}},newsList_newsDetail:{serviceParams:{},viewOptions:{el:"#newsList_detail",templateId:"newsList_newsDetail",templateFile:"/newsList/detail.htm",niceScroll:{id:"niceScrollNewsDetailList"},itemIdPrefix:"homeNewsBasic"}},instrumentDetail_issuer_positions:{serviceParams:{data:{type:"4",header:"735,350,740,330,340,750,360"}},viewOptions:{el:"#instrumentDetail_positions",templateId:"instrumentDetail_issuer_positions",templateFile:"/instrumentDetail/issuer/positions.htm",highlightDescriptors:[],streaming:true}},instrumentDetail_issuer_multiples:{serviceParams:{data:{type:"4",header:"716,676,677,717,678,679,718,681,682,683,684,686,687,688,689,4221,4220,4224,4231,4230,4234,4233,4232,4235,4241,4240,4225,4223"}},viewOptions:{el:"#instrumentDetail_resume",templateId:"instrumentDetail_issuer_multiples",templateFile:"/instrumentDetail/issuer/multiples.htm",streaming:true}},instrumentDetail_news:{serviceParams:{searchFunc:"41",data:{fromDate:moment().subtract("d",70).format("YYYYMMDD"),sources:"EMISNET"}},viewOptions:{el:"#instrumentDetail_resume",templateId:"instrumentDetail_news",templateFile:"/instrumentDetail/base/news.htm",dataTable:{id:"newsTable"}},urlFileNode:"FicheroIB"},instrumentDetail_view:{serviceParams:{searchFunc:"41",data:{sources:"EMISNET;BCMRANALISIS",fromDate:moment().subtract("d",1e3).format("YYYYMMDD")},numberOfItems:14},viewOptions:{el:"#instrumentDetail_resume",templateId:"instrumentDetail_view",templateFile:"/instrumentDetail/base/view.htm",itemIdPrefix:"item",streaming:true,greenClsSources:["EMISNET"],blueClsSources:["BCMRANALISIS"]},urlFileNode:"FicheroIB",maxTitleLength:100},investmentDetail_chart1:{serviceParams:{data:{param:"I MX   ",header:"420,10103",type:"4"}},viewOptions:{el:"#chart1",templateId:"investmentDetail_chart1",templateFile:"/investmentDetail/chart.htm",filters:{chartType:{el:"#chart1FilterChartType",suffixCls:"1",config:"investmentDetail_filter_chartType"},period:{el:"#chart1FilterPeriod",suffixCls:"1",config:"investmentDetail_filter_period"},frequency:{el:"#chart1FilterFrequency",suffixCls:"1",config:"investmentDetail_filter_frequency"}}},charts:{intraday:{type:"line",frequency:"1",period:"1d"},daily:{type:"line",frequency:"d",period:"1y"}},saveOnServer:"1"},investmentDetail_chart2:{serviceParams:{data:{param:"I NY   ",header:"420,10103",type:"4"}},viewOptions:{el:"#chart2",templateId:"investmentDetail_chart2",templateFile:"/investmentDetail/chart.htm",filters:{chartType:{el:"#chart2FilterChartType",suffixCls:"2",config:"investmentDetail_filter_chartType"},period:{el:"#chart2FilterPeriod",suffixCls:"2",config:"investmentDetail_filter_period"},frequency:{el:"#chart2FilterFrequency",suffixCls:"2",config:"investmentDetail_filter_frequency"}}},charts:{intraday:{type:"line",frequency:"1",period:"1d"},daily:{type:"line",frequency:"d",period:"1y"}},saveOnServer:"1"},investmentDetail_chart3:{serviceParams:{data:{param:"I ME   ",header:"420,10103",type:"4"}},viewOptions:{el:"#chart3",templateId:"investmentDetail_chart3",templateFile:"/investmentDetail/chart.htm",filters:{chartType:{el:"#chart3FilterChartType",suffixCls:"3",config:"investmentDetail_filter_chartType"},period:{el:"#chart3FilterPeriod",suffixCls:"3",config:"investmentDetail_filter_period"},frequency:{el:"#chart3FilterFrequency",suffixCls:"3",config:"investmentDetail_filter_frequency"}}},charts:{intraday:{type:"line",frequency:"1",period:"1d"},daily:{type:"line",frequency:"d",period:"1y"}},saveOnServer:"1"},investmentDetail_filter_chartType:{serviceParams:{},viewOptions:{templateId:"investmentDetail_filter_chartType",templateFile:"/investmentDetail/moduleFilterChartType.htm"}},investmentDetail_filter_period:{serviceParams:{},viewOptions:{templateId:"investmentDetail_filter_period",templateFile:"/investmentDetail/moduleFilterPeriod.htm"}},investmentDetail_filter_frequency:{serviceParams:{},viewOptions:{templateId:"investmentDetail_filter_frequency",templateFile:"/investmentDetail/moduleFilterFrequency.htm"}},investmentChartDetail_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"investmentChartDetail_markUp",templateFile:"/investmentChartDetail/markUp.htm"}},investmentChartDetail_filter_chartType:{serviceParams:{},viewOptions:{templateId:"investmentChartDetail_filter_chartType",templateFile:"/investmentChartDetail/moduleFilterChartType.htm"}},investmentChartDetail_filter_period:{serviceParams:{},viewOptions:{templateId:"investmentChartDetail_filter_period",templateFile:"/investmentChartDetail/moduleFilterPeriod.htm"}},investmentChartDetail_filter_frequency:{serviceParams:{},viewOptions:{templateId:"investmentChartDetail_filter_frequency",templateFile:"/investmentChartDetail/moduleFilterFrequency.htm"}},positionDetail_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"positionDetail_markUp",templateFile:"/positionDetail/markUp.htm"}},positionDetail_positionTable:{serviceBCOMParams:{operationCode:"7",params:{data1:"D"}},serviceParams:{header:{columnado:"TAURO_DETALLEINVERSIONPOSICION",tipo:"1",defecto:"0"},data:{header:"1538,642,356,1562,250,410,390,9754"}},viewOptions:{el:"#positionDetail_positionTable",templateId:"positionDetail_positionTable",templateFile:"/positionDetail/positionTable.htm",streaming:true,highlightDescriptors:["1538","356","1562","250","390","410","9754"],dataTable:{id:"positionTable"},enableSort:true,sortConfig:{descriptor:IFB.Descriptors.Emisora.descriptor}},configHeaderSelector:{config:"header_selector",file:"investmentDetail_positionTable"}},orderBookDetail_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"orderBookDetail_markUp",templateFile:"/orderBookDetail/markUp.htm"}},orderBookDetail_orderBookTable:{serviceBCOMParams:{operationCode:"4",params:{data1:"4"}},serviceParams:{header:{columnado:"TAURO_DETALLEINVERSIONORDENES",tipo:"1",defecto:"0"},data:{header:"1538,642,356,1562,250,410,390,9754"}},viewOptions:{el:"#orderBookDetail_orderBookTable",templateId:"orderBookDetail_orderBookTable",templateFile:"/orderBookDetail/orderBookTable.htm",dataTable:{id:"orderBookTable"},enableSort:true,sortConfig:{descriptor:IFB.Descriptors.Bancomer_Estado.descriptor,direction:"desc"}},configHeaderSelector:{config:"header_selector",file:"investmentDetail_orderBookTable"}},header_selector:{serviceParams:{},viewOptions:{el:"#lightboxHeaderSelector",templateId:"header_selector",templateFile:"/base/headerSelector.htm"}},tutorial_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"tutorial_markUp",templateFile:"/tutorial/markUp.htm"}},instrumentList_moduleFilter:{serviceParams:{},viewOptions:{el:"#moduleFilterInstrumentList",templateId:"instrumentList_moduleFilter",templateFile:"/instrumentList/moduleFilter.htm"}},instrument_selector:{serviceParams:{},viewOptions:{el:"#lightboxInstrumentSelector",templateId:"instrument_selector",templateFile:"/base/instrumentSelector.htm"},numMinimum:5,searchTextKey:"componentInstrumentSelector_IndexSelected",itemsSelectedTextKey:"componentInstrumentSelector_IndexNoSelected",placeHolderText:"componentLabel_Placeholder_IndexSelector"},instrument_selector_maximized:{serviceParams:{},viewOptions:{el:"#lightboxInstrumentSelector",templateId:"instrument_selector_maximized",templateFile:"/base/instrumentSelector.htm"},numMinimum:8,searchTextKey:"componentInstrumentSelector_IndexSelected",itemsSelectedTextKey:"componentInstrumentSelector_IndexNoSelected"},instrument_selector_search_result:{serviceParams:{data:{header:"10103,40,25,9828,9829",sort:"10103"}},viewOptions:{el:"#instrument_selector_search_result",templateId:"instrument_selector_search_result",templateFile:"/base/instrumentSelectorSearchResults.htm",sortConfig:{descriptor:IFB.Descriptors.IFBShortName.descriptor}},pattern:"0;29;20(07)|20(25),{0},,I;I0;I1;I2;I3,0,,3,0,1"},footerMenu:{serviceParams:{},viewOptions:{el:"#footerMenu",templateId:"footerMenu",templateFile:"/base/menu.htm",maxItems:6}},workspace_layout_markUp1:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"workspace_layout_markUp1",templateFile:"/workspaceLayout/markUp1.htm"}},workspace_layout_options:{serviceParams:{},viewOptions:{templateId:"workspace_layout_options",templateFile:"/workspaceLayout/options.htm"}},workspace_layout_chart:{serviceParams:{data:{param:"I MX   ",header:"420,10103",type:"4"}},viewOptions:{templateId:"workspace_layout_chart",templateFile:"/workspaceLayout/chart.htm",filters:{chartType:{el:"#chartLayoutModuleFilterChartType",config:"workspaceLayout_filter_chartType",modulePrueba:1},period:{el:"#chartLayoutModuleFilterPeriod",config:"workspaceLayout_filter_period"},frequency:{el:"#chartLayoutModuleFilterFrequency",config:"workspaceLayout_filter_frecuency"}}},charts:{intraday:{type:"line",frequency:"1",period:"1d"},daily:{type:"line",frequency:"d",period:"1y"}}},workspace_layout_chart_maximized:{serviceParams:{data:{param:"I MX   ",header:"420,10103",type:"4"}},viewOptions:{templateId:"workspace_layout_chart_maximized",templateFile:"/workspaceLayout/chart_maximized.htm",filters:{chartType:{el:"#detailLayoutModuleChartFilterChartType",suffixCls:"1",config:"workspaceLayout_max_filter_chartType"},period:{el:"#detailLayoutModuleChartFilterPeriod",suffixCls:"1",config:"workspaceLayout_max_filter_period"},frequency:{el:"#detailLayoutModuleChartFilterFrequency",suffixCls:"1",config:"workspaceLayout_max_filter_frecuency"}}},charts:{intraday:{type:"line",frequency:"1",period:"1d"},daily:{type:"line",frequency:"d",period:"1y"}}},workspaceLayout_filter_chartType:{serviceParams:{},viewOptions:{templateId:"workspaceLayout_filter_chartType",templateFile:"/workspaceLayout/moduleFilterChartType.htm"}},workspaceLayout_filter_period:{serviceParams:{},viewOptions:{templateId:"workspaceLayout_filter_period",templateFile:"/workspaceLayout/moduleFilterPeriod.htm"}},workspaceLayout_filter_frecuency:{serviceParams:{},viewOptions:{templateId:"workspaceLayout_filter_frecuency",templateFile:"/workspaceLayout/moduleFilterFrecuency.htm"}},workspaceLayout_max_filter_chartType:{serviceParams:{},viewOptions:{templateId:"workspaceLayout_max_filter_chartType",templateFile:"/workspaceLayout/moduleMaxFilterChartType.htm"}},workspaceLayout_max_filter_period:{serviceParams:{},viewOptions:{templateId:"workspaceLayout_max_filter_period",templateFile:"/workspaceLayout/moduleMaxFilterPeriod.htm"}},workspaceLayout_max_filter_frecuency:{serviceParams:{},viewOptions:{templateId:"workspaceLayout_max_filter_frecuency",templateFile:"/workspaceLayout/moduleMaxFilterFrequency.htm"}},workspaces_module_indexes:{serviceParams:{},viewOptions:{templateId:"workspaces_module_indexes",templateFile:"/workspaceLayout/myInstruments.htm",configInstrumentList:"workspaces_module_indexes_table",titleTextKey:"componentLabel_ModuleWorkSpace_Option_Indexes"},pattern:"0;29;20(07)|20(25),{0},,I;I0;I1;I2;I3,0,,3,0,1",searchTextKey:"componentInstrumentSelector_IndexNoSelected",itemsSelectedTextKey:"componentInstrumentSelector_IndexSelected",placeHolderText:"componentLabel_Placeholder_IndexSelector"},workspaces_module_indexes_maximized:{serviceParams:{},viewOptions:{templateId:"workspaces_module_indexes_maximized",templateFile:"/workspaceLayout/myInstrumentsMaximized.htm",configInstrumentList:"workspaces_module_indexes_table",titleTextKey:"componentLabel_ModuleWorkSpace_Option_Indexes"},pattern:"0;29;20(07)|20(25),{0},,I;I0;I1;I2;I3,0,,3,0,1",searchTextKey:"componentInstrumentSelector_IndexNoSelected",itemsSelectedTextKey:"componentInstrumentSelector_IndexSelected",placeHolderText:"componentLabel_Placeholder_IndexSelector"},workspaces_module_indexes_table:{serviceParams:{data:{param:"I MX   ",type:"4",rt:"1",sort:"-1"},header:{columnado:"TAURO_INDICES_INDICES2",tipo:"1",defecto:"0",descriptoresAdicionales:"10103"}},viewOptions:{templateId:"workspaces_module_indexes_table",templateFile:"/instrumentList/table.htm",streaming:true},configHeaderSelector:{config:"header_selector",title:"componentTitle_UserHeader_MyIndexes"}},workspaces_module_issuers:{serviceParams:{},viewOptions:{templateId:"workspaces_module_issuers",templateFile:"/workspaceLayout/myInstruments.htm",configInstrumentList:"workspaces_module_Issuers_table",titleTextKey:"componentLabel_ModuleWorkSpace_Option_Issuer"},pattern:"0;29;20(07)|20(25),{0},,MX;M0;M1;M2;M3;M4;M5;M6;M7;M8;M9;5V,0,,3,0,1",searchTextKey:"componentInstrumentSelector_InstrumentNoSelected",itemsSelectedTextKey:"componentInstrumentSelector_InstrumentSelected"},workspaces_module_issuers_maximized:{serviceParams:{},viewOptions:{templateId:"workspaces_module_issuers_maximized",templateFile:"/workspaceLayout/myInstrumentsMaximized.htm",configInstrumentList:"workspaces_module_Issuers_table",titleTextKey:"componentLabel_ModuleWorkSpace_Option_Issuer"},pattern:"0;29;20(07)|20(25),{0},,MX;M0;M1;M2;M3;M4;M5;M6;M7;M8;M9;5V,0,,3,0,1",searchTextKey:"componentInstrumentSelector_InstrumentNoSelected",itemsSelectedTextKey:"componentInstrumentSelector_InstrumentSelected"},workspaces_module_Issuers_table:{serviceParams:{data:{param:"MXPEO00",type:"4",rt:"1",sort:"-1"},header:{columnado:"TAURO_ACCIONES2_PANORAMA2",tipo:"1",defecto:"0",descriptoresAdicionales:"10103"}},viewOptions:{templateId:"workspaces_module_Issuers_table",templateFile:"/instrumentList/table.htm",streaming:true},configHeaderSelector:{config:"header_selector",title:"componentTitle_UserHeader_MyIssuer"}},workspaces_module_investmentDetailTable:{serviceBCOMParams:{operationCode:"7",params:{data1:"D"}},serviceParams:{header:{columnado:"TAURO_DETALLEINVERSIONPOSICION",tipo:"1",defecto:"0"},data:{header:"1538,642,356,1562,250,410,390,9754"}},viewOptions:{el:"#investmentDetail_positionTable",templateId:"workspaces_module_investmentDetailTable",templateFile:"/workspaceLayout/position.htm",streaming:true,highlightDescriptors:["1538","356","1562","250","390","410","9754"],enableSort:true,sortConfig:{descriptor:IFB.Descriptors.Emisora.descriptor}},configHeaderSelector:{config:"header_selector",title:"componentTitle_UserHeader_PositionTable"}},workspaces_module_investmentDetailTable_maximized:{serviceBCOMParams:{operationCode:"7",params:{data1:"D"}},serviceParams:{header:{columnado:"TAURO_DETALLEINVERSIONPOSICION",tipo:"1",defecto:"0"},data:{header:"1538,642,356,1562,250,410,390,9754"}},viewOptions:{el:"#investmentDetail_positionTable",templateId:"workspaces_module_investmentDetailTable_maximized",templateFile:"/workspaceLayout/positionMaximized.htm",streaming:true,highlightDescriptors:["1538","356","1562","250","390","410","9754"],enableSort:true,sortConfig:{descriptor:IFB.Descriptors.Emisora.descriptor}},configHeaderSelector:{config:"header_selector",title:"componentTitle_UserHeader_PositionTable"}},workspaces_maximized_markUp:{serviceParams:{},viewOptions:{el:$("#mainContent"),templateId:"workspaces_maximized_markUp",templateFile:"/workspaceLayout/markUp_maximized.htm"}},workspaces_module_instruments_instrumentSelector:{serviceParams:{},viewOptions:{el:"#lightboxInstrumentSelector",templateId:"workspaces_module_instruments_instrumentSelector",templateFile:"/base/instrumentSelector.htm"}},workspaces_module_chart_instrumentSelector:{serviceParams:{},viewOptions:{el:"#lightboxInstrumentSelector",templateId:"workspaces_module_chart_instrumentSelector",templateFile:"/workspaceLayout/chartInstrumentSelector.htm"},pattern:"0;29;20(07)|20(25),{0},,I;I0;I1;I2;I3;MX;M0;M1;M2;M3;M4;M5;M6;M7;M8;M9;5V,0,,3,0,1"},chart_instrument_selector_search_result:{serviceParams:{data:{header:"10103,40,25,9828,9829",sort:"10103"}},viewOptions:{el:"#chart_instrument_selector_search_result",templateId:"chart_instrument_selector_search_result",templateFile:"/workspaceLayout/chartinstrumentSelectorSearchResults.htm",sortConfig:{descriptor:IFB.Descriptors.IFBShortName.descriptor}},pattern:"0;29;20(07)|20(25),{0},,I;I0;I1;I2;I3,0,,3,0,1"}}})})();BANCOMER.Utils.Filters={RESEARCH_CHANNEL:"1923",options:{marketSummary:{STOCKS:{key:"STOCKS",textKey:"componentLabel_ModuleFilterMarketSummary_Option_Stocks",mv:"RAMXC",constituentscode:"mx0001",constituentscodeDetail:"mx1002"},GLOBALMARKET:{key:"GLOBALMARKET",textKey:"componentLabel_ModuleFilterMarketSummary_Option_GlobalMarket",mv:"RAMXG",constituentscode:"mx0002",constituentscodeDetail:"mx0002"},STOCKS_GLOBALMARKET:{key:"STOCKS_GLOBALMARKET",textKey:"componentLabel_ModuleFilterMarketSummary_Option_StocksGlobalMarket",mv:"RAMXT",constituentscode:"mx0000",constituentscodeDetail:"mx0000"}},topFlop:{STOCKS:{key:"STOCKS",textKey:"componentLabel_ModuleFilterTopFlop_Option_Stocks",constituentscode:"mx0001",constituentscodeDetail:"mx1002"},GLOBALMARKET:{key:"GLOBALMARKET",textKey:"componentLabel_ModuleFilterTopFlop_Option_GlobalMarket",constituentscode:"mx0002",constituentscodeDetail:"mx0002"},STOCKS_GLOBALMARKET:{key:"STOCKS_GLOBALMARKET",textKey:"componentLabel_ModuleFilterTopFlop_Option_StocksGlobalMarket",constituentscode:"mx0000",constituentscodeDetail:"mx0000"},WARRANTS:{key:"WARRANTS",textKey:"componentLabel_ModuleFilterTopFlop_Option_Warrants",constituentscode:"mx0007",constituentscodeDetail:"mx0007"},ALL:{key:"ALL",textKey:"componentLabel_ModuleFilterTopFlop_Option_ALL",constituentscode:"mx1500",constituentscodeDetail:"mx1500"}},researchNews:{RESEARCH:{key:"RESEARCH",value:"research",textKey:"componentLabel_ModuleFilterResearchNews_Option_Research"},NEWS:{key:"NEWS",value:"news",textKey:"componentLabel_ModuleFilterResearchNews_Option_News"},RESEARCH_NEWS:{key:"RESEARCH_NEWS",value:"researchNews",textKey:"componentLabel_ModuleFilterResearchNews_Option_ResearchNews"}},investmentDetail:{STOCKS:{key:"STOCKS",textKey:"componentLabel_ModuleFilterInvestmentDetail_Option_Stocks",instrumentType:"V"},STOCKS_FUNDS:{key:"STOCKS_FUNDS",textKey:"componentLabel_ModuleFilterInvestmentDetail_Option_StocksFunds",instrumentType:""}},chartType:{LINE:{key:"LINE",textKey:"componentLabel_ModuleFilterChartType_Option_Line",type:IFB.Constants.Highcharts.ChartTypes.line},CANDLESTICK:{key:"CANDLESTICK",textKey:"componentLabel_ModuleFilterChartType_Option_Candlestick",type:IFB.Constants.Highcharts.ChartTypes.candlestick},OHLC:{key:"OHCL",textKey:"componentLabel_ModuleFilterChartType_Option_Ohlc",type:IFB.Constants.Highcharts.ChartTypes.ohlc},AREA:{key:"AREA",textKey:"componentLabel_ModuleFilterChartType_Option_Area",type:IFB.Constants.Highcharts.ChartTypes.area},COLUMN:{key:"COLUMN",textKey:"componentLabel_ModuleFilterChartType_Option_Column",type:IFB.Constants.Highcharts.ChartTypes.column}},chartPeriod:{P_1D:{key:"1D",textKey:"componentLabel_ModuleFilterPeriod_Option_1D",value:"1d",chartAvailability:["intraday"],frequencyAvailability:["1","5","10","30","60"]},P_1M:{key:"1M",textKey:"componentLabel_ModuleFilterPeriod_Option_1M",value:"1M",chartAvailability:["daily"],frequencyAvailability:["d","W","M"]},P_3M:{key:"3M",textKey:"componentLabel_ModuleFilterPeriod_Option_3M",value:"3M",chartAvailability:["daily"],frequencyAvailability:["d","W","M","Q"]},P_1Y:{key:"1Y",textKey:"componentLabel_ModuleFilterPeriod_Option_1Y",value:"1y",chartAvailability:["daily"],frequencyAvailability:["d","W","M","Q","S","Y"]},P_3Y:{key:"3Y",textKey:"componentLabel_ModuleFilterPeriod_Option_3Y",value:"3y",chartAvailability:["daily"],frequencyAvailability:["d","W","M","Q","S","Y"]},P_5Y:{key:"5Y",textKey:"componentLabel_ModuleFilterPeriod_Option_5Y",value:"5y",chartAvailability:["daily"],frequencyAvailability:["d","W","M","Q","S","Y"]}},chartFrequency:{F_1M:{key:"F_1M",textKey:"componentLabel_ModuleFilterFrequency_Option_1M",value:"1",chartAvailability:["intraday"],periodAvailability:["1d"]},F_5M:{key:"F_5M",textKey:"componentLabel_ModuleFilterFrequency_Option_5M",value:"5",chartAvailability:["intraday"],periodAvailability:["1d"]},F_10M:{key:"F_10M",textKey:"componentLabel_ModuleFilterFrequency_Option_10M",value:"10",chartAvailability:["intraday"],periodAvailability:["1d"]},F_30M:{key:"F_30M",textKey:"componentLabel_ModuleFilterFrequency_Option_30M",value:"30",chartAvailability:["intraday"],periodAvailability:["1d"]},F_60M:{key:"F_60M",textKey:"componentLabel_ModuleFilterFrequency_Option_60M",value:"60",chartAvailability:["intraday"],periodAvailability:["1d"]},DAILY:{key:"DAILY",textKey:"componentLabel_ModuleFilterFrequency_Option_Daily",value:"d",chartAvailability:["daily"],periodAvailability:["1M","3M","1y","3y","5y"]},WEEKLY:{key:"WEEKLY",textKey:"componentLabel_ModuleFilterFrequency_Option_Weekly",value:"W",chartAvailability:["daily"],periodAvailability:["1M","3M","1y","3y","5y"]},MONTHLY:{key:"MONTHLY",textKey:"componentLabel_ModuleFilterFrequency_Option_Monthly",value:"M",chartAvailability:["daily"],periodAvailability:["1M","3M","1y","3y","5y"]},QUARTERLY:{key:"QUATERLY",textKey:"componentLabel_ModuleFilterFrequency_Option_Quarterly",value:"Q",chartAvailability:["daily"],periodAvailability:["3M","1y","3y","5y"]},SEMESTERLY:{key:"SEMESTERLY",textKey:"componentLabel_ModuleFilterFrequency_Option_Semesterly",value:"S",chartAvailability:["daily"],periodAvailability:["1y","3y","5y"]},YEARLY:{key:"YEARLY",textKey:"componentLabel_ModuleFilterFrequency_Option_Yearly",value:"Y",chartAvailability:["daily"],periodAvailability:["1y","3y","5y"]}}}};BANCOMER.Utils.Helper={RESEARCH_CHANNEL:"1923",researchChannelEnable:undefined,showNotificationMessage:function(type,message,modal,buttons){var notyParams={layout:"center",text:message};this.showNotificationNoty(notyParams,type,modal,buttons)},showNotificationTemplate:function(type,htmlTemplate,modal,buttons,position){var notyParams={layout:position||"center",template:htmlTemplate};IFB.Utils.Helper.showNotificationNoty(notyParams,type,modal,buttons)},showNotificationNoty:function(notyParams,type,modal,buttons){notyParams.type=this.getClsContainerNotification(type)||"success";notyParams.modal=modal||"false";var classButton;var self=this;if(buttons){var buttonsNotify=[];_.each(buttons,function(button,index){buttonsNotify.push({addClass:button.cls||self.getClsButtonNotification(index,buttons.length),text:button.text,onClick:function($noty){$noty.close();if(button.callback){button.callback()}}})});notyParams.buttons=buttonsNotify}noty(notyParams)},getClsContainerNotification:function(type){return["error","warning"].indexOf(type)!==-1?type+"_"+BANCOMER.Launcher.getOS():type},getClsContainerMessageNotification:function(){return"ifb-contNoty"+BANCOMER.Launcher.getOS()},getClsContainerMessageNotificationWorkSpace:function(){return"noty_"+BANCOMER.Launcher.getOS()+"_btn"},getClsButtonNotification:function(index,numButtons){var cls="btnNotification";var os=BANCOMER.Launcher.getOS();if(numButtons===1){cls+="Center_"+os}else if(index===0&&numButtons===2){cls+="Left_"+os}else if(index===1&&numButtons===2){cls+="Right_"+os}return cls},showNotificationWorkSpaceName:function(type,errorInfo,modal,buttons){BANCOMER.Utils.Helper.showNotificationTemplate(type,this.getNotificationTemplateWorkSpace(BANCOMER.CULTURETEXT.t("noty_WorkSpace_NameChange_Title"),errorInfo),modal,buttons,"topCenter")},showNotificationIncomingMessage:function(type,errorInfo,modal,buttons){BANCOMER.Utils.Helper.showNotificationTemplate(type,this.getNotificationTemplate(BANCOMER.CULTURETEXT.t("noty_Warning_Message"),errorInfo),modal,buttons)},showNotificationWarning:function(type,errorInfo,modal,buttons){BANCOMER.Utils.Helper.showNotificationTemplate(type,this.getNotificationTemplate(BANCOMER.CULTURETEXT.t("noty_Warning_Title"),errorInfo),modal,buttons)},showNotificationError:function(type,errorInfo,modal,buttons){BANCOMER.Utils.Helper.showNotificationTemplate(type,this.getNotificationTemplate(BANCOMER.CULTURETEXT.t("noty_Error_Title"),errorInfo),modal,buttons)},getNotificationTemplate:function(title,message){var clsMessageContainer=this.getClsContainerMessageNotification();var htmlTemplate='<div class="'+clsMessageContainer+'">'+'<section class="contTop">'+'<div class="icoInfo"></div>'+"<h3>"+title+"</h3>"+"</section>"+'<section class="contTxtWarning">'+'<div class="txtWarning">'+message+"</div>"+"</section>"+"</div>";return htmlTemplate},getNotificationTemplateWorkSpace:function(title,message){var clsMessageContainer=this.getClsContainerMessageNotification();var htmlTemplate='<div class="'+clsMessageContainer+'">'+'<section class="contTopWorkSpace">'+"<h3>"+title+"</h3>"+"</section>"+'<section class="contTxtWorkSpace">'+'<div class="txtWarning">'+"Nombre:"+"</div>"+message+"</section>"+"</div>";return htmlTemplate},hash:function(str){var hash=5381;var i=0;for(i=0;i<str.length;i++){char=str.charCodeAt(i);hash=(hash<<5)+hash+char}return hash},getUserFiles:function(session,type,next){var self=this;var mgService=new IFB.Services.Management;mgService.loadUserFiles({session:session||IFB.Services.Session,type:type,transform:"0"},function(response){self._readUserFiles(response,type,next)})},_readUserFiles:function(response,type,next){var responseJson;var typeNode;var files=[];if(response){responseJson=JSON.parse(response);if(responseJson.status!==undefined&&responseJson.status.ok){if(responseJson.answer.Files[type]){typeNode=responseJson.answer.Files[type];if(typeNode.File){if(_.isArray(typeNode.File)){_.each(typeNode.File,function(file,index){files.push(file)})}else{files.push(typeNode.File)}}}if(_.isFunction(next)){next(files)}}}},createNiceScroll:function(component,niceScrollId){var height;var niceScrollElement=$("#"+niceScrollId,component.config.viewOptions.el);if(niceScrollElement){height=niceScrollElement.css("height");niceScrollElement.css("height",height);niceScrollElement.niceScroll({touchbehavior:true})}},hasResearchChannel:function(callbackSuccess,callbackFailure,context){var mgService=new IFB.Services.Management;var self=this;var channel="CS"+this.RESEARCH_CHANNEL;if(_.isUndefined(self.researchChannelEnable)){mgService.getProfile({session:IFB.Services.Session,canalessubcanales:this.RESEARCH_CHANNEL},function(response){var responseJson=JSON.parse(response);if(responseJson.answer!==undefined&&responseJson.status!==undefined&&responseJson.status.ok){if(!_.isNull(responseJson.answer.PROFILE.CS)&&responseJson.answer.PROFILE.CS[channel]==="1"){self.researchChannelEnable=true;callbackSuccess(context)}else{self.researchChannelEnable=false;callbackFailure(context)}}else{self.researchChannelEnable=false;callbackFailure(context)}},this)}else if(self.researchChannelEnable){callbackSuccess(context)}else{callbackFailure(context)}},hasStreamingEnabled:function(){return(BANCOMER.Defaults.Application.streaming||"1")==="1"},setRefreshIcon:function(){if(this.hasStreamingEnabled()){$(".iconRefresh").hide()}else{$(".iconRefresh").show()}},closeFooterMenu:function(){$("#clickableLevel").hide();$("#footerMenu").hide("slow")},openFooterMenu:function(){$("#footerMenu").show("slow")},chartIntradayTooltipFormatter:function(view){return function(){var html="";var difCSS="";var point=this;var serieType=point.points[0].series.type;var data=this.points[0].point;if(serieType===IFB.Constants.Highcharts.ChartTypes.candlestick||serieType===IFB.Constants.Highcharts.ChartTypes.ohlc){html='<section class="ifb-tooltipGraph">'+'<div class="time">'+Highcharts.dateFormat("%H:%M",point.x)+"</div>"+'<div class="last">O: '+Highcharts.numberFormat(data.open,view.getDecimals(),accounting.settings.number.decimal,accounting.settings.number.thousand)+"</div>"+'<div class="last">H: '+Highcharts.numberFormat(data.high,view.getDecimals(),accounting.settings.number.decimal,accounting.settings.number.thousand)+"</div>"+'<div class="last">L: '+Highcharts.numberFormat(data.low,view.getDecimals(),accounting.settings.number.decimal,accounting.settings.number.thousand)+"</div>"+'<div class="last">C: '+Highcharts.numberFormat(data.close,view.getDecimals(),accounting.settings.number.decimal,accounting.settings.number.thousand)+"</div>"+"</section>"}else{html='<section class="ifb-tooltipGraph">'+'<div class="last">'+Highcharts.numberFormat(point.y,view.getDecimals(),accounting.settings.number.decimal,accounting.settings.number.thousand)+"</div>"+'<div class="time">'+Highcharts.dateFormat("%H:%M",point.x)+"</div>"+"</section>"}return html}},chartDailyTooltipFormatter:function(view){return function(){var html="";var difCSS="";var point=this;var serieType=point.points[0].series.type;var data=this.points[0].point;if(serieType===IFB.Constants.Highcharts.ChartTypes.candlestick||serieType===IFB.Constants.Highcharts.ChartTypes.ohlc){html='<section class="ifb-tooltipGraph">'+'<div class="time">'+Highcharts.dateFormat("%d/%m/%y",point.x)+"</div>"+'<div class="last">O: '+Highcharts.numberFormat(data.open,view.getDecimals(),accounting.settings.number.decimal,accounting.settings.number.thousand)+"</div>"+'<div class="last">H: '+Highcharts.numberFormat(data.high,view.getDecimals(),accounting.settings.number.decimal,accounting.settings.number.thousand)+"</div>"+'<div class="last">L: '+Highcharts.numberFormat(data.low,view.getDecimals(),accounting.settings.number.decimal,accounting.settings.number.thousand)+"</div>"+'<div class="last">C: '+Highcharts.numberFormat(data.close,view.getDecimals(),accounting.settings.number.decimal,accounting.settings.number.thousand)+"</div>"+"</section>"}else{html='<section class="ifb-tooltipGraph">'+'<div class="last">'+Highcharts.numberFormat(point.y,view.getDecimals(),accounting.settings.number.decimal,accounting.settings.number.thousand)+"</div>"+'<div class="time">'+Highcharts.dateFormat("%d/%m/%y",point.x)+"</div>"+"</section>"}return html}},createDataTable:function(config){var configDataTable;var dataTableEl;var dataTable;configDataTable=config.viewOptions.dataTable;if(!configDataTable){return}dataTableEl=$("#"+configDataTable.id,config.viewOptions.el);if(!dataTableEl){return}dataTable=dataTableEl.dataTable(this.getConfigDataTable(dataTableEl,configDataTable));if(config.viewOptions.dataTable.fixedColumns){new $.fn.dataTable.FixedColumns(dataTable,configDataTable.fixedColumns)}},getConfigDataTable:function(dataTableEl,configDataTable){var factorAdjust=0;var height=configDataTable.scrollHeight||dataTableEl.parent().height()-dataTableEl.find("thead").height()+factorAdjust;var config={paging:false,searching:false,ordering:false,info:false,scrollY:height+"px",scrollX:"100%",scrollCollapse:true,language:{emptyTable:BANCOMER.CULTURETEXT.t("dataTable_ErrorMessage_EmptyTable")}};return config},getClickOnDocumentsFixedParams:function(){return{CLICKON_CODCOMPANY:"1",CLICKON_CODPRODUCT:"0084",CLICKON_CODSELLER:"59",CLICKON_EMAILLIST:"administracion@infobolsa.es"}},openExternalFile:function(url){var params={};if(url){params.data1=url;BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.AperturaFichero,params,function(response){if(response.answer!==undefined&&response.status!==undefined&&response.status.ok&&params.id_testigo===response.answer.id_testigo){console.log("OpenFile",url,"OK")}})}},showMessageErrorSendOrderBCOM:function(response){var message=response&&response.status&&response.status.reason?"("+response.status.reason+")":"";var buttons=[{text:BANCOMER.CULTURETEXT.t("noty_ErrorBCOM_Btn_Ok")}];IFB.Utils.Helper.showNotificationWarning("warning",BANCOMER.CULTURETEXT.t("noty_ErrorBCOM_Msg")+message,true,buttons)},resetScrollTo:function(){$(":focus").blur();setTimeout(function(){window.scrollTo(0,0)},0)},getWorkspaceDefaultTitle:function(position){return BANCOMER.CULTURETEXT.t("componentTitle_Workspace")+" "+position}};IFB.Utils.Helper.showNotificationMessage=function(type,message,modal,buttons){return BANCOMER.Utils.Helper.showNotificationMessage(type,message,modal,buttons)};IFB.Utils.Helper.showNotificationNoty=function(notyParams,type,modal,buttons){return BANCOMER.Utils.Helper.showNotificationNoty(notyParams,type,modal,buttons)};IFB.Utils.Helper.showNotificationTemplate=function(type,htmlTemplate,modal,buttons){return BANCOMER.Utils.Helper.showNotificationTemplate("",htmlTemplate,modal,buttons)};IFB.Utils.Helper.showNotificationWarning=function(type,htmlTemplate,modal,buttons){return BANCOMER.Utils.Helper.showNotificationWarning(type,htmlTemplate,modal,buttons)};IFB.Utils.Helper.showNotificationError=function(type,htmlTemplate,modal,buttons){return BANCOMER.Utils.Helper.showNotificationError(type,htmlTemplate,modal,buttons)};IFB.Utils.Helper.hash=function(str){return BANCOMER.Utils.Helper.hash(str)};IFB.Utils.Helper.getUserFiles=function(str){return BANCOMER.Utils.Helper.getUserFiles(str)};IFB.Utils.Helper.chartIntradayTooltipFormatter=function(view){return BANCOMER.Utils.Helper.chartIntradayTooltipFormatter(view)};IFB.Utils.Helper.chartDailyTooltipFormatter=function(view){return BANCOMER.Utils.Helper.chartDailyTooltipFormatter(view)};IFB.Utils.Helper.getClickOnDocumentsFixedParams=function(){return BANCOMER.Utils.Helper.getClickOnDocumentsFixedParams()};BANCOMER.Utils.Preferences={config:{researchNews:["home_ResearchNews","researchNews_ResearchNews"]},preferences:{modules:{},application:{},workspaces:{}},defaults:{loadOnInitialize:true,file:"_~PREFERENCES",type:"PRF",replace:"1",waitForSaveMillis:500,transform:"0"},initialize:function(options,next){_.defaults(this,options||{},this.defaults);_.extend(this,Backbone.Events);this.mgService=new IFB.Services.Management({});this.save=this.waitForSaveMillis>0?_.debounce(this._save,this.waitForSaveMillis):this._save;if(this.loadOnInitialize){this.load(next)}else{next(null,this)}},load:function(next){var self=this;this.mgService.loadFile({session:this.session||IFB.Services.Session,file:this.file,type:this.type,transform:this.transform},function(response){try{self.readPreferencesFromFile(response,self);if(_.isFunction(next)){next(null,self,response)}}catch(error){if(_.isFunction(next)){next(error,self,response)}}})},_save:function(next){var self=this;this.mgService.saveFile({session:this.session||IFB.Services.Session,file:this.file,type:this.type,replace:this.replace,content:this.formatContent(self.preferences),transform:this.transform},function(response){if(_.isFunction(next)){next(null,self,response)}})},readPreferencesFromFile:function(response,self){var responseJson=JSON.parse(response);if(!IFB.Utils.Helper.getObjectValueIfExists(responseJson,"status.ok")){throw new Error("Invalid response")}self.preferences=responseJson.answer;self.preferences.workspaces=self.preferences.workspaces||{}},formatContent:function(preferences){preferences=preferences||{modules:{}};return JSON.stringify(preferences)},addPreferenceModuleServiceParam:function(configId,param){this.preferences.modules=this.preferences.modules||{};this.preferences.modules[configId]=this.preferences.modules[configId]||{};this.preferences.modules[configId].serviceParams={data:{param:param}}},addPreferenceModuleServiceParamType:function(configId,param,type){this.preferences.modules=this.preferences.modules||{};this.preferences.modules[configId]=this.preferences.modules[configId]||{};this.preferences.modules[configId].serviceParams={data:{param:param,type:type}}},addPreferenceModuleViewOptions:function(configId,viewOptions){this.preferences.modules=this.preferences.modules||{};this.preferences.modules[configId]=this.preferences.modules[configId]||{};this.preferences.modules[configId].viewOptions=viewOptions},addPreferenceApplication:function(configId,preferences){this.preferences.application=this.preferences.application||{};this.preferences.application[configId]=preferences},getPreferenceApplication:function(configId){return this.preferences.application&&!_.isUndefined(this.preferences.application[configId])?this.preferences.application[configId]:undefined},addPreferencesModuleResearchNews:function(viewOptions){var self=this;_.each(this.config.researchNews,function(configId){self.addPreferenceModuleViewOptions(configId,viewOptions)})},addPreferencesModuleInstrumentList:function(module,mv,constituentscode){if(module==="marketSummary"){this.addPreferenceModuleServiceParam("home_TopFlopPieChart",mv);this.addPreferenceModuleServiceParam("home_multipleTopFlopActive",constituentscode)}else if(module==="topFlop"){this.addPreferenceModuleServiceParam("home_multipleTopFlopHorizontalList",constituentscode)}},addPreferencesModule:function(configId,key,values){this.preferences.modules=this.preferences.modules||{};this.preferences.modules[configId]=this.preferences.modules[configId]||{};this.preferences.modules[configId][key]=values},getWorkspaceObject:function(titleValue,position,layout,modules){return{title:titleValue||BANCOMER.Utils.Helper.getWorkspaceDefaultTitle(position),layout:layout,modules:modules||{}}},updateModuleWorkspace:function(workspaceId,moduleId,moduleData){this.preferences.workspaces=this.preferences.workspaces||{};this.preferences.workspaces[workspaceId]=this.preferences.workspaces[workspaceId]||{};this.preferences.workspaces[workspaceId].modules[moduleId]=this.preferences.workspaces[workspaceId].modules[moduleId]||{};this.preferences.workspaces[workspaceId].modules[moduleId]=moduleData;this.save()},saveWorkspace:function(id,workspace){this.preferences.workspaces[id]=workspace;this.save()}};BANCOMER.Utils.Trader={orderTypeOptions:{LIMIT:{textKey:"orderType_Limit",value:"L"}},sideOptions:{BUY:{text:"Comprar",value:"Compra"},SELL:{text:"Vender",value:"Venta"}},orderStatus:{PENDING:{text:"Pendiente",value:"pe"},CANCELED:{text:"Cancelada",value:"c"},EXECUTED:{text:"Ejecutada",value:"m"}},actionReceiptOptions:{BUY:{value:"1"},SELL:{value:"2"},CANCEL:{value:"3"}},_findOrderType:function(orderType){var orderTypeText=_.find(this.orderTypeOptions,function(orderTypeElement){return orderTypeElement.value===orderType},this);return orderTypeText},getOrderTypeText:function(orderType){var orderTypeText=this._findOrderType(orderType);return orderTypeText.text},getOrderType:function(orderType){var orderTypeText=this._findOrderType(orderType);return orderTypeText.value},getSideText:function(side){var sideText=_.find(this.sideOptions,function(sideElement){return sideElement.value===side},this);return sideText.text},_findOrderStatus:function(status){var orderStatus=_.find(this.orderStatus,function(orderStatusElement){return orderStatusElement.value===status},this);return orderStatus},getOrderStatus:function(status){var orderStatus=this._findOrderStatus(status);return orderStatus.value},getOrderStatusText:function(status){var orderStatus=this._findOrderStatus(status);return orderStatus.text},isTradable:function(MV){var actions=IFB.Utils.ProductConfig.getAcciones();var tradableMarkets="";var index=-1;if(actions&&actions.Accion&&actions.Accion[0]&&MV){tradableMarkets=actions.Accion[0].LM.split(",");index=_.indexOf(tradableMarkets,MV.substring(0,2))}return index>=0}};IFB.Descriptors=$.extend(true,IFB.Descriptors,{IFBShortName:{css:"name"},DateOrTimeSituationMessage:{formatFunction:{name:"getDateOrTime",params:{onlySituationMessage:true}},css:""},Last:{formatFunction:[{name:"getLast"},{name:"getCurrencySymbol"}],css:"last",topFlopColored:true},ChangePercent:{formatFunction:{name:"getChangePercent",params:{positiveSign:""}},topFlopColored:true,css:"difP"},Trend:{css:"arrow",topFlopColored:true,formatFunction:{name:"getEmptyDivData"}},Emisora:{css:"name"},Date:{css:"date"},Time:{css:"time"},AskVolume:{css:"volSell"},BidVolume:{css:"volBuy"},AskPrice:{css:"priceSell"},BidPrice:{css:"priceBuy"},Cash:{css:"amount"},Serie:{css:"serie"},Buy:{css:"buy",formatFunction:function(){return"C"}},Sell:{css:"sell",formatFunction:function(){return"V"}},Bancomer_Estado:{formatFunction:{name:"getEstado"}},Bancomer_Accion_CancelarOrden:{css:"cancel"},Bancomer_Accion_DetalleOrden:{css:"detail"}});BANCOMER.Components.Base=IFB.Class(IFB.Components.Base,{initialize:function(options){this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.Base.parent.initialize.call(this,options)}});BANCOMER.Components.BoletaConfirmation=IFB.Class(BANCOMER.Components.Base,{view:undefined,model:undefined,create:function(){var self=this;this.configure();this.model=this.config.viewOptions.model;this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.Static(this.config.viewOptions);this.registerView(this.view);this._addEvents();this.view.reset()},_addEvents:function(){this.on("sendOrderConfirmationClick",this.sendConfirmationOrderClick,this)},sendConfirmationOrderClick:function(){this.trigger("onSendOrderConfirmation",this.model.getConfirmationToTrader())}});BANCOMER.Components.BoletaForm=IFB.Class(BANCOMER.Components.Base,{dataInstrument:{},view:undefined,model:undefined,create:function(){var self=this;this.configure();this._getInstrumentSituation(function(dataInstrument){self.dataInstrument=dataInstrument;self._create()})},_create:function(){var self=this;this.model=new BANCOMER.Models.BoletaOrder({dataInstrument:this.dataInstrument,side:this.options.side});this.model.load=function(){self._getInstrumentSituation(function(dataInstrument){self.model.set("price",self.model.getSide()===BANCOMER.Utils.Trader.sideOptions.BUY.value?Number(dataInstrument[IFB.Descriptors.AskPrice.descriptor]):Number(dataInstrument[IFB.Descriptors.BidPrice.descriptor]));self.view.reset()})};this.model.options=this.config;this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.BoletaForm(this.config.viewOptions);this.registerView(this.view);this._addEvents(this.view);this.view.reset()},_addEvents:function(view){this.on("sendOrderClick",view.onSendOrderClick,view);view.on("cancelOrderClick",this.onCancelOrderClick,this);this.on("sharesKeyDown",view.sharesKeyDown,view);this.on("sharesKeyUp",view.sharesKeyUp,view);this.on("sharesFocusIn",view.sharesFocusIn,view);this.on("sharesFocusOut",view.sharesFocusOut,view);this.on("sharesClick",view.sharesClick,view);this.on("priceKeyDown",view.priceKeyDown,view);this.on("priceKeyUp",view.priceKeyUp,view);this.on("priceFocusIn",view.priceFocusIn,view);this.on("priceFocusOut",view.priceFocusOut,view);this.on("priceChange",view.onPriceChange,view);this.on("priceClick",view.onPriceClick,view)},onCancelOrderClick:function(){this.trigger("cancelOrderClick",this)},_getInstrumentSituation:function(next){var self=this;var configInstrumentSituation={sesion:IFB.Services.Session,param:self.options.mv,type:self.config.serviceParams.data.type,header:self.config.serviceParams.data.header,rt:self.config.serviceParams.data.rt};this.dbService.loadDataLV(configInstrumentSituation,function(result){var json=JSON.parse(result);if(json.answer&&json.answer.LV){var instrument=json.answer.LV.V;next(instrument)}})}});BANCOMER.Components.BoletaMenu=IFB.Class(BANCOMER.Components.Base,{view:undefined,model:undefined,create:function(){var self=this;this.configure();this.model=new Backbone.Model(this.config);this.model.load=function(){self.view.reset()};this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.Static(this.config.viewOptions);this.registerView(this.view);this._addEvents();this.view.reset()},_addEvents:function(){this.on("sendChangeSideClick",this.sendChangeSideClick,this)},sendChangeSideClick:function(eventData,target){if(eventData.side!==this.config.viewOptions.side){this.trigger("sendChangeSide",eventData.side)}}});BANCOMER.Components.BoletaReceipt=IFB.Class(BANCOMER.Components.Base,{view:undefined,model:undefined,create:function(){var self=this;this.configure();this.model=this.config.viewOptions.model;this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.Static(this.config.viewOptions);this.registerView(this.view);this._addEvents();this.view.reset()},_addEvents:function(){this.on("sendOrderReceiptSaveClick",this.sendOrderReceiptSaveClick,this);this.on("sendOrderReceiptMailClick",this.sendOrderReceiptMailClick,this);this.on("orderReceiptTooltipClick",this.showHideReceiptToolTip,this)},sendOrderReceiptSaveClick:function(){this.trigger("sendOrderReceiptSave",this.model.getReceiptSaveToTrader(this.getActionReceipt()))},sendOrderReceiptMailClick:function(){this.trigger("sendOrderReceiptMail",this.model.getReceiptMailToTrader(this.getActionReceipt()))},showHideReceiptToolTip:function(){$("#orderReceiptTooltip",this.$el).toggle()},getActionReceipt:function(){var side=this.model.getSide();return side===BANCOMER.Utils.Trader.sideOptions.BUY.value?BANCOMER.Utils.Trader.actionReceiptOptions.BUY.value:BANCOMER.Utils.Trader.actionReceiptOptions.SELL.value}});BANCOMER.Components.ChartColumnInstrumentList=IFB.Class(IFB.Components.ChartColumnInstrumentList,{initialize:function(options){this._templates=BANCOMER.Defaults.Templates;IFB.Components.ChartColumnInstrumentList.parent.initialize.call(this,options)}});BANCOMER.Components.ChartDaily=IFB.Class(IFB.Components.ChartDaily,{initialize:function(options){this._templates=BANCOMER.Defaults.Templates;IFB.Components.ChartDaily.parent.initialize.call(this,options)}});BANCOMER.Components.ChartIndexes=IFB.Class(BANCOMER.Components.Base,{view:undefined,model:undefined,initialize:function(options){this._templates=IFB.Defaults.Templates;BANCOMER.Components.ChartIndexes.parent.initialize.call(this,options)},create:function(){var self=this;this.configure("InstrumentList","/wtdb/LoadDataLV");this.model=new IFB.Collections.InstrumentList(this.config);this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.ChartIndexes(this.config.viewOptions);this.registerView(this.view);this.model.load()}});BANCOMER.Components.ChartInstrumentSelector=IFB.Class(BANCOMER.Components.Base,{view:undefined,model:undefined,searchComponent:undefined,activationDelay:1e3,activationTextLenght:3,numMinimum:0,searchPattern:"",initialize:function(options){this._templates=IFB.Defaults.Templates;BANCOMER.Components.InstrumentSelector.parent.initialize.call(this,options)},create:function(){this.configure();this.model=new Backbone.Model(this.config);this.model.title=this.options.title;this.numMinimum=this.options.numMinimum||this.config.numMinimum||0;this.searchPattern=this.options.pattern||this.config.pattern||"";this.model.models=this.options.models||[];this.model.numMinimum=this.numMinimum;this.model.searchTextKey=this.options.searchTextKey||this.config.searchTextKey||"";this.model.itemsSelectedTextKey=this.options.itemsSelectedTextKey||this.config.itemsSelectedTextKey||"";this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.Static(this.config.viewOptions);this.registerView(this.view);this._addEvents();this.view.reset()},_addEvents:function(){this.on("rendered",this.onRender,this)},initializeSearcher:function(){var self=this;var message;this.initializeSearchComponent();$("#chart_instrument_selector_search").on("click",function(){$("#chart_instrument_selector_search").val("");if(self.searchComponent&&self.searchComponent.view){self.searchComponent.view.$el.html("")}});$("#chart_instrument_selector_search").on("keydown",_.debounce(function(){message=escape($("#chart_instrument_selector_search").val());if(message.length>=self.activationTextLenght){self.showSearchResults(message)}},self.activationDelay))},showSearchResults:function(message){if(message&&message!==""){this.searchComponent.model.instrumentsMarked=this.model.models;this.searchComponent.search(message);BANCOMER.Utils.Helper.resetScrollTo()}},isEnterKeyCode:function(event){return event.keyCode===13},onRender:function(){this.initializeSearcher();this.initializeNestableComponent();this.attachDeleteEvent();this.attachAddEvent();this.attachChangeEvent()},initializeSearchComponent:function(){var self=this;this.searchComponent=new BANCOMER.Components.Search({config:"chart_instrument_selector_search_result",view:{el:$("#chart_instrument_selector_search_result")},instrumentsMarked:self.model.models,pattern:self.searchPattern});this.searchComponent.on("rendered",function(){self.searchComponent.view.$el.show();self.attachDeleteEvent();self.attachAddEvent();self.attachChangeEvent()});this.searchComponent.on("updateChartInstrument",this.updateChartInstrument,this)},updateChartInstrument:function(eventData){var mv=eventData.mv;this.trigger("updateChart",{param:mv,type:"4"},this)},initializeNestableComponent:function(){$("#userInstruments").nestable({maxDepth:1,group:1})},attachDeleteEvent:function(){var self=this;$("#userInstruments .dd-item .delete").off("click");$("#userInstruments .dd-item .delete").on("click",function(){self.deleteInstrument(this)})},attachChangeEvent:function(){var self=this;$("#userInstruments").on("change",function(){self.refreshIconGraph()})},refreshIconGraph:function(){var self=this;$("#userInstruments .dd-item .icoColGraph").remove();$("#userInstruments .dd-item.dd3-item").each(function(index){if(self.numMinimum!==0&&index<self.numMinimum){$('<div class="icoColGraph"></div>').insertAfter($(this).children(":first"))}})},deleteInstrument:function(item){var self=this;var numItems=$("li","#userInstruments").length;var buttons=[];var txt="";if(numItems>this.numMinimum){buttons=[{text:BANCOMER.CULTURETEXT.t("noty_Btn_InstrumentSelector_Delete_Accept"),callback:function(){self.deleteItemModel($(item.parentNode).attr("data-id"));self.deleteItem(item)}},{text:BANCOMER.CULTURETEXT.t("noty_Btn_InstrumentSelector_Delete_Cancel")}];txt=BANCOMER.CULTURETEXT.t("noty_Txt_InstrumentSelector_Delete")}else{buttons=[{text:BANCOMER.CULTURETEXT.t("noty_Btn_InstrumentSelector_Delete_Accept")}];txt=BANCOMER.CULTURETEXT.t("noty_Txt_InstrumentSelector_Delete_NumMinimum")+self.numMinimum}IFB.Utils.Helper.showNotificationWarning("warning",txt,true,buttons)},attachAddEvent:function(){var self=this;$("#category .dd-item .add").off("click");$("#category .dd-item .add").on("click",function(event){self.addItem(this);self.addItemModel($(this.parentNode).attr("data-id"));$(this).hide();event.stopPropagation()})},addItemModel:function(mv){var itemModel=this.searchComponent.model.get(mv);if(itemModel){this.model.models.push(itemModel)}},deleteItemModel:function(mv){this.model.models=_.filter(this.model.models,function(model){return model.id!==mv})},addItem:function(item){var self=this;var id=$(item).parent().attr("data-id");var name=$(item).next().html();var htmlItem='<li class="dd-item dd3-item" data-id="'+id+'">'+'<div class="delete"></div>'+'<div class="dd-handle dd3-handle">'+'<div class="contLines"><div></div><div></div><div></div></div>'+"</div>"+'<div class="dd3-content">'+name+"</div>"+"</li>";if($("#userInstruments .dd-list div.delete").length>0){$("#userInstruments .dd-list div.delete").last().parent().after(htmlItem)}else{$("#userInstruments .dd-list").append(htmlItem)}self.attachDeleteEvent();self.refreshIconGraph()},deleteItem:function(item){var id=$(item).parent().attr("data-id");$("#category .dd-item[data-id='"+id+"'] .add").show();$(item).parent().remove();this.refreshIconGraph()},saveUserInstruments:function(){var mvs=this.serializeInstrument();this.trigger("userInstrumentsSaved",{param:mvs,type:"4"},this)},serializeInstrument:function(){var self=this;var mvs=[];$("li","#userInstruments").each(function(){mvs.push($(this).attr("data-id"))});return mvs.join()},destroy:function(){if(this.searchComponent){this.searchComponent.destroy()}BANCOMER.Components.InstrumentSelector.parent.destroy()},reload:function(){if(this.searchComponent){this.searchComponent.reload()}BANCOMER.Components.InstrumentSelector.parent.reload()}});BANCOMER.Components.ChartIntraday=IFB.Class(IFB.Components.ChartIntraday,{initialize:function(options){this._templates=BANCOMER.Defaults.Templates;IFB.Components.ChartIntraday.parent.initialize.call(this,options)}});BANCOMER.Components.ClickOn=IFB.Class(IFB.Components.ClickOn,{initialize:function(options){this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.ClickOn.parent.initialize.call(this,options)}});BANCOMER.Components.HeaderSelector=IFB.Class(IFB.Components.HeaderSelector,{initialize:function(options){this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.HeaderSelector.parent.initialize.call(this,options)},serializeHeader:function(){var self=this;var jsonUserHeader={HDU:{Data:{Header:{ID:this.options.service.columnado,Col:[],numLeftFixedColumns:this.model.userHeader.numLeftFixedColumns}}}};$("li","#userHeader").each(function(){var model=self.model.get($(this).attr("data-id"));jsonUserHeader.HDU.Data.Header.Col=jsonUserHeader.HDU.Data.Header.Col||[];if(model){jsonUserHeader.HDU.Data.Header.Col.push(model.attributes)}});return JSON.stringify(jsonUserHeader)}});BANCOMER.Components.InstrumentDetail=IFB.Class(IFB.Components.InstrumentDetail,{initialize:function(options){this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.InstrumentDetail.parent.initialize.call(this,options)},_doCreate:function(){var self=this;this.model=new(IFB.Collections.InstrumentList.extend({parse:function(){return self._parseDataPreopeningState(IFB.Collections.InstrumentList.prototype.parse.apply(this,arguments))}}))(this.config);this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.InstrumentDetail(this.config.viewOptions);this.registerView(this.view);this.model.load()}});BANCOMER.Components.InstrumentDetailCharts=IFB.Class(IFB.Components.InstrumentDetail,{currentChart:undefined,TYPE:{DAILY:"daily",INTRADAY:"intraday"},mv:"",filterComponents:[],filterSettings:{CHART_TYPE:{key:"chartType"},PERIOD:{key:"period"},FREQUENCY:{key:"frequency"}},initialize:function(options){var self=this;this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.InstrumentDetailCharts.parent.initialize.call(this,options);if(this.options.service&&this.options.service.param){this.mv=this.options.service.param}else{this.mv=this.config.serviceParams.data.param}if(this.options.charts){this.config.charts=this.options.charts}this.on("rendered",this.onRendered,this);this.on("clickTabChart",function(data,target){self.onClickTab(data,target)});this.on("clickFilter",this.onClickFilter,this);this.on("clickRefreshModule",this.refreshModule);window.addEventListener("orientationchange",function(){self.onOrientationchange()},false)},onRendered:function(){var type=this.getDefaultChart();this.loadChartComponent(type);this.updateSettingChart(type);BANCOMER.Utils.Helper.setRefreshIcon()},updateSettingChart:function(type){this.setSelectedTab(type);this.setPeriodTxt(type);this.setFrequencyTxt()},setPeriodTxt:function(type){var selector="#period"+this.mv.replace(/ /g,"_");var currentOption=this.getCurrentOptionFilterPeriod();if(type===this.TYPE.INTRADAY){$(selector,this.options.view.el).removeClass("selected")}else{$(selector,this.options.view.el).addClass("selected")}$(selector,this.options.view.el).text(BANCOMER.CULTURETEXT.t(currentOption.textKey))},setFrequencyTxt:function(){var selector="#frequency"+this.mv.replace(/ /g,"_");var currentOption=this.getCurrentOptionFilterFrequency();$(selector,this.options.view.el).text(BANCOMER.CULTURETEXT.t(currentOption.textKey))},loadChartComponent:function(type){var self=this;switch(type){case this.TYPE.DAILY:this.currentChart=this.loadChartDaily();break;case this.TYPE.INTRADAY:this.currentChart=this.loadChartIntraday();break}},loadChartIntraday:function(){var el="#chart"+this.mv.replace(/ /g,"_");var component=new BANCOMER.Components.ChartIntraday({config:"chartIntraday",view:{el:el,decimalsYAxis:this.config.viewOptions.decimalsYAxis,lineWidth:this.config.viewOptions.lineWidth,typeChart:this.config.charts[this.TYPE.INTRADAY].type,width:$(el).width(),height:$(el).height()},service:{param:this.mv,compressionMult:this.config.charts[this.TYPE.INTRADAY].frequency||"1"}});component.type=this.TYPE.INTRADAY;return component},loadChartDaily:function(){var el="#chart"+this.mv.replace(/ /g,"_");var frequency=this.config.charts[this.TYPE.DAILY].frequency;var period=this.config.charts[this.TYPE.DAILY].period;var DATE_FORMAT="YYYYMMDD";var dateEnd=moment().format("YYYYMMDD");var dateStart=moment(dateEnd,DATE_FORMAT).subtract(period.substring(1,2),period.substring(0,1)).format(DATE_FORMAT);var component=new BANCOMER.Components.ChartDaily({config:"chartDaily",view:{el:el,decimalsYAxis:this.config.viewOptions.decimalsYAxis,lineWidth:this.config.viewOptions.lineWidth,typeChart:this.config.charts[this.TYPE.DAILY].type,width:$(el).width(),height:$(el).height()},service:{param:this.mv,dateStart:dateStart,dateEnd:dateEnd,frequency:frequency}});component.type=this.TYPE.DAILY;return component},markDefaultChart:function(type){var self=this;_.each(this.TYPE,function(componentType){if(componentType===type){self.config.charts[componentType].selected="1"}else{self.config.charts[componentType].selected="0"}})},getDefaultChart:function(){var result=this.TYPE.INTRADAY;var self=this;_.each(this.TYPE,function(componentType){if(componentType&&self.config.charts[componentType]&&self.config.charts[componentType].selected==="1"){result=componentType}});return result},onClickTab:function(data,target){var type=data.type;this.currentChart.destroy();this.currentChart=undefined;this.loadChartComponent(type);this.markDefaultChart(type);this.updateSettingChart(type);this.saveChartPreferences()},setSelectedTab:function(type){var selector="";if(type){$(".contGraphMenu ul li",this.options.view.el).removeClass("active");selector=".contGraphMenu ul li[data-type="+type+"]";$(selector,this.options.view.el).addClass("active")}},onOrientationchange:function(){if(this.currentChart){if(this.currentChart.views&&this.currentChart.views[0]){this.currentChart.views[0].view.render()}}},onClickFilter:function(eventData,target){if(eventData&&eventData.filter){this.showHideFilter(eventData.filter)}},getCurrentOptionFilterChartType:function(){var whereSearch={type:this.config.charts[this.currentChart.type].type};return _.findWhere(BANCOMER.Utils.Filters.options.chartType,whereSearch)},getCurrentOptionFilterPeriod:function(){var whereSearch={value:this.config.charts[this.currentChart.type].period||BANCOMER.Utils.Filters.options.chartPeriod.P_1D.value};return _.findWhere(BANCOMER.Utils.Filters.options.chartPeriod,whereSearch)},getCurrentOptionFilterFrequency:function(){var whereSearch={value:this.config.charts[this.currentChart.type].frequency};return _.findWhere(BANCOMER.Utils.Filters.options.chartFrequency,whereSearch)},showHideFilter:function(filter){var currentOption;var config;var suffixCls;var el;var component;var type=this.currentChart.type||this.TYPE.INTRADAY;var options;if(filter){switch(filter){case this.filterSettings.CHART_TYPE.key:currentOption=this.getCurrentOptionFilterChartType();config=this.config.viewOptions.filters.chartType.config||"";suffixCls=this.config.viewOptions.filters.chartType.suffixCls||"";el=this.config.viewOptions.filters.chartType.el||"";component=this.getFilterComponent(el);options=BANCOMER.Utils.Filters.options.chartType;this.showHideFilterComponent(el,suffixCls,config,component,currentOption?currentOption.key:{},options,this.onClickOptionModuleFilterChartType);break;case this.filterSettings.PERIOD.key:if(type===this.TYPE.DAILY){currentOption=this.getCurrentOptionFilterPeriod();config=this.config.viewOptions.filters.period.config||"";suffixCls=this.config.viewOptions.filters.period.suffixCls||"";el=this.config.viewOptions.filters.period.el||"";component=this.getFilterComponent(el);options=this.getPeriodOptions(this.config.charts[this.currentChart.type].frequency);this.showHideFilterComponent(el,suffixCls,config,component,currentOption?currentOption.key:{},options,this.onClickOptionModuleFilterPeriod)}break;case this.filterSettings.FREQUENCY.key:currentOption=this.getCurrentOptionFilterFrequency();config=this.config.viewOptions.filters.frequency.config||"";suffixCls=this.config.viewOptions.filters.frequency.suffixCls||"";el=this.config.viewOptions.filters.frequency.el||"";component=this.getFilterComponent(el);options=this.getFrequencyOptions(this.config.charts[this.currentChart.type].period);this.showHideFilterComponent(el,suffixCls,config,component,currentOption?currentOption.key:{},options,this.onClickOptionModuleFilterFrequency);break;default:break}}},showHideFilterComponent:function(elFilter,suffixCls,config,component,currentOptionKey,options,onChangeFunction){if($(elFilter).is(":visible")){this.hideFilter(elFilter)}else{if(!component){component=this.loadComponentModuleFilter(config,elFilter,suffixCls,currentOptionKey,options);this.filterComponents.push(component);component.on("clickOptionFilter",onChangeFunction,this)}else{component.update(currentOptionKey,options,true)}this.showFilter(elFilter)}},onClickOptionModuleFilterChartType:function(eventData,target){var chartType=$(target).val().trim();this.currentChart.changeChartType(chartType);this.config.charts[this.currentChart.type].type=chartType;this.saveChartPreferences()},onClickOptionModuleFilterPeriod:function(eventData,target){var period=$(target).val().trim();this.currentChart.changePeriodChart(period);this.config.charts[this.currentChart.type].period=period;this.setPeriodTxt(this.currentChart.type);this.saveChartPreferences()},onClickOptionModuleFilterFrequency:function(eventData,target){var frequency=$(target).val().trim();this.currentChart.changeFrequencyChart(frequency);this.config.charts[this.currentChart.type].frequency=frequency;this.setFrequencyTxt();this.saveChartPreferences()},getPeriodOptions:function(frequency){var options=_.filter(BANCOMER.Utils.Filters.options.chartPeriod,function(item){return item.frequencyAvailability.indexOf(frequency)!==-1});return options},getFrequencyOptions:function(period){var options=_.filter(BANCOMER.Utils.Filters.options.chartFrequency,function(item){return item.periodAvailability.indexOf(period)!==-1});return options},saveChartPreferences:function(){if(this.config.saveOnServer==="1"){BANCOMER.Utils.Preferences.addPreferencesModule(this.options.config,"charts",this.config.charts);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}},loadComponentModuleFilter:function(config,el,suffixCls,currentOptionKey,options){var component=new BANCOMER.Components.ModuleFilter({config:config,view:{el:el,options:options,checkedOption:currentOptionKey,componentId:config,suffixCls:suffixCls}});return component},hideFilter:function(el){$("#clickableLevel").hide();$(el).hide()},showFilter:function(el){$("#clickableLevel").show();$(el).show()},destroy:function(){if(this.currentChart){this.currentChart.destroy()}while(this.filterComponents.length){this.filterComponents.shift().destroy()}BANCOMER.Components.Base.parent.destroy.call(this)},getFilterComponent:function(elFilter){return _.find(this.filterComponents,function(component){return component&&component.config.viewOptions.el===elFilter})},register:function(){if(this.currentChart){this.currentChart.register()}BANCOMER.Components.InstrumentDetailCharts.parent.register.call(this)},refreshModule:function(){if(this.currentChart){this.currentChart.reload()}}});BANCOMER.Components.InstrumentList=IFB.Class(IFB.Components.InstrumentListHeader,{initialize:function(options){var self=this;this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.InstrumentList.parent.initialize.call(this,options);this.on("rendered",function(){if(self.config.viewOptions.dataTable){self.createDataTable()}});this.on("AbrirFicha",function(eventData){var instrument=self.model.get(eventData.mv);document.location.href="#!/lightbox/instrumentDetail/"+instrument.id});this.on("AbrirBoletaCompra",function(eventData){var instrument=self.model.get(eventData.mv);var issuerSerie=instrument.getEmisora()+" "+instrument.getSerie();document.location.href="#!/lightbox/boleta/"+instrument.id+"/"+issuerSerie+"/Compra"});this.on("AbrirBoletaVenta",function(eventData){var instrument=self.model.get(eventData.mv);var issuerSerie=instrument.getEmisora()+" "+instrument.getSerie();document.location.href="#!/lightbox/boleta/"+instrument.id+"/"+issuerSerie+"/Venta"});this.on("componentSelectorHeaderRendered",function(){$(self.componentSelectorHeader.config.viewOptions.el).show()});this.on("componentSelectorHeaderClose",function(){$(self.componentSelectorHeader.config.viewOptions.el).hide()});this.on("componentSelectorHeaderSave",function(){$(self.componentSelectorHeader.config.viewOptions.el).hide()})},_doCreate:function(){var self=this;this.model=new IFB.Collections.InstrumentList(this.config);this.model.userHeader=this.userHeader;var viewOptions=_.extend({model:this.model,component:this},this.config.viewOptions);this.view=new IFB.Views.InstrumentList(viewOptions);this.registerView(this.view);this.on("sortView",this.view.sortView,this.view);this.model.load()},createDataTable:function(){var configFixedHeaders;if(!this.config.viewOptions.dataTable.fixedColumns){configFixedHeaders=this.getFixedColumnsConfigFromHeader();if(configFixedHeaders!==""){this.config.viewOptions.dataTable.fixedColumns=configFixedHeaders}}BANCOMER.Utils.Helper.createDataTable(this.config)},getFixedColumnsConfigFromHeader:function(){var header=this.userHeader;var leftColumns=-1;var countFixedColumns;var aux;var returnValue={};if(!header){return""}countFixedColumns=_.reduce(header.models,function(memo,model){return model.isFixed()?memo+1:memo},0);if(countFixedColumns===0){return""}aux=_.find(header.models,function(model){leftColumns++;return!model.isFixed()});if(leftColumns>0){returnValue.leftColumns=leftColumns}if(countFixedColumns-leftColumns>0){returnValue.rightColumns=countFixedColumns-leftColumns}return returnValue},getComponentHeaderSelector:function(){var self=this;var file=this.config.configHeaderSelector&&this.config.configHeaderSelector.file?this.config.configHeaderSelector.file:this.options.configHeaderSelector&&this.options.configHeaderSelector.file?this.options.configHeaderSelector.file:this.options.config;var component=new BANCOMER.Components.HeaderSelector({config:this.config.configHeaderSelector.config,service:{columnado:this.config.serviceParams.header.columnado},file:file,userHeader:self.userHeader,title:this.config.configHeaderSelector.title||""});return component},openSelectorHeader:function(){var self=this;var component=this.getComponentHeaderSelector();component.on("closeClick",function(){self.trigger("componentSelectorHeaderClose")});component.on("userHeaderSaved",function(){self.trigger("componentSelectorHeaderSave");self.onSaveUserHeader()});component.on("rendered",function(){self.trigger("componentSelectorHeaderRendered")});this.componentSelectorHeader=component}});BANCOMER.Components.InstrumentSelector=IFB.Class(BANCOMER.Components.Base,{view:undefined,model:undefined,searchComponent:undefined,activationDelay:1e3,activationTextLenght:3,numMinimum:0,searchPattern:"",placeHolderText:"",initialize:function(options){this._templates=IFB.Defaults.Templates;BANCOMER.Components.InstrumentSelector.parent.initialize.call(this,options)},create:function(){this.configure();this.model=new Backbone.Model(this.config);this.model.title=this.options.title;this.numMinimum=this.options.numMinimum||this.config.numMinimum||0;this.searchPattern=this.options.pattern||this.config.pattern||"";this.model.models=this.options.models||[];this.model.numMinimum=this.numMinimum;this.model.searchTextKey=this.options.searchTextKey||this.config.searchTextKey||"";this.model.itemsSelectedTextKey=this.options.itemsSelectedTextKey||this.config.itemsSelectedTextKey||"";this.model.placeHolderText=this.options.placeHolderText||this.config.placeHolderText||"";this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.Static(this.config.viewOptions);this.registerView(this.view);this._addEvents();this.view.reset()},_addEvents:function(){this.on("rendered",this.onRender,this);this.on("saveUserInstruments",this.saveUserInstruments,this)},initializeSearcher:function(){var self=this;var message;this.initializeSearchComponent();$("#instrument_selector_search").on("click",function(){$("#instrument_selector_search").val("");if(self.searchComponent&&self.searchComponent.view){self.searchComponent.view.$el.html("")}});$("#instrument_selector_search").on("keydown",_.debounce(function(){message=escape($("#instrument_selector_search").val());if(message.length>=self.activationTextLenght){self.showSearchResults(message)}},self.activationDelay))},showSearchResults:function(message){if(message&&message!==""){this.searchComponent.model.instrumentsMarked=this.model.models;this.searchComponent.search(message);BANCOMER.Utils.Helper.resetScrollTo()}},isEnterKeyCode:function(event){return event.keyCode===13},onRender:function(){this.initializeSearcher();this.initializeNestableComponent();this.attachDeleteEvent();this.attachAddEvent();this.attachChangeEvent()},initializeSearchComponent:function(){var self=this;this.searchComponent=new BANCOMER.Components.Search({config:"instrument_selector_search_result",view:{el:$("#instrument_selector_search_result")},instrumentsMarked:self.model.models,pattern:self.searchPattern});this.searchComponent.on("rendered",function(){self.searchComponent.view.$el.show();self.attachDeleteEvent();self.attachAddEvent();self.attachChangeEvent()})},initializeNestableComponent:function(){$("#userInstruments").nestable({maxDepth:1,group:1})},attachDeleteEvent:function(){var self=this;$("#userInstruments .dd-item .delete").off("click");$("#userInstruments .dd-item .delete").on("click",function(){self.deleteInstrument(this)})},attachChangeEvent:function(){var self=this;$("#userInstruments").on("change",function(){self.refreshIconGraph()})},refreshIconGraph:function(){var self=this;$("#userInstruments .dd-item .icoColGraph").remove();$("#userInstruments .dd-item.dd3-item").each(function(index){if(self.numMinimum!==0&&index<self.numMinimum){$('<div class="icoColGraph"></div>').insertAfter($(this).children(":first"))}})},deleteInstrument:function(item){var self=this;var numItems=$("li","#userInstruments").length;var buttons=[];var txt="";if(numItems>this.numMinimum){buttons=[{text:BANCOMER.CULTURETEXT.t("noty_Btn_InstrumentSelector_Delete_Accept"),callback:function(){self.deleteItemModel($(item.parentNode).attr("data-id"));self.deleteItem(item)}},{text:BANCOMER.CULTURETEXT.t("noty_Btn_InstrumentSelector_Delete_Cancel")}];txt=BANCOMER.CULTURETEXT.t("noty_Txt_InstrumentSelector_Delete")}else{buttons=[{text:BANCOMER.CULTURETEXT.t("noty_Btn_InstrumentSelector_Delete_Accept")}];txt=BANCOMER.CULTURETEXT.t("noty_Txt_InstrumentSelector_Delete_NumMinimum")+self.numMinimum}IFB.Utils.Helper.showNotificationWarning("warning",txt,true,buttons)},attachAddEvent:function(){var self=this;$("#category .dd-item .add").off("click");$("#category .dd-item .add").on("click",function(event){self.addItem(this);self.addItemModel($(this.parentNode).attr("data-id"));$(this).hide();event.stopPropagation()})},addItemModel:function(mv){var itemModel=this.searchComponent.model.get(mv);if(itemModel){this.model.models.push(itemModel)}},deleteItemModel:function(mv){this.model.models=_.filter(this.model.models,function(model){return model.id!==mv})},addItem:function(item){var self=this;var id=$(item).parent().attr("data-id");var name=$(item).next().html();var htmlItem='<li class="dd-item dd3-item" data-id="'+id+'">'+'<div class="delete"></div>'+'<div class="dd-handle dd3-handle">'+'<div class="contLines"><div></div><div></div><div></div></div>'+"</div>"+'<div class="dd3-content">'+name+"</div>"+"</li>";if($("#userInstruments .dd-list div.delete").length>0){$("#userInstruments .dd-list div.delete").last().parent().after(htmlItem)}else{$("#userInstruments .dd-list").append(htmlItem)}self.attachDeleteEvent();self.refreshIconGraph()},deleteItem:function(item){var id=$(item).parent().attr("data-id");$("#category .dd-item[data-id='"+id+"'] .add").show();$(item).parent().remove();this.refreshIconGraph()},saveUserInstruments:function(){var mvs=this.serializeInstrument();this.trigger("userInstrumentsSaved",{param:mvs,type:"4"},this)},serializeInstrument:function(){var self=this;var mvs=[];$("li","#userInstruments").each(function(){mvs.push($(this).attr("data-id"))});return mvs.join()},destroy:function(){if(this.searchComponent){this.searchComponent.destroy()}BANCOMER.Components.InstrumentSelector.parent.destroy()},reload:function(){if(this.searchComponent){this.searchComponent.reload()}BANCOMER.Components.InstrumentSelector.parent.reload()}});BANCOMER.Components.InvestmentDetailChart=IFB.Class(IFB.Components.InstrumentListHeader,{initialize:function(options){var self=this;this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.InvestmentDetailChart.parent.initialize.call(this,options);this.on("rendered",function(){BANCOMER.Utils.Helper.createNiceScroll(self,self.config.viewOptions.niceScroll.id)});this.on("AbrirFicha",function(eventData){document.location.href="#!/lightbox/instrumentDetail/"+eventData.mv})},create:function(){var self=this;this.configure();self.loadDataFromHeader(function(){self._doCreate()})},_doCreate:function(){this.config.userHeader=this.userHeader;this.model=new BANCOMER.Collections.PositionBook(this.config);this.model.userHeader=this.userHeader;this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.InvestmentDetail(this.config.viewOptions);this.registerView(this.view);this.model.load()},destroy:function(){$("#"+this.config.viewOptions.niceScroll.id).getNiceScroll().remove();BANCOMER.Components.InvestmentDetailChart.parent.destroy()},reload:function(sortConfig){if(sortConfig){this.view.sortConfig=sortConfig;this.view.sortModel();this.model.sortConfig=sortConfig;this.view.render()}else{this.model.sortConfig="";BANCOMER.Components.InvestmentDetailChart.parent.reload.call(this)}}});BANCOMER.Components.InvestmentDetailTable=IFB.Class(IFB.Components.InstrumentListHeader,{waitForReloadMillis:500,initialize:function(options){var self=this;this.refresh=this.waitForReloadMillis>0?_.debounce(this._refresh,this.waitForReloadMillis):this._refresh;this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.InvestmentDetailTable.parent.initialize.call(this,options);this.on("rendered",function(){BANCOMER.Utils.Helper.createDataTable(this.config);BANCOMER.Utils.Helper.setRefreshIcon()});this.on("AbrirFicha",function(eventData){document.location.href="#!/lightbox/instrumentDetail/"+eventData.mv});this.on("AbrirBoletaCompra",function(eventData){var instrument=self.model.get(eventData.mv);var issuerSerie=instrument.getEmisora()+" "+instrument.getSerie();document.location.href="#!/lightbox/boleta/"+instrument.id+"/"+issuerSerie+"/Compra"});this.on("AbrirBoletaVenta",function(eventData){var instrument=self.model.get(eventData.mv);var issuerSerie=instrument.getEmisora()+" "+instrument.getSerie();document.location.href="#!/lightbox/boleta/"+instrument.id+"/"+issuerSerie+"/Venta"});this.on("refreshData",this.refresh,this);this.on("componentSelectorHeaderRendered",function(){$(self.componentSelectorHeader.config.viewOptions.el).show()});this.on("componentSelectorHeaderClose",function(){$(self.componentSelectorHeader.config.viewOptions.el).hide()});this.on("componentSelectorHeaderSave",function(){$(self.componentSelectorHeader.config.viewOptions.el).hide()})},create:function(){var self=this;this.configure();self.loadDataFromHeader(function(){self._doCreate()})},_doCreate:function(){var self=this;this.config.serviceBCOMParams.params.data1=this.options.serviceBCOMParams?this.options.serviceBCOMParams.params.data1:this.config.serviceBCOMParams.params.data1;this.config.userHeader=this.userHeader;this.model=new BANCOMER.Collections.PositionBook(this.config);this.model.userHeader=this.userHeader;this.model.module=this.config.viewOptions.module;this.model.workspace=this.config.viewOptions.workspace;this.model.layout=this.config.viewOptions.layout;this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.InvestmentDetail(this.config.viewOptions);this.registerView(this.view);if(this.options.data){this.model.models=[];this.model.add(this.options.data.models);this.model.load=function(){self.view.reset()}}this.addEvents();this.model.load()},addEvents:function(){var self=this;this.on("positionBookPeriodFilterChange",this.onPositionBookPeriodFilterChange,this)},onPositionBookPeriodFilterChange:function(eventData,target){this.config.serviceBCOMParams.params.data1=target.val();this.reload()},reload:function(sortConfig){this.view.sortConfig.descriptor="";this.model.sortview=false;BANCOMER.Components.InvestmentDetailTable.parent.reload.call(this)},getComponentHeaderSelector:function(){var self=this;var file=this.config.configHeaderSelector&&this.config.configHeaderSelector.file?this.config.configHeaderSelector.file:this.options.configHeaderSelector&&this.options.configHeaderSelector.file?this.options.configHeaderSelector.file:this.options.config;var component=new BANCOMER.Components.HeaderSelector({config:this.config.configHeaderSelector.config,service:{columnado:this.config.serviceParams.header.columnado},file:file,userHeader:self.userHeader,title:this.config.configHeaderSelector.title||""});return component},_refresh:function(){this.reload()}});BANCOMER.Components.MenuFooter=IFB.Class(BANCOMER.Components.Base,{view:undefined,model:undefined,create:function(){this.configure();this._create()},_create:function(){var self=this;this.model=new Backbone.Model(this.config);this.model.options=this.config;this.model.items=this.config.viewOptions.items;this.model.maxItems=this.config.viewOptions.maxItems;this.model.load=function(){self.view.reset()};this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.Static(this.config.viewOptions);this.registerView(this.view);this.view.reset()}});BANCOMER.Components.MenuSettings=IFB.Class(BANCOMER.Components.Base,{view:undefined,model:undefined,create:function(){var self=this;this.configure();this.model=new Backbone.Model(this.config);this.model.streamingStatus=this.config.viewOptions.streamingStatus;this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.Static(this.config.viewOptions);this.registerView(this.view);this.view.reset()},addEvents:function(){this.on("change",this.sendChangeStreaming,this)},sendChangeStreaming:function(){this.trigger("sendChangeStreaming")}});BANCOMER.Components.ModuleFilter=IFB.Class(BANCOMER.Components.Base,{view:undefined,model:undefined,create:function(){var self=this;this.configure();this.model=new Backbone.Model(this.config);this.model.options=this.config.viewOptions.options;this.model.checkedOption=this.config.viewOptions.checkedOption;this.model.componentId=this.config.viewOptions.componentId;this.model.suffixCls=this.config.viewOptions.suffixCls||"";this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.Static(this.config.viewOptions);this.registerView(this.view);this.view.reset()},update:function(newCheckedOption,newOptions,needRendered){if(newCheckedOption){this.model.checkedOption=newCheckedOption}if(newOptions){this.model.options=newOptions}if(needRendered&&this.view){this.view.render()}}});BANCOMER.Components.MultipleTopFlopActive=IFB.Class(BANCOMER.Components.Base,{components:[],create:function(){var self=this;this.components=[];this.configure("TopFlopActive","/wtdb/LoadDataMasSubenBajanContratan");self._doCreate()},_doCreate:function(){var self=this;_.each(this.config.components,function(component){self.components.push(self.loadComponent(component.config,self.config.serviceParams.data.param,$(BANCOMER.Defaults.Templates[component.config].viewOptions.el)))})},loadComponent:function(config,param,el){var component=new BANCOMER.Components.TopFlopActive({config:config,view:{el:$(el)},service:{param:param}});return component},destroy:function(){_.each(this.components,function(component){if(_.isFunction(component.destroy)){component.destroy()}})},reload:function(){var self=this;_.each(this.components,function(component){if(_.isFunction(component.reload)){component.config.serviceParams.data.param=self.config.serviceParams.data.param;component.reload()}})},register:function(){var self=this;_.each(this.components,function(component){if(component){component.register()}})}});BANCOMER.Components.News=IFB.Class(IFB.Components.News,{DATE_FORMAT:"YYYYMMDD",initialize:function(options){this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.News.parent.initialize.call(this,options);this.on("rendered",function(){BANCOMER.Utils.Helper.createDataTable(this.config)});this.on("loaded",function(){this.onloaded()});IFB.Events.on("newsMarkedAsRead",this.onNewsMarkedAsRead,this)},onloaded:function(){throw new Error("This method must be overriden")},onUpdateNews:function(data){throw new Error("This method must be overriden")},onNewsMarkedAsRead:function(eventData,target){throw new Error("This method must be overriden")},filterCurrentNews:function(news){var today=this.getCurrentDate();var clasificacion;var filteredNews=_.filter(news,function(item){clasificacion=item.getClassification();if(clasificacion&&clasificacion.Vencimiento){return Number(clasificacion.Vencimiento)>=Number(today)}return true});return filteredNews},filterReadNews:function(news){var filteredNews=_.filter(news,function(item){return!IFB.Utils.ReadStatusConfig.isRead(item.getSource(),item.getKey())});return filteredNews},getNewsModel:function(newsData){return new IFB.Models.News(JSON.parse(JSON.stringify(newsData).replace(/@/g,"")))},getCurrentDate:function(){return moment().format(this.DATE_FORMAT)}});BANCOMER.Components.NewsButton=IFB.Class(BANCOMER.Components.News,{DATE_FORMAT:"YYYYMMDD",initialize:function(options){this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.NewsButton.parent.initialize.call(this,options)},onloaded:function(){var models=this.filterCurrentNews(this.model.models);this.model.models=this.filterReadNews(models)},onUpdateNews:function(data){var self=this;data=_.isArray(data)?data:[data];_.each(data,function(newsData){self.model.unshift(self.getNewsModel(newsData));self.notifyIncomingMessage(self.getNewsModel(newsData))});self.onRendered()},onRendered:function(){this.reload()},onNewsMarkedAsRead:function(eventData,target){var modelNews;if(eventData&&eventData.source.indexOf(this.config.serviceParams.data.fuentes)!==-1){modelNews=this.model.get(eventData.key);if(modelNews){this.model.remove([modelNews]);this.reload()}}},getCurrentDate:function(){return moment().format(this.DATE_FORMAT)},notifyIncomingMessage:function(model){var self=this;var buttons=[{text:BANCOMER.CULTURETEXT.t("noty_Btn_IncomingNews_Open"),callback:function(){IFB.Utils.ReadStatusConfig.markAsRead(model.getSource(),model.getKey(),self.getCurrentDate());if(self.config.viewOptions.format==="1"){document.location.href="#!/lightbox/newsList/pageTitle_MessagePage/"+model.getSource()+"/"+model.getKey()}else{document.location.href="#!/lightbox/newsList/pageTitle_NoticePage/"+model.getSource()+"/"+model.getKey()}}},{text:BANCOMER.CULTURETEXT.t("noty_Btn_IncomingNews_Close")}];if(this.config.viewOptions.format==="1"){BANCOMER.Utils.Helper.showNotificationIncomingMessage("warning",model.getTitle(),true,buttons)}else{IFB.Utils.Helper.showNotificationWarning("warning",model.getTitle(),true,buttons)}}});BANCOMER.Components.NewsCriteria=IFB.Class(IFB.Components.NewsCriteria,{urlFileNode:"",initialize:function(options){this.urlFileNode=options.urlFileNode||"FicheroIB";this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.NewsCriteria.parent.initialize.call(this,options);this.on("rendered",function(){BANCOMER.Utils.Helper.createDataTable(this.config)});this.on("clickNews",this.onClickNews,this)},_configureParam:function(config){var serviceParams=config.serviceParams;return"0;"+serviceParams.searchFunc+";"+serviceParams.data.sources+","+(serviceParams.data.fromDate||"")+",,"+(serviceParams.data.toDate||"")+",,,"+(serviceParams.data.isin||"")+","+(serviceParams.numberOfItems||"")+",,,"+(serviceParams.data.detailFormat||"")},getURLFile:function(detail){var url="";var documentDetail;if(detail){if(window.DOMParser){parser=new DOMParser;xmlDoc=parser.parseFromString(detail,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=false;xmlDoc.loadXML(detail)}if(xmlDoc&&xmlDoc.documentElement.nodeName!=="parsererror"){try{x=xmlDoc.getElementsByTagName(this.urlFileNode)[0];y=x.childNodes[0];url=y.nodeValue}catch(e){}}}return url},onClickNews:function(dataEvent,target){var item;var url="";var databaseService;var message="";if(dataEvent&&dataEvent.key){item=this.model.get(dataEvent.key);if(item){databaseService=new IFB.Services.Database({});databaseService.news(_.extend({idNot:item.getKey(),source:item.getSource()},{sesion:IFB.Services.Session}),function(response){message=JSON.parse(response);if(message&&message.answer&&message.answer.Noticia&&message.answer.Noticia.FicheroIB){url=_.isObject(message.answer.Noticia.FicheroIB)?message.answer.Noticia.FicheroIB.value:message.answer.Noticia.FicheroIB;BANCOMER.Utils.Helper.openExternalFile(url)}else{document.location.href="#!/lightbox/newsDetail/"+item.getSource()+"/"+item.getKey()}})}}}});BANCOMER.Components.NewsDetail=IFB.Class(IFB.Components.NewsDetail,{initialize:function(options){var self=this;this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.NewsDetail.parent.initialize.call(this,options);this.on("rendered",function(){BANCOMER.Utils.Helper.createNiceScroll(self,self.config.viewOptions.niceScroll.id)});this.on("openExternalFile",function(eventData){BANCOMER.Utils.Helper.openExternalFile(eventData.url)})},destroy:function(){var niceScroll=$("#"+this.config.viewOptions.niceScroll.id).getNiceScroll();if(niceScroll){niceScroll.remove()}BANCOMER.Components.NewsDetail.parent.destroy()}});BANCOMER.Components.NewsList=IFB.Class(BANCOMER.Components.News,{numItems:0,initialize:function(options){var self=this;this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.NewsList.parent.initialize.call(this,options);this.on("rendered",function(){BANCOMER.Utils.Helper.createNiceScroll(self,self.config.viewOptions.niceScroll.id)});this._addEvents()},destroy:function(){$("#"+this.config.viewOptions.niceScroll.id).getNiceScroll().remove();BANCOMER.Components.NewsList.parent.destroy()},_addEvents:function(){this.on("itemNewsClick",this.onNewsClick,this)},onNewsClick:function(eventData,target){target.removeClass(this.options.view.clsItemNoRead);this.trigger("showNewsDetail",eventData)},onloaded:function(){this.model.models=this.filterCurrentNews(this.model.models);this.numItems=this.model.models.length},onUpdateNews:function(data){var self=this;var newModel;var numItems=0;var cls="";data=_.isArray(data)?data:[data];numItems=data.length;_.each(data,function(newsData,index){cls=index%2===0?self.options.view.clsItemEven:"";newModel=self.getNewsModel(newsData);if(newModel){self.model.unshift(newModel);self.insertItemView(newModel,cls)}});self.updateViewOldItems(numItems);self.updateCounterNumItems(numItems)},onRendered:function(numItems){this.reload()},insertItemView:function(item,cls){var el=this.options.view.el;var niceScrollId="#"+(this.options.view.niceScroll?this.options.view.niceScroll.id:"newsListTable");var htmlItem='<div id="'+item.getKey()+'" class="mesAviTbl_data ifbEventTrigger '+cls+" "+this.options.view.clsItemNoRead+'" data-event="itemNewsClick" data-source="'+item.getSource()+'" data-key="'+item.getKey()+'">';htmlItem+='<div class="mesAviTbl_date">'+item.getDate()+"</div>";htmlItem+='<div class="mesAviTbl_hour">'+item.getTime()+"</div>";htmlItem+='<div class="mesAviTbl_tit">'+item.getTitle()+"</div>";htmlItem+="</div>";$(niceScrollId,el).prepend(htmlItem)},updateViewOldItems:function(indexFrom){var cls;var self=this;var el=this.options.view.el;_.each(this.model.models,function(item,index){if(index>=indexFrom){cls=index%2===0?self.options.view.clsItemEven:"";$("#"+item.getKey(),el).removeClass(self.options.view.clsItemEven);if(cls!==""){$("#"+item.getKey(),el).addClass(cls)}}})},updateCounterNumItems:function(increments){var counter=$("#"+this.options.view.counterId);this.numItems+=increments;var labelCount=this.numItems===1?BANCOMER.CULTURETEXT.t("componentLabel_newsList_countMessage"):BANCOMER.CULTURETEXT.t("componentLabel_newsList_countMessages");if(counter){$(counter).html(this.numItems+"&nbsp;"+labelCount)}},onNewsMarkedAsRead:function(eventData,target){}});BANCOMER.Components.NewsTreeMap=IFB.Class(BANCOMER.Components.NewsCriteria,{defaultNumberOfItems:7,defaultMaxTitleLength:30,initialize:function(options){this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.NewsTreeMap.parent.initialize.call(this,options);this.on("rendered",this.onRendered,this);this.numberOfItems=this.getNumberOfItems();this.maxTitleLength=this.config.maxTitleLength||this.defaultMaxTitleLength},onRendered:function(){var idNumberItem=0;var idItem="";var itemIdPrefix=this.options.view.itemIdPrefix;var el=this.options.view.el;var self=this;if(itemIdPrefix){_.each(this.model.models,function(item,index){idNumberItem=index+1;idItem="#"+itemIdPrefix+idNumberItem;self.setDetailLink(item,idItem,el)})}},setDetailLink:function(item,selector,el){if(item&&$(selector,el)){$(selector,el).text(this.getTextTitle(item.getTitle()));$(selector,el).attr("class","ifbEventTrigger");$(selector,el).data("event","clickNews");$(selector,el).data("key",item.getKey())}},onUpdateNews:function(data){var self=this;data=_.isArray(data)?data:[data];_.each(data,function(newsData){self.model.unshift(self.getNewsModel(newsData));if(self.model.length>self.numberOfItems){self.model.pop()}});self.onRendered()},getNumberOfItems:function(){return this.config&&this.config.serviceParams&&this.config.serviceParams.numberOfItems?this.config.serviceParams.numberOfItems:this.defaultNumberOfItems},getNewsModel:function(newsData){return new IFB.Models.News(JSON.parse(JSON.stringify(newsData).replace(/@/g,"")))},getTextTitle:function(title){return title.length>this.maxTitleLength?this.getTrimmedTitle(title)+" ...":title},getTrimmedTitle:function(title){var trimmedString=title.substr(0,this.maxTitleLength);return trimmedString.substr(0,Math.min(trimmedString.length,trimmedString.lastIndexOf(" ")))}});BANCOMER.Components.NewsViewTreeMap=IFB.Class(BANCOMER.Components.NewsTreeMap,{initialize:function(options){BANCOMER.Components.NewsViewTreeMap.parent.initialize.call(this,options)},onRendered:function(){var idNumberItem=0;var idItem="";var itemIdPrefix=this.config.viewOptions.itemIdPrefix;var el=this.config.viewOptions.el;var self=this;if(itemIdPrefix){_.each(this.model.models,function(item,index){idNumberItem=index+1;idItem="#"+itemIdPrefix+idNumberItem;self.setDetailLink(item,idItem,el);self.setBackgroundItem(item,idItem,el)})}},setBackgroundItem:function(item,idItem,el){if(this.config.viewOptions.greenClsSources.indexOf(item.getSource())!==-1){$(idItem,el).parent().parent().addClass("colorGreen")}else if(this.config.viewOptions.blueClsSources.indexOf(item.getSource())!==-1){$(idItem,el).parent().parent().addClass("colorBlue")}}});BANCOMER.Components.OrderBookTable=IFB.Class(IFB.Components.InstrumentListHeader,{waitForReloadMillis:500,initialize:function(options){var self=this;this.refresh=this.waitForReloadMillis>0?_.debounce(this._refresh,this.waitForReloadMillis):this._refresh;this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.OrderBookTable.parent.initialize.call(this,options);this.on("rendered",function(){BANCOMER.Utils.Helper.createDataTable(this.config);self.deleteLinkOnExecutedCancelOrders();BANCOMER.Utils.Helper.setRefreshIcon()});this.on("AbrirFicha",function(eventData){var order=this.model.getElementById(eventData.mv);if(order){document.location.href="#!/lightbox/instrumentDetail/"+order.getDescriptorValue("MV")}});this.on("refreshData",this.refresh,this);this.on("componentSelectorHeaderRendered",function(){$(self.componentSelectorHeader.config.viewOptions.el).show()});this.on("componentSelectorHeaderClose",function(){$(self.componentSelectorHeader.config.viewOptions.el).hide()});this.on("componentSelectorHeaderSave",function(){$(self.componentSelectorHeader.config.viewOptions.el).hide()});this.on("orderCancel",function(eventData){document.location.href="#!/lightbox/ordercancel/"+eventData.mv});this.on("orderDetail",function(eventData){var order=this.model.getElementById(eventData.mv);if(order){document.location.href="#!/lightbox/orderdetail/"+order.getEmpresa()+"/"+order.getFolio()+"/"+order.getFechaReg()+"/"+order.getOperacion()+"/"+order.getEmisora()+"/"+order.getSerie()}})},create:function(){var self=this;this.configure();self.loadDataFromHeader(function(){self._doCreate()})},_doCreate:function(){this.config.userHeader=this.userHeader;this.model=new BANCOMER.Collections.OrderBook(this.config);this.model.userHeader=this.userHeader;this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.OrderBook(this.config.viewOptions);this.registerView(this.view);this.on("sortView",this.view.sortView,this.view);this.addEvents();this.model.load()},addEvents:function(){this.on("orderBookStatusFilterChange",this.onOrderBookStatusFilterChange,this)},onOrderBookStatusFilterChange:function(eventData,target){this.model.paramFilter=target.val();this.view.render()},getComponentHeaderSelector:function(){var self=this;var file=this.config.configHeaderSelector&&this.config.configHeaderSelector.file?this.config.configHeaderSelector.file:this.options.configHeaderSelector&&this.options.configHeaderSelector.file?this.options.configHeaderSelector.file:this.options.config;var component=new BANCOMER.Components.HeaderSelector({config:this.config.configHeaderSelector.config,service:{columnado:this.config.serviceParams.header.columnado},file:file,userHeader:self.userHeader,title:this.config.configHeaderSelector.title||""});return component},deleteLinkOnExecutedCancelOrders:function(){var self=this;var orders=_.filter(this.model.models,function(order){return order.getEstadoRaw()===BANCOMER.Models.Order.prototype.Status.Executed.key||order.getEstadoRaw()===BANCOMER.Models.Order.prototype.Status.Canceled.key});_.each(orders,function(order){$('td.cancel[data-mv="'+order.getFolio()+'"]',self.config.viewOptions.el).removeClass("cancel")})},_refresh:function(){this.reload()}});BANCOMER.Components.OrderCancelConfirmation=IFB.Class(BANCOMER.Components.Base,{folio:"",order:undefined,initialize:function(options){this._templates=BANCOMER.Defaults.Templates;this.folio=options.view.folio;BANCOMER.Components.OrderCancelConfirmation.parent.initialize.call(this,options)},create:function(){var self=this;this.configure();this.model=new BANCOMER.Collections.OrderBook(this.config);self.config.viewOptions.model=self.model;this.view=new BANCOMER.Views.OrderBook(self.config.viewOptions);self.registerView(this.view);this.addEvents();this.model.load()},addEvents:function(){this.on("sendOrderCancelConfirmationClick",this.sendOrderCancelConfirmation,this);this.on("sendOrderCancelSaveClick",this.sendOrderCancelSave,this);this.on("sendOrderCancelMailClick",this.sendOrderCancelMail,this);this.on("sendOrderCancelReceiptTooltipClick",this.showHideReceiptToolTip,this)},sendOrderCancelConfirmation:function(eventData,target){var folio=eventData.folio.toString();var params;var self=this;if(folio===this.folio){this.order=this.model.get(folio);if(this.order){params=this.order.getCancelConfirmationToTrader();BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.CancelacionOrdenCapitales,params,function(response){if(response.answer!==undefined&&response.status!==undefined&&response.status.ok&&params.id_testigo===response.answer.id_testigo){self.hideCancelConfirmation();self.order.setFolioCancelacion(response.answer.folioInternet);self.showCancelConfirmation()}})}}},sendOrderCancelSave:function(){var params=this.order.getCancelSaveMailToTrader();BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.GuardadoComprobante,params,function(response){if(response.answer!==undefined&&response.status!==undefined&&response.status.ok&&params.id_testigo===response.answer.id_testigo){console.log("GuardadoComprobante - OK")}})},sendOrderCancelMail:function(){var params=this.order.getCancelSaveMailToTrader();BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.EnvioComprobante,params,function(response){if(response.answer!==undefined&&response.status!==undefined&&response.status.ok&&params.id_testigo===response.answer.id_testigo){console.log("EnvioComprobante - OK")}})},hideCancelConfirmation:function(){$("#orderCancelConfirmationButton",this.config.viewOptions.el).hide();$("#orderCancelConfirmationInfo",this.config.viewOptions.el).hide()},showCancelConfirmation:function(){$("#orderCancelReceiptTooltipContainer",this.config.viewOptions.el).show();$("#orderCancelReceipt",this.config.viewOptions.el).show();$("#orderCancelReceiptFolioContainer",this.config.viewOptions.el).show();$("#orderCancelRegisterDate").removeClass("noBorderBttm");$("#orderCancelReceiptFolio",this.config.viewOptions.el).text(this.order.getFolioCancelacion())},showHideReceiptToolTip:function(){$("#orderReceiptTooltip",this.$el).toggle()}});BANCOMER.Components.OrderDetail=IFB.Class(BANCOMER.Components.Base,{initialize:function(options){var self=this;this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.OrderDetail.parent.initialize.call(this,options);this.on("rendered",function(){BANCOMER.Utils.Helper.createDataTable(this.config)})},create:function(){var self=this;this.configure();_.extend(this.config.serviceBCOMParams,this.options.serviceBCOMParams);this.model=new BANCOMER.Collections.OrderDetail(this.config);self.config.viewOptions.model=self.model;this.view=new BANCOMER.Views.OrderDetail(self.config.viewOptions);self.registerView(this.view);this.model.load()}});BANCOMER.Components.Positions=IFB.Class(IFB.Components.Positions,{initialize:function(options){this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.Positions.parent.initialize.call(this,options)}});BANCOMER.Components.ResearchNews=IFB.Class(BANCOMER.Components.Base,{components:[],urlFileNode:"",create:function(){var self=this;this.components=[];this.configure();this.urlFileNode=this.config.urlFileNode||"FicheroIB";self.doCreate()},doCreate:function(){var self=this;switch(this.config.viewOptions.preference){case"news":this.loadMarkUpNews();break;case"research":this.loadMarkUpResearch();break;case"researchNews":this.loadMarkUpResearchNews();break;default:BANCOMER.Utils.Helper.hasResearchChannel(function(){self.loadMarkUpResearchNews()},function(){self.loadMarkUpNews()},self);break}},loadMarkUpResearchNews:function(){this.config.viewOptions.preference="researchNews";this.loadMarkUp(this.config.researchNews)},loadMarkUpNews:function(){this.config.viewOptions.preference="news";this.loadMarkUp(this.config.news)},loadMarkUpResearch:function(){this.config.viewOptions.preference="research";this.loadMarkUp(this.config.research)},loadMarkUp:function(preference){var self=this;var component=new BANCOMER.Components.Static({config:preference.markUp});component.on("rendered",function(){self.loadComponents(preference.components);self.trigger("rendered",self)});return component},loadComponents:function(components){var self=this;_.each(components,function(component){self.components.push(self.loadComponent(component.config,self.config.serviceParams.data.param,$(BANCOMER.Defaults.Templates[component.config].viewOptions.el)))})},loadComponent:function(config,param,el){var component=new BANCOMER.Components.NewsTreeMap({config:config,view:{el:$(el)},service:{param:param},urlFileNode:this.urlFileNode});return component},destroy:function(){_.each(this.components,function(component){if(_.isFunction(component.destroy)){component.destroy()}})},reload:function(){_.each(this.components,function(component){if(_.isFunction(component.reload)){component.reload()}})},recreate:function(){this.destroy();this.doCreate()},register:function(){var self=this;_.each(this.components,function(component){if(component){component.register()}})}});BANCOMER.Components.Search=IFB.Class(IFB.Components.Search,{initialize:function(options){var self=this;this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.Search.parent.initialize.call(this,options);this.on("rendered",function(){if(self.config.viewOptions.niceScroll){BANCOMER.Utils.Helper.createNiceScroll(self,self.config.viewOptions.niceScroll.id)}})},create:function(){this.configure("InstrumentList","/wtdb/LoadDataLV");this.model=new IFB.Collections.InstrumentList(this.config);this.model.instrumentsMarked=this.options.instrumentsMarked||[];this.model.bind("reset",this._onSearchReady,this);this.searchPattern=this.options.pattern||this.config.pattern||IFB.Utils.ProductConfig.getBuscadorHTPattern()},search:function(stringToSearch){IFB.Components.Search.lastCall=stringToSearch;if(this.view){this.destroy()}var searchParam=this.searchPattern.replace("{0}",stringToSearch);searchParam=searchParam.replace("{1}","");this.model.load({param:searchParam,type:"2"})},destroy:function(){if(this.config.viewOptions.niceScroll){$("#"+this.config.viewOptions.niceScroll.id).getNiceScroll().remove()}BANCOMER.Components.Search.parent.destroy.call(this)}});BANCOMER.Components.Static=IFB.Class(IFB.Components.Static,{initialize:function(options){this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.Static.parent.initialize.call(this,options)}});BANCOMER.Components.TopFlopActive=IFB.Class(IFB.Components.TopFlopActive,{view:undefined,initialize:function(options){this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.TopFlopActive.parent.initialize.call(this,options);this.on("AbrirFicha",function(eventData){document.location.href="#!/lightbox/instrumentDetail/"+eventData.mv})},create:function(){this.configure("TopFlopActive","/wtdb/LoadDataMasSubenBajanContratan");this.config.serviceParams.data.param=IFB.Utils.Helper.getConstituentsCode(this.config.serviceParams.data.param);var model=new IFB.Collections.InstrumentList(this.config);this.config.viewOptions.model=model;this.view=new BANCOMER.Views.TopFlopActive(this.config.viewOptions);this.registerView(this.view);model.load()}});BANCOMER.Components.TopFlopDetailList=IFB.Class(BANCOMER.Components.InstrumentList,{create:function(){var self=this;this.configure("TopFlopActive","/wtdb/LoadDataMasSubenBajanContratan");this.setServiceParams();this._configureComponent(undefined,function(){self.loadDataFromHeader(function(){self._doCreate()})})}});BANCOMER.Components.TopFlopPieChart=IFB.Class(BANCOMER.Components.Base,{create:function(){var self=this;this.configure("InstrumentList","/wtdb/LoadDataLV");this.model=new IFB.Collections.InstrumentList(this.config);this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.TopFlopPieChart(this.config.viewOptions);this.registerView(this.view);this.model.load()}});BANCOMER.Components.WorkSpaceChart=IFB.Class(BANCOMER.Components.InstrumentDetailCharts,{layout:undefined,workspace:undefined,moduleId:undefined,componentChart:undefined,instrumentSelector:undefined,layoutText:"Layout",moduleText:"module",initialize:function(options){var self=this;this._templates=BANCOMER.Defaults.Templates;BANCOMER.Components.WorkSpaceChart.parent.initialize.call(this,options);this.moduleId=this.config.viewOptions.componentId;this.layout=this.config.viewOptions.layout;this.workspace=this.config.viewOptions.workspace;this.model.workspace=this.workspace;this.model.layout=this.layout;this.model.componentId=this.moduleId;if(this.options.charts){this.config.charts=this.options.charts}this.on("clickToolBoxInstrumentSelector",this.openInstrumentSelector,this)},openInstrumentSelector:function(){var self=this;this.instrumentSelector=this.getComponentInstrumentSelector();this.instrumentSelector.on("rendered",function(){$(self.instrumentSelector.config.viewOptions.el).show()});this.instrumentSelector.on("closeClick",function(){$(self.instrumentSelector.config.viewOptions.el).hide();self.instrumentSelector.destroy()});this.instrumentSelector.on("updateChart",function(data){$(self.instrumentSelector.config.viewOptions.el).hide();self.mv=data.param;self.type=data.type;self.config.serviceParams.data.param=data.param;self.trigger("saveChartPreferences",data);self.reload()})},getComponentInstrumentSelector:function(){var self=this;var component=new BANCOMER.Components.ChartInstrumentSelector({config:"workspaces_module_chart_instrumentSelector",service:{},title:self.title,pattern:self.searchPattern,searchTextKey:self.searchTextKey,itemsSelectedTextKey:self.itemsSelectedTextKey});return component},saveChartPreferences:function(){var charts=this.config.charts;var self=this;this.trigger("saveChartPreferences",{charts:charts,module:self.moduleId,workspace:self.workspace},this)},loadChartIntraday:function(){this.componentChart=new BANCOMER.Components.ChartIntraday({config:"chartIntraday",view:{el:"#chart_"+this.model.componentId,decimalsYAxis:this.config.viewOptions.decimalsYAxis,lineWidth:this.config.viewOptions.lineWidth,typeChart:this.config.charts[this.TYPE.INTRADAY].type},service:{param:this.mv,compressionMult:this.config.charts[this.TYPE.INTRADAY].frequency||"1"}});this.componentChart.type=this.TYPE.INTRADAY;return this.componentChart},loadChartDaily:function(){var frequency=this.config.charts[this.TYPE.DAILY].frequency;var period=this.config.charts[this.TYPE.DAILY].period;var DATE_FORMAT="YYYYMMDD";var dateEnd=moment().format("YYYYMMDD");var dateStart=moment(dateEnd,DATE_FORMAT).subtract(period.substring(1,2),period.substring(0,1)).format(DATE_FORMAT);this.componentChart=new BANCOMER.Components.ChartDaily({config:"chartDaily",view:{el:"#chart_"+this.model.componentId,decimalsYAxis:this.config.viewOptions.decimalsYAxis,lineWidth:this.config.viewOptions.lineWidth,typeChart:this.config.charts[this.TYPE.DAILY].type},service:{param:this.mv,dateStart:dateStart,dateEnd:dateEnd,frequency:frequency}});this.componentChart.type=this.TYPE.DAILY;return this.componentChart},setPeriodTxt:function(type){var selector="#period"+this.model.componentId;var currentOption=this.getCurrentOptionFilterPeriod();if(type===this.TYPE.INTRADAY){$(selector,this.options.view.el).removeClass("selected")}else{$(selector,this.options.view.el).addClass("selected")}$(selector,this.options.view.el).text(BANCOMER.CULTURETEXT.t(currentOption.textKey))},setFrequencyTxt:function(){var selector="#frequency"+this.model.componentId;var currentOption=this.getCurrentOptionFilterFrequency();$(selector,this.options.view.el).text(BANCOMER.CULTURETEXT.t(currentOption.textKey))},showHideFilterComponent:function(elFilter,suffixCls,config,component,currentOptionKey,options,onChangeFunction){suffixCls=this.layoutText+this.layout+this.moduleText+this.moduleId;if($(elFilter).is(":visible")){this.hideFilter(elFilter)}else{component=this.loadComponentModuleFilter(config,elFilter,suffixCls,currentOptionKey,options);this.filterComponents.push(component);component.on("clickOptionFilter",onChangeFunction,this);this.showFilter(elFilter)}}});BANCOMER.Components.WorkspaceInstruments=IFB.Class(BANCOMER.Components.Base,{view:undefined,model:undefined,componentTable:undefined,instrumentSelector:undefined,serviceParamsTable:undefined,configInstrumentList:"",searchPattern:"",searchTextKey:"",itemsSelectedTextKey:"",placeHolderText:"",create:function(){this.configure();this._create()},_create:function(){var self=this;this.title=BANCOMER.CULTURETEXT.t(this.config.viewOptions.titleTextKey);this.model=new Backbone.Model(this.config);this.model.options=this.config;this.model.title=this.title;this.model.idTable=this.config.viewOptions.idTable;this.model.module=this.config.viewOptions.module;this.model.workspace=this.config.viewOptions.workspace;this.model.layout=this.config.viewOptions.layout;this.searchPattern=this.options.pattern||this.config.pattern||"";this.searchTextKey=this.options.searchTextKey||this.config.searchTextKey||"";this.itemsSelectedTextKey=this.options.itemsSelectedTextKey||this.config.itemsSelectedTextKey||"";this.placeHolderText=this.options.placeHolderText||this.config.placeHolderText||"";this.configInstrumentList=this.config.viewOptions.configInstrumentList;this.serviceParamsTable=this.options.service;this.model.load=function(){self.view.reset()};this.config.viewOptions.model=this.model;this.view=new BANCOMER.Views.Static(this.config.viewOptions);this.registerView(this.view);this.addEvents();this.view.reset()},addEvents:function(){var self=this;this.on("rendered",function(){self.createTable();BANCOMER.Utils.Helper.setRefreshIcon()});this.on("clickRefreshModule",this.onClickRefreshModule,this);this.on("clickToolBoxIndexes",function(){self.componentTable.openSelectorHeader()});this.on("clickToolBoxInstrumentSelector",this.openInstrumentSelector,this)},onClickRefreshModule:function(){if(this.componentTable){this.componentTable.reload()}},createTable:function(){var self=this;var config={config:self.configInstrumentList,view:{el:$("#"+self.model.idTable),dataTable:{id:self.model.idTable}},configHeaderSelector:{config:"header_selector",title:self.model.title,file:self.model.idTable}};if(this.serviceParamsTable){config.service={param:this.serviceParamsTable.data.param,type:this.serviceParamsTable.data.type}}this.componentTable=new BANCOMER.Components.InstrumentList(config)},destroy:function(){if(this.componentTable){this.componentTable.destroy()}if(this.instrumentSelector){this.instrumentSelector.destroy()}BANCOMER.Components.WorkspaceInstruments.parent.destroy.call(this)},reload:function(){if(this.componentTable){this.componentTable.reload()}},openInstrumentSelector:function(){var self=this;var models=this.getTableModels();this.instrumentSelector=this.getComponentInstrumentSelector(models);this.instrumentSelector.on("rendered",function(){$(self.instrumentSelector.config.viewOptions.el).show()});this.instrumentSelector.on("closeClick",function(){$(self.instrumentSelector.config.viewOptions.el).hide();self.instrumentSelector.destroy()});this.instrumentSelector.on("userInstrumentsSaved",function(data){self.reloadTableComponent(data);$(self.instrumentSelector.config.viewOptions.el).hide();self.instrumentSelector.destroy()})},getTableModels:function(){var models=[];if(this.componentTable&&this.componentTable.model.models){models=this.componentTable.model.models}return models},getComponentInstrumentSelector:function(models){var self=this;var component=new BANCOMER.Components.InstrumentSelector({config:"workspaces_module_instruments_instrumentSelector",service:{},title:self.title,models:models,pattern:self.searchPattern,searchTextKey:self.searchTextKey,itemsSelectedTextKey:self.itemsSelectedTextKey,placeHolderText:self.placeHolderText});return component},reloadTableComponent:function(data){if(this.componentTable&&data&&data.type&&data.param){this.componentTable.config.serviceParams.data.param=data.param;this.componentTable.config.serviceParams.data.type=data.type;this.componentTable.reload();this.trigger("userInstrumentsChanged",{param:this.componentTable.config.serviceParams.data.param,type:this.componentTable.config.serviceParams.data.type},this)}},register:function(){if(this.componentTable){this.componentTable.register()}}});BANCOMER.Components.WorkSpaceModule=IFB.Class(BANCOMER.Components.Base,{create:function(){var model,view;this.configure();model=new Backbone.Model(this.config);model.options=this.config.viewOptions.options;model.checkedOption=this.config.viewOptions.checkedOption;model.layout=this.config.viewOptions.layout;model.module=this.config.viewOptions.module;model.workspace=this.config.viewOptions.workspace;this.config.viewOptions.model=model;view=new BANCOMER.Views.Static(this.config.viewOptions);this.registerView(view);view.reset()}});BANCOMER.Pages.Base=IFB.Class(null,{components:[],initialize:function(options){},_load:function(){throw new Error("This method must be overriden")},destroy:function(){while(this.components.length){this.components.shift().destroy()}},getComponent:function(configId){return _.find(this.components,function(component){return component&&component.options&&component.options.config===configId})},hideComponent:function(configIds){configIds=_.isArray(configIds)?configIds:[configIds];var component;var self=this;_.each(configIds,function(configId){component=self.getComponent(configId);if(component){self.components=_.without(self.components,component);component.hide()}})},onClickModuleFilter:function(eventData,target){if(eventData){this.showHideModuleFilter(eventData.module)}},onClickRefreshModule:function(eventData,target){if(eventData){this.refreshModule(eventData.module)}},refreshModule:function(module){throw new Error("This method must be overriden")},showHideModuleFilter:function(module){throw new Error("This method must be overriden")},onClickModuleOpen:function(eventData,target){if(eventData&&eventData.module){this.openPage(eventData,target)}},onClickCloseButton:function(){document.location.href="#!/home"},registerComponents:function(){_.each(this.components,function(component){if(component&&_.isFunction(component.register)){component.register()}})},_loadComponentModuleFilter:function(moduleOption,currentOptionKey,options){var component=new BANCOMER.Components.ModuleFilter({config:moduleOption.componentIdFilter,view:{el:moduleOption.elFilter,options:options,checkedOption:currentOptionKey,componentId:moduleOption.componentIdFilter}});return component},_showHideModuleFilter:function(moduleOption,currentOptionKey,options,onChangeFunction){var component;if($(moduleOption.elFilter).is(":visible")){this._hideModuleFilter(moduleOption.elFilter)}else{this._showModuleFilter(moduleOption.elFilter);component=this.getComponent(moduleOption.componentIdFilter);if(!component){$("#clickableLevel").show();component=this._loadComponentModuleFilter(moduleOption,currentOptionKey,options);this.components.push(component);component.on("clickOptionModuleFilter",onChangeFunction,this)}}},_hideModuleFilter:function(el){$("#clickableLevel").hide();$(el).hide()},_showModuleFilter:function(el){$("#clickableLevel").show();$(el).show()}});BANCOMER.Pages.Home=IFB.Class(BANCOMER.Pages.Base,{waitForReloadMillis:500,initialize:function(options){this.reloadInvestmentDetail=this.waitForReloadMillis>0?_.debounce(this._reloadInvestmentDetail,this.waitForReloadMillis):this._reloadInvestmentDetail;this.components.push(this._loadMarkUp())},moduleSettings:{INDEXES:{key:"indexes",elFilter:"#moduleFilterIndexes",componentIdFilter:"home_moduleFilter_indexes"},TOP_FLOP:{key:"topFlop",elFilter:"#moduleFilterTopFlop",componentIdFilter:"home_moduleFilter_topFlop"},MARKET_SUMMARY:{key:"marketSummary",elFilter:"#moduleFilterMarketSummary",componentIdFilter:"home_moduleFilter_marketSummary"},RESEARCH_NEWS:{key:"researchNews",elFilter:"#moduleFilterResearchNews",componentIdFilter:"home_moduleFilter_researchNews"},INVESTMENT_DETAIL:{key:"investmentDetail",elFilter:"#moduleFilterInvestmentDetail",componentIdFilter:"home_moduleFilter_investmentDetail"}},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"home_markUp"});component.on("rendered",function(){self._loadModules();self._addEvents(component);self._setModuleTitles();self._enableFilters();BANCOMER.Utils.Helper.setRefreshIcon()});component.on("clickToolBoxIndexes",function(){self.getComponent("home_marketGrid").openSelectorHeader()});component.on("clickToolBoxInstrumentSelector",this.openInstrumentSelector,this);component.on("clickRefreshInvestmentDetail",this.reloadInvestmentDetail,this);return component},_setModuleTitles:function(){var optionMarketSummary=this.getCurrentOptionModuleFilterMarketSummary();var optionTopFlop=this.getCurrentOptionModuleFilterTopFlop();var optionInvestmentDetail=this.getCurrentOptionModuleFilterInvestmentDetail();$("#marketSummaryHeader h2").text(BANCOMER.CULTURETEXT.t("moduleTitle_HomeMarketSummaryPrefix")+BANCOMER.CULTURETEXT.t(optionMarketSummary.textKey));$("#topFlopHeader h2").text(BANCOMER.CULTURETEXT.t(optionTopFlop.textKey));$("#investmentDetailHeader h2").text(BANCOMER.CULTURETEXT.t("moduleTitle_InvestmentDetailPrefix")+BANCOMER.CULTURETEXT.t(optionInvestmentDetail.textKey))},_enableFilters:function(){this._enableFilterResearchNews()},_enableFilterResearchNews:function(){var self=this;BANCOMER.Utils.Helper.hasResearchChannel(function(){$("#researchNewsHeaderFilter").show()},function(){$("#researchNewsHeaderFilter").hide()},self)},_loadComponentChartIndexes:function(){var component=new BANCOMER.Components.ChartIndexes({config:"home_IndexesChart",view:{el:$("#homeIndexesChart")}});return component},_addEvents:function(component){var self=this;BANCOMER.Launcher.on("changeAccount",this.reloadInvestmentDetail,this);component.on("clickModuleFilter",this.onClickModuleFilter,this);component.on("clickRefreshModule",this.onClickRefreshModule,this);component.on("clickModuleOpen",this.onClickModuleOpen,this)},_loadModules:function(){this._loadModuleIndexes();this._loadModulesTopFlopHorizontalList();this._loadModulesMarketSummary();this._loadModulesNewsResearch();this._loadModulesInvestmentDetail()},_loadModuleIndexes:function(){this.components.push(this._loadComponentChartIndexes());this.components.push(this._loadMarketGridIndexes())},_loadModulesMarketSummary:function(){this.components.push(this._loadComponentTopFlopPieChart());this.components.push(this._loadComponentMultipleTopFlopActive())},_loadModulesTopFlopHorizontalList:function(){this.components.push(this._loadModuleTopFlopHorizontalList())},_loadModulesNewsResearch:function(){this.components.push(this._loadComponentResearchNews())},_reloadInvestmentDetail:function(){var chart=this.getComponent("home_investmentDetailChart");var table=this.getComponent("home_investmentDetailTable");if(chart&&table){chart.reload()}},_loadModulesInvestmentDetail:function(){var self=this;var investmentChart=this._loadInvestmentDetailChart();this.components.push(investmentChart);investmentChart.on("loaded",function(){var investmentTable=self.getComponent("home_investmentDetailTable");if(investmentTable){investmentTable.model.models=investmentChart.model.models;investmentTable.reload()}else{self.components.push(self._loadInvestmentDetailTable(investmentChart.model))}})},_loadInvestmentDetailChart:function(){var component=new BANCOMER.Components.InvestmentDetailChart({config:"home_investmentDetailChart",view:{el:$("#homeInvestmentDetailChart")}});return component},_loadInvestmentDetailTable:function(model){var self=this;var component=new BANCOMER.Components.InvestmentDetailTable({serviceBCOMParams:{operationCode:"7",params:{data1:"D"}},config:"home_investmentDetailTable",view:{el:$("#homeInvestmentDetailTable")},data:model});component.on("sortView",function(eventData,target){component.model.sortview=true;self.onSortTableInvestmentDetail(eventData,component.view);self.getComponent("home_investmentDetailChart").reload(component.view.sortConfig)});return component},_loadMarketGridIndexes:function(){var component=new BANCOMER.Components.InstrumentList({config:"home_marketGrid",view:{el:$("#homeIndexesMarketGrid"),titleTextKey:this.titleTextKey}});return component},_loadModuleTopFlopHorizontalList:function(){var component=new BANCOMER.Components.MultipleTopFlopActive({config:"home_multipleTopFlopHorizontalList",view:{el:$("#homeMultiTopFlopList")}});return component},_loadComponentTopFlopPieChart:function(){var component=new BANCOMER.Components.TopFlopPieChart({config:"home_TopFlopPieChart",view:{el:$("#homeTopFlopPieChart")}});return component},_loadComponentMultipleTopFlopActive:function(){var component=new BANCOMER.Components.MultipleTopFlopActive({config:"home_multipleTopFlopActive",view:{el:$("#multipleTopFlopActive")}});return component},_loadComponentResearchNews:function(){var component=new BANCOMER.Components.ResearchNews({config:"home_ResearchNews",view:{}});component.on("rendered",this._setTitleComponentResearchNews,this);return component},_setTitleComponentResearchNews:function(component){var textKey="moduleTitle_ResearchNews";switch(component.config.viewOptions.preference){case"news":textKey="moduleTitle_ResearchNews_News";break;case"research":textKey="moduleTitle_ResearchNews_Research";break;case"researchNews":textKey="moduleTitle_ResearchNews";break}$("#researchNewsHeader h2").text(BANCOMER.CULTURETEXT.t(textKey))},destroy:function(){BANCOMER.Launcher.off("changeAccount");BANCOMER.Pages.Home.parent.destroy.call(this)},getCurrentOptionModuleFilterMarketSummary:function(){var pieChartComponent=this.getComponent("home_TopFlopPieChart");var multipleTopFlopActive=this.getComponent("home_multipleTopFlopActive");var whereSearch={mv:pieChartComponent.config.serviceParams.data.param.trim(),constituentscode:multipleTopFlopActive.config.serviceParams.data.param.trim()};return _.findWhere(BANCOMER.Utils.Filters.options.marketSummary,whereSearch)},getCurrentOptionModuleFilterTopFlop:function(){var topFlopComponent=this.getComponent("home_multipleTopFlopHorizontalList");var whereSearch={constituentscode:topFlopComponent.config.serviceParams.data.param.trim()};return _.findWhere(BANCOMER.Utils.Filters.options.topFlop,whereSearch)},getCurrentOptionModuleFilterInvestmentDetail:function(){var investmentDetailChartComponent=this.getComponent("home_investmentDetailChart");var whereSearch={instrumentType:investmentDetailChartComponent.config.viewOptions.filter&&investmentDetailChartComponent.config.viewOptions.filter.instrumentType?investmentDetailChartComponent.config.viewOptions.filter.instrumentType.trim():""};return _.findWhere(BANCOMER.Utils.Filters.options.investmentDetail,whereSearch)},getCurrentOptionModuleFilterResearchNews:function(){var researchNewsComponent=this.getComponent("home_ResearchNews");var whereSearch={value:researchNewsComponent.config.viewOptions.preference||"researchNews"};return _.findWhere(BANCOMER.Utils.Filters.options.researchNews,whereSearch)},showHideModuleFilter:function(module){var currentOption;if(module){switch(module){case this.moduleSettings.MARKET_SUMMARY.key:currentOption=this.getCurrentOptionModuleFilterMarketSummary();this._showHideModuleFilter(this.moduleSettings.MARKET_SUMMARY,currentOption?currentOption.key:{},BANCOMER.Utils.Filters.options.marketSummary,this._onClickOptionModuleFilterMarketSummary);break;case this.moduleSettings.TOP_FLOP.key:currentOption=this.getCurrentOptionModuleFilterTopFlop();this._showHideModuleFilter(this.moduleSettings.TOP_FLOP,currentOption?currentOption.key:{},BANCOMER.Utils.Filters.options.topFlop,this._onClickOptionModuleFilterTopFlop);break;case this.moduleSettings.INVESTMENT_DETAIL.key:currentOption=this.getCurrentOptionModuleFilterInvestmentDetail();this._showHideModuleFilter(this.moduleSettings.INVESTMENT_DETAIL,currentOption?currentOption.key:{},BANCOMER.Utils.Filters.options.investmentDetail,this._onClickOptionModuleFilterInvestmentDetail);break;case this.moduleSettings.RESEARCH_NEWS.key:currentOption=this.getCurrentOptionModuleFilterResearchNews();this._showHideModuleFilter(this.moduleSettings.RESEARCH_NEWS,currentOption?currentOption.key:{},BANCOMER.Utils.Filters.options.researchNews,this._onClickOptionModuleFilterResearchNews);break;default:break}}},_onClickOptionModuleFilterMarketSummary:function(eventData,target){var pieChartComponent=this.getComponent("home_TopFlopPieChart");var multipleTopFlopActive=this.getComponent("home_multipleTopFlopActive");if(pieChartComponent&&multipleTopFlopActive){if(eventData){this._hideModuleFilter(this.moduleSettings.MARKET_SUMMARY.elFilter);$("#marketSummaryHeader h2").text(BANCOMER.CULTURETEXT.t("moduleTitle_HomeMarketSummaryPrefix")+BANCOMER.CULTURETEXT.t(eventData.textkey));pieChartComponent.config.serviceParams.data.param=eventData.mv;multipleTopFlopActive.config.serviceParams.data.param=eventData.constituentscode;BANCOMER.Utils.Preferences.addPreferenceModuleServiceParam("home_TopFlopPieChart",eventData.mv);BANCOMER.Utils.Preferences.addPreferenceModuleServiceParam("home_multipleTopFlopActive",eventData.constituentscode);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}pieChartComponent.reload();multipleTopFlopActive.reload()}},_onClickOptionModuleFilterTopFlop:function(eventData,target){var topFlopComponent=this.getComponent("home_multipleTopFlopHorizontalList");var filterComponent=this.getComponent(this.moduleSettings.TOP_FLOP.componentIdFilter);if(topFlopComponent){if(eventData&&eventData.constituentscode&&eventData.textkey&&filterComponent){this._hideModuleFilter(this.moduleSettings.TOP_FLOP.elFilter);$("#topFlopHeader h2").text(BANCOMER.CULTURETEXT.t(eventData.textkey));topFlopComponent.config.serviceParams.data.param=eventData.constituentscode;BANCOMER.Utils.Preferences.addPreferenceModuleServiceParam("home_multipleTopFlopHorizontalList",eventData.constituentscode);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}topFlopComponent.reload()}},_onClickOptionModuleFilterInvestmentDetail:function(eventData,target){var chartComponent=this.getComponent("home_investmentDetailChart");var tableComponent=this.getComponent("home_investmentDetailTable");var viewOptions={};var filterInvestmentDetailComponent=this.getComponent(this.moduleSettings.INVESTMENT_DETAIL.componentIdFilter);if(eventData&&eventData.textkey&&chartComponent&&tableComponent&&filterInvestmentDetailComponent){this._hideModuleFilter(this.moduleSettings.INVESTMENT_DETAIL.elFilter);viewOptions={filter:{instrumentType:eventData.instrumenttype}};$("#investmentDetailHeader h2").text(BANCOMER.CULTURETEXT.t("moduleTitle_InvestmentDetailPrefix")+BANCOMER.CULTURETEXT.t(eventData.textkey));chartComponent.config.viewOptions.filter=chartComponent.config.viewOptions.filter||{};chartComponent.config.viewOptions.filter.instrumentType=eventData.instrumenttype;chartComponent.view.render();tableComponent.config.viewOptions.filter=tableComponent.config.viewOptions.filter||{};tableComponent.config.viewOptions.filter.instrumentType=eventData.instrumenttype;tableComponent.view.render();BANCOMER.Utils.Preferences.addPreferenceModuleViewOptions("home_investmentDetailChart",viewOptions);BANCOMER.Utils.Preferences.addPreferenceModuleViewOptions("home_investmentDetailTable",viewOptions);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}},_onClickOptionModuleFilterResearchNews:function(eventData,target){var researchNewsComponent=this.getComponent("home_ResearchNews");var filterComponent=this.getComponent(this.moduleSettings.RESEARCH_NEWS.componentIdFilter);var viewOptions={};if(eventData.preference&&eventData.textkey&&researchNewsComponent&&filterComponent){this._hideModuleFilter(this.moduleSettings.RESEARCH_NEWS.elFilter);researchNewsComponent.config.viewOptions.preference=eventData.preference;researchNewsComponent.recreate();this._setTitleComponentResearchNews(researchNewsComponent);viewOptions={preference:eventData.preference};BANCOMER.Utils.Preferences.addPreferencesModuleResearchNews(viewOptions);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}},onSortTableInvestmentDetail:function(data,view){view.sortView(data)},openPage:function(data,target){var currentOption;var constituentsCode;var textKey;var module=data.module;if(module){switch(module){case this.moduleSettings.MARKET_SUMMARY.key:currentOption=this.getCurrentOptionModuleFilterMarketSummary();constituentsCode=BANCOMER.Utils.Filters.options.marketSummary[currentOption.key].constituentscodeDetail;textKey=BANCOMER.Utils.Filters.options.marketSummary[currentOption.key].textKey;document.location.href=data.href+"/"+constituentsCode+"/"+textKey+"/"+module;break;case this.moduleSettings.TOP_FLOP.key:currentOption=this.getCurrentOptionModuleFilterTopFlop();constituentsCode=BANCOMER.Utils.Filters.options.topFlop[currentOption.key].constituentscodeDetail;textKey=BANCOMER.Utils.Filters.options.topFlop[currentOption.key].textKey;document.location.href=data.href+"/"+constituentsCode+"/"+textKey+"/"+module;break;case this.moduleSettings.RESEARCH_NEWS.key:currentOption=this.getCurrentOptionModuleFilterResearchNews();document.location.href=data.href+"/"+currentOption.textKey;break;default:break}}},getComponentInstrumentSelector:function(models){var self=this;var component=new BANCOMER.Components.InstrumentSelector({config:"instrument_selector",service:{},title:"componentTitle_InstrumentSelector_Index",models:models});this.components.push(component);return component},getMVSIndexesChart:function(){var models=[];var self=this;var indexexChart=this.getComponent("home_IndexesChart");if(indexexChart&&indexexChart.model.models){models=indexexChart.model.models}return models},openInstrumentSelector:function(){var self=this;var models=this.getMVSIndexesChart();var component=this.getComponentInstrumentSelector(models);component.on("rendered",function(){$(component.config.viewOptions.el).show()});component.on("closeClick",function(){$(component.config.viewOptions.el).hide();self.hideComponent("instrument_selector")});component.on("userInstrumentsSaved",function(data){self.reloadChartIndexes(data);self.reloadMarketGridIndexes(data);$(component.config.viewOptions.el).hide();self.hideComponent("instrument_selector")})},reloadChartIndexes:function(data){var component=this.getComponent("home_IndexesChart");if(component){if(data&&data.type&&data.param){component.config.serviceParams.data.param=data.param||component.config.serviceParams.data.param;component.config.serviceParams.data.type=data.type||component.config.serviceParams.data.type;BANCOMER.Utils.Preferences.addPreferenceModuleServiceParamType("home_IndexesChart",data.param,data.type);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}component.reload()}},reloadMarketGridIndexes:function(data){var component=this.getComponent("home_marketGrid");if(component){if(data&&data.type&&data.param){component.config.serviceParams.data.param=data.param||component.config.serviceParams.data.param;component.config.serviceParams.data.type=data.type||component.config.serviceParams.data.type;BANCOMER.Utils.Preferences.addPreferenceModuleServiceParamType("home_marketGrid",data.param,data.type);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}component.reload()}},refreshModule:function(module){if(module==="researchNews"){this.reloadModuleResearchNews()}else if(module==="indexes"){this.reloadMarketGridIndexes();this.reloadChartIndexes()}else if(module==="marketSummary"){this._onClickOptionModuleFilterMarketSummary()}else if(module==="investmentDetail"){this.reloadInvestmentDetail()}else if(module==="topFlop"){this._onClickOptionModuleFilterTopFlop()}},reloadModuleResearchNews:function(){var component=this.getComponent("home_ResearchNews");if(component){component.reload()}}});BANCOMER.Pages.IndexDetailPage=IFB.Class(BANCOMER.Pages.Base,{initialize:function(options){this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"indexDetailPage_markUp"});component.on("rendered",function(){self._loadComponents();BANCOMER.Utils.Helper.setRefreshIcon()});component.on("clickToolBoxIndexesPage",function(){self.getComponent("indexDetailPage_indexTable").openSelectorHeader()});component.on("clickToolBoxInstrumentSelector",this.openInstrumentSelector,this);component.on("clickRefreshModule",this.onClickRefreshModule,this);component.on("clickClosePage",function(){self.onClickCloseButton()});return component},_loadComponents:function(){this.components.push(this._loadComponentChartIndexes());this.components.push(this._loadMarketIndexesTable())},_loadComponentChartIndexes:function(){var component=new BANCOMER.Components.ChartIndexes({config:"indexDetailPage_indexChart",view:{el:$("#indexDetailPageChart")}});return component},_loadMarketIndexesTable:function(){var component=new BANCOMER.Components.InstrumentList({config:"indexDetailPage_indexTable",view:{el:$("#indexDetailPageTable")}});return component},getMVSIndexesChart:function(){var models=[];var self=this;var indexexChart=this.getComponent("indexDetailPage_indexChart");if(indexexChart&&indexexChart.model.models){models=indexexChart.model.models}return models},getComponentInstrumentSelector:function(models){var self=this;var component=new BANCOMER.Components.InstrumentSelector({config:"instrument_selector_maximized",service:{},title:"componentTitle_InstrumentSelector_Index",models:models});this.components.push(component);return component},openInstrumentSelector:function(){var self=this;var models=this.getMVSIndexesChart();var component=this.getComponentInstrumentSelector(models);component.on("rendered",function(){$(component.config.viewOptions.el).show()});component.on("closeClick",function(){$(component.config.viewOptions.el).hide();self.hideComponent("instrument_selector")});component.on("userInstrumentsSaved",function(data){self.reloadChartIndexes(data);self.reloadMarketGridIndexes(data);$(component.config.viewOptions.el).hide();self.hideComponent("instrument_selector")})},reloadChartIndexes:function(data){var component=this.getComponent("indexDetailPage_indexChart");if(data&&data.type&&data.param&&component){component.config.serviceParams.data.param=data.param;component.config.serviceParams.data.type=data.type;component.reload();BANCOMER.Utils.Preferences.addPreferenceModuleServiceParamType("indexDetailPage_indexChart",data.param,data.type);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}},reloadMarketGridIndexes:function(data){var component=this.getComponent("indexDetailPage_indexTable");if(data&&data.type&&data.param&&component){component.config.serviceParams.data.param=data.param;component.config.serviceParams.data.type=data.type;component.reload();BANCOMER.Utils.Preferences.addPreferenceModuleServiceParamType("indexDetailPage_indexTable",data.param,data.type);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}},refreshModule:function(module){if(module==="indexDetail"){this.reloadModuleIndexDetail()}},reloadModuleIndexDetail:function(){var chartComponent=this.getComponent("indexDetailPage_indexChart");var tableComponent=this.getComponent("indexDetailPage_indexTable");if(chartComponent){chartComponent.reload()}if(tableComponent){tableComponent.reload()}}});BANCOMER.Pages.InstrumentList=IFB.Class(BANCOMER.Pages.Base,{constituentsCode:"",titleTextKey:"",module:"",moduleSettings:{key:"",elFilter:"#moduleFilterInstrumentList",componentIdFilter:"instrumentList_moduleFilter"},initialize:function(options){this.constituentsCode=options.constituentsCode;this.titleTextKey=options.titleTextKey;this.module=options.module;this.moduleSettings.key=this.module;this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"instrumentList_markUp"});component.on("rendered",function(){$("h2",self.el).html(BANCOMER.CULTURETEXT.t(self.titleTextKey));self._loadComponents();BANCOMER.Utils.Helper.setRefreshIcon()});component.on("clickToolBoxInstrumentList",function(){if(self.components[1]){self.components[1].openSelectorHeader()}});component.on("clickClosePage",function(){self.onClickCloseButton()});component.on("clickModuleFilter",this.onClickModuleFilter,this);component.on("clickRefreshModule",this.onClickRefreshModule,this);return component},_loadComponents:function(){if(this.titleTextKey.indexOf("GlobalMarket")!==-1||this.titleTextKey.indexOf("Warrants")!==-1){this.components.push(this._loadComponentTopFlop())}else{this.components.push(this._loadComponentInstrumentList())}},_loadComponentInstrumentList:function(){var component=new BANCOMER.Components.TopFlopDetailList({config:"instrumentList_table",view:{el:$("#instrumentList_table"),titleTextKey:this.titleTextKey},service:{param:this.constituentsCode}});return component},_loadComponentTopFlop:function(){var component=new BANCOMER.Components.TopFlopDetailList({config:"instrument_listTopFlop",view:{el:$("#instrumentList_table"),titleTextKey:this.titleTextKey},service:{param:this.constituentsCode}});return component},getCurrentOptionModuleFilter:function(){var component=this.getComponent("instrumentList_table")||this.getComponent("instrument_listTopFlop");var whereSearch={constituentscodeDetail:component.config.serviceParams.data.param.trim()};return _.findWhere(BANCOMER.Utils.Filters.options[this.module],whereSearch)},showHideModuleFilter:function(){var currentOption=this.getCurrentOptionModuleFilter();this._showHideModuleFilter(this.moduleSettings,currentOption?currentOption.key:{},BANCOMER.Utils.Filters.options[this.module],this._onClickOptionModuleFilter)},_onClickOptionModuleFilter:function(eventData,target){var component=this.getComponent("instrumentList_table")||this.getComponent("instrument_listTopFlop");var filterComponent=this.getComponent(this.moduleSettings.componentIdFilter);if(eventData.constituentscode&&eventData.textkey&&filterComponent){this._hideModuleFilter(this.moduleSettings.elFilter);$("#intrumentListHeader h2").text(BANCOMER.CULTURETEXT.t(eventData.textkey));component.config.serviceParams.data.param=eventData.constituentscode;component.reload();BANCOMER.Utils.Preferences.addPreferencesModuleInstrumentList(this.module,eventData.mv,eventData.constituentscode);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}},refreshModule:function(module){if(module==="instrumentList"){this.reloadModuleInstrumentList()}},reloadModuleInstrumentList:function(){var component=this.getComponent("instrumentList_table")||this.getComponent("instrument_listTopFlop");if(component){component.reload()}}});BANCOMER.Pages.InvestmentChartDetail=IFB.Class(BANCOMER.Pages.Base,{configId:"",initialize:function(options){this.configId=options.configId;this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"investmentChartDetail_markUp"});component.on("rendered",function(){self._loadComponents()});return component},_loadComponents:function(){this.components.push(this._loadComponentChart(this.configId))},_loadComponentChart:function(configId){var self=this;var component=new BANCOMER.Components.InstrumentDetailCharts({config:configId,view:{el:"#investmentChartDetail_chart",templateFile:"/investmentChartDetail/chart.htm",filters:{chartType:{el:"#detailChartFilterChartType",suffixCls:"",config:"investmentChartDetail_filter_chartType"},period:{el:"#detailChartFilterPeriod",suffixCls:"",config:"investmentChartDetail_filter_period"},frequency:{el:"#detailChartFilterFrequency",suffixCls:"",config:"investmentChartDetail_filter_frequency"}}},service:{}});component.on("clickClosePage",function(){self.onClickCloseButton()});return component},onClickCloseButton:function(){document.location.href="#!/investmentDetail"},destroy:function(){BANCOMER.Launcher.off("changeAccount");BANCOMER.Pages.InvestmentChartDetail.parent.destroy.call(this)}});BANCOMER.Pages.InvestmentDetail=IFB.Class(BANCOMER.Pages.Base,{waitForReloadMillis:500,changeAccountRequested:false,initialize:function(options){this.reloadInvestmentDetail=this.waitForReloadMillis>0?_.debounce(this._reloadInvestmentDetail,this.waitForReloadMillis):this._reloadInvestmentDetail;this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"investmentDetail_markUp"});component.on("rendered",function(){self._loadComponents();self._addEvents()});return component},_addEvents:function(){BANCOMER.Launcher.on("changeAccount",this.reloadInvestmentDetail,this)},_loadComponents:function(){var self=this;var orderBookComponent;var positionBookComponent=this._loadComponentInvestmentDetailTable();this.components.push(positionBookComponent);positionBookComponent.on("loaded",function(){orderBookComponent=self.getComponent("investmentDetail_orderBookTable");if(!orderBookComponent){self.components.push(self._loadComponentOrderBook())}else{if(self.changeAccountRequested){orderBookComponent.reload();self.changeAccountRequested=false}}});this.components.push(this._loadComponentChart("investmentDetail_chart1"));this.components.push(this._loadComponentChart("investmentDetail_chart2"));this.components.push(this._loadComponentChart("investmentDetail_chart3"))},_loadComponentInvestmentDetailTable:function(){var self=this;var component=new BANCOMER.Components.InvestmentDetailTable({serviceBCOMParams:{operationCode:"7",params:{data1:"D"}},config:"investmentDetail_positionTable",view:{el:$("#investmentDetail_positionTable")}});component.on("clickToolBoxInstrumentList",function(){component.openSelectorHeader()});component.on("sortView",function(eventData,target){component.model.sortview=true;self.onSortTableInvestmentDetail(eventData,component.view)});return component},onSortTableInvestmentDetail:function(data,view){view.sortView(data)},_loadComponentOrderBook:function(){var component=new BANCOMER.Components.OrderBookTable({config:"investmentDetail_orderBookTable",view:{el:$("#investmentDetail_orderBookTable")}});component.on("clickToolBoxInstrumentList",function(){component.openSelectorHeader()});return component},_loadComponentChart:function(configId){var component=new BANCOMER.Components.InstrumentDetailCharts({config:configId,view:{}});return component},destroy:function(){BANCOMER.Launcher.off("changeAccount");BANCOMER.Pages.InvestmentDetail.parent.destroy.call(this)},_reloadInvestmentDetail:function(){var positionBook=this.getComponent("investmentDetail_positionTable");this.changeAccountRequested=true;if(positionBook){positionBook.reload()}}});BANCOMER.Pages.Logout=IFB.Class(BANCOMER.Pages.Base,{initialize:function(options){this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"logout_markUp"});return component}});BANCOMER.Pages.OrderBookDetail=IFB.Class(BANCOMER.Pages.Base,{initialize:function(options){this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"orderBookDetail_markUp"});component.on("rendered",function(){self._loadComponents();self._addEvents()});return component},_addEvents:function(){var self=this;var component;BANCOMER.Launcher.on("changeAccount",function(){component=self.getComponent("orderBookDetail_orderBookTable");component.config.serviceBCOMParams.params={data1:component.config.serviceBCOMParams.params.data1};component.reload()})},_loadComponents:function(){this.components.push(this._loadComponentOrderBook())},_loadComponentOrderBook:function(){var component=new BANCOMER.Components.OrderBookTable({config:"orderBookDetail_orderBookTable",view:{el:$("#orderBookDetail_orderBookTable")}});component.on("clickToolBoxInstrumentList",function(){component.openSelectorHeader()});return component},destroy:function(){BANCOMER.Launcher.off("changeAccount");BANCOMER.Pages.OrderBookDetail.parent.destroy.call(this)}});BANCOMER.Pages.PositionDetail=IFB.Class(BANCOMER.Pages.Base,{initialize:function(options){this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"positionDetail_markUp"});component.on("rendered",function(){self._loadComponents();self._addEvents()});return component},_addEvents:function(){var self=this;var component;BANCOMER.Launcher.on("changeAccount",function(){component=self.getComponent("positionDetail_positionTable");component.config.serviceBCOMParams.params={data1:component.config.serviceBCOMParams.params.data1};component.reload()})},_loadComponents:function(){this.components.push(this._loadComponentPositionDetailTable())},_loadComponentPositionDetailTable:function(){var self=this;var component=new BANCOMER.Components.InvestmentDetailTable({serviceBCOMParams:{operationCode:"7",params:{data1:"D"}},config:"positionDetail_positionTable",view:{el:$("#positionDetail_positionTable")}});component.on("clickToolBoxInstrumentList",function(){component.openSelectorHeader()});component.on("sortView",function(eventData,target){component.model.sortview=true;self.onSortTableInvestmentDetail(eventData,component.view)});return component},onSortTableInvestmentDetail:function(data,view){view.sortView(data)},destroy:function(){BANCOMER.Launcher.off("changeAccount");BANCOMER.Pages.PositionDetail.parent.destroy.call(this)}});BANCOMER.Pages.ResearchNews=IFB.Class(BANCOMER.Pages.Base,{titleTextKey:"",moduleSettings:{RESEARCH_NEWS:{key:"researchNews",elFilter:"#moduleFilterResearchNewsMaximized",componentIdFilter:"researchNews_moduleFilter_researchNews"}},initialize:function(options){this.titleTextKey=options.titleTextKey;this.components.push(this._loadMarkUp())},_enableFilters:function(){this._enableFilterResearchNews()},_enableFilterResearchNews:function(){var self=this;BANCOMER.Utils.Helper.hasResearchChannel(function(){$("#researchNewsHeaderFilter").show()},function(){$("#researchNewsHeaderFilter").hide()},self)},showHideModuleFilter:function(module){var currentOption;if(module){switch(module){case this.moduleSettings.RESEARCH_NEWS.key:currentOption=this.getCurrentOptionModuleFilterResearchNews();this._showHideModuleFilter(this.moduleSettings.RESEARCH_NEWS,currentOption?currentOption.key:{},BANCOMER.Utils.Filters.options.researchNews,this._onClickOptionModuleFilterResearchNews);break;default:break}}},_addEvents:function(component){component.on("clickModuleFilter",this.onClickModuleFilter,this);component.on("clickRefreshModule",this.onClickRefreshModule,this)},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"researchNews_markUp"});component.on("rendered",function(){self.components.push(self._loadComponents());self._enableFilters();self._addEvents(component);BANCOMER.Utils.Helper.setRefreshIcon()});component.on("clickClosePage",function(){self.onClickCloseButton()});return component},_loadComponents:function(){var component=new BANCOMER.Components.ResearchNews({config:"researchNews_ResearchNews",view:{}});component.on("rendered",this._setTitleComponentResearchNews,this);return component},_setTitleComponentResearchNews:function(component){var textKey="moduleTitle_ResearchNews";switch(component.config.viewOptions.preference){case"news":textKey="moduleTitle_ResearchNews_News";break;case"research":textKey="moduleTitle_ResearchNews_Research";break;case"researchNews":textKey="moduleTitle_ResearchNews";break}$("#researchNewsHeader h2").text(BANCOMER.CULTURETEXT.t(textKey))},getCurrentOptionModuleFilterResearchNews:function(){var researchNewsComponent=this.getComponent("researchNews_ResearchNews");var whereSearch={value:researchNewsComponent.config.viewOptions.preference||"researchNews"};return _.findWhere(BANCOMER.Utils.Filters.options.researchNews,whereSearch)},_onClickOptionModuleFilterResearchNews:function(eventData,target){var researchNewsComponent=this.getComponent("researchNews_ResearchNews");var filterComponent=this.getComponent(this.moduleSettings.RESEARCH_NEWS.componentIdFilter);var viewOptions={};if(eventData.preference&&eventData.textkey&&researchNewsComponent&&filterComponent){this._hideModuleFilter(this.moduleSettings.RESEARCH_NEWS.elFilter);researchNewsComponent.config.viewOptions.preference=eventData.preference;researchNewsComponent.recreate();this._setTitleComponentResearchNews(researchNewsComponent);viewOptions={preference:eventData.preference};BANCOMER.Utils.Preferences.addPreferencesModuleResearchNews(viewOptions);BANCOMER.Utils.Preferences.save();BANCOMER.Defaults.Templates=$.extend(true,BANCOMER.Defaults.Templates,BANCOMER.Utils.Preferences.preferences.modules)}},refreshModule:function(module){if(module==="researchNews"){this.reloadModuleResearchNews()}},reloadModuleResearchNews:function(){var component=this.getComponent("researchNews_ResearchNews");if(component){component.reload()}}});BANCOMER.Pages.Tutorial=IFB.Class(BANCOMER.Pages.Base,{initialize:function(options){this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"tutorial_markUp"});component.on("rendered",function(){var mySwiper=new Swiper(".swiper-container",{loop:true,pagination:".swiper-pagination",nextButton:".swiper-button-next",prevButton:".swiper-button-prev",scrollbar:".swiper-scrollbar"})});component.on("clickClosePage",function(){self.onClickCloseButton()});return component}});BANCOMER.Pages.WorkSpace=IFB.Class(BANCOMER.Pages.Base,{id:undefined,name:undefined,workspace:undefined,canEditModule:true,LAYOUT_TYPE_1:"1",LAYOUT1_MODULE1:"1",LAYOUT1_MODULE2:"2",LAYOUT1_MODULE3:"3",layoutComponents:{1:{1:{el:"#layout1Module1",component:undefined},2:{el:"#layout1Module2",component:undefined},3:{el:"#layout1Module3",component:undefined}}},options:{modules:{INDEXES:{key:"1",textKey:"componentLabel_ModuleWorkSpace_Option_Indexes",suffixFile:"_index"},ISSUER:{key:"2",textKey:"componentLabel_ModuleWorkSpace_Option_Issuer",suffixFile:"_issuer"},CHART:{key:"3",textKey:"componentLabel_ModuleWorkSpace_Option_Chart",suffixFile:"_chart"},POSITIONS:{key:"4",textKey:"componentLabel_ModuleWorkSpace_Option_Position",suffixFile:"_position"}}},initialize:function(options){this.id=options.id;this.name=options.name;this.loadLayout()},loadLayout:function(){this.workspace=BANCOMER.Utils.Preferences.preferences.workspaces[this.id]||BANCOMER.Utils.Preferences.getWorkspaceObject(this.name,this.id,"1",{});this.saveWorkspace();if(this.workspace){this.setWorkspaceName();switch(this.workspace.layout){case this.LAYOUT_TYPE_1:this.loadLayout1();break}}},loadLayout1:function(){var markUpLayout=this.loadMarkUpLayout1();var self=this;markUpLayout.on("rendered",function(){self.loadComponentsLayout1()});this.components.push(markUpLayout)},loadMarkUpLayout1:function(){return new BANCOMER.Components.Static({config:"workspace_layout_markUp1"})},loadComponentsLayout1:function(){if(this.workspace){if(!this.workspace.modules["1"]||this.workspace.modules["1"]&&!this.workspace.modules["1"].type){this.loadComponentOptions(this.LAYOUT_TYPE_1,this.LAYOUT1_MODULE1)}else{this.loadComponentModule(this.LAYOUT_TYPE_1,this.LAYOUT1_MODULE1,this.workspace.modules["1"])}if(!this.workspace.modules["2"]||this.workspace.modules["2"]&&!this.workspace.modules["2"].type){this.loadComponentOptions(this.LAYOUT_TYPE_1,this.LAYOUT1_MODULE2)}else{this.loadComponentModule(this.LAYOUT_TYPE_1,this.LAYOUT1_MODULE2,this.workspace.modules["2"])}if(!this.workspace.modules["3"]||this.workspace.modules["3"]&&!this.workspace.modules["3"].type){this.loadComponentOptions(this.LAYOUT_TYPE_1,this.LAYOUT1_MODULE3)}else{this.loadComponentModule(this.LAYOUT_TYPE_1,this.LAYOUT1_MODULE3,this.workspace.modules["3"])}}},addComponentLayout:function(layout,moduleId,component){if(component){this.layoutComponents[layout][moduleId].component=component;this.components.push(component)}},loadComponentOptions:function(layout,moduleId){var self=this;var component=new BANCOMER.Components.WorkSpaceModule({config:"workspace_layout_options",service:{},view:{el:$(self.layoutComponents[layout][moduleId].el),options:this.options.modules,layout:layout,module:moduleId,workspace:self.id}});component.on("clickOptionFilter",function(data){self.changeModule(data,false)});this.addComponentLayout(layout,moduleId,component)},changeModule:function(data,loadSelector){if(data){var oldComponent=this.layoutComponents[data.layout][data.module].component;this.components=_.without(this.components,oldComponent);oldComponent.destroy();this.workspace.modules[data.module]=this.workspace.modules[data.module]||{};this.workspace.modules[data.module].config={};this.workspace.modules[data.module].type=data.type;this.saveWorkspace();if(loadSelector){this.loadComponentOptions(data.layout,data.module)}else{this.loadComponentModule(data.layout,data.module,this.workspace.modules[data.module])}}},loadComponentModule:function(layout,moduleId,moduleData){var component;if(moduleData&&moduleData.type){switch(moduleData.type.toString()){case this.options.modules.INDEXES.key:component=this.loadComponentModuleIndexes(this.layoutComponents[layout][moduleId].el,layout,moduleId,moduleData,this.options.modules.INDEXES.suffixFile);break;case this.options.modules.ISSUER.key:component=this.loadComponentModuleIssuers(this.layoutComponents[layout][moduleId].el,layout,moduleId,moduleData,this.options.modules.ISSUER.suffixFile);break;case this.options.modules.CHART.key:component=this.loadComponentModuleChart(this.layoutComponents[layout][moduleId].el,layout,moduleId,moduleData,this.options.modules.CHART.suffixFile);break;case this.options.modules.POSITIONS.key:component=this.loadComponentModuleInvestmentDetail(this.layoutComponents[layout][moduleId].el,layout,moduleId,moduleData,this.options.modules.POSITIONS.suffixFile);break}}if(component){if(this.canEditModule){component.on("clickEditModule",this.clickEditModule,this);this.addComponentLayout(layout,moduleId,component)}}},clickEditModule:function(data){var self=this;var buttons=[{text:BANCOMER.CULTURETEXT.t("noty_Btn_Exit_Close"),callback:function(){self.changeModule(data,true)}},{text:BANCOMER.CULTURETEXT.t("noty_Btn_Exit_Cancel")}];BANCOMER.Utils.Helper.showNotificationWarning("warning",BANCOMER.CULTURETEXT.t("noty_ChangeModule_Title"),true,buttons)},setWorkspaceName:function(){this.name=this.name||this.workspace.title;this.hideWSHeaderItems();$(".contHeader02 .title").append("<i class='icoTitle layout1' id='icoWorkSpace'></i>");$(".contHeader02 .title").append("<div class='txtTitle layout1' id='titleWorkSpace'>"+BANCOMER.Utils.Preferences.preferences.workspaces[this.id].title+"</div>");$(".contHeader02 .title").append("<i class='icoLapiz' id='icoEdit'></i>");BANCOMER.Router.setWorkspaceTitle(this.name);this.addEventEdit()},hideWSHeaderItems:function(){$("#icoEdit").remove();$("#icoWorkSpace").remove();$("#titleWorkSpace").remove()},addEventEdit:function(){var self=this;$("#icoEdit").on("click",function(){self.clickEditWorkspace()})},clickEditWorkspace:function(data){var self=this;var buttons=[{text:BANCOMER.CULTURETEXT.t("noty_Btn_Exit_Cancel"),callback:function(){BANCOMER.Utils.Helper.resetScrollTo()}},{text:BANCOMER.CULTURETEXT.t("noty_Btn_WorkSpace_NameChange"),callback:function(){BANCOMER.Utils.Helper.resetScrollTo();var title=$(".inputWorkSpace").val()||self.name;self.name=title;self.workspace.title=title;self.saveWorkspace();BANCOMER.Router.setWorkspaceTitle(title)}}];BANCOMER.Utils.Helper.showNotificationWorkSpaceName("warning",'<input class="inputWorkSpace" value="'+self.name+'" maxlength="15" type="text" name="search" placeholder="">',true,buttons)},saveWorkspace:function(){if(this.id&&this.workspace){BANCOMER.Utils.Preferences.saveWorkspace(this.id,this.workspace)}},destroy:function(){this.hideWSHeaderItems();this.layoutComponents={};BANCOMER.Launcher.off("changeAccount");BANCOMER.Pages.WorkSpace.parent.destroy.call(this)},loadComponentModuleInvestmentDetail:function(el,layout,moduleId,moduleData,suffixFile){return this.loadComponentInvestmentDetail(el,layout,moduleId,moduleData,"workspaces_module_investmentDetailTable",suffixFile)},onSortTableInvestmentDetail:function(data,view){view.sortView(data)},loadComponentModuleChart:function(el,layout,moduleId,moduleData,suffixFile){return this.loadComponentChart(el,layout,moduleId,moduleData,"workspace_layout_chart",suffixFile)},loadComponentChart:function(el,layout,moduleId,moduleData,configId,suffixFile){var self=this;var config={config:configId,service:{},view:{el:$(el),layout:layout,componentId:moduleId,workspace:self.id},charts:{intraday:{type:"line",frequency:"1",period:"1d"},daily:{type:"line",frequency:"d",period:"1y"}}};if(moduleData){if(moduleData.config&&moduleData.config.mv){var service={param:moduleData.config.mv};config.service=service}if(moduleData.config&&moduleData.config.charts){config.charts=moduleData.config.charts}}var component=new BANCOMER.Components.WorkSpaceChart(config);component.on("saveChartPreferences",function(data){moduleData.config.charts=data.charts||moduleData.config.charts||{};moduleData.config.mv=data.param||moduleData.config.mv||"";BANCOMER.Utils.Preferences.updateModuleWorkspace(self.id,moduleId,moduleData)});return component},loadComponentModuleMyInstruments:function(el,layout,moduleId,moduleData,configId,suffixFile){var self=this;var config={config:configId,view:{el:$(el),idTable:self.getColumnadoNameFile(moduleId,suffixFile),module:moduleId,layout:layout,workspace:self.id},service:moduleData.config.serviceParams};var component=new BANCOMER.Components.WorkspaceInstruments(config);component.on("userInstrumentsChanged",function(data){var serviceParams={serviceParams:{data:{param:data.param,type:data.type}}};moduleData.config=serviceParams;BANCOMER.Utils.Preferences.updateModuleWorkspace(self.id,moduleId,moduleData)});return component},loadComponentModuleIssuers:function(el,layout,moduleId,moduleData,suffixFile){return this.loadComponentModuleMyInstruments(el,layout,moduleId,moduleData,"workspaces_module_issuers",suffixFile)},loadComponentModuleIndexes:function(el,layout,moduleId,moduleData,suffixFile){return this.loadComponentModuleMyInstruments(el,layout,moduleId,moduleData,"workspaces_module_indexes",suffixFile)},loadComponentInvestmentDetail:function(el,layout,moduleId,moduleData,configId,suffixFile){var self=this;var config={config:configId,serviceBCOMParams:{operationCode:"7",params:{data1:"D"}},view:{el:$(el),dataTable:{id:self.getColumnadoNameFile(moduleId,suffixFile)},module:moduleId,workspace:self.id,layout:layout,dataTable:{id:"instrumentListTableLayout"+layout+"module"+moduleId,fixedColumns:{leftColumns:3,rightColumns:2}}},configHeaderSelector:{file:self.getColumnadoNameFile(moduleId,suffixFile)}};var component=new BANCOMER.Components.InvestmentDetailTable(config);component.on("clickToolBoxInstrumentList",function(){component.openSelectorHeader()});component.on("sortView",function(eventData,target){component.model.sortview=true;self.onSortTableInvestmentDetail(eventData,component.view)});BANCOMER.Launcher.on("changeAccount",function(){if(component){component.reload()}});return component},getColumnadoNameFile:function(moduleId,suffix){return"ws"+this.id+"_md"+moduleId+(suffix||"")}});BANCOMER.Pages.WorkspaceMaximized=IFB.Class(BANCOMER.Pages.WorkSpace,{layoutComponents:{1:{1:{el:"#workspaceModuleMaximized"},2:{el:"#workspaceModuleMaximized"},3:{el:"#workspaceModuleMaximized"}}},initialize:function(options){this.module=options.module;this.id=options.id;this.canEditModule=false;this.components.push(this.loadMarkUp())},loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"workspaces_maximized_markUp"});component.on("rendered",function(){self.loadWorkspace()});return component},loadWorkspace:function(){this.workspace=BANCOMER.Utils.Preferences.preferences.workspaces[this.id]||BANCOMER.Utils.Preferences.getWorkspaceObject(this.name,this.id,"1",{});if(this.workspace){this.setWorkspaceName();this.loadComponentModule(this.workspace.layout,this.module,this.workspace.modules[this.module])}},loadComponentModuleIssuers:function(el,layout,moduleId,moduleData,suffixFile){return this.loadComponentModuleMyInstruments(el,layout,moduleId,moduleData,"workspaces_module_issuers_maximized",suffixFile)},loadComponentModuleIndexes:function(el,layout,moduleId,moduleData,suffixFile){return this.loadComponentModuleMyInstruments(el,layout,moduleId,moduleData,"workspaces_module_indexes_maximized",suffixFile)},loadComponentModuleInvestmentDetail:function(el,layout,moduleId,moduleData,suffixFile){return this.loadComponentInvestmentDetail(el,layout,moduleId,moduleData,"workspaces_module_investmentDetailTable_maximized",suffixFile)},loadComponentModuleChart:function(el,layout,moduleId,moduleData,suffixFile){return this.loadComponentChart(el,layout,moduleId,moduleData,"workspace_layout_chart_maximized",suffixFile)}});BANCOMER.Lightboxes.Base=IFB.Class(BANCOMER.Pages.Base,{components:[],initialize:function(options){this.components=[];BANCOMER.Lightboxes.Base.parent.initialize.call(this,options)},show:function(){$(this.components[0].config.viewOptions.el).show();BANCOMER.Utils.Helper.resetScrollTo();this.reloadcomponents()},hide:function(){$(this.components[0].config.viewOptions.el).hide()},close:function(){this.hide();BANCOMER.Router.destroyPreviousLightbox();BANCOMER.Router.navigate("",{trigger:false,replace:true})},reloadcomponents:function(){if(this.components.length>0){_.each(this.components,function(component){if(component&&component.model&&_.isFunction(component.reload)){component.reload()}})}},getComponentModel:function(componentId){var component=this.getComponent(componentId);return component&&component.model?component.model:undefined}});BANCOMER.Lightboxes.Boleta=IFB.Class(BANCOMER.Lightboxes.Base,{mv:"",side:"",title:"",components:[],listenBoletaForm:false,initialize:function(options){this.mv=options.mv;this.side=options.side;this.title=options.title;BANCOMER.Lightboxes.Boleta.parent.initialize.call(this,options);this.components.push(this._loadMarkUp())},setTitle:function(title){$("#boletaTitle h3").text(title)},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"boleta_markUp"});component.on("rendered",function(){self.setTitle(self.title);self._loadBoletaComponents()});component.on("cancelOrderClick",this.onClose,this);return component},_loadBoletaComponents:function(){var instrumentDetail=this._loadBoletaInstrumentDetail(this.mv);var form=this._loadBoletaForm(this.mv,this.side);var positions=this._loadBoletaPositions(this.mv);var menu=this._loadBoletaMenu(this.side);this.components.push(instrumentDetail);this.components.push(form);this.components.push(menu);this.components.push(positions)},_loadBoletaInstrumentDetail:function(mv){var component=new BANCOMER.Components.InstrumentDetail({config:"boleta_instrumentDetail",view:{el:$("#boletaInstrumentDetail")},service:{param:mv}});return component},_loadBoletaPositions:function(mv){var component=new BANCOMER.Components.Positions({config:"boleta_positions",view:{el:$("#boletaPositions")},service:{param:(mv+"    ").slice(0,7),streaming:true}});return component},_loadBoletaForm:function(mv,side){var config={config:"boleta_form",view:{el:$("#boletaForm")},mv:mv,side:side};var component=new BANCOMER.Components.BoletaForm(config);this._addEventsBoletaForm(component);return component},_loadBoletaMenu:function(side){var config={config:"boleta_menu",view:{side:side}};var component=new BANCOMER.Components.BoletaMenu(config);this._addEventsBoletaMenu(component);return component},_loadBoletaConfirmation:function(model){$("#boletaConfirmation").show();var component=new BANCOMER.Components.BoletaConfirmation({config:"boleta_confirmation",view:{el:$("#boletaConfirmation"),model:model}});this._addEventsBoletaConfirmation(component);return component},_loadBoletaReceipt:function(model){$("#boletaReceipt").show();var component=new BANCOMER.Components.BoletaReceipt({config:"boleta_receipt",view:{el:$("#boletaReceipt"),model:model}});this._addEventsBoletaReceipt(component);return component},_addEventsBoletaMenu:function(component){component.on("sendChangeSide",this.onSendChangeSide,this)},_addEventsBoletaForm:function(component){var self=this;component.on("rendered",function(){if(!self.listenBoletaForm){self.listenBoletaForm=true;component.view.on("onSendOrder",self.onSendOrder,self)}},this);component.on("cancelOrderClick",this.onClose,this)},_addEventsBoletaConfirmation:function(component){component.on("cancelOrderClick",this.onClose,this);component.on("onSendOrderConfirmation",this.onSendOrderConfirmation,this)},_addEventsBoletaReceipt:function(component){component.on("cancelOrderClick",this.onClose,this);component.on("sendOrderReceiptSave",this.sendOrderReceiptSave,this);component.on("sendOrderReceiptMail",this.sendOrderReceiptMail,this)},onSendChangeSide:function(side){var boletaForm=this.getComponent("boleta_form");var boletaMenu=this.getComponent("boleta_menu");if(boletaForm&&boletaMenu){boletaForm.model.set("side",side);boletaForm.reload();boletaMenu.config.viewOptions.side=side;boletaMenu.reload()}},onClose:function(){this.close();BANCOMER.Launcher.trigger("changeAccount")},onSendOrder:function(order){var self=this;var boletaOrderModel;BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.SimulaCompraVenta,order,function(response){if(response.answer!==undefined&&response.status!==undefined&&response.status.ok&&order.id_testigo===response.answer.id_testigo){boletaOrderModel=self.getComponentModel("boleta_form");if(boletaOrderModel){boletaOrderModel.updateModelFromTraderConfirmation(response.answer);self.hideBoletaComponents();self.showConfirmationComponents(boletaOrderModel)}}})},onSendOrderConfirmation:function(confirmation){var self=this;var boletaOrderModel;BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.CompraVentaInversiones,confirmation,function(response){if(response.answer!==undefined&&response.status!==undefined&&response.status.ok&&confirmation.id_testigo===response.answer.id_testigo){boletaOrderModel=self.getComponentModel("boleta_confirmation");if(boletaOrderModel){boletaOrderModel.updateModelFromTraderReceipt(response.answer);self.hideConfirmationBoletaComponents();self.showReceiptComponents(boletaOrderModel)}}})},sendOrderReceiptSave:function(receipt){BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.GuardadoComprobante,receipt,function(response){if(response.answer!==undefined&&response.status!==undefined&&response.status.ok&&receipt.id_testigo===response.answer.id_testigo){console.log("GuardadoComprobante - OK")}})},sendOrderReceiptMail:function(receipt){BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(BANCOMER.Services.BCOM.OperationCode.EnvioComprobante,receipt,function(response){if(response.answer!==undefined&&response.status!==undefined&&response.status.ok&&receipt.id_testigo===response.answer.id_testigo){console.log("EnvioComprobante - OK")}})},hideBoletaComponents:function(){var menu=this.getComponent("boleta_menu");var instrumentDetail=this.getComponent("boleta_instrumentDetail");var boletaForm=this.getComponent("boleta_form");var positions=this.getComponent("boleta_positions");if(instrumentDetail&&boletaForm&&positions&&menu){this.hideComponent(["boleta_menu","boleta_instrumentDetail","boleta_form","boleta_positions"]);$("#boletaBoleta").hide()}},hideConfirmationBoletaComponents:function(){var boletaConfirmationForm=this.getComponent("boleta_confirmation");if(boletaConfirmationForm){this.components=_.without(this.components,boletaConfirmationForm);boletaConfirmationForm.hide();$("#boletaConfirmation").hide()}},showConfirmationComponents:function(model){var component=this._loadBoletaConfirmation(model);this.components.push(component)},showReceiptComponents:function(model){var component=this._loadBoletaReceipt(model);this.components.push(component)}});BANCOMER.Lightboxes.InstrumentDetail=IFB.Class(BANCOMER.Lightboxes.Base,{id:"",mv:"",isin:"",componentsActive:[],markets:{index:["I ","I0","I1","I2"],eft:["M2","M3","M4","M6","M9","20","5V"],warrant:["40","41","42"]},templatesConfig:{markUp:"",header:"",resume:""},menu:{index:[{id:"resume",textKey:"instrumentDetail_menu_resume",css:"index detail"}],etf:[{id:"resume",textKey:"instrumentDetail_menu_resume",css:"etf detail"},{id:"research",textKey:"instrumentDetail_menu_research",css:"etf research"},{id:"news",textKey:"instrumentDetail_menu_news",css:"etf news"},{id:"serie",textKey:"instrumentDetail_menu_serie",css:"etf serie"},{id:"view",textKey:"instrumentDetail_menu_view",css:"etf view"}],warrant:[{id:"resume",textKey:"instrumentDetail_menu_resume",css:"warrant detail"}],issuer:[{id:"resume",textKey:"instrumentDetail_menu_resume",css:"issuer detail"},{id:"research",textKey:"instrumentDetail_menu_research",css:"issuer research"},{id:"news",textKey:"instrumentDetail_menu_news",css:"issuer news"},{id:"serie",textKey:"instrumentDetail_menu_serie",css:"issuer serie"},{id:"multiples",textKey:"instrumentDetail_menu_multiples",css:"issuer multiples"},{id:"view",textKey:"instrumentDetail_menu_view",css:"issuer view"}]},initialize:function(options){this.id=options.mv;this.mv=options.mv;this.isin=options.isin;this.componentsActive=[];BANCOMER.Lightboxes.InstrumentDetail.parent.initialize.call(this,options);this.setTemplatesConfig();this.loadMarkUp()},setTemplatesConfig:function(){this.templatesConfig.markUp="instrumentDetail_markUp";this.templatesConfig.header="instrumentDetail_header";this.templatesConfig.research="instrumentDetail_research";this.templatesConfig.news="instrumentDetail_news";this.templatesConfig.view="instrumentDetail_view";if(this.isIndexInstrument()){this.templatesConfig.resume="instrumentDetail_index_resume"}else if(this.isEtfInstrument()){this.templatesConfig.resume="instrumentDetail_etf_resume";this.templatesConfig.positions="instrumentDetail_etf_positions";this.templatesConfig.serie="instrumentDetail_etf_serie"}else if(this.isWarrantInstrument()){this.templatesConfig.resume="instrumentDetail_warrant_resume"}else{this.templatesConfig.resume="instrumentDetail_issuer_resume";this.templatesConfig.positions="instrumentDetail_issuer_positions";this.templatesConfig.serie="instrumentDetail_issuer_serie";this.templatesConfig.multiples="instrumentDetail_issuer_multiples"}return},loadMarkUp:function(config){var self=this;var component=new BANCOMER.Components.Static({config:this.templatesConfig.markUp});this.components.push(component);component.on("rendered",function(){self.getIsin(function(){self.changeCss("resume");self.loadHeader();self.loadResumeComponent()})})},onClose:function(){this.close()},loadResumeComponent:function(){var self=this;var component=new BANCOMER.Components.InstrumentDetail({config:this.templatesConfig.resume,service:{param:this.mv}});component.on("rendered",self.onRenderResumeComponent,self);this.components.push(component);this.componentsActive.push(component)},loadSerieComponent:function(){var self=this;var component=new BANCOMER.Components.InstrumentDetail({config:this.templatesConfig.serie,service:{param:this.mv}});this.components.push(component);this.componentsActive.push(component)},loadMultiplesComponent:function(){var self=this;var component=new BANCOMER.Components.InstrumentDetail({config:this.templatesConfig.multiples,service:{param:this.mv}});this.components.push(component);this.componentsActive.push(component)},onRenderResumeComponent:function(){var self=this;this.activeMenuTab("resume");self.loadChartsResumeComponents();if(this.templatesConfig.positions){self.loadPositionsComponent()}},isIndexInstrument:function(){var market=this.getMarket(this.mv);return this.markets.index.indexOf(market)!==-1},isEtfInstrument:function(){var market=this.getMarket(this.mv);return this.markets.eft.indexOf(market)!==-1},isWarrantInstrument:function(){var market=this.getMarket(this.mv);return this.markets.warrant.indexOf(market)!==-1},getMarket:function(){return this.mv&&this.mv.length>2?this.mv.substring(0,2):""},loadChartsResumeComponents:function(){var component=new BANCOMER.Components.InstrumentDetailCharts({config:"instrumentDetail_resumeCharts",service:{param:this.mv},view:{},mv:this.mv.trim(),charts:{intraday:{type:"line",frequency:"1",selected:"1",period:"1d"},daily:{type:"line",frequency:"d",period:"1y"}}});this.components.push(component);this.componentsActive.push(component)},onClickTab:function(data,event){var tab=data.tab;this.destroyComponentsActive();this.activeMenuTab(tab);this.changeCss(tab);this.mv=data.mv;switch(tab){case"research":this.loadResearchComponent();break;case"resume":this.loadResumeComponent();break;case"serie":this.loadSerieComponent();break;case"multiples":this.loadMultiplesComponent();break;case"news":this.loadNewsComponent();break;case"view":this.loadViewComponent();break;default:break}},loadResearchComponent:function(){var self=this;var component=new BANCOMER.Components.NewsCriteria({config:self.templatesConfig.research,service:{isin:this.isin}});self.components.push(component);this.componentsActive.push(component)},loadNewsComponent:function(){var self=this;var component=new BANCOMER.Components.NewsCriteria({config:self.templatesConfig.news,service:{isin:this.isin}});self.components.push(component);this.componentsActive.push(component)},loadViewComponent:function(){var self=this;var component=new BANCOMER.Components.NewsViewTreeMap({config:self.templatesConfig.view,service:{isin:this.isin}});self.components.push(component);this.componentsActive.push(component)},loadHeaderComponent:function(menu){var self=this;var component=new BANCOMER.Components.InstrumentDetail({config:this.templatesConfig.header,service:{param:this.mv},view:{menu:menu}});component.on("closeClick",this.onClose,this);component.on("clickInstrumentDetailTab",this.onClickTab,this);this.components.push(component)},loadHeader:function(){var self=this;var menu=this.getMenuFromIntrumentType();BANCOMER.Utils.Helper.hasResearchChannel(function(){self.loadHeaderComponent(menu)},function(){self.loadHeaderComponent(_.reject(menu,function(item){return item.id==="research"}))},self)},getMenuFromIntrumentType:function(){if(this.isIndexInstrument()){return this.menu.index}else if(this.isEtfInstrument()){return this.menu.etf}else if(this.isWarrantInstrument()){return this.menu.warrant}else{return this.menu.issuer}},getCss:function(tabId){var menu=this.getMenuFromIntrumentType();return _.findWhere(menu,{id:tabId}).css},loadPositionsComponent:function(){var component=new BANCOMER.Components.Positions({config:this.templatesConfig.positions,service:{param:this.mv}});this.components.push(component);this.componentsActive.push(component)},activeMenuTab:function(tabId){$("li","section.contMenu ul").removeClass("active");$('li[data-tab="'+tabId+'"]',"section.contMenu ul").addClass("active")},changeCss:function(tabId){var css="ifb-PopUp fv "+this.getCss(tabId);$("div.ifb-PopUp.fv").removeClass().addClass(css)},getIsin:function(next){var self=this;var dbService=new IFB.Services.Database({});var config={sesion:IFB.Services.Session,param:this.mv,type:"4",header:"40"};dbService.loadDataLV(config,function(result){var json=JSON.parse(result);if(json.answer&&json.answer.LV){var instrument=json.answer.LV.V;self.isin=instrument.D40;next()}})},destroyComponentsActive:function(){_.each(this.componentsActive,function(component){component.destroy()});this.componentsActive=[]}});BANCOMER.Lightboxes.NewsDetail=IFB.Class(BANCOMER.Lightboxes.Base,{idNews:"",source:"",initialize:function(options){this.idNews=options.idNews;this.source=options.source;BANCOMER.Lightboxes.NewsDetail.parent.initialize.call(this,options);this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"newsDetail_markUp"});component.on("rendered",function(){self._load()});return component},onClose:function(){this.close()},_load:function(){this.components.push(this._loadNewsDetail())},_loadNewsDetail:function(){var component=new BANCOMER.Components.NewsDetail({config:"newsDetail_newsDetail",view:{el:"#newsDetail_newsDetail"},service:{source:this.source,idNot:this.idNews}});component.on("closeClick",this.onClose,this);return component}});BANCOMER.Lightboxes.NewsList=IFB.Class(BANCOMER.Lightboxes.Base,{titleTextKey:"",source:"",idIncomingNews:"",DATE_FORMAT:"YYYYMMDD",newsDetail:undefined,initialize:function(options){this.titleTextKey=options.titleTextKey||"";this.source=options.source||"";this.idIncomingNews=options.idIncomingNews;BANCOMER.Lightboxes.NewsList.parent.initialize.call(this,options);this.components.push(this._loadMarkUp())},setTitle:function(titleTextKey){$("#newsListTitle h3").text(BANCOMER.CULTURETEXT.t(titleTextKey))},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"newsList_markUp"});component.on("rendered",function(){self.setTitle(self.titleTextKey);self._loadComponents();if(self.idIncomingNews){self.refreshNewsDetail(self.source,self.idIncomingNews)}});component.on("closeClick",this.onClose,this);return component},_loadComponents:function(){var list=this._loadNewsTable(this.source,this.getCurrentDate());this.components.push(list)},onClose:function(){this.close()},_loadNewsTable:function(source,date){var self=this;var component=new BANCOMER.Components.NewsList({config:"newsList_newsList",service:{fuentes:source,fecha:date},view:{el:$("#newsList_table")}});component.on("showNewsDetail",this.onShowNewsDetail,this);return component},_loadNewsDetail:function(source,key){var component=new BANCOMER.Components.NewsDetail({config:"newsList_newsDetail",view:{el:$("#newsList_detail")},service:{source:source,idNot:key}});return component},refreshNewsDetail:function(source,key){if(_.isUndefined(this.newsDetail)){this.newsDetail=this._loadNewsDetail(source,key);this.components.push(this.newsDetail)}else{this.newsDetail.config.serviceParams.data.idNot=key;this.newsDetail.config.serviceParams.data.source=source;this.newsDetail.reload()}},onShowNewsDetail:function(eventData){IFB.Utils.ReadStatusConfig.markAsRead(eventData.source,eventData.key,this.getCurrentDate());this.refreshNewsDetail(eventData.source,eventData.key)},getCurrentDate:function(){return moment().format(this.DATE_FORMAT)}});BANCOMER.Lightboxes.OrderCancel=IFB.Class(BANCOMER.Lightboxes.Base,{folio:"",initialize:function(options){this.folio=options.folio;BANCOMER.Lightboxes.OrderCancel.parent.initialize.call(this,options);this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"orderCancel_markUp"});component.on("rendered",function(){self._loadComponents()});return component},_loadComponents:function(){var components=this._loadOrderCancelConfirmation();this.components.push(components)},_loadOrderCancelConfirmation:function(){var component=new BANCOMER.Components.OrderCancelConfirmation({config:"orderCancel_confirmation",view:{folio:this.folio,el:"#orderCancelConfirmation"}});component.on("closeCancelationClick",this.onClose,this);return component},onClose:function(){this.close();BANCOMER.Launcher.trigger("changeAccount")}});BANCOMER.Lightboxes.OrderDetail=IFB.Class(BANCOMER.Lightboxes.Base,{folio:"",empresa:"",fechaRegistro:"",operacion:"",emisora:"",serie:"",initialize:function(options){this.folio=options.folio;this.empresa=options.empresa;this.fechaRegistro=options.fechaRegistro;this.operacion=options.operacion;this.emisora=options.emisora;this.serie=options.serie;BANCOMER.Lightboxes.OrderDetail.parent.initialize.call(this,options);this.components.push(this._loadMarkUp())},_loadMarkUp:function(){var self=this;var component=new BANCOMER.Components.Static({config:"orderDetail_markUp"});component.on("rendered",function(){self._loadComponents()});return component},_loadComponents:function(){var instrumentDetail=this._loadOrderDetailTable();this.components.push(instrumentDetail)},_loadOrderDetailTable:function(){var self=this;var component=new BANCOMER.Components.OrderDetail({config:"investmentDetail_orderDetail",view:{operacion:self.operacion,emisora:self.emisora,serie:self.serie},serviceBCOMParams:{params:{data1:self.empresa,data2:self.folio,data3:self.fechaRegistro}}});component.on("rendered",function(){$(".icoCloseWindow").on("click",function(){self.close()})});return component}});BANCOMER.Router.Main=Backbone.Router.extend({initialize:function(){},currentPage:undefined,currentHelpPage:undefined,lightboxes:[],HELP_HOME_EL:".ifb-helpSummary",HELP_INDEXDETAIL_EL:".ifb-helpIndices",HELP_CHART_MAXIMIZED_EL:".ifb-helpGraph",HELP_INVESTMENTDETAIL_EL:".ifb-helpDetail",HELP_NEWS_MAXIMIZED_EL:".ifb-helpNews",HELP_INSTRUMENTLIST_EL:".ifb-helpShares",routes:{"":"showHomePage","!/home":"showHomePage","!/investmentDetail":"showInvestmentDetail","!/instrumentList/:constituentsCode/:titleTextKey/:module":"showInstrumentList","!/indexDetailPage":"showIndexDetailPage","!/researchNews/:titleTextKey":"showResearchNews","!/logout":"showLogoutPage","!/investmentChartDetail/:configId":"showInvestmentChartDetail","!/positionDetail":"showPositionDetail","!/orderBookDetail":"showOrderBookDetail","!/lightbox/boleta/:mv/:title/:side":"showBoletaLightbox","!/lightbox/orderdetail/:empresa/:folio/:fechareg/:operacion/:emisora/:serie":"showOrderDetailLightbox","!/lightbox/ordercancel/:folio":"showOrderCancelLightbox","!/lightbox/instrumentDetail/:mv":"showInstrumentDetailLightBox","!/lightbox/newsDetail/:source/:idNews":"showNewsDetailLightBox","!/lightbox/newsList/:titleTextKey/:source(/:idIncomingNews)":"showNewsListLightBox","!/tutorial":"showTutorial","!/lightbox/help":"showHelpLightBox","!/workspace/:id":"showWorkspace","!/workspaceMaximized/:id/:module":"showWorkspaceMaximized"},route:function(route,name,callback){var router=this;if(!callback){callback=this[name]}var f=function(){if(router.existsLightboxShowing()){if(router.isLightbox(route)){router.hidePreviousLightbox()}else{router.destroyPreviousPage()}}else{if(!router.isLightbox(route)){router.destroyPreviousPage()}}if(_.isFunction(callback)){callback.apply(router,arguments)}};return Backbone.Router.prototype.route.call(this,route,name,f)},existsLightboxShowing:function(){return this.lightboxes.length>0},hidePreviousLightbox:function(){var currentLightbox=_.last(this.lightboxes);if(currentLightbox){currentLightbox.hide()}},destroyPreviousLightbox:function(){var currentLightbox=this.lightboxes.pop();var newCurrentLightbox;if(currentLightbox){currentLightbox.destroy();newCurrentLightbox=_.last(this.lightboxes);if(newCurrentLightbox){newCurrentLightbox.show()}}},destroyPreviousPage:function(){if(this.currentPage){this.currentPage.destroy();this.currentPage=undefined}this.destroyLightboxes()},destroyLightboxes:function(){while(this.lightboxes.length){this.lightboxes.shift().destroy()}this.lightboxes=[]},isLightbox:function(route){return route.indexOf("/lightbox/")!==-1},showHomePage:function(mv){this.hideHomeIcon();this.showPagesHeader();this.showSettingsHelpIcon();this.currentHelpPage=this.HELP_HOME_EL;var options={mv:mv||"I IB   "};this.currentPage=new BANCOMER.Pages.Home(options);this.setNavigationTitle(BANCOMER.CULTURETEXT.t("pageTitle_Home"))},showHomeIcon:function(){$("#homeBtn").show()},hideHomeIcon:function(){$("#homeBtn").hide()},showSettingsHelpIcon:function(){$(".txtHelpLine3").show();$(".ifb-help").hide()},hideSettingsHelpIcon:function(){$(".txtHelpLine3").hide()},showLogoutPage:function(){this.hideHomeIcon();this.showPagesHeader();this.currentHelpPage=undefined;this.hideSettingsHelpIcon();this.currentPage=new BANCOMER.Pages.Logout;this.setNavigationTitle(BANCOMER.CULTURETEXT.t("pageTitle_Logout"))},showBoletaLightbox:function(mv,title,side){var options={mv:mv||"MXVIT00",title:title,side:side||"Compra"};var lightbox=new BANCOMER.Lightboxes.Boleta(options);if(lightbox){this.lightboxes.push(lightbox);lightbox.show()}},showOrderDetailLightbox:function(empresa,folio,fechareg,operacion,emisora,serie){var options={empresa:empresa,folio:folio,fechaRegistro:fechareg,operacion:operacion,emisora:emisora,serie:serie};var lightbox=new BANCOMER.Lightboxes.OrderDetail(options);if(lightbox){this.lightboxes.push(lightbox);lightbox.show()}},showOrderCancelLightbox:function(folio){var options={folio:folio};var lightbox=new BANCOMER.Lightboxes.OrderCancel(options);if(lightbox){this.lightboxes.push(lightbox);lightbox.show()}},showInstrumentDetailLightBox:function(mv){var options={mv:mv||""};var lightbox=new BANCOMER.Lightboxes.InstrumentDetail(options);if(lightbox){this.lightboxes.push(lightbox);lightbox.show()}$("#search_instrumentList").hide()},showNewsDetailLightBox:function(source,idNews){var options={idNews:idNews||"",source:source||""};var lightbox=new BANCOMER.Lightboxes.NewsDetail(options);if(lightbox){this.lightboxes.push(lightbox);lightbox.show()}},showNewsListLightBox:function(titleTextKey,source,idIncomingNews){var options={titleTextKey:titleTextKey||"",source:source||"",idIncomingNews:idIncomingNews};var lightbox=new BANCOMER.Lightboxes.NewsList(options);if(lightbox){this.lightboxes.push(lightbox);lightbox.show()}},showTutorial:function(){this.hideHomeIcon();this.showPagesHeader();this.hideSettingsHelpIcon();this.currentHelpPage=undefined;this.currentPage=new BANCOMER.Pages.Tutorial;this.setNavigationTitle(BANCOMER.CULTURETEXT.t("pageTitle_Tutorial"))},showInvestmentDetail:function(){this.showHomeIcon();this.showPagesHeader();this.showSettingsHelpIcon();this.currentHelpPage=this.HELP_INVESTMENTDETAIL_EL;this.currentPage=new BANCOMER.Pages.InvestmentDetail;this.setNavigationTitle(BANCOMER.CULTURETEXT.t("pageTitle_InvestmentDetail"))},showIndexDetailPage:function(){this.hideHomeIcon();this.showPagesHeader();this.showSettingsHelpIcon();this.currentHelpPage=this.HELP_INDEXDETAIL_EL;this.currentPage=new BANCOMER.Pages.IndexDetailPage;this.setNavigationTitle(BANCOMER.CULTURETEXT.t("pageTitle_IndexDetail"))},showInstrumentList:function(constituentsCode,titleTextKey,module){this.hideHomeIcon();this.showPagesHeader();this.showSettingsHelpIcon();this.currentHelpPage=this.HELP_INSTRUMENTLIST_EL;var options={constituentsCode:constituentsCode,titleTextKey:titleTextKey,module:module};this.currentPage=new BANCOMER.Pages.InstrumentList(options);this.setNavigationTitle(BANCOMER.CULTURETEXT.t("pageTitle_InstrumentList"))},showResearchNews:function(titleTextKey){this.hideHomeIcon();this.showPagesHeader();this.showSettingsHelpIcon();this.currentHelpPage=this.HELP_NEWS_MAXIMIZED_EL;var options={titleTextKey:titleTextKey};this.currentPage=new BANCOMER.Pages.ResearchNews(options);this.setNavigationTitle(BANCOMER.CULTURETEXT.t("pageTitle_ResearchNews"))},showInvestmentChartDetail:function(configId){this.hideHomeIcon();this.showPagesHeader();this.showSettingsHelpIcon();this.currentHelpPage=this.HELP_CHART_MAXIMIZED_EL;var options={configId:configId};this.currentPage=new BANCOMER.Pages.InvestmentChartDetail(options);this.setNavigationTitle(BANCOMER.CULTURETEXT.t("pageTitle_InvestmentDetail"))},showPositionDetail:function(){this.hideHomeIcon();this.showPagesHeader();this.hideSettingsHelpIcon();this.currentHelpPage=undefined;this.currentPage=new BANCOMER.Pages.PositionDetail;this.setNavigationTitle(BANCOMER.CULTURETEXT.t("pageTitle_InvestmentDetail_Positions"))},showOrderBookDetail:function(){this.hideHomeIcon();this.showPagesHeader();this.hideSettingsHelpIcon();this.currentHelpPage=undefined;this.currentPage=new BANCOMER.Pages.OrderBookDetail;this.setNavigationTitle(BANCOMER.CULTURETEXT.t("pageTitle_InvestmentDetail_OrderBook"))},showWorkspace:function(id){this.showHomeIcon();this.hidePagesHeader();this.hideSettingsHelpIcon();this.currentHelpPage=undefined;BANCOMER.Utils.Helper.closeFooterMenu();var options={id:id};this.currentPage=new BANCOMER.Pages.WorkSpace(options)},hidePagesHeader:function(){$(".txtTitle").hide();$(".icoTitle").hide()},showPagesHeader:function(){$(".txtTitle").show();$(".icoTitle").show();this.hideWorkSpaceHeader()},hideWorkSpaceHeader:function(){$(".layout1").hide()},showWorkSpaceHeader:function(){$(".layout1").show()},showWorkspaceMaximized:function(id,module){this.showHomeIcon();this.hidePagesHeader();this.hideSettingsHelpIcon();this.currentHelpPage=undefined;var options={id:id,module:module};this.currentPage=new BANCOMER.Pages.WorkspaceMaximized(options)},showHelpLightBox:function(){if(this.currentHelpPage){$(".ifb-help").hide();$(".ifb-contHelp").show();$(this.currentHelpPage).show()}},setNavigationTitle:function(text){$("#ifb-txtTitSup").text(" - "+text)},setWorkspaceTitle:function(text){$("#titleWorkSpace").text(" - "+text)}});BANCOMER.Models.BoletaOrder=Backbone.Model.extend({initialize:function(data){this.initializeModel(data);this.createDataValidators();this.createValidators()},DEFAULTS_DECIMALS:3,DEFAULTS_DATE_FORMAT:"DD/MM/YYYY",DEFAULTS_DATE_FORMAT_RAW:"YYYYMMDD",DEFAULTS_OPERATIONDATE_FORMAT_RAW:"YYYYMMDDHHMMSS",DATE_INPUT_FORMAT_RAW:"YYYY-MM-DD",initializeModel:function(data){this.set("id",data.dataInstrument.MV);this.set("MV",data.dataInstrument.MV);this.set("issuer",data.dataInstrument[IFB.Descriptors.Emisora.descriptor]);this.set("serie",data.dataInstrument[IFB.Descriptors.Serie.descriptor]);this.set("side",data.side);this.set("pivotPrice",data.dataInstrument[IFB.Descriptors.Last.descriptor]);this.set("price",data.side===BANCOMER.Utils.Trader.sideOptions.BUY.value?Number(data.dataInstrument[IFB.Descriptors.AskPrice.descriptor]):Number(data.dataInstrument[IFB.Descriptors.BidPrice.descriptor]))},defaults:{MV:"",issuer:"",serie:"",side:"",price:0,volume:0,pivotPrice:0,orderType:BANCOMER.Utils.Trader.orderTypeOptions.LIMIT.value,expireDate:moment().format(this.DEFAULTS_DATE_FORMAT_RAW),commission:0,amount:0,vat:0,percentage:0,registerNumber:""},getDescriptorValue:function(field){return this.getRawValue(field)},getRawValue:function(field){return this.get(field)||""},getIssuer:function(){return this.getRawValue("issuer")},getSerie:function(){return this.getRawValue("serie")},getSide:function(){return this.getRawValue("side")},getAmount:function(){return this.getRawValue("amount")},getVolume:function(){return this.getRawValue("volume")},getCommission:function(){return this.getRawValue("commission")},getVat:function(){return this.getRawValue("vat")},getRegisterNumber:function(){return this.getRawValue("registerNumber")},getPercentage:function(){return this.getRawValue("percentage")},getDecimals:function(defaultValue){var value=this.getRawValue(IFB.Descriptors.Decimals.descriptor);return/^\s*\d+\s*$/.test(value)?parseInt(value,10):defaultValue||this.DEFAULTS_DECIMALS},getNumberDecriptorValue:function(field,decimals){try{decimals=decimals||decimals===0?decimals:this.getDecimals();var value=this.formatAsNumber(field,decimals,"");return value}catch(e){}},getOrderType:function(){var orderType=this.getRawValue("orderType");return BANCOMER.Utils.Trader.getOrderType(orderType)},getExpireDate:function(format){try{return this.formatAsDate("expireDate",format)}catch(e){}},formatAsNumber:function(descriptor,decimals,zeroValue,positiveSign,suffix){return this.formatValueAsNumber(this.getRawValue(descriptor),decimals,zeroValue,positiveSign,suffix)},formatValueAsNumber:function(value,decimals,zeroValue,positiveSign,suffix){if(zeroValue!==undefined&&(!value||value==="0"||value==="")){return zeroValue}var fmtValue=accounting.formatNumber(value,{precision:typeof (decimals==="number")?decimals:this.getDecimals(),zero:zeroValue||""});fmtValue+=suffix||"";return positiveSign&&value>0&&fmtValue.indexOf(positiveSign)===-1?positiveSign+fmtValue:fmtValue},formatValueAsDate:function(value,format){var format=format||this.DEFAULTS_DATE_FORMAT;if(value){value=moment(value,this.DEFAULTS_DATE_FORMAT_RAW).format(format)}return value},formatAsDate:function(descriptor,format){return this.formatValueAsDate(this.getRawValue(descriptor),format)},createDataValidators:function(){this.validation={price:[{rangePrice:{}}],expireDate:[{required:true,msg:BANCOMER.CULTURETEXT.t("noty_Error_BoletaForm_EmptyDate")},{date:{unavailableWeekend:true,validRange:{initDate:moment(),endDate:moment().add("d",90)}}}]}},createValidators:function(){var self=this;_.extend(Backbone.Validation.validators,{decimals:function(value,attr,customValue,model){var regex=new RegExp("^[-]?\\d*(\\"+accounting.settings.number.decimal+"\\d{1,"+customValue+"})?$");if(!regex.test(value)){return"Sólo se admiten "+model.DEFAULTS_DECIMALS+" decimales como máximo"}},date:function(value,attr,customValue,model){var SUNDAY_WEEKDAY=0;var SATURDAY_WEEKDAY=6;if(!value){return}var date=moment(value,model.DEFAULTS_DATE_FORMAT);if(!date.isValid()){return"Formato de fecha no valido"}if(customValue.validRange){if(date.isBefore(customValue.validRange.initDate.startOf("day"))||date.isAfter(customValue.validRange.endDate)){return BANCOMER.CULTURETEXT.t("noty_Error_BoletaForm_InvalidedDate")}}if(customValue.unavailableWeekend){if(date.day()===SATURDAY_WEEKDAY||date.day()===SUNDAY_WEEKDAY){return BANCOMER.CULTURETEXT.t("noty_Error_BoletaForm_UnavailableWeekendDate")}}},getErrorMessageRange:function(rangeNumber){var rangeValue=rangeNumber*100;return BANCOMER.CULTURETEXT.t("noty_Error_BoletaForm_PriceRangePart1")+rangeValue+BANCOMER.CULTURETEXT.t("noty_Error_BoletaForm_PriceRangePart2")},rangePrice:function(value,attr,customValue,model,attributes){var variationRanks=self.loadVariationRanks();var variationRank;var minRank;var maxRank;var transactionPrice;var pivotPrice;var side=model.getSide();var marketCode=model.id.substring(0,2);var percentage=Number(variationRanks[marketCode]);var isLimitedOrder=model.get("orderType")===BANCOMER.Utils.Trader.orderTypeOptions.LIMIT.value;if(isLimitedOrder){transactionPrice=Number(model.get("price"));pivotPrice=Number(model.get("pivotPrice"));variationRank=percentage*pivotPrice;minRank=pivotPrice-variationRank;maxRank=pivotPrice+variationRank;if(side===BANCOMER.Utils.Trader.sideOptions.BUY.value&&transactionPrice>maxRank){return this.getErrorMessageRange(percentage)}else if(side===BANCOMER.Utils.Trader.sideOptions.SELL.value&&transactionPrice<minRank){return this.getErrorMessageRange(percentage)}}}});_.extend(Backbone.Validation.patterns,{date:/^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/,positive:/^0*[1-9][0-9]*(\,[0-9]+)?|0+\,[0-9]*[1-9][0-9]*$/,integer:/^\d+$/,price:/(^\d+([,.]\d+)?$)|((^\d{1,3}(,\d{3})+(\.\d+)?)$)|((^\d{1,3}(\.\d{3})+(,\d+)?)$)/});_.extend(Backbone.Validation.messages,{date:"Por favor, seleccione una fecha correcta",positive:"Por favor, seleccione un número mayor que cero",integer:"Por favor, seleccione un entero",price:"Por favor, seleccione un precio correcto"})},loadVariationRanks:function(){return _.object(["5V","M0","M1","M2","M3","M4","M5","M6","M7","M9","MX","40","41","42"],[.05,.05,.05,.05,.05,.05,.05,.05,.05,.05,.05,.05,.05,.05])},getOrderToTrader:function(){var order={data1:this.getRawValue("issuer"),data2:this.getRawValue("serie"),data3:this.getRawValue("price").toString(),data4:this.getRawValue("side"),data5:this.getRawValue("volume").toString(),data6:this.getRawValue("expireDate")};return order},getConfirmationToTrader:function(){var confirmation={data1:this.getRawValue("issuer"),data2:this.getRawValue("serie"),data3:this.getRawValue("price").toString(),data4:this.getRawValue("side"),data5:this.getRawValue("volume").toString(),data6:this.getRawValue("expireDate")};return confirmation},getReceiptSaveToTrader:function(actionReceipt){var receipt={emisora:this.getIssuer(),operacion:this.getSide(),importe:this.getAmount(),precio:this.getRawValue("price").toString(),titulos:this.getVolume().toString(),fechaVigencia:this.getExpireDate(this.DEFAULTS_DATE_FORMAT_RAW),comision:this.getCommission(),iva:this.getVat(),porcentajeComision:this.getPercentage(),folioInternet:this.getRegisterNumber(),fechaOperacion:moment().format(this.DEFAULTS_OPERATIONDATE_FORMAT_RAW),accionComprobante:actionReceipt};return receipt},getReceiptMailToTrader:function(actionReceipt){var receipt={emisora:this.getIssuer(),operacion:this.getSide(),importe:this.getAmount(),precio:this.getRawValue("price").toString(),titulos:this.getVolume().toString(),fechaVigencia:this.getExpireDate(this.DEFAULTS_DATE_FORMAT_RAW),comision:this.getCommission(),iva:this.getVat(),porcentajeComision:this.getPercentage(),folioInternet:this.getRegisterNumber(),fechaOperacion:moment().format(this.DEFAULTS_OPERATIONDATE_FORMAT_RAW),accionComprobante:actionReceipt};return receipt},updateModelFromTraderConfirmation:function(updates){if(updates){this.set("commission",updates.comision||0);this.set("amount",updates.importe||0);this.set("vat",updates.iva||0);this.set("percentage",updates.porcentaje||0)}},updateModelFromTraderReceipt:function(updates){if(updates){this.set("registerNumber",updates.folioInternet||0)}}});BANCOMER.Models.Order=IFB.Models.Instrument.extend({id:undefined,data:undefined,TRADER_ACTIONRECEIPT_CANCEL:"3",DEFAULTS_OPERATIONDATE_FORMAT_RAW:"YYYYMMDDHHMMSS",Status:{Executed:{key:"e",textKey:"orderStatus_Executed"},PartiallyExecuted:{key:"pe",textKey:"orderStatus_PartiallyExecuted"},PartiallyCanceled:{key:"pc",textKey:"orderStatus_PartiallyCanceled"},Market:{key:"m",textKey:"orderStatus_Market"},Canceled:{key:"c",textKey:"orderStatus_Canceled"},Rejected:{key:"r",textKey:"orderStatus_Rejected"}},Operation:{Buy:{key:"C",textKey:"operationSide_Buy"},Sell:{key:"V",textKey:"operationSide_Sell"}},initialize:function(){this.data=this.toJSON();this.set({id:this.data.folio})},getAsignados:function(){try{return this.formatValueAsNumber(this.data.asignados,0)}catch(e){}},getEmisora:function(){return this.data.emisora||""},getEmpresa:function(){return this.data.empresa||""},getEstadoRaw:function(){return this.data.estado},getEstado:function(){var textKey=_.findWhere(this.Status,{key:this.data.estado}).textKey;return textKey?BANCOMER.CULTURETEXT.t(textKey)||"":""},getFechaReg:function(){return this.data.fechareg||""},getFolio:function(){return this.data.folio||""},getOperacion:function(){return this.data.operacion||""},getOperacionText:function(){var textKey=_.findWhere(this.Operation,{key:this.data.operacion}).textKey;return textKey?BANCOMER.CULTURETEXT.t(textKey)||"":""},getPendientes:function(){try{return this.formatValueAsNumber(this.data.pendientes,0)}catch(e){}},getPrecio:function(decimals){try{decimals=decimals||decimals===0?decimals:this.getDecimals();return this.formatValueAsNumber(this.data.precio,decimals)}catch(e){}},getSerie:function(){return this.data.serie||""},getSolicitados:function(){return this.data.solicitados||""},setFolioCancelacion:function(folio){this.data.folioCancelacion=folio||""},getFolioCancelacion:function(){return this.data.folioCancelacion||""},getCancelConfirmationToTrader:function(){var cancel={data1:this.getEmpresa(),data2:this.getFolio(),data3:this.getFechaReg(),data4:this.getPendientes(),data5:""};return cancel},getCancelSaveMailToTrader:function(){var receipt={emisora:this.getEmisora(),operacion:this.getOperacionText(),importe:"",precio:"",titulos:this.getSolicitados(),fechaVigencia:this.getFechaReg(),comision:"",iva:"",porcentajeComision:"",folio:this.getFolio(),folioInternet:this.getFolioCancelacion(),fechaOperacion:moment().format(this.DEFAULTS_OPERATIONDATE_FORMAT_RAW),accionComprobante:this.TRADER_ACTIONRECEIPT_CANCEL};return receipt},formatValueAsNumber:function(value,decimals,zeroValue,positiveSign,suffix){if(zeroValue&&(!value||value==="0")){return zeroValue}var fmtValue=accounting.formatNumber(value,{precision:typeof decimals==="number"?decimals:this.getDecimals(),zero:zeroValue||""});fmtValue+=suffix||"";return positiveSign&&value>0&&fmtValue.indexOf(positiveSign)===-1?positiveSign+fmtValue:fmtValue}});BANCOMER.Models.OrderDetail=Backbone.Model.extend({id:undefined,data:undefined,initialize:function(){this.data=this.toJSON();this.set({id:this.data.fecha+this.data.hora+this.data.tipo+this.data.titulo})},getFecha:function(){try{return this.formatValueAsDate(this.data.fecha)}catch(e){}},getHora:function(){try{return this.formatValueAsTime(this.data.hora)}catch(e){}},getTipoRaw:function(){return this.data.tipo||""},getTipo:function(){var type="";switch(this.getTipoRaw()){case"A":type=BANCOMER.CULTURETEXT.t("field_OrderDetail_Assigned");break;case"S":type=BANCOMER.CULTURETEXT.t("field_OrderDetail_RequestToBeCanceled");break;case"C":type=BANCOMER.CULTURETEXT.t("field_OrderDetail_Canceled");break}return type},getTitulos:function(){var result="";try{result=this.formatValueAsNumber(this.data.titulo,0)}catch(e){}return result==="0"?"":result},formatValueAsNumber:function(value,decimals,zeroValue,positiveSign,suffix){if(zeroValue&&(!value||value==="0")){return zeroValue}var fmtValue=accounting.formatNumber(value,{precision:typeof decimals==="number"?decimals:this.getDecimals(),zero:zeroValue||""});fmtValue+=suffix||"";return positiveSign&&value>0&&fmtValue.indexOf(positiveSign)===-1?positiveSign+fmtValue:fmtValue},formatValueAsDate:function(value,format){format=format||"DD/MM/YYYY";if(value){value=moment(value,"YYYYMMDD").format(format)}return value},formatValueAsTime:function(value,format){format=format||"HH:mm:ss";if(value){value=moment(value,"HHmmss").format(format)}return value}});BANCOMER.Models.Position=IFB.Models.Instrument.extend({id:undefined,data:undefined,getEmisora:function(){return this.data.emisora||""},getPrecio:function(){return this.data.precio||""},getSerie:function(){return this.data.serie||""},getTitulos:function(){try{return this.formatAsNumber("titulos",0)}catch(e){}},getBancomer_Ultimo:function(decimals){var options=_.isObject(decimals)?decimals:{decimals:decimals};try{options.decimals=options.decimals||options.decimals===0?options.decimals:this.getDecimals();return this.formatAsNumber(IFB.Descriptors.Bancomer_Ultimo.descriptor,options.decimals,options.zeroValue,options.positiveSign,options.suffix)}catch(e){}},getValuationRaw:function(valuePrice){try{var price=valuePrice||Number(this.getDescriptorValue(IFB.Descriptors.Bancomer_Ultimo.descriptor));var numTitles=Number(this.getDescriptorValue("titulos"));return numTitles*price}catch(e){return 0}},getValuation:function(price,decimals){var options=_.isObject(price)?price:{price:price};if(!options&&decimals){decimals=decimals}try{options.decimals=options.decimals||options.decimals===0?options.decimals:this.getDecimals();return this.formatValueAsNumber(this.getValuationRaw(price),options.decimals,options.zeroValue,options.positiveSign,options.suffix)}catch(e){}}});BANCOMER.Collections.Base=Backbone.Collection.extend({model:undefined,options:{},initialize:function(options,code,params){this.options=options||{};this.options.serviceParams=this.options.serviceParams||{};this.options.serviceParams.reset=true;this.bind("dataLoaded",this.dataLoaded,this)},dataLoaded:function(){},parse:function(message){throw new Error("This method must be overrided")},load:function(){throw new Error("This method must be overrided")},loadDataFromBCOMService:function(next){var self=this;BANCOMER.Services.BCOM.invocaServicioDesdeInfoBolsa(this.options.serviceBCOMParams.operationCode,this.options.serviceBCOMParams.params,function(response){next(response)})},loadIFBHeader:function(next){var databaseService=new IFB.Services.Database({});databaseService.columnado(_.extend(this.options.serviceParams.header,{sesion:IFB.Services.Session}),function(data){next(data)})},sync:function(method,model,options){var self=this;var response,_ref;if(method==="read"){response=options.data;if(response){return options.success(response,options)}}else{return Backbone.sync.apply(arguments)}},getElementById:function(id){return this.get(id)},getDescriptorsFromHeader:function(){var descriptors="";if(this.options.userHeader){_.each(this.options.userHeader.models,function(model){descriptors+=model.id+","})}return descriptors},loadIFBData:function(BCOMdata,next){var databaseService=new IFB.Services.Database({});var instruments="";var self=this;var paramSearch="0;43;"+self.getIssuersFormBCOMdata(BCOMdata);var descriptors="";var message={};var IFBData=[];databaseService.loadDataLV(_.extend({param:paramSearch,type:"2",header:descriptors},{sesion:IFB.Services.Session}),function(dataInstruments){message=JSON.parse(dataInstruments);if(message&&message.answer&&message.answer.LV.V){IFBData=$.isArray(message.answer.LV.V)?message.answer.LV.V:[message.answer.LV.V]}_.each(IFBData,function(instrument){instruments+=instrument.MV+","});databaseService.loadDataLV({param:instruments,type:"4",header:self.getDescriptorsFromHeader(),rt:"1",sesion:IFB.Services.Session,sort:"10103"},function(data){next(data)})})},extendBCOMData:function(BCOMdata,IFBdata,nodeNameBCOM){var instruments=[];var auxInstruments;var IFBdataInstruments=[];if(IFBdata&&IFBdata.answer&&IFBdata.answer.LV.V){IFBdataInstruments=$.isArray(IFBdata.answer.LV.V)?IFBdata.answer.LV.V:[IFBdata.answer.LV.V]}_.each(IFBdataInstruments,function(instrument){auxInstruments=_.where(BCOMdata.answer[nodeNameBCOM],{emisora:instrument[IFB.Descriptors.Emisora.descriptor],serie:instrument[IFB.Descriptors.Serie.descriptor]});if(auxInstruments){_.each(auxInstruments,function(auxInstrument){instruments.push(_.extend(auxInstrument,instrument))})}});return instruments}});BANCOMER.Collections.OrderBook=BANCOMER.Collections.Base.extend({model:BANCOMER.Models.Order,parse:function(message){var self=this;this.message=message;this.trigger("dataLoaded",this);return message.length?message:[]},load:function(){if(this.options.serviceParams.header){this.loadWithHeader()}else{this.loadWithoutHeader()}},loadWithoutHeader:function(){var self=this;this.loadDataFromBCOMService(function(data){self.fetch({data:data.answer.ordenes||[],reset:true})})},loadWithHeader:function(){var self=this;var BCOMdata={};var IFBdata={};this.loadDataFromBCOMService(function(data){BCOMdata=data;self.loadIFBData(BCOMdata,function(data){IFBdata=JSON.parse(data);self.fetch({data:self.extendBCOMData(BCOMdata,IFBdata,"ordenes"),reset:true})})})},getIssuersFormBCOMdata:function(BCOMdata){var formattedIssuer="";var issuersAsString="";if(BCOMdata.answer&&BCOMdata.answer.ordenes){_.each(BCOMdata.answer.ordenes,function(issuer){if(issuer.emisora&&issuer.serie){formattedIssuer=issuer.emisora.replace("#","&");issuersAsString+=(formattedIssuer+"       ").slice(0,7).replace("&","%26");issuersAsString+=(issuer.serie+"     ").slice(0,5)}})}return issuersAsString},filterModel:function(paramFilter){var status=[];switch(paramFilter){case"1":status=["pe","pc","m"];break;case"2":status=["c","r"];break;case"3":status=["e"];break;case"4":status=["pe","m","c","e","pc","r"];break}return ordersFiltered=_.filter(this.models,function(order){return status.indexOf(order.getEstadoRaw())!==-1})}});BANCOMER.Collections.OrderDetail=BANCOMER.Collections.Base.extend({model:BANCOMER.Models.OrderDetail,parse:function(message){var data=[];this.message=message;this.trigger("dataLoaded",this);if(!message.status.ok||!message.answer.hechos){return[]}data=$.isArray(message.answer.hechos)?message.answer.hechos:[message.answer.hechos];return data.length?data:[]},load:function(){var self=this;this.loadDataFromBCOMService(function(data){self.fetch({data:data,reset:true})})}});BANCOMER.Collections.PositionBook=BANCOMER.Collections.Base.extend({model:BANCOMER.Models.Position,parse:function(message){var self=this;this.message=message;this.trigger("dataLoaded",this);return message.length?message:[]},load:function(){var self=this;var BCOMdata={};var IFBdata={};this.loadDataFromBCOMService(function(data){BCOMdata=data;self.loadIFBData(BCOMdata,function(data){IFBdata=JSON.parse(data);self.fetch({data:self.extendBCOMData(BCOMdata,IFBdata,"inversiones"),reset:true})})})},getIssuersFormBCOMdata:function(BCOMdata){var formattedIssuer="";var issuersAsString="";if(BCOMdata.answer&&BCOMdata.answer.inversiones){_.each(BCOMdata.answer.inversiones,function(issuer){if(issuer.emisora&&issuer.serie){formattedIssuer=issuer.emisora.replace("#","&");issuersAsString+=(formattedIssuer+"       ").slice(0,7).replace("&","%26");issuersAsString+=(issuer.serie+"     ").slice(0,5)}})}return issuersAsString},transformModelToView:function(){var instruments=this.models;var self=this;if(!instruments){return}var instrumentsGrouped=_.groupBy(instruments,function(instrument){return instrument.getInstrumentType()});this.equities=_.sortBy(instrumentsGrouped[IFB.Models.Instrument.prototype.INSTRUMENTS_TYPES.EQUITY],function(equity){return Number(equity.getDescriptorValue("titulos"))*-1});this.funds=_.sortBy(instrumentsGrouped[IFB.Models.Instrument.prototype.INSTRUMENTS_TYPES.FUND],function(fund){return Number(fund.getDescriptorValue("titulos"))*-1});this.models=[];_.each(this.equities,function(equity){self.models.push(equity)});_.each(this.funds,function(fund){self.models.push(fund)})},filterByInstrumentType:function(){var instrumentType=this.options.viewOptions.filter&&this.options.viewOptions.filter.instrumentType?this.options.viewOptions.filter.instrumentType:"";var instruments=this.models;if(instrumentType){instruments=_.filter(instruments,function(model){return model.getInstrumentType().trim()===instrumentType})}return instruments}});BANCOMER.Views.BoletaForm=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments);Backbone.Validation.bind(this,{valid:function(view,attr){},invalid:function(view,attr,error){view.validationErrors.push({field:attr,error:error})}})},validationErrors:[],DECIMAL:3,KEYCODE_DELETE:8,KEYCODE_POINT:190,KEYCODE_COMMA:188,validationPatterns:{integer:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:[,.]\d{3})+)(?:[,.]\d+)?$/,positive:/^0*[1-9][0-9]*(\,[0-9]+)?|0+\,[0-9]*[1-9][0-9]*$/},getUnformatFieldValue:function(idField){var fieldValue=this.getFieldValue(idField);fieldValue=this.replaceAll(fieldValue,accounting.settings.number.thousand,"");return this.replaceAll(fieldValue,accounting.settings.number.decimal,".")},getFieldValue:function(idField){return $("#"+idField,this.$el).val()||""},setFieldValue:function(idField,value){$("#"+idField,this.$el).val(value)},onUpdateData:function(data){var self=this;_.each(data.V,function(msg){if(msg.D===IFB.Descriptors.Last.descriptor){self.model.set("pivotPrice",msg.V);$("#pivotPrice",self.$el).html(msg.V)}})},onSendOrderClick:function(){var self=this;BANCOMER.Utils.Helper.resetScrollTo();if($("#btnAccept",this.$el).hasClass("disable")){return}if(this.validateOrder()){this.trigger("onSendOrder",this.model.getOrderToTrader())}else{var buttons=[{text:BANCOMER.CULTURETEXT.t("noty_Btn_BoletaForm_Edit")},{text:BANCOMER.CULTURETEXT.t("noty_Btn_BoletaForm_Cancel"),callback:function(){self.trigger("cancelOrderClick",self)}}];IFB.Utils.Helper.showNotificationWarning("warning",this.validationErrors[0].error,true,buttons)}},getKeyCode:function(evt){var keyCode=evt.which?evt.which:evt.charCode?evt.charCode:evt.keyCode?evt.keyCode:0;return keyCode},sharesKeyDown:function(eventData,target,event){var code=this.getKeyCode(event);var notDelete=code!==this.KEYCODE_DELETE;if(notDelete&&this.isNumericKeyCode(event)){event.preventDefault();return}},sharesClick:function(){var volumeStr=$("#volume",this.$el).val();if(volumeStr==="0"){$("#volume",this.$el).val("")}},escapeRegExp:function(string){return string.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")},replaceAll:function(string,find,replace){return string.replace(new RegExp(this.escapeRegExp(find),"g"),replace)},sharesKeyUp:function(eventData,target,event){var volumeStr=target.val().toString();volumeStr=this.replaceAll(volumeStr,accounting.settings.number.thousand,"");target.val(accounting.formatNumber(volumeStr));this.refreshStatusBtn()},validateShares:function(){var volumeStr=$("#volume",this.$el).val();var volumeUnformatted=accounting.unformat(volumeStr);var validate=this.isNumber(volumeStr)&&this.isPositive(volumeStr)&&this.isInteger(volumeUnformatted)&&Number(volumeUnformatted)>=1;return validate},isInteger:function(value){return _.isNumber(value)||_.isString(value)&&!_.isNull(value.match(this.validationPatterns.integer))},isDecimalPoint:function(keyCode){return accounting.settings.number.decimal==="."&&(keyCode===this.KEYCODE_POINT||keyCode===".")||accounting.settings.number.decimal===","&&(keyCode===this.KEYCODE_COMMA||keyCode===",")},isNumericKeyCode:function(event){var code=this.getKeyCode(event);return(event.shiftKey||code<48||code>57)&&(code<96||code>105)},priceKeyDown:function(eventData,target,event){var code=this.getKeyCode(event);var priceStr=accounting.unformat(target.val());var positionDecimal=_.indexOf(target.val(),accounting.settings.number.decimal);var notDelete=code!==this.KEYCODE_DELETE;var duplicateDecimal=this.isDecimalPoint(code)&&positionDecimal!==-1;var maxDecimal=positionDecimal!==-1&&target.val().substring(positionDecimal).length>this.DECIMAL;if(notDelete&&(duplicateDecimal||maxDecimal||this.isNumericKeyCode(event)&&!this.isDecimalPoint(code))){event.preventDefault();return}},priceKeyUp:function(eventData,target,event){var code=this.getKeyCode(event);var priceStr;var positionDecimal=_.indexOf(target.val(),accounting.settings.number.decimal);var decimalVal=positionDecimal!==-1?target.val().substr(positionDecimal+1).length:0;var lastChar=target.val().substring(target.val().length-1,target.val().length);if(!this.isDecimalPoint(code)&&!this.isDecimalPoint(lastChar)){priceStr=target.val().toString();priceStr=this.replaceAll(priceStr,accounting.settings.number.thousand,"");priceStr=this.replaceAll(priceStr,accounting.settings.number.decimal,".");target.val(accounting.formatNumber(priceStr,{precision:decimalVal}))}this.refreshStatusBtn()},onPriceChange:function(){var price=this.getUnformatFieldValue("price");this.model.set("price",price)},priceFocusOut:function(){this.onPriceChange();this.refreshStatusBtn()},priceFocusIn:function(){this.onPriceChange();this.refreshStatusBtn()},onPriceClick:function(){var priceStr=$("#price",this.$el).val();if(priceStr==="0"){$("#price",this.$el).val("")}},validatePrice:function(){var priceStr=$("#price",this.$el).val();return this.isNumber(priceStr)&&this.isPositive(priceStr)},isNumber:function(value){return _.isNumber(value)||_.isString(value)&&!_.isNull(value.match(this.validationPatterns.number))},isPositive:function(value){return!_.isNull(value.match(this.validationPatterns.positive))},sharesFocusOut:function(){this.refreshStatusBtn()},sharesFocusIn:function(){this.refreshStatusBtn()},refreshStatusBtn:function(){if(this.validatePrice()&&this.validateShares()){$("#btnAccept",this.$el).removeClass("disable")}else{$("#btnAccept",this.$el).addClass("disable")}},testDateInputFormatRaw:function(date){return/^\d{4}-\d{1,2}-\d{1,2}$/.test(date)},validateOrder:function(){var self=this;var data=IFB.Utils.Helper.serializeObject(this.$el);if(data.expireDate&&this.testDateInputFormatRaw(data.expireDate)){data.expireDate=moment(data.expireDate,this.model.DATE_INPUT_FORMAT_RAW).format(this.model.DEFAULTS_DATE_FORMAT)}var errorMessage=this.model.preValidate(data);if(errorMessage){self.validationErrors=[];_.each(errorMessage,function(error,attr){self.validationErrors.push({field:attr,error:error})});return false}else{this.setModelData(data);return true}},setModelData:function(dataObject){try{this.model.set("volume",this.getUnformatFieldValue("volume"));this.model.set("price",this.getUnformatFieldValue("price"));this.model.set("expireDate",moment(dataObject.expireDate,this.model.DEFAULTS_DATE_FORMAT).format(this.model.DEFAULTS_DATE_FORMAT_RAW));this.model.set("orderType",dataObject.orderType)}catch(e){}}});BANCOMER.Views.ChartIndexes=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments)},onUpdateData:function(data){var self=this;var mv=data.MV;var instrument=this.model.getElementById(data.MV);if(!instrument){return}IFB.Views.Base.prototype.onUpdateData.apply(this,arguments);_.each(data.V,function(msg){if(msg.D===IFB.Descriptors.ChangePercent.descriptor){self.render()}})}});BANCOMER.Views.InstrumentDetail=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments)},onUpdateData:function(data){var self=this;var mv=data.MV;var instrument=this.model.getElementById(data.MV);var key;var elements;if(!instrument){return}_.each(data.V,function(msg){if(msg.D===IFB.Descriptors.Trend.descriptor){key="[data-mv='"+mv+"'][data-descriptor='"+IFB.Descriptors.Trend.descriptor+"']";elements=$(key,self.$el);_.each(elements,function(element){self.updateClsTrend(element,msg.V,self.options.topFlopBackgroundCls);self.updateClsTrend(element,msg.V,self.options.topFlopArrowCls)})}});IFB.Views.Base.prototype.onUpdateData.apply(this,arguments)},hasClsElement:function(el,optionsTopFlop){return $(el).hasClass(optionsTopFlop.top)||$(el).hasClass(optionsTopFlop.flop)||$(el).hasClass(optionsTopFlop.equal)},updateClsTrend:function(el,trendValue,optionsTopFlop){if(optionsTopFlop&&this.hasClsElement(el,optionsTopFlop)){$(el).removeClass(optionsTopFlop.top+" "+optionsTopFlop.flop+" "+optionsTopFlop.equal);if(trendValue==="1"){$(el).addClass(optionsTopFlop.top)}else if(trendValue==="2"){$(el).addClass(optionsTopFlop.flop)}else{$(el).addClass(optionsTopFlop.equal)}}}});BANCOMER.Views.InvestmentDetail=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments);if(this.options.enableSort){if(this.options.sortConfig){this.sortConfig=_.defaults({},this.options.sortConfig,this.defaultSortConfig)}else{this.sortConfig=_.defaults({},this.defaultSortConfig)}this.subscribe("rendered",this.addSortCss,this)}},defaultSortConfig:{type:"string",direction:"asc",descriptor:IFB.Descriptors.ShortName.descriptor,css:{arrow:"sortArrow",asc:"activeUp",desc:"activeDown"}},onUpdateData:function(data){var self=this;var mv=data.MV;var instrument=this.model.getElementById(data.MV);var key;var elements;if(!instrument){return}_.each(data.V,function(msg){if(msg.D===IFB.Descriptors.Bancomer_Ultimo.descriptor){key="[data-mv='"+mv+"'][data-descriptor='"+IFB.Descriptors.Bancomer_ValorHoyEstimado.descriptor+"']";$(key,self.$el).html(instrument.getValuation(msg.V));self.highlight($(key,self.$el),self.getDifValue(instrument,IFB.Descriptors.Trend.descriptor))}});IFB.Views.Base.prototype.onUpdateData.apply(this,arguments)}});BANCOMER.Views.OrderBook=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments);if(this.options.enableSort){if(this.options.sortConfig){this.sortConfig=_.defaults({},this.options.sortConfig,this.defaultSortConfig)}else{this.sortConfig=_.defaults({},this.defaultSortConfig)}this.subscribe("rendered",this.addSortCss,this)}},defaultSortConfig:{type:"string",direction:"desc",descriptor:IFB.Descriptors.Bancomer_Estado.descriptor,css:{arrow:"sortArrow",asc:"activeUp",desc:"activeDown"}}});BANCOMER.Views.OrderDetail=IFB.Views.Base.extend({initialize:function(){IFB.Views.Base.prototype.initialize.apply(this,arguments)}});BANCOMER.Views.Static=IFB.Views.Static.extend({});BANCOMER.Views.TopFlopActive=IFB.Views.TopFlopActive.extend({initialize:function(){IFB.Views.TopFlopActive.prototype.initialize.apply(this,arguments)},onUpdateData:function(data){var self=this;var mv=data.MV;var instrument=this.model.getElementById(data.MV);var key;var elements;if(!instrument){return}_.each(data.V,function(msg){if(msg.D===IFB.Descriptors.Trend.descriptor){key="[data-mv='"+mv+"'][data-descriptor='"+IFB.Descriptors.Trend.descriptor+"']";elements=$(key,self.$el);_.each(elements,function(element){self.updateClsTrend(element,msg.V,self.options.topFlopArrowCls)})}});IFB.Views.TopFlopActive.prototype.onUpdateData.apply(this,arguments)},hasClsElement:function(el,optionsTopFlop){return $(el).hasClass(optionsTopFlop.top)||$(el).hasClass(optionsTopFlop.flop)||$(el).hasClass(optionsTopFlop.equal)},updateClsTrend:function(el,trendValue,optionsTopFlop){if(optionsTopFlop&&this.hasClsElement(el,optionsTopFlop)){$(el).removeClass(optionsTopFlop.top+" "+optionsTopFlop.flop+" "+optionsTopFlop.equal);if(trendValue==="1"){$(el).addClass(optionsTopFlop.top)}else if(trendValue==="2"){$(el).addClass(optionsTopFlop.flop)}else{$(el).addClass(optionsTopFlop.equal)}}}});BANCOMER.Views.TopFlopPieChart=IFB.Views.DonutChart.extend({initialize:function(){IFB.Views.DonutChart.prototype.initialize.apply(this,arguments);var self=this},colors:{top:"#5cc800",flop:"#cc0a5a",equal:"#757c49"},getChartConfig:function(){var chartConfig={renderTo:this.el,plotBackgroundColor:null,plotBorderWidth:0,plotShadow:false,backgroundColor:"rgba(255, 255, 255, 0.1)"};if(this.options.height){chartConfig.height=this.options.height}return chartConfig},getTitleConfig:function(){},getPlotOptionsConfig:function(){var self=this;var plotOptionsConfig={pie:{dataLabels:{distance:-30,color:"white"},startAngle:-90,endAngle:270,borderColor:"rgba(255, 255, 255, 0.1)"},series:{states:{hover:{enabled:false}}}};return plotOptionsConfig},getSeriesConfig:function(){var seriesConfig=[{type:"pie",innerSize:"0%",data:this.getDataFromModel(),size:"130%"}];return seriesConfig},getColors:function(){return[]},getTooltipConfig:function(){var tooltipConfig={enabled:false};return tooltipConfig},getDataFromModel:function(){var model=this.model.models[0];var topCount=Number(model.getTopCount());var flopCount=Number(model.getFlopCount());var equalCount=Number(model.getEqualCount());var data=[];if(topCount!==0){data.push({name:"",y:Number(topCount),color:this.colors.top})}if(flopCount!==0){data.push({name:"",y:Number(flopCount),color:this.colors.flop})}if(equalCount!==0){data.push({name:"",y:Number(equalCount),color:this.colors.equal})}this.updateLabels();return data},onUpdateData:function(data){var self=this;var serieData;_.each(data.V,function(item){self.model.models[0].setDescriptorValue(item.D,item.V)});serieData=this.getDataFromModel();this.chart.series[0].setData(serieData,true);this.updateLabels()},updateLabels:function(){var model=this.model.models[0];var topCount=Number(model.getTopCount());var flopCount=Number(model.getFlopCount());var equalCount=Number(model.getEqualCount());$("#txtTop").html(BANCOMER.CULTURETEXT.t("componentFootLegend_TopFlopPieChart_Top")+"<br>"+topCount);$("#txtFlop").html(BANCOMER.CULTURETEXT.t("componentFootLegend_TopFlopPieChart_Flop")+"<br>"+flopCount);$("#txtEqual").html(BANCOMER.CULTURETEXT.t("componentFootLegend_TopFlopPieChart_Equal")+"<br>"+equalCount)}});(function(){var callbacks={logout:function(){var buttons=[{text:"Aceptar",callback:function(){window.location.href="http://www.bancomer.com"}}];IFB.Utils.Helper.showNotificationWarning("warning",BANCOMER.CULTURETEXT.t("noty_Error_ServicesNetworkUnavailable"),true,buttons)}};IFB.Services.StreamingCallbacks.logout=function(){return BANCOMER.Services.StreamingCallbacks.logout()};BANCOMER.Services.StreamingCallbacks=callbacks})();
